/*! For license information please see 990.js.LICENSE.txt */
"use strict";(self.webpackChunk_reneos_slider_player_engine=self.webpackChunk_reneos_slider_player_engine||[]).push([[990],{614:(e,t,s)=>{s.r(t),s.d(t,{ActionsManager:()=>_,AssetsManager:()=>b,CssManager:()=>We,Factory:()=>h,MouseManager:()=>Me,Project:()=>V,SlidesManager:()=>Z,THREE:()=>a});var n=s(44),a=s.t(n,2);const i=class{constructor(){this._events={"*":[]}}subs(e,t,s){null==this._events[e]&&(this._events[e]=[]),this._events[e].push({handler:s,once:t})}on(e,t){this.subs(e,!1,t)}once(e,t){this.subs(e,!0,t)}off(e,t){const s=this._events[e];if(s){for(let e=s.length-1;e>=0;e--)s[e].handler===t&&s.splice(e,1);0===s.length&&delete this._events[e]}}clear(e){this._events[e]=[]}clearAll(){this._events={"*":[]}}emit(e,...t){const s=[];this._events[e]&&s.push(...this._events[e]),this._events["*"].length&&s.push(...this._events["*"].map(t=>({handler:t.handler.bind(this,e),once:t.once})));for(let e=s.length-1;e>=0;e--){const n=s[e];n.handler.apply(null,t),n.once&&s.splice(e,1)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}};function r(e){for(;e;){if(e.isElement)return e;e=e.parent}return null}function o(e,t){let s=1,n=e;for(;t.includes(n);)n=`${e}_${s}`,s++;return n}const c=class{#e;#t="";#s=!1;#n=!1;#a=!1;#i={};#r;constructor(e={}){this.#e=e.type,this.#t=e.label||"",this.#s=e.isModel||!1,this.#n=e.isAsset||!1,this.#a=e.isHelper||!1,this.#i=e.template,this.#r=e.module,this.create=e.create,this.decode=e.decode,this.encode=e.encode,this.verify=e.verify,this.add=e.add}get type(){return this.#e}get label(){return this.#t}get isModel(){return this.#s}get isAsset(){return this.#n}get isHelper(){return this.#a}get template(){return this.#i}get module(){return this.#r}decode(e){return null}encode(e){return{}}verify(e,t){return!0}check(e,t){return!0}};async function l(e){if(null===(t=e)||"object"!=typeof t&&"function"!=typeof t)return e;var t;if(Array.isArray(e))return Promise.all(e.map(e=>l(e)));if(e.uid&&d.instances.has(e.uid))return d.instances.get(e.uid);if(e.isAsset)return window.AssetsManager.GetResource(e.uid);const s=e.type;if(!s)return e;let n;Array.isArray(e.args)?n=await Promise.all(e.args.map(e=>l(e))):e.args&&(n=await Object.fromEntries(await Promise.all(Object.entries(e.args).map(async([e,t])=>[e,await l(t)]))));const i=n||[];let r,o,c=e.uid||`${s}_${Math.random().toString(36).slice(2,11)}`;d.typeRegistry.has(s)&&(o=d.typeRegistry.get(s),o.allow&&o.allow(e,i));try{r=o?.create?await o.create(i,e,c):o?.module?new o.module(...i,e):new a[s](...i)}catch(e){throw console.warn(`Error create object of type ${s}:`,e),new Error(`Error on create instance of ${s}`)}return r.uid=c,d.instances.set(r.uid,r),e.properties&&await Promise.all(Object.entries(e.properties).map(async([e,t])=>{r[e]=await l(t)})),r}class d{static instances=new Map;static typeRegistry=new Map;static emmiter=new i;static RemoveInstance(e){d.instances.has(e)&&d.instances.delete(e)}static AddInstance(e,t){console.log(t),console.log(e),e.uid=Math.random().toString(36).slice(2,11),e.name=o(e.type,Array.from(d.instances.values().map(e=>e.name))),e.isElement=!0,e.isModel=!0,e.states={},e.actions=[],e.blocked={},e.paths=t.paths?[...t.paths,e.uid]:[e.uid],e.path=e.paths.join(".");const s=d.typeRegistry.get(e.type);s&&s.verify&&s.verify(e,t);const n=d.typeRegistry.get(t.type);n&&n.verifyAdd&&n.verifyAdd(e,t),t.add(e),d.instances.set(e.uid,e),d.emmiter.emit("create",e)}static async BuildElement(e,t){const s=await l(e);s.isElement=!0,s.states=e.states||{},s.actions=e.actions||[],s.paths=t.paths?[...t.paths,s.uid]:[s.uid],s.path=s.paths.join("."),s.blocked={},s.name=e.name||o(s.type,Array.from(d.instances.values().map(e=>e.name)));const n=d.typeRegistry.get(e.type);n&&n.verify&&n.verify(s,t);const a=d.typeRegistry.get(t.type);return a&&a.check&&a.check(s,t),t.add(s),d.emmiter.emit("create",s),s}static CreateValue(e){return l(e)}static RegisterType(e){if(!e.type)throw new Error("RegisterType need type");d.typeRegistry.set(e.type,new c(e))}static createFromJSON(e){return l(e)}static exportToJSON(e){const t=function(e){let t={};e.args&&(t.args=e.args);const s=d.typeRegistry.get(e.type)||{};return s.encode&&(t={...t,...s.encode(e)}),e.encode&&(t={...t,...e.encode(e)}),t}(e);return t.uid=e.uid,t.states=e.states||{},t.actions=e.actions||[],t.name=e.name,t.paths=e.paths||[t.uid],t.path=t.paths.join("."),t.parent=e.parent?.uid,t}static GetTypes(){return Array.from(d.typeRegistry.values()).map(e=>({isModel:e.isModel,type:e.type,label:e.label}))}static GetType(e){return d.typeRegistry.get(e)}static findTypes(e){const t=e.toLowerCase();return d.GetTypes().filter(e=>e.type.toLowerCase().includes(t)||e.label.toLowerCase().includes(t))}static clearCache(){d.instances.clear()}static getCacheSize(){return d.instances.size}static GetInstance(e){return d.instances.get(e)}static GetInstances(){return Array.from(d.instances.values())}static isTypeRegistered(e){return d.typeRegistry.has(e)}static unRegisterType(e){d.typeRegistry.delete(e)}static getTypeConfig(e){return d.typeRegistry.get(e)}}const u=new Proxy(d,{get:(e,t)=>t in e?e[t]:u.emmiter[t]});window.Factory=u;const h=u,p=class extends i{constructor(e){super(),this.isAsset=!0,this.data=e,this._clones=[],this.promise=null,this.progress=0,this._resource=null}get url(){return this.data.url}get uid(){return this.data.uid}get type(){return this.data.type}get name(){return this.data.name}set name(e){this.data.name=e}get resource(){if(this.data.clone){console.log("CLONE");const e=this._resource.clone();return e.uid=`${this.uid}_${Date.now()}`,this._clones.push(e),e.traverse(e=>{e.visible=!0}),e}return this._resource}async getResource(){if(this.data.clone){const e=this._resource.clone();return e.uid=this.uid,e}return this._resource}get clone(){return this.data.clone}set clone(e){this.data.clone=e}async load(){}async update(e,t){console.log(e),this.data[e]=t,this.emit("update",this)}destroy(){this._clones.forEach(e=>{e.parent&&e.parent.remove(e)}),this.emit("destroy",this)}};var m=s(92);var g=s(449);const y=new Map,w={model:class extends p{constructor(e){super(e),this.uses={}}get shadow(){return this.data.shadow||{}}set shadow(e){this.data.shadow=e}_updateEnvMap(e){this.data.envMap=e?e.uid:null;const t=e?e.resource:null;for(let e=0;e<this._clones.length;e++)this._clones[e].traverse(e=>{e.isMesh&&(e.material.envMap=t)});this._resource.traverse(e=>{e.isMesh&&(e.material.envMap=t)}),this.emit("update")}async _setEnvMap(e,t=!1){if(console.log(e),t||!e||e!==this.data.envMap){const t=this.data.envMap;let s=this.uses[t];if(s&&(delete this.uses[t],s.off("destroy",this._updateEnvMap.bind(this,null)),s.off("update",this._updateEnvMap.bind(this))),delete this.data.envMap,s=null,e){const t=this.data.envMap=e;if(s=this.uses[t]=await b.FindAsset(t),!s)return;s.on("destroy",this._updateEnvMap.bind(this,null)),s.on("update",this._updateEnvMap.bind(this))}this._updateEnvMap(s)}}async load(){const e=await b.Load(this,{type:"arrayBuffer"}),t=new m.B;t.setResourcePath(this.url.replace(/[^/]*$/,"")),await new Promise(s=>{t.parse(e,null,async e=>{this._resource=e.scene.children.length>1?e.scene:e.scene.children[0],this._resource.uid=this.uid,this.data.position&&this._resource.position.copy(this.data.position),this.data.rotation&&this._resource.rotation.set(this.data.rotation.x,this.data.rotation.y,this.data.rotation.z,"XYZ"),this.data.scale&&this._resource.scale.copy(this.data.scale),await this._setEnvMap(this.data.envMap,!0),this._resource.traverse(e=>{e.isMesh&&(e.castShadow=this.data.shadow?.cast||!1,e.receiveShadow=this.data.shadow?.receive||!1,e.geometry.computeBoundingBox())}),this.emit("change",this),s()},e=>{console.warn(e)})})}async update(e,t){switch(console.log(`Update ${e}`),e){case"url":await this.load();break;case"envMap":await this._setEnvMap(t);break;default:this._resource.traverse(e=>{e.isMesh&&(e.castShadow=this.data.shadow?.cast||!1,e.receiveShadow=this.data.shadow?.receive||!1)})}super.update(e,t)}setTo(e){e.isObject3D&&e.add(this.resource)}},image:class extends p{constructor(e){super(e),this.uses={}}getTypes(){return[...super.getTypes(),"image"]}get name(){return this.data.name||this.uid}set name(e){this.data.name=e}async load(){console.log("load texture");const e=await b.Load(this,{type:"blob"}),t=await createImageBitmap(e),s=new n.CanvasTexture(t);s.colorSpace=n.SRGBColorSpace,s.encoding=n.sRGBEncoding,s.flipY=!0,s.flipX=!0,this._resource=s,this._resource.uid=this.uid,console.log(this._resource)}async update(e,t){"url"===e&&await this.load(),super.update(e,t)}},hdr:class extends p{constructor(e){return super(e),this.uses={},new Proxy(this,{get:(e,t)=>t in e?e[t]:e.data[t]})}load(){return new Promise(e=>{(new g.Y).load(this.data.url,t=>{t.mapping=n.EquirectangularReflectionMapping,this._resource=t,this._resource.asset=this,this._resource.uid=this.uid,this.emit("update",this),e()})})}async update(e,t,s){if(this.data[t]=e[t],"url"===t)return this.load(s)}}};let f=async(e,t={type:"text"})=>{const s=await fetch(e.url);return await s[t.type]()};class v{static get Assets(){return y}static SetLoader(e){f=e}static async*Init(e,t={}){let s=0;const n=e.length,a=[];for(e.map(e=>v.Add(e)).forEach(e=>{e.load().then(()=>{s++,a.push(s/n)})});s<n;){for(;0===a.length;)await new Promise(e=>setTimeout(e,50));yield a.shift()}return"done"}static GetAsset(e){return y.get(e)}static GetAssets(e){const t=new Set(e);return[...y.values()].filter(e=>t.has(e.uid))}static GetResource(e){const t=y.get(e);if(t)return t._resource?t.resource:(t.promise||(t.promise=new Promise(async e=>{await t.load(),e(t.resource)})),t.promise)}static FindAsset(e){const t=y.get(e);if(t)return t.resource?t:(t.promise||(t.promise=new Promise(async e=>{await t.load(),e(t)})),t.promise)}static async SetAssetTo(e,t){y.get(t.uid).setTo(e)}static Load(e,t){return f(e,t)}static Add(e){const t=new(0,w[e.type])(e);return y.set(t.uid,t),t}static async Update(e,t,s){const n=y.get(e.uid);if(n)try{await n.update(t,s)}catch(e){console.warn(e)}}static Remove(e){y.has(e)&&(y.get(e).destroy(),y.delete(e))}}window.AssetsManager=v;const b=v,x={},M=[];function S(e,t,s=!1){try{const{handler:n,...a}=M.find(t=>t.uid===e.uid);if(a.single&&e.stop)return;e.stop=n(a,t,e,s)}catch(e){console.warn(e)}}function E(e,t){const s=[];for(const n of e)s.push(S(n,t));return Promise.allSettled(s)}const C=new i;class A{static Force=!1;static get Actions(){return M}static get Handlers(){return x}static FindHandler(e){return x[e]}static RegisterHandler(e,t){x[e]=t,M.forEach(t=>{t.type===e&&(t.handler=x[t.type])}),C.emit("register",e)}static Init(e){for(let t=0;t<e.length;t++)A.Add(e[t])}static Add(e){e.type in x&&(e.handler=x[e.type]),M.push(e),C.emit("add",e)}static Remove(e){const t=M.findIndex(t=>t.uid===e);if(t>=0){const e=M.splice(t,1),s=e[0];console.log(s),C.emit("remove",e)}}static Stop(e){for(let t=0;t<e.length;t++){const s=e[t];s.stop&&(s.stop(),s.stop=null)}}static Call(e,t,s=!1){return S(e,t,s)}static async Run(e=[],t,s){const n=e.filter(e=>e.hook===s);0!==n.length&&await E(n,t,A.Force)}static async Execute(e,t){const s=[];for(let n=0;n<e.length;n++){const a=e[n],i=a.actions?a.actions.filter(e=>e.hook===t):[];try{const e=a.model.actions?a.model.actions.filter(e=>e.hook===t):[];(i.length>0||e.length>0)&&s.push(E([...i,...e],a,A.Force))}catch(e){console.warn("Error execute action")}}await Promise.all(s)}}const _=new Proxy(A,{get:(e,t)=>t in e?e[t]:C[t]});var k=s(24);let R,P;const T=class{static MoveTo(e,t){const s={position:new n.Vector3,time:1e3,...e,control:!1},a={position:new n.Vector3,time:1e3,...t,control:!1};R.enabled=!1;const i=Workspace.Camera.position.clone(),r=R.target.clone();s.control=s.time>a.time,a.control=a.time>=s.time;const o=new Tween(i).to(s.position,s.time).easing(Easing.Quadratic.InOut).onUpdate(()=>{Workspace.Camera.position.copy(i),Workspace.Camera.updateProjectionMatrix(),R.update()}).onComplete(()=>{s.control&&(R.enabled=!0),tweengroup.remove(o)}).start(),c=new Tween(r).to(a.position,a.time).easing(Easing.Quadratic.InOut).onUpdate(()=>{R.target.copy(r),R.getPolarAngle()>R.maxPolarAngle&&R.target.setY(center.y+Math.cos(R.maxPolarAngle)*distance)}).onComplete(()=>{a.control&&(R.enabled=!0),tweengroup.remove(c)}).start();tweengroup.add(o,c)}static SetState(e){R.enabled=e}static Target(e){R.target.copy(e)}static Init({canvas:e},t,s){R&&s.remove(R),R=new k.N(t,e),R.enabled=!0,R.enableDamping=!0,R.dampingFactor=.25,R.screenSpacePanning=!1,R.minDistance=.01,R.maxDistance=500}static ChangeCamera(e){R.object=e}static get Transformer(){return P}static Select(e){e?P.attach(e):P.detach()}static Update(e){R.update(e)}static FitTo({center:e,radius:t}){const s=n.MathUtils.degToRad(Workspace.Camera.fov),a=t/Math.sin(s/2),i=(new n.Vector3).subVectors(Workspace.Camera.position,e).normalize(),r=e.clone().add(i.multiplyScalar(a)),o=Workspace.Camera.position.clone();R.enabled=!1;const c=R.target.clone(),l=new Tween(c).to(e,1e3).easing(Easing.Quadratic.InOut).onUpdate(()=>{R.target.copy(c),R.getPolarAngle()>R.maxPolarAngle&&R.target.setY(e.y+Math.cos(R.maxPolarAngle)*distance)}).start(),d=new Tween(o).to(r,1e3).easing(Easing.Quadratic.InOut).onUpdate(()=>{Workspace.Camera.position.copy(o);const t=Workspace.Camera.position.distanceTo(e);t<R.minDistance?Workspace.Camera.position.copy(e.clone().add(i.clone().multiplyScalar(R.minDistance))):t>R.maxDistance&&Workspace.Camera.position.copy(e.clone().add(i.clone().multiplyScalar(R.maxDistance))),Workspace.Camera.updateProjectionMatrix(),R.update()}).onComplete(()=>{R.enabled=!0,tweengroup.remove(d,l)}).start();tweengroup.add(d,l)}};let W,I,j,F,O,H,U,G=[];const L=new i;function $(e){for(let t=0;t<G.length;t++)G[t](e);F.render(j,H)}class z{static get Root(){return O}static get Scene(){return j}static get Camera(){return H}static get Canvas(){return W}static get Renderer(){return F}static Init(e){W=e,I=new n.Clock,j=new n.Scene,F=new n.WebGLRenderer({canvas:e,alpha:!0,powerPreference:"high-performance",antialias:!0,stencil:!1});const t=W.clientWidth,s=W.clientHeight;F.setSize(t,s,!1),F.setPixelRatio(window.devicePixelRatio),F.shadowMap.enabled=!0,F.shadowMap.type=n.PCFSoftShadowMap,O=new n.Object3D,j.add(O),U=O.position.clone()}static async Start(){H=new n.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.01,1e3),H.uid="EditorCamera",j.add(H),H.position.set(0,10,20),F.setAnimationLoop($),H.layers.enable(1),Me.Init(F.domElement,H,j,O),Me.on("click",e=>{_.Run([...e.actions,...e.state?.actions||[]],e,"mouse.click")}),Me.on("mouse.in",e=>{_.Run([...e.actions,...e.state?.actions||[]],e,"mouse.in")}),Me.on("mouse.out",e=>{_.Run([...e.actions,...e.state?.actions||[]],e,"mouse.out")}),G.push(Me.Update)}static AddToUpdate(e){G.push(e)}static RemoveFromUpdate(e){const t=G.indexOf(e);t>=0&&G.splice(t,1)}static Collect(e,t,s=[]){for(let n=0;n<e.length;n++){const a=e[n];a.isElement&&a.states[t]&&s.push(a),a.children.length&&z.Collect(a.children,t,s)}}static FindStates(e){const t=[];return z.Collect(O.children,e,t),t}static Find(e){console.log(e);let t=O;for(let s=0;s<e.length;s++)t=t.children.find(t=>t.uid===e[s]);return t}static SetCamera(e){H.visible=!1,H=e,H.aspect=window.innerWidth/window.innerHeight,H.updateProjectionMatrix(),H.visible=!0,Me.SetCamera(H)}static async Builds(e){await h.BuildElements(e,O),O.children.push(...O.children),console.log(O)}static FindBlock(e){return O.children.find(t=>t.uid===e)}static FindElement(e){let t=O.children.find(t=>t.uid===e[0]);for(let s=1;s<e.length;s++)t=t.children.find(t=>t.uid===e[s]);return t}static async SetAsset(e,t){const s=await b.GetAsset({uid:t.uid}),n=e.split(".");let a=O.children.find(e=>e.uid===n[0]);for(let e=1;e<n.length;e++)a=a.children.find(t=>t.uid===n[e]);a.addAsset(t,s)}static RemoveAsset(e,t){const s=e.split(".");let n=O.children.find(e=>e.uid===s[0]);for(let e=1;e<s.length;e++)n=n.children.find(t=>t.uid===s[e]);n.removeAsset(t)}static RemoveElement(e){const t=e.split(".");let s=O.children;for(let e=0;e<t.length-1;e++){const n=s.find(s=>s.uid===t[e]);s=n.children}const n=s.findIndex(t=>t.path===e);if(n>=0){const e=s.splice(n,1);e[0].parent.remove(e[0])}}}const D=new Proxy(z,{get:(e,t)=>t in e?e[t]:L[t]});window.Project=D;const V=D,B=[],Y=[];let X,N=!1;const q=new i;class Q{static get Processed(){return N}static get Current(){return X}static AddSlides(e){for(let t=0;t<e.length;t++){const s=e[t],n={name:"",children:[],camera:{},scene:{},actions:[],index:t,background:null,environment:{},...s};s.background&&(n.background=new J(s.background));const a=V.FindStates(n.uid);for(let e=0;e<a.length;e++){const t=a[e];n.children.push({model:t,...t.states[n.uid]})}B.push(n)}return B.sort((e,t)=>e.index-t.index),q.emit("add",B),B}static async GoTo(e){const t="number"==typeof e?B[e]:B.find(t=>t.uid===e);t&&X?.uid!==t.uid&&(Y[Y.length-1]!==t.uid&&Y.push(t.uid),await Q.Activate(t,X))}static async GoToNext(){const e=X||B[0],t=B.findIndex(t=>t===e);await Q.GoTo(t+1)}static async GoToBack(){Y.pop(),await Q.GoTo(Y[Y.length-1])}static async Activate(e,t){N||(N=!0,t&&await Q.SlideOut(t,e.children),X=e,q.emit("activate",e,t),await Q.SlideIn(e,t),q.emit("change",e,t),N=!1)}static async SlideIn(e,t={}){const s=t.children||[],n=[],a=[],i=[];for(let t=0;t<e.children.length;t++){const a=e.children[t];s.findIndex(e=>e.model.uid===a.model.uid)>=0?i.push(a):n.push(a),a.model.state=a}for(let t=0;t<s.length;t++){const n=s[t];e.children.findIndex(e=>e.model.uid===n.model.uid)<0&&a.push(n)}try{if(e.camera?.path&&e.camera?.path!==V.Camera?.path){const t=e.camera.path.split("."),s=V.Find(t);V.SetCamera(s),s.updateProjectionMatrix()}}catch(e){console.warn(e.message)}if(e.background)try{switch(e.background.type){default:V.Scene.background=e.background[e.background.type];break;case"cube":case"texture":V.Scene.background=e.background.value}}catch(e){console.warn(e.message)}const r=[...n,...i];await Promise.all([_.Execute(r,"slide.in.before")]),await _.Execute(n.map(e=>e.model),"enable.on"),_.Execute(r,"slide.in");const o=r.map(t=>Q.ActivateState(t,e.uid));await Promise.all(o),await Promise.all([_.Execute(r,"slide.in.after")])}static async ActivateState(e,t){const{actions:s=[],position:n,rotation:a,scale:i,model:r,visible:o=!1,...c}=e;console.log(e),r.state=e,!n||r.blocked?.position&&0!==r.blocked?.position?.size||r.position.copy(n),!a||r.blocked?.rotation&&0!==r.blocked?.rotation?.size||r.rotation.setFromVector3(a,"XYZ"),!i||r.blocked?.scale&&0!==r.blocked?.scale?.size||r.scale.copy(i);const l=Object.keys(c);for(let e=0;e<l.length;e++){const t=l[e],s=t.split("."),n=c[t];let a=s[0],i=r;for(let e=0;e<s.length-1;e++)i=i[s[e]],a=s[e+1];const o=await h.CreateValue(n);r.blocked?.[a]||(i[a]=o)}r.visible=o}static async SlideOut(e,t){const s=[],n=[];for(let a=0;a<e.children.length;a++){const i=e.children[a],r=t.find(e=>e.model.uid===i.model.uid);r&&!1!==r.visible?s.push(i):n.push(i)}const a=[...n,...s];await Promise.all([_.Execute(a,"slide.out")]),await _.Execute(n,"disable.on");for(let e=0;e<a.length;e++)Q.DectivateState(a[e])}static DectivateState(e){const{actions:t=[],model:s}=e;_.Stop(t,e)}}class J{constructor(e){this.type=e.type,this.value=e.value,this.setValue(this.type,this.value)}exportValue(){return{type:this.type,value:this.value}}async setValue(e,t){"hdr"===e?this.hdr=await b.FindAsset(t):this.color=new n.Color(t)}}window.SlidesManager=new Proxy(Q,{get:(e,t)=>t in e?e[t]:q[t]});const Z=window.SlidesManager,K=new n.Raycaster,ee=new i;let te,se,ne,ae,ie=0,re=0;const oe={x:0,y:0};let ce,le=!1,de=0,ue=null,he=!1,pe=.03,me=.03,ge=.01,ye=.01,we=window.innerWidth/2,fe=window.innerHeight/2;function ve(e){if(le&&(ie=(e.clientX-we)*ge,re=(e.clientY-fe)*ye,Date.now()-de>50)){de=Date.now();const t=e.target.getBoundingClientRect(),s=new n.Vector2((e.clientX-t.left)/t.width*2-1,-(e.clientY-t.top)/t.height*2+1);K.setFromCamera(s,se);const a=K.intersectObjects(te.children,!0);let i=null;if(a.length>0)for(let e=0;e<a.length;e++){const t=r(a[e].object);if(t&&t.visible){i=t;break}}if(he){if(!ue||i&&i===ue){if(i===ue)return}else if(ee.emit("mouse.out",ue),ue=null,he=!1,i)return ue=i,ee.emit("mouse.in",ue),void(he=!0)}else i&&(ue=i,ee.emit("mouse.in",ue),he=!0)}}function be(e){oe.x=e.clientX,oe.y=e.clientY,ce=Date.now()}function xe(e){if(!le||Z.Processed)return;if(Math.abs(oe.x-e.clientX)>10||Math.abs(oe.y-e.clientY)>10||Date.now()-ce>500)return;const t=e.clientX/window.innerWidth,s=-e.clientY/window.innerHeight,a=new n.Vector2;a.x=2*t-1,a.y=2*s+1,K.setFromCamera(a,se);const i=K.intersectObjects(te.children,!0);if(0===i.length)return;const o=[];for(let e=0;e<i.length;e++){const t=r(i[e].object);if(t.visible&&!o.includes(t))return o.push(t),void ee.emit("click",t)}}const Me=new Proxy(class{static get Control(){return T}static Init(e,t,s,n,a){const i={camera:{range:{x:.01,y:.01},movespeed:{x:.03,y:.03}},...a};te=n,ne=s,se=t,ae=e,pe=i.camera.movespeed.x,me=i.camera.movespeed.y,ge=i.camera.range.x,ye=i.camera.range.y,we=window.innerWidth/2,fe=window.innerHeight/2,e.addEventListener("click",xe.bind(null)),e.addEventListener("mousemove",ve,!1),e.addEventListener("mousedown",be,!1),le=!0}static Update(e){}static SetCamera(e){se=e}},{get:(e,t)=>t in e?e[t]:ee[t]});let Se;const Ee=new i;class Ce{static Init(e,t){Se=new Te({element:e}),Se.setSize(window.innerWidth,window.innerHeight),Se.elements.length=0;const s=t.clientWidth,n=t.clientHeight,a=s/Se.domElement.offsetWidth,i=n/Se.domElement.offsetHeight;Se.domElement.style.transform=`scale(${a}, ${i})`,window.addEventListener("resize",()=>{}),V.AddToUpdate(Ce.Render)}static Render(){Se.render(V.Scene,V.Camera)}static async OnRemove(e,t){e.isUIElement&&(await t.removeElement(e.element),Se.elements.remove(e))}static async OnCreate(e,t){if(e.isUIElement){e.on("clicked",t=>{console.log(t),console.log("CLICK"),_.Run([...e.actions||[],...e.states[Z.Current.uid]?.actions||[]],e,"mouse.click")});try{const s=await t.addElement(e.data.element.component||"UILabel",{data:{...e.data.element,path:e.path},events:e.data.events||{}});e.setElement(s.data,s.element),console.log(s,e)}catch(e){return}Se.elements.push(e)}}static UpdateSize(e){Se.setSize(window.innerWidth,window.innerHeight);const t=e.width,s=e.height,n=t/Se.domElement.offsetWidth,a=s/Se.domElement.offsetHeight;Se.domElement.style.transform=`scale(${n}, ${a})`}}const Ae=new n.Vector3,_e=new n.Matrix4,ke=new n.Matrix4,Re=new n.Vector3,Pe=new n.Vector3;class Te{constructor(e={}){const t=this;let s,n,a,i;const r={objects:new WeakMap},o=void 0!==e.element?e.element:document.createElement("div");function c(e,s,n){Ae.setFromMatrixPosition(e.matrixWorld),Ae.applyMatrix4(ke);const c=Ae.z>=-1&&Ae.z<=1&&!0===e.layers.test(n.layers),l=e.element;!0===c&&(e.onBeforeRender(t,s,n),l.style.transform=`translate(${-100*e.center.x}%, ${-100*e.center.y}%) translate(${Ae.x*a+a}px, ${-Ae.y*i+i}px)`,l.parentNode!==o&&o.appendChild(l),e.onAfterRender(t,s,n));const d={distanceToCameraSquared:(u=n,h=e,Re.setFromMatrixPosition(u.matrixWorld),Pe.setFromMatrixPosition(h.matrixWorld),Re.distanceToSquared(Pe))};var u,h;r.objects.set(e,d);for(let t=0,s=e.children.length;t<s;t++);}o.style.overflow="hidden",this.domElement=o,this.elements=[],this.getSize=function(){return{width:s,height:n}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),_e.copy(t.matrixWorldInverse),ke.multiplyMatrices(t.projectionMatrix,_e);for(let s=0;s<this.elements.length;s++)c(this.elements[s],e,t);!function(e){const t=function(e){const t=[];for(let s=e.length-1;s>=0;s--)e[s].traverseVisible(function(e){e.isCSS2DObject&&t.push(e)});return t}(e).sort(function(e,t){return e.renderOrder!==t.renderOrder?t.renderOrder-e.renderOrder:r.objects.get(e).distanceToCameraSquared-r.objects.get(t).distanceToCameraSquared}),s=t.length;for(let e=0,n=t.length;e<n;e++)t[e].element.style.zIndex=s-e}(this.elements)},this.setSize=function(e,t){s=e,n=t,a=s/2,i=n/2,o.style.width=e+"px",o.style.height=t+"px"}}}const We=new Proxy(Ce,{get:(e,t)=>t in e?e[t]:Ee[t]})}}]);