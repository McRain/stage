"use strict";(self.webpackChunk_reneos_3d_mods_tools=self.webpackChunk_reneos_3d_mods_tools||[]).push([[993],{870:(e,t,n)=>{var o={};n.r(o),n.d(o,{BackSlide:()=>u,CallFunction:()=>w,CamMover:()=>P,CubeTexture:()=>L,GoTo:()=>d,NextSlide:()=>h,UrlOpen:()=>U,VisibleSet:()=>_});var i=n(320),a=n(372);async function s(e,t,n){return/Mobi|Android/i.test(navigator.userAgent)?async function(e,t){t.getContext("2d").drawImage(document.documentElement,0,0,t.width,t.height);const n=t.toDataURL("image/png"),o=document.createElement("a");o.href=n,o.download=`${e}.png`,o.click()}(e,t):async function(e,t={}){try{const n=(await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"tabs"},audio:!1,selfBrowserSurface:"include",surfaceSwitching:"exclude",...t})).getVideoTracks()[0];let o=new ImageCapture(n);const i=await o.grabFrame(),a=document.createElement("canvas");a.width=i.width,a.height=i.height,a.getContext("2d").drawImage(i,0,0);const s=a.toDataURL("image/png"),c=document.createElement("a");c.href=s,c.download=`${e}.png`,c.click()}catch(e){console.warn(e)}}(e,n)}async function c(e="presentation"){const t=window.screen.width*window.devicePixelRatio,n=window.screen.height*window.devicePixelRatio,o=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"browser",width:{max:t},height:{max:n},frameRate:{ideal:30,max:60},cursor:"always",resizeMode:"crop-and-scale"},audio:!1,preferCurrentTab:!1,selfBrowserSurface:"include",surfaceSwitching:"exclude"}),i=document.createElement("video");i.height=window.height,i.width=window.width,i.srcObject=o;const a={mimeType:"video/webm; codecs=vp9",videoBitsPerSecond:8e6,bitsPerSecond:51e4};MediaRecorder.isTypeSupported(a.mimeType)||(a.mimeType="video/webm",a.videoBitsPerSecond=3e6);const s=new MediaRecorder(o,a),c=[];s.ondataavailable=e=>{e.data.size>0&&c.push(e.data)},s.onerror=e=>{console.warn(e.message)},s.onstop=()=>{const t=new Blob(c,{type:a.mimeType.includes("mp4")?"video/mp4":"video/webm"});o.getVideoTracks()[0].stop();const n=`${e}.${a.mimeType.includes("mp4")?"mp4":"webm"}`;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,n);else{const e=window.document.createElement("a");e.href=window.URL.createObjectURL(t),e.download=n,e.style="display: none",e.click()}},s.start(1e3)}function r(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}const l=i.default||i;function d(e,t,n=!1){if(console.log(t),n);else{let t=e.delay||0;setTimeout(()=>{l.engine.SlidesManager.GoTo(e.slide)},t)}}const m=i.default||i;function u(e,t,n){m.engine.getManager("SlidesManager").GoToBack()}const p=i.default||i;function h(e,t,n){if(n)return;let o=e.delay||0;setTimeout(()=>{p.engine.SlidesManager.GoToNext()},o)}function w(e,t,n=!1){const o=e.target?e.target.split("."):"",i=window.Project.FindElement(o)||t.model;if(i){const t=e.arg,n=i[e.method];try{n.apply(i,[t])}catch(e){console.warn(e)}}}var g=n(783);let y,f,v,b,S={camera:{range:{x:.015,y:.01},movespeed:{x:.03,y:.03},offset:{x:0,y:4,z:0}}},C=0,x=0,k=.03,A=.03,E=.001,M=.001;function T(e){const t=window.Project.Canvas.getBoundingClientRect(),n=e.clientX-t.left,o=e.clientY-t.top,i=t.width/2,a=t.height/2;C=(n-i)*E,x=-(o-a)*M}function R(){const e=v.x+C,t=v.y+x;f.position.x+=(e-f.position.x)*k,f.position.y+=(t-f.position.y)*A;const n=b.position.clone().add(S.camera.offset);y.lerp(n,.03),f.lookAt(y)}function P(e,t,n=!1,o){f=window.Project.Camera,f.mover?"slide.out"===e.hook&&(window.Project.RemoveFromUpdate(R),f.mover=!1):(f.mover=!0,v=f.position.clone(),b=window.Project.Root,y=new g.Vector3,f.setlook=e=>{b=window.Project.FindElement(e.split("."))},k=S.camera.movespeed.x,A=S.camera.movespeed.y,E=S.camera.range.x,M=S.camera.range.y,window.Project.Canvas.addEventListener("mousemove",T,!1),window.Project.AddToUpdate(R))}function U(e,t,n=!1){window.open(e.url,e.target||" _blank")}function _(e,t,n=!1){let o=t.model;if(e.paths)for(let t=0;t<e.paths.length;t++)o=o[e.paths[t]];if(e.target)for(let t=0;t<e.target.length;t++)o=o.children.find(n=>n.uid===e.target[t]);o.visible=e.value,o.traverse(t=>{t.isObject3D&&(t.visible=e.value)})}window.innerWidth,window.innerHeight;var j=n(487);function L(e,t,n=!1){return console.log("CUBE"),new Promise((e,t)=>{(new j.H).load("https://s3.eu-west-1.amazonaws.com/3dbuilder.reneos.com/hdr/Nebula_03_Cubemap.exr",t=>{t.mapping=g.EquirectangularReflectionMapping,window.Project.Scene.background=t,e(t)},void 0,t)})}function B(){return class extends g.Group{constructor(e){super(),this.type="planeimg",this.data={...e},this.geometry=new g.PlaneGeometry(1,1),this.material=new g.MeshBasicMaterial({toneMapped:!1,side:g.DoubleSide,transparent:!0,opacity:1}),this.mesh=new g.Mesh(this.geometry,this.material),this.data.image&&this.load(),this.add(this.mesh)}async load(){console.log("load");const e=await App.engine.AssetsManager.GetResource(this.data.image);console.log(e)}get url(){return this.data.url}set url(e){this.data.url=e,this.data.url&&this.load()}get opacity(){return this.material.opacity}set opacity(e){this.material.opacity=e,this.material.needsUpdate=!0}get image(){return this.material.map}set image(e){this.material.map=e,this.material.needsUpdate=!0}get color(){return this.material.color}set color(e){this.material.color.copy(e),this.data.color=this.material.color.getHex()}get outlinecolor(){return this._outcolor}set outlinecolor(e){this._outcolor.copy(e),this._text.outlineColor=this._outcolor.getHex()}getTypes(){return[...super.getTypes(),this.type]}}}function F(){return class extends g.Object3D{constructor(e){super(),this._url=e.url,this.type="AudioPlayer",this.audio=new Audio;const t=new SpeechSynthesisUtterance;t.text="Привет, это синтез речи в браузере",t.lang="ru-RU",t.rate=1,t.pitch=1,t.volume=1,window.speechSynthesis.onvoiceschanged=function(){const e=window.speechSynthesis.getVoices();console.log("Доступные голоса:"),e.forEach(e=>{if((e.lang.includes("ru")||e.lang.includes("RU"))&&e.name.includes("Google")){console.log(`${e.name} (${e.lang}) - ${e.localService?"Локальный":"Удаленный"}`);const t=new SpeechSynthesisUtterance("Со́лнечная систе́ма — планетная система, включающая в себя центральную звезду Солнце и все естественные космические объекты на гелиоцентрических орбитах. Она сформировалась путём гравитационного сжатия газопылевого облака примерно 4,57 млрд лет назад");t.voice=e,t.rate=1,t.pitch=.75}})}}getTypes(){return[...super.getTypes(),this.type]}get url(){return this._url}set url(e){console.log(e),this._url=e,this.audio.src=e}async play(){try{return await this.audio.play(),this.audio.addEventListener("ended",()=>{console.log("ended")}),void this.audio.addEventListener("error",e=>{console.warn("Ошибка аудио:",e)})}catch(e){if("NotAllowedError"!==e?.name&&!/user gesture|user interaction/i.test(e?.message||""))return void console.error("Ошибка аудио:",e)}const e=()=>{["click","keydown","touchstart"].forEach(t=>document.removeEventListener(t,e)),this.audio.muted=!1,this.play()};["click","keydown","touchstart"].forEach(t=>document.addEventListener(t,e,{once:!0,passive:!0}))}}}const O=i.default||i;function G(){const e=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(818).then(n.t.bind(n,437,19));return e.default||e});if(window.vue.component("LoaderScreen",e),console.log("Set LoaderScreen"),Object.keys(o).forEach(e=>{O.engine.ActionsManager.RegisterAction(e,o[e])}),O.engine.Factory.RegisterElement("planeimg",B,{label:"Plane Image"}),O.engine.Factory.RegisterElement("AudioPlayer",F,{label:"Audio Player"}),!window.isEditor)return void O.menu.tools.list.unshift({icon:"camera",tooltip:"Screenshot",handler:s},{icon:"film",tooltip:"Video capture",handler:c},{icon:"enlarge",tooltip:"Screen switch",handler:r});O.inspector.addToModels(["planeimg"],[{label:"URL",content:{prop:"url",component:"LabelEdit"}},{label:"Color",head:{component:"EditColor",prop:"color",state:!0}},{label:"Opacity",head:{component:"Float",prop:"opacity",step:.01,min:0,max:1,state:!0}},{label:"Image",content:{prop:"image",component:"AssetImage",onclean(e,t,n,o){e.image=null,delete e.properties.image,O.project.save(e)},events:{select:async e=>{const t=await O.assets.selectAsset("image");if(!t)return e.image=null,void delete e.properties.image;await O.engine.AssetsManager.SetResourceTo(e,"image",t.uid),e.properties.image={asset:t.uid},O.project.save(e)}}}}]),O.inspector.addToModels(["circularimgs"],[]),O.inspector.addToModels(["AudioPlayer"],[{label:"URL",content:{prop:"url",component:"LabelEdit",state:!0}},{label:"Audio Control",readonly:!0,content:{prop:"audio",component:"AudioControl"}}]);const t=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(970).then(n.bind(n,970));return e.default||e});window.vue.component("CallFunction",t),O.actions.register({component:"CallFunction",type:"base",name:"Call function",template:{name:"new CallFunction",slide:0},check:async()=>!0});const i=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(423).then(n.bind(n,423));return e.default||e});window.vue.component("GoTo",i),O.actions.register({component:"GoTo",type:"base",name:"Slide switch",template:{name:"new GoTo",slide:0},check:async()=>!0});const l=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(609).then(n.bind(n,609));return e.default||e});window.vue.component("BackSlide",l),O.actions.register({component:"BackSlide",type:"base",name:"Switch to back",template:{name:"BackSlide"},check:async()=>!0});const d=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(684).then(n.bind(n,684));return e.default||e});window.vue.component("NextSlide",d),O.actions.register({component:"NextSlide",type:"base",name:"Slide to next",template:{name:"NextSlide"},check:async()=>!0});const m=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(680).then(n.bind(n,680));return e.default||e});window.vue.component("CamMover",m),O.actions.register({component:"CamMover",type:"base",name:"Move Camera",description:"Move camera when mouse moves. Applies to slide only",template:{name:"new CamMover"},check:async()=>!0});const u=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(920).then(n.bind(n,920));return e.default||e});window.vue.component("VisibleSet",u),O.actions.register({component:"VisibleSet",type:"base",name:"Set model visible",template:{name:"new VisibleSet",slide:0},check:async()=>!0});const p=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(459).then(n.bind(n,459));return e.default||e});window.vue.component("UrlOpen",p),O.actions.register({component:"UrlOpen",type:"base",name:"Open URL",description:"",template:{name:"UrlOpen"},check:async()=>!0}),O.menu.tools.list.unshift({icon:"camera",tooltip:"Screenshot",handler:s},{icon:"film",tooltip:"Capture video",handler:c},{icon:"enlarge",tooltip:"Screen switch",handler:r})}O.engine.ready?G():O.engine.onInit(G),console.log("Modul")}}]);