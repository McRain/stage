"use strict";(self.webpackChunk_reneos_slider_mods_tools=self.webpackChunk_reneos_slider_mods_tools||[]).push([[993],{870:(e,t,n)=>{var o={};n.r(o),n.d(o,{BackSlide:()=>u,CallFunction:()=>g,CamMover:()=>P,CubeTexture:()=>B,GoTo:()=>d,NextSlide:()=>h,UrlOpen:()=>U,VisibleSet:()=>j});var i=n(333),a=n(66);async function s(e,t,n){return/Mobi|Android/i.test(navigator.userAgent)?async function(e,t){t.getContext("2d").drawImage(document.documentElement,0,0,t.width,t.height);const n=t.toDataURL("image/png"),o=document.createElement("a");o.href=n,o.download=`${e}.png`,o.click()}(e,t):async function(e,t={}){try{const n=(await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"tabs"},audio:!1,selfBrowserSurface:"include",surfaceSwitching:"exclude",...t})).getVideoTracks()[0];let o=new ImageCapture(n);const i=await o.grabFrame(),a=document.createElement("canvas");a.width=i.width,a.height=i.height,a.getContext("2d").drawImage(i,0,0);const s=a.toDataURL("image/png"),r=document.createElement("a");r.href=s,r.download=`${e}.png`,r.click()}catch(e){console.warn(e)}}(e,n)}async function r(e="presentation"){const t=window.screen.width*window.devicePixelRatio,n=window.screen.height*window.devicePixelRatio,o=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"browser",width:{max:t},height:{max:n},frameRate:{ideal:30,max:60},cursor:"always",resizeMode:"crop-and-scale"},audio:!1,preferCurrentTab:!1,selfBrowserSurface:"include",surfaceSwitching:"exclude"}),i=document.createElement("video");i.height=window.height,i.width=window.width,i.srcObject=o;const a={mimeType:"video/webm; codecs=vp9",videoBitsPerSecond:8e6,bitsPerSecond:51e4};MediaRecorder.isTypeSupported(a.mimeType)||(a.mimeType="video/webm",a.videoBitsPerSecond=3e6);const s=new MediaRecorder(o,a),r=[];s.ondataavailable=e=>{e.data.size>0&&r.push(e.data)},s.onerror=e=>{console.warn(e.message)},s.onstop=()=>{const t=new Blob(r,{type:a.mimeType.includes("mp4")?"video/mp4":"video/webm"});o.getVideoTracks()[0].stop();const n=`${e}.${a.mimeType.includes("mp4")?"mp4":"webm"}`;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,n);else{const e=window.document.createElement("a");e.href=window.URL.createObjectURL(t),e.download=n,e.style="display: none",e.click()}},s.start(1e3)}function c(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}const l=i.default||i;function d(e,t,n=!1){if(console.log(t),n);else{let t=e.delay||0;setTimeout(()=>{l.engine.SlidesManager.GoTo(e.slide)},t)}}const m=i.default||i;function u(e,t,n){m.engine.getManager("SlidesManager").GoToBack()}const p=i.default||i;function h(e,t,n){if(n)return;let o=e.delay||0;setTimeout(()=>{(window.isEditor?p.slides:p.engine.SlidesManager).GoToNext()},o)}function g(e,t,n=!1){const o=e.target?e.target.split("."):"",i=window.Project.FindElement(o)||t.model;if(i){const t=e.arg,n=i[e.method];try{n.apply(i,[t])}catch(e){console.warn(e)}}}var w=n(186);let y,f,v,b,S={camera:{range:{x:.015,y:.01},movespeed:{x:.03,y:.03},offset:{x:0,y:4,z:0}}},C=0,k=0,x=.03,E=.03,T=.001,A=.001;function M(e){const t=window.Project.Canvas.getBoundingClientRect(),n=e.clientX-t.left,o=e.clientY-t.top,i=t.width/2,a=t.height/2;C=(n-i)*T,k=-(o-a)*A}function R(){const e=v.x+C,t=v.y+k;f.position.x+=(e-f.position.x)*x,f.position.y+=(t-f.position.y)*E;const n=b.position.clone().add(S.camera.offset);y.lerp(n,.03),f.lookAt(y)}function P(e,t,n=!1,o){f=window.Project.Camera,f.mover?"slide.out"===e.hook&&(window.Project.RemoveFromUpdate(R),f.mover=!1):(f.mover=!0,v=f.position.clone(),b=window.Project.Root,y=new w.Vector3,f.setlook=e=>{b=window.Project.FindElement(e.split("."))},x=S.camera.movespeed.x,E=S.camera.movespeed.y,T=S.camera.range.x,A=S.camera.range.y,window.Project.Canvas.addEventListener("mousemove",M,!1),window.Project.AddToUpdate(R))}function U(e,t,n=!1){window.open(e.url,e.target||" _blank")}function j(e,t,n=!1){let o=t.model;if(e.paths)for(let t=0;t<e.paths.length;t++)o=o[e.paths[t]];if(e.target)for(let t=0;t<e.target.length;t++)o=o.children.find(n=>n.uid===e.target[t]);o.visible=e.value,o.traverse(t=>{t.isObject3D&&(t.visible=e.value)})}window.innerWidth,window.innerHeight;var L=n(487);function B(e,t,n=!1){return console.log("CUBE"),new Promise((e,t)=>{(new L.H).load("https://s3.eu-west-1.amazonaws.com/3dbuilder.reneos.com/hdr/Nebula_03_Cubemap.exr",t=>{t.mapping=w.EquirectangularReflectionMapping,window.Project.Scene.background=t,e(t)},void 0,t)})}function F(){return class extends w.Group{constructor(e){super(),this.type="planeimg",this.data={...e},this.geometry=new w.PlaneGeometry(1,1),this.material=new w.MeshBasicMaterial({toneMapped:!1,side:w.DoubleSide,transparent:!0,opacity:1}),this.mesh=new w.Mesh(this.geometry,this.material),this.data.image&&this.load(),this.add(this.mesh)}async load(){await App.engine.AssetsManager.GetResource(this.data.image)}get url(){return this.data.url}set url(e){this.data.url=e,this.data.url&&this.load()}get opacity(){return this.material.opacity}set opacity(e){this.material.opacity=e,this.material.needsUpdate=!0}get image(){return this.material.map}set image(e){this.material.map=e,this.material.needsUpdate=!0}get color(){return this.material.color}set color(e){this.material.color.copy(e),this.data.color=this.material.color.getHex()}getTypes(){return[...super.getTypes(),this.type]}}}function _(){return class extends w.Object3D{constructor(e){super(),this._url=e.url,this.type="AudioPlayer",this.audio=new Audio;const t=new SpeechSynthesisUtterance;t.text="Привет, это синтез речи в браузере",t.lang="ru-RU",t.rate=1,t.pitch=1,t.volume=1,window.speechSynthesis.onvoiceschanged=function(){const e=window.speechSynthesis.getVoices();console.log("Доступные голоса:"),e.forEach(e=>{if((e.lang.includes("ru")||e.lang.includes("RU"))&&e.name.includes("Google")){console.log(`${e.name} (${e.lang}) - ${e.localService?"Локальный":"Удаленный"}`);const t=new SpeechSynthesisUtterance("Со́лнечная систе́ма — планетная система, включающая в себя центральную звезду Солнце и все естественные космические объекты на гелиоцентрических орбитах. Она сформировалась путём гравитационного сжатия газопылевого облака примерно 4,57 млрд лет назад");t.voice=e,t.rate=1,t.pitch=.75}})}}getTypes(){return[...super.getTypes(),this.type]}get url(){return this._url}set url(e){console.log(e),this._url=e,this.audio.src=e}async play(){try{return await this.audio.play(),this.audio.addEventListener("ended",()=>{console.log("ended")}),void this.audio.addEventListener("error",e=>{console.warn("Ошибка аудио:",e)})}catch(e){if("NotAllowedError"!==e?.name&&!/user gesture|user interaction/i.test(e?.message||""))return void console.error("Ошибка аудио:",e)}const e=()=>{["click","keydown","touchstart"].forEach(t=>document.removeEventListener(t,e)),this.audio.muted=!1,this.play()};["click","keydown","touchstart"].forEach(t=>document.addEventListener(t,e,{once:!0,passive:!0}))}}}const G=i.default||i;function O(){const e=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(818).then(n.t.bind(n,437,19));return e.default||e});if(window.vue.component("LoaderScreen",e),console.log("Set LoaderScreen"),Object.keys(o).forEach(e=>{G.engine.ActionsManager.RegisterHandler(e,o[e])}),G.engine.Factory.RegisterElement("planeimg",F,{label:"Plane Image"}),G.engine.Factory.RegisterElement("AudioPlayer",_,{label:"Audio Player"}),!window.isEditor)return void G.menu.tools.list.unshift({icon:"camera",tooltip:"Screenshot",handler:s},{icon:"film",tooltip:"Video capture",handler:r},{icon:"enlarge",tooltip:"Screen switch",handler:c});[{}].forEach(e=>{const t=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(192).then(n.t.bind(n,192,19));return e.default||e});window.vue.component("GoTo",t),G.actions.register({component:"GoTo",group:"base",name:"GoTo",description:"Go to slide",template:{name:"new GoTo",slide:0,delay:0},check:async()=>!0})}),G.inspector.addToModels(["planeimg"],[{label:"URL",content:{prop:"url",component:"LabelEdit"}},{label:"Color",head:{component:"EditColor",prop:"color",state:!0}},{label:"Opacity",head:{component:"Float",prop:"opacity",step:.01,min:0,max:1,state:!0}},{label:"Image",content:{prop:"image",component:"AssetImage",onclean(e,t,n,o){e.image=null,delete e.properties.image,G.project.save(e)},events:{select:async e=>{const t=await G.assets.selectAsset("image");if(!t)return e.image=null,void delete e.properties.image;await G.engine.AssetsManager.SetResourceTo(e,"image",t.uid),e.properties.image={asset:t.uid},G.project.save(e)}}}}]),G.inspector.addToModels(["circularimgs"],[]),G.inspector.addToModels(["AudioPlayer"],[{label:"URL",content:{prop:"url",component:"LabelEdit",state:!0}},{label:"Audio Control",readonly:!0,content:{prop:"audio",component:"AudioControl"}}]);const t=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(789).then(n.bind(n,789));return e.default||e});window.vue.component("CallFunction",t),G.actions.register({component:"CallFunction",group:"base",name:"Call function",template:{name:"new CallFunction",slide:0},check:async()=>!0});const i=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(884).then(n.bind(n,884));return e.default||e});window.vue.component("BackSlide",i),G.actions.register({component:"BackSlide",group:"base",name:"Switch to back",template:{name:"BackSlide"},check:async()=>!0});const l=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(549).then(n.bind(n,549));return e.default||e});window.vue.component("NextSlide",l),G.actions.register({component:"NextSlide",group:"base",name:"Slide to next",template:{name:"NextSlide"},check:async()=>!0});const d=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(139).then(n.bind(n,139));return e.default||e});window.vue.component("CamMover",d),G.actions.register({component:"CamMover",group:"base",name:"Move Camera",description:"Move camera when mouse moves. Applies to slide only",template:{name:"new CamMover"},check:async()=>!0});const m=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(772).then(n.bind(n,772));return e.default||e});window.vue.component("VisibleSet",m),G.actions.register({component:"VisibleSet",group:"base",name:"Set model visible",template:{name:"new VisibleSet",slide:0},check:async()=>!0});const u=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(38).then(n.bind(n,38));return e.default||e});window.vue.component("UrlOpen",u),G.actions.register({component:"UrlOpen",group:"base",name:"Open URL",description:"",template:{name:"UrlOpen"},check:async()=>!0}),G.menu.tools.list.unshift({icon:"camera",tooltip:"Screenshot",handler:s},{icon:"film",tooltip:"Capture video",handler:r},{icon:"enlarge",tooltip:"Screen switch",handler:c})}console.log("Tools"),G.engine.ready?O():G.engine.onInit(O)}}]);