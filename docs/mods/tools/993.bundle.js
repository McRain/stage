"use strict";(self.webpackChunk_reneos_slider_mods_tools=self.webpackChunk_reneos_slider_mods_tools||[]).push([[993],{657:(e,t,o)=>{var n={};o.r(n),o.d(n,{BackSlide:()=>h,CallFunction:()=>m,GoTo:()=>d,NextSlide:()=>u,UrlOpen:()=>g,VisibleSet:()=>b});var i=o(333),a=o(66);async function s(e,t,o){return/Mobi|Android/i.test(navigator.userAgent)?async function(e,t){t.getContext("2d").drawImage(document.documentElement,0,0,t.width,t.height);const o=t.toDataURL("image/png"),n=document.createElement("a");n.href=o,n.download=`${e}.png`,n.click()}(e,t):async function(e,t={}){try{const o=(await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"tabs"},audio:!1,selfBrowserSurface:"include",surfaceSwitching:"exclude",...t})).getVideoTracks()[0];let n=new ImageCapture(o);const i=await n.grabFrame(),a=document.createElement("canvas");a.width=i.width,a.height=i.height,a.getContext("2d").drawImage(i,0,0);const s=a.toDataURL("image/png"),r=document.createElement("a");r.href=s,r.download=`${e}.png`,r.click()}catch(e){console.warn(e)}}(e,o)}async function r(e="presentation"){const t=window.screen.width*window.devicePixelRatio,o=window.screen.height*window.devicePixelRatio,n=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"browser",width:{max:t},height:{max:o},frameRate:{ideal:30,max:60},cursor:"always",resizeMode:"crop-and-scale"},audio:!1,preferCurrentTab:!1,selfBrowserSurface:"include",surfaceSwitching:"exclude"}),i=document.createElement("video");i.height=window.height,i.width=window.width,i.srcObject=n;const a={mimeType:"video/webm; codecs=vp9",videoBitsPerSecond:8e6,bitsPerSecond:51e4};MediaRecorder.isTypeSupported(a.mimeType)||(a.mimeType="video/webm",a.videoBitsPerSecond=3e6);const s=new MediaRecorder(n,a),r=[];s.ondataavailable=e=>{e.data.size>0&&r.push(e.data)},s.onerror=e=>{console.warn(e.message)},s.onstop=()=>{const t=new Blob(r,{type:a.mimeType.includes("mp4")?"video/mp4":"video/webm"});n.getVideoTracks()[0].stop();const o=`${e}.${a.mimeType.includes("mp4")?"mp4":"webm"}`;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,o);else{const e=window.document.createElement("a");e.href=window.URL.createObjectURL(t),e.download=o,e.style="display: none",e.click()}},s.start(1e3)}function l(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}const c=i.default.default||i.default;function d(e,t,o,n){if(window.isEditor&&!n)return;let i=e.delay||0;setTimeout(()=>{c.engine.SlidesManager.GoTo(e.slide)},i)}const p=i.default.default||i.default;function h(e,t,o,n){if(window.isEditor&&!n)return;let i=e.delay||0;setTimeout(()=>{p.engine.getManager("SlidesManager").GoToBack()},i)}function u(e,t,o,n){if(window.isEditor&&!n)return;let i=e.delay||0;setTimeout(()=>{window.SlidesManager.GoToNext()},i)}function m(e,t,o,n){if(window.isEditor&&!n)return;const i=e.target?e.target.split("."):"",a=window.Project.FindElement(i)||t.model;if(a){const t=e.arg,o=a[e.method];try{o.apply(a,[t])}catch(e){console.warn(e)}}}function g(e,t,o,n){window.isEditor&&!n||window.open(e.url,e.target||" _blank")}function b(e,t,o,n){if(window.isEditor&&!n)return;let i=t.model;if(e.paths)for(let t=0;t<e.paths.length;t++)i=i[e.paths[t]];if(e.target)for(let t=0;t<e.target.length;t++)i=i.children.find(o=>o.uid===e.target[t]);i.visible=e.value,i.traverse(t=>{t.isObject3D&&(t.visible=e.value)})}i.default.default||i.default;var y=o(186);const f=i.default.default||i.default;y.Color.prototype.encode=function(){return{type:"Color",args:[`#${this.getHexString()}`]}},y.Vector2.prototype.encode=function(){return{type:"Vector2",args:[this.x,this.y]}},y.Vector3.prototype.encode=function(){return{type:"Vector3",args:[this.x,this.y,this.z]}},y.Vector4.prototype.encode=function(){return{type:"Vector4",args:[this.x,this.y,this.z,this.w]}},y.Quaternion.prototype.encode=function(){return{type:"Quaternion",args:[this.x,this.y,this.z,this.w]}},Object.defineProperty(y.Object3D.prototype,"types",{get:()=>["Object3D"],configurable:!0,enumerable:!1}),Object.defineProperty(y.Object3D.prototype,"model",{get(){return this},configurable:!0,enumerable:!1}),Object.defineProperty(y.Group.prototype,"types",{get:()=>["Object3D","Group"],configurable:!0,enumerable:!1}),Object.defineProperty(y.Group.prototype,"model",{get(){return this},configurable:!0,enumerable:!1}),y.Group.prototype.isUseAsset=function(e){return this.args?.uid===e},Object.defineProperty(y.Mesh.prototype,"types",{get:()=>["Object3D","Mesh"],configurable:!0,enumerable:!1}),y.Mesh.prototype.isUseAsset=function(e){return this.args?.uid===e},Object.defineProperty(y.DirectionalLight.prototype,"types",{get:()=>["Object3D","Light","DirectionalLight"],configurable:!0,enumerable:!1}),Object.defineProperty(y.AmbientLight.prototype,"types",{get:()=>["Object3D","Light","AmbientLight"],configurable:!0,enumerable:!1}),Object.defineProperty(y.Camera.prototype,"types",{get:()=>["Object3D","Camera"],configurable:!0,enumerable:!1}),Object.defineProperty(y.PerspectiveCamera.prototype,"types",{get:()=>["Object3D","Camera","PerspectiveCamera"],configurable:!0,enumerable:!1});const w=y.PerspectiveCamera.prototype;Object.defineProperty(w,"fovs",{get(){return this.fov},set(e){this.fov=e,this.updateProjectionMatrix()},configurable:!0,enumerable:!1}),console.log("fovs in PerspectiveCamera prototype:","fovs"in y.PerspectiveCamera.prototype),console.log("fovs in Camera prototype:","fovs"in y.Camera.prototype),Object.defineProperty(y.OrthographicCamera.prototype,"types",{get:()=>["Object3D","Camera","OrthographicCamera"],configurable:!0,enumerable:!1});const v={Group:{type:"Group",label:"Group",isModel:!0,create:async(e,t,o)=>{if(e.children){const o=new y.Group;return o.data=t,e.children.forEach(e=>o.add(e)),o}if(e.isAsset){const o=await window.AssetsManager.FindAsset(e.uid),n=new y.Group;return n.add(o.resource.clone()),n.data=t,n.args=e,n}const n=new y.Group;return n.data=t,n},encode:e=>e.data},Mesh:{type:"Mesh",isModel:!0,label:"3D Object",types:["Object3D","Mesh"],create:async(e,t,o)=>{if(!e?.uid){const o=async()=>{const o=await f.assets.selectAsset(["model"]);if(!o)throw new Error("Need select asset");if(!(await window.AssetsManager.FindAsset(o.uid)).resource.isMesh)throw new Error("Wrong asset type for Mesh");e={uid:o.uid,isAsset:!0},t.args=e};await o()}const n=(await window.AssetsManager.FindAsset(e.uid)).resource,i=new y.Mesh(n.geometry,n.material);return i.args=e,i.data=t,i},remove:e=>{},encode:e=>e.data},PerspectiveCamera:{type:"PerspectiveCamera",label:"Perspective Camera",isModel:!0,create:(e={})=>new y.PerspectiveCamera(e.fov||75,e.aspect||1,e.near||.1,e.far||1e3),encode:e=>({fov:e.fov,aspect:e.aspect,near:e.near,far:e.far}),properties:{fov:{required:!1},aspect:{required:!1},near:{required:!1},far:{required:!1}},specificFields:{position:e=>({x:e.position.x,y:e.position.y,z:e.position.z}),rotation:e=>({x:e.rotation.x,y:e.rotation.y,z:e.rotation.z})},types:["Object3D","Camera","PerspectiveCamera"]},AmbientLight:{type:"AmbientLight",label:"Ambient Light",isModel:!0,create:(e={})=>(console.log("DL"),new y.AmbientLight(e.color||new y.Color,e.intensity||1))},DirectionalLight:{type:"DirectionalLight",label:"Directional Light",isModel:!0,module:y.DirectionalLight}};function C(e,t,o,n){e[t].copy(o),e.states[n][t]={type:"Color",args:["#"+o.getHexString()]}}const x={Object3D:[{label:"Transform",readonly:!0,content:{component:"TransformEdit",state:!0}},{label:"Visibility",data:{},head:{prop:"visible",component:"BoolEdit",state:!0}}],DirectionalLight:[{label:"Color",head:{component:"EditColor",prop:"color",state:!0,onupdate:C}},{label:"Intensity",head:{component:"Float",prop:"intensity",step:.1,min:0}},{label:"Shadow",data:{},head:{prop:"castShadow",component:"BoolEdit"}}],AmbientLight:[{label:"Color",head:{component:"EditColor",prop:"color",state:!0,onupdate:C}},{label:"Intensity",head:{component:"Float",prop:"intensity",step:.1,min:0,state:!0}}],Camera:[{label:"Far",head:{prop:"far",component:"Float",onupdate(e,t,o,n){e[t]=e.states[n][t]=o,e.updateProjectionMatrix(),window.Editor.CameraHelper.update()}}},{label:"Near",head:{prop:"near",component:"Float",state:!0,onupdate(e,t,o,n){e[t]=e.states[n][t]=o,e.updateProjectionMatrix(),window.Editor.CameraHelper.update()}}}],PerspectiveCamera:[{label:"FOV",head:{prop:"fov",component:"Float",onupdate(e,t,o,n){e[t]=e.states[n][t]=o,e.updateProjectionMatrix(),window.Editor.CameraHelper.update()}}}],OrthographicCamera:[{label:"Left",head:{prop:"left",component:"Float",onupdate(e,t,o,n){e[t]=e.states[n][t]=o,e.updateProjectionMatrix(),window.Editor.CameraHelper.update()}}},{label:"Top",head:{prop:"top",component:"Float",onupdate(e,t,o,n){e[t]=e.states[n][t]=o,e.updateProjectionMatrix(),window.Editor.CameraHelper.update()}}},{label:"Right",head:{prop:"right",component:"Float",onupdate(e,t,o,n){e[t]=e.states[n][t]=o,e.updateProjectionMatrix(),window.Editor.CameraHelper.update()}}},{label:"Bottom",head:{prop:"bottom",component:"Float",onupdate(e,t,o,n){e[t]=e.states[n][t]=o,e.updateProjectionMatrix(),window.Editor.CameraHelper.update()}}}]};class E extends y.Object3D{static get IsElement(){return!0}constructor(e){super(),this.type="element",this.isElement=!0,this.isBase=!0,this.uid=e.uid,this.data={...e},this.path=e.path,this.paths=e.paths,this.state=null,this.actions=[]}exportData(e){const{model:t,children:o,...n}=this.data||e,i=JSON.parse(JSON.stringify(n));if(this.data.rotation&&(i.rotation={x:this.data.rotation.x,y:this.data.rotation.y,z:this.data.rotation.z}),o){i.children=[];for(let e=0;e<o.length;e++){const t=o[e],n=this.children.find(e=>e.uid===t.uid);i.children[e]=n.exportData?n.exportData():JSON.parse(JSON.stringify(n.data||{}))}}return i}get types(){return["Object3D","BaseElement"]}addAction(e){this.actions.push(e)}removeAction(e,t){const o=this.data.actions.findIndex(o=>o.uid===e&&o.hook===t);o>=0&&this.data.actions.splice(o,1)}get model(){return this}find(e){const t=e.split(".");let o=this;for(let e=0;e<t.length;e++)o=this.children.find(o=>o.uid===t[e]),list=o.children;return o}}const O=E,S={type:"Model",isModel:!1,nonlist:!0,add(){},label:"Model",template:{type:"Model",args:{source:{}}},module:class extends O{constructor(e,t){super(t),this.isElement=!0,this.isModel=!0,this.type="Model",this.state=null,this.add(e.clone())}encode(){return{args:this.data.args}}get model(){return this}get types(){return[...super.types,this.type]}}},j=class{constructor(){this._events={"*":[]}}subs(e,t,o){null==this._events[e]&&(this._events[e]=[]),this._events[e].push({handler:o,once:t})}on(e,t){this.subs(e,!1,t)}once(e,t){this.subs(e,!0,t)}off(e,t){const o=this._events[e];if(o){for(let e=o.length-1;e>=0;e--)o[e].handler===t&&o.splice(e,1);0===o.length&&delete this._events[e]}}clear(e){this._events[e]=[]}clearAll(){this._events={"*":[]}}emit(e,...t){const o=[];this._events[e]&&o.push(...this._events[e]),this._events["*"].length&&o.push(...this._events["*"].map(t=>({handler:t.handler.bind(this,e),once:t.once})));for(let e=o.length-1;e>=0;e--){const n=o[e];n.handler.apply(null,t),n.once&&o.splice(e,1)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}};class M extends O{constructor(e){return super(e),this.type="label2d",this.isUIElement=!0,this.isCSS2DObject=!0,this._emmiter=new j,this.data.onEvent=this.onEvent.bind(this),this.data.element||(this.data.element={text:{value:"Text",size:"3em"},styles:{display:"flex",width:"0px",height:"0px",color:"#474747ff","pointer-events":"none",backgroundColor:"rgba(0, 0, 0, 0)"},visible:!0},this.data.events={click:e=>{console.log(e),this._emmiter.emit("clicked")}}),this._bgColor="#000000",this._bgOpacity=0,this.updateVisible(),this.center=new y.Vector2(.5,.5),new Proxy(this,{set(e,t,o){return"visible"===t?(e.visible=o,o?e.showElement():e.hideElement(),!0):Reflect.set(...arguments)}})}get background(){return this.data.element.styles.backgroundColor}set background(e){this.data.element.styles.backgroundColor=e}get bgcolor(){return this._bgColor}set bgcolor(e){this._bgColor=e,this._updateBackgroundColor()}get bgopacity(){return this._bgOpacity}set bgopacity(e){this._bgOpacity=Math.max(0,Math.min(1,e)),this._updateBackgroundColor()}_updateBackgroundColor(){if(0===this._bgOpacity)this.background="rgba(0, 0, 0, 0)";else try{const e=function(e){let t,o,n;if(3===(e=e.replace("#","")).length)t=parseInt(e[0]+e[0],16),o=parseInt(e[1]+e[1],16),n=parseInt(e[2]+e[2],16);else{if(6!==e.length)throw new Error("Invalid HEX color format");t=parseInt(e[0]+e[1],16),o=parseInt(e[2]+e[3],16),n=parseInt(e[4]+e[5],16)}return{r:t,g:o,b:n}}(this._bgColor);this.background=`rgba(${e.r}, ${e.g}, ${e.b}, ${this._bgOpacity})`}catch(e){console.error("Error converting color:",e),this.background="rgba(0, 0, 0, 0)"}}setBackground(e,t=null){"object"==typeof e&&void 0!==e.color?(this.bgcolor=e.color,this.bgopacity=void 0!==e.opacity?e.opacity:this._bgOpacity):null!==t?(this.bgcolor=e,this.bgopacity=t):e.includes("rgba")||e.includes("rgb")?(this.background=e,this._parseRgbaString(e)):this.bgcolor=e}_parseRgbaString(e){const t=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*([\d.]+))?\)/);if(t){const e=parseInt(t[1]),o=parseInt(t[2]),n=parseInt(t[3]),i=void 0!==t[4]?parseFloat(t[4]):1;this._bgColor=`#${((1<<24)+(e<<16)+(o<<8)+n).toString(16).slice(1)}`,this._bgOpacity=i}}encode(){return this._actions.some(e=>["mouse.click","mouse.enter","mouse.out"].includes(e.hook))?this.data.element.styles["pointer-events"]="all":this.data.element.styles["pointer-events"]="none",{...this.data}}get actions(){return this._actions}set actions(e){this._actions=e,this.data?.element&&this.updateVisible()}updateVisible(){this._actions.some(e=>["mouse.click","mouse.enter","mouse.out"].includes(e.hook))?this.data.element.styles["pointer-events"]="all":this.data.element.styles["pointer-events"]="none"}get types(){return[...super.types,this.type]}on(e,t){this._emmiter.on(e,t)}onEvent(e){this._emmiter.emit("click")}setElement(e,t){this.data.element=e,this.data.element.visible=!0,this.element=t}get text(){return this.data.element.text.value}set text(e){this.data.element.text.value=e}get size(){return this.data.element.text.size}set size(e){this.data.element.text.size=e}get textAlign(){return this.data.element.styles.justifyContent}set textAlign(e){this.data.element.styles.justifyContent!==e&&(this.data.element.styles.justifyContent=e)}get textValign(){return this.data.element.styles.alignItems}set textValign(e){this.data.element.styles.alignItems!==e&&(this.data.element.styles.alignItems=e)}get width(){return this.data.element.styles.width}set width(e){this.data.element.styles.width=e}get height(){return this.data.element.styles.height}set height(e){this.data.element.styles.height=e}SetLabelColor(){this.data.element.styles.color="#ff0000"}get color(){return this.data.element.styles.color}set color(e){this.data.element.styles.color=e}hideElement(){!this.visible&&this.element&&(this.element.style.display="none")}showElement(){this.visible&&(this.element.style.display="flex")}show(){this.visible=!0,this.showElement()}hide(){this.visible=!1,this.hideElement()}}const k={type:"label2d",isModel:!0,label:"2D Label",module:M,create:(e={})=>new M(e),types:["Object3D","element","label2d"]},_=[{label:"$$Size",content:{component:"DimensionsEdit",onupdate(e,t,o,n){console.log(t,o),e[t]=e.states[n][t]=o},onclean(e,t,o,n){delete e.states[n].width,delete e.states[n].height},state:!0}},{label:"$$Text",content:{prop:"text",component:"TextEdit",state:!0}},{label:"$$Color",head:{component:"TextColorEdit",prop:"color",state:!0}},{label:"Background opacity",head:{component:"Range",prop:"bgopacity",state:!0}},{label:"Background",head:{component:"TextColorEdit",prop:"bgcolor",state:!0}},{label:"$$Font size",head:{component:"FontSize",prop:"size",state:!0}},{label:"Vertical Align",head:{component:"SectionSelect",prop:"textValign",props:{list:[{value:"start",label:"top"},{value:"end",label:"bottom"},{value:"center",label:"center"}]}}},{label:"Horizontal Align",head:{component:"SectionSelect",prop:"textAlign",props:{list:[{value:"left"},{value:"right"},{value:"center"}]}}}],A=i.default.default||i.default;function D(){window.isEditor&&(A.translations.addTranslations("en","/mods/tools/contents/en.json"),A.translations.addTranslations("ru","/mods/tools/contents/ru.json"));const e=(0,a.defineAsyncComponent)(async()=>{const e=await o.e(818).then(o.t.bind(o,818,19));return e.default||e});if(window.vue.component("LoaderScreen",e),Object.keys(n).forEach(e=>{A.engine.ActionsManager.RegisterHandler(e,n[e])}),Object.values(v).forEach(e=>{A.engine.Factory.RegisterType(e)}),A.engine.Factory.RegisterType(S),A.engine.Factory.RegisterType(k),!window.isEditor)return void A.menu.tools.children.unshift({icon:"camera",tooltip:"$$Screenshot",handler:s},{icon:"film",tooltip:"$$Video capture",handler:r},{icon:"enlarge",tooltip:"$$Screen switch",handler:l});Object.keys(x).forEach(e=>{A.inspector.addToModels([e],x[e])}),A.inspector.addToModels(["label2d"],_),A.inspector.addToModels(["planeimg"],[{label:"URL",content:{prop:"url",component:"LabelEdit"}},{label:"Color",head:{component:"EditColor",prop:"color",state:!0}},{label:"Opacity",head:{component:"Float",prop:"opacity",step:.01,min:0,max:1,state:!0}},{label:"Image",content:{prop:"image",component:"AssetImage",onclean(e,t,o,n){e.image=null,delete e.properties.image,A.models.save(e)},events:{select:async e=>{const t=await A.assets.selectAsset("image");if(!t)return e.image=null,void delete e.properties.image;await A.engine.AssetsManager.SetResourceTo(e,"image",t.uid),e.properties.image={asset:t.uid},A.models.save(e)}}}}]),A.inspector.addToModels(["circularimgs"],[]);const t=(0,a.defineAsyncComponent)(async()=>{const e=await o.e(509).then(o.bind(o,509));return e.default||e});window.vue.component("CallFunction",t),A.actions.register({component:"CallFunction",group:"base",name:"Call function",template:{name:"new CallFunction",slide:0},check:async()=>!0});const i=(0,a.defineAsyncComponent)(async()=>{const e=await o.e(960).then(o.bind(o,960));return e.default||e});window.vue.component("GoTo",i),A.actions.register({component:"GoTo",group:"base",name:"Slide switch",template:{name:"new GoTo",slide:0},check:async()=>!0});const c=(0,a.defineAsyncComponent)(async()=>{const e=await o.e(884).then(o.bind(o,884));return e.default||e});window.vue.component("BackSlide",c),A.actions.register({component:"BackSlide",group:"base",name:"Switch to back",template:{name:"BackSlide"},check:async()=>!0});const d=(0,a.defineAsyncComponent)(async()=>{const e=await o.e(549).then(o.bind(o,549));return e.default||e});window.vue.component("NextSlide",d),A.actions.register({component:"NextSlide",group:"base",name:"Slide to next",template:{name:"NextSlide"},check:async()=>!0});const p=(0,a.defineAsyncComponent)(async()=>{const e=await o.e(772).then(o.bind(o,772));return e.default||e});window.vue.component("VisibleSet",p),A.actions.register({component:"VisibleSet",group:"base",name:"Set model visible",template:{name:"new VisibleSet",slide:0},check:async()=>!0});const h=(0,a.defineAsyncComponent)(async()=>{const e=await o.e(38).then(o.bind(o,800));return e.default||e});window.vue.component("UrlOpen",h),A.actions.register({component:"UrlOpen",group:"base",name:"Open URL",description:"",template:{name:"UrlOpen"},check:async()=>!0}),A.menu.add([{path:"tools.screenshot",icon:"camera",tooltip:"Screenshot",handler:s},{path:"tools.capturevideo",icon:"film",tooltip:"Capture video",handler:r},{path:"tools.screenswitch",icon:"enlarge",tooltip:"Screen switch",handler:l}])}A.engine.ready?D():A.engine.onInit(D)}}]);