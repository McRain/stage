"use strict";(self.webpackChunk_reneos_slider_mods_tools=self.webpackChunk_reneos_slider_mods_tools||[]).push([[993],{831:(e,t,n)=>{var o={};n.r(o),n.d(o,{BackSlide:()=>m,CallFunction:()=>h,CamMover:()=>k,CamOrbit:()=>T,CubeTexture:()=>R,GoTo:()=>d,NextSlide:()=>u,UrlOpen:()=>F,VisibleSet:()=>L});var i=n(333),a=n(66);async function s(e,t,n){return/Mobi|Android/i.test(navigator.userAgent)?async function(e,t){t.getContext("2d").drawImage(document.documentElement,0,0,t.width,t.height);const n=t.toDataURL("image/png"),o=document.createElement("a");o.href=n,o.download=`${e}.png`,o.click()}(e,t):async function(e,t={}){try{const n=(await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"tabs"},audio:!1,selfBrowserSurface:"include",surfaceSwitching:"exclude",...t})).getVideoTracks()[0];let o=new ImageCapture(n);const i=await o.grabFrame(),a=document.createElement("canvas");a.width=i.width,a.height=i.height,a.getContext("2d").drawImage(i,0,0);const s=a.toDataURL("image/png"),r=document.createElement("a");r.href=s,r.download=`${e}.png`,r.click()}catch(e){console.warn(e)}}(e,n)}async function r(e="presentation"){const t=window.screen.width*window.devicePixelRatio,n=window.screen.height*window.devicePixelRatio,o=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"browser",width:{max:t},height:{max:n},frameRate:{ideal:30,max:60},cursor:"always",resizeMode:"crop-and-scale"},audio:!1,preferCurrentTab:!1,selfBrowserSurface:"include",surfaceSwitching:"exclude"}),i=document.createElement("video");i.height=window.height,i.width=window.width,i.srcObject=o;const a={mimeType:"video/webm; codecs=vp9",videoBitsPerSecond:8e6,bitsPerSecond:51e4};MediaRecorder.isTypeSupported(a.mimeType)||(a.mimeType="video/webm",a.videoBitsPerSecond=3e6);const s=new MediaRecorder(o,a),r=[];s.ondataavailable=e=>{e.data.size>0&&r.push(e.data)},s.onerror=e=>{console.warn(e.message)},s.onstop=()=>{const t=new Blob(r,{type:a.mimeType.includes("mp4")?"video/mp4":"video/webm"});o.getVideoTracks()[0].stop();const n=`${e}.${a.mimeType.includes("mp4")?"mp4":"webm"}`;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,n);else{const e=window.document.createElement("a");e.href=window.URL.createObjectURL(t),e.download=n,e.style="display: none",e.click()}},s.start(1e3)}function l(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}const c=i.default.default||i.default;function d(e,t){if(window.isEditor)return;let n=e.delay||0;setTimeout(()=>{c.engine.SlidesManager.GoTo(e.slide)},n)}const p=i.default.default||i.default;function m(e,t){if(window.isEditor)return;let n=e.delay||0;setTimeout(()=>{p.engine.getManager("SlidesManager").GoToBack()},n)}function u(e,t){if(window.isEditor)return;let n=e.delay||0;setTimeout(()=>{window.SlidesManager.GoToNext()},n)}function h(e,t){if(window.isEditor&&!e.allowEditor)return;const n=e.target?e.target.split("."):"",o=window.Project.FindElement(n)||t.model;if(o){const t=e.arg,n=o[e.method];try{n.apply(o,[t])}catch(e){console.warn(e)}}}i.default.default||i.default;var g=n(186);let w,y,b,f,v={camera:{range:{x:.015,y:.01},movespeed:{x:.03,y:.03},offset:{x:0,y:4,z:0}}},C=0,x=0,E=.03,M=.03,j=.001,O=.001;function S(e){const t=window.Project.Canvas.getBoundingClientRect(),n=e.clientX-t.left,o=e.clientY-t.top,i=t.width/2,a=t.height/2;C=(n-i)*j,x=-(o-a)*O}function P(){const e=b.x+C,t=b.y+x;y.position.x+=(e-y.position.x)*E,y.position.y+=(t-y.position.y)*M;const n=f.position.clone().add(v.camera.offset);w.lerp(n,.03),y.lookAt(w)}function k(e,t,n=!1,o){y=window.Project.Camera,y.mover?"slide.out"===e.hook&&(window.Project.RemoveFromUpdate(P),y.mover=!1):(y.mover=!0,b=y.position.clone(),f=window.Project.Root,w=new g.Vector3,y.setlook=e=>{f=window.Project.FindElement(e.split("."))},E=v.camera.movespeed.x,M=v.camera.movespeed.y,j=v.camera.range.x,O=v.camera.range.y,window.Project.Canvas.addEventListener("mousemove",S,!1),window.Project.AddToUpdate(P))}window.innerWidth,window.innerHeight;var A=n(24);let D;function T(e,t){const n=window.Project.Renderer.domElement;D=new A.N(window.Project.Camera,n),D.dampingFactor=.05,D.screenSpacePanning=!1,D.minDistance=.01,D.maxDistance=10,D.maxPolarAngle=Math.PI/2}function F(e,t,n=!1){window.open(e.url,e.target||" _blank")}function L(e,t,n=!1){let o=t.model;if(e.paths)for(let t=0;t<e.paths.length;t++)o=o[e.paths[t]];if(e.target)for(let t=0;t<e.target.length;t++)o=o.children.find(n=>n.uid===e.target[t]);o.visible=e.value,o.traverse(t=>{t.isObject3D&&(t.visible=e.value)})}var _=n(487);function R(e,t,n=!1){return console.log("CUBE"),new Promise((e,t)=>{(new _.H).load("https://s3.eu-west-1.amazonaws.com/3dbuilder.reneos.com/hdr/Nebula_03_Cubemap.exr",t=>{t.mapping=g.EquirectangularReflectionMapping,window.Project.Scene.background=t,e(t)},void 0,t)})}const z=i.default.default||i.default;g.Color.prototype.encode=function(){return{type:"Color",args:[`#${this.getHexString()}`]}},g.Vector2.prototype.encode=function(){return{type:"Vector2",args:[this.x,this.y]}},g.Vector3.prototype.encode=function(){return{type:"Vector3",args:[this.x,this.y,this.z]}},g.Vector4.prototype.encode=function(){return{type:"Vector4",args:[this.x,this.y,this.z,this.w]}},g.Quaternion.prototype.encode=function(){return{type:"Quaternion",args:[this.x,this.y,this.z,this.w]}},Object.defineProperty(g.Object3D.prototype,"types",{get:()=>["Object3D"],configurable:!0,enumerable:!1}),Object.defineProperty(g.Object3D.prototype,"model",{get(){return this},configurable:!0,enumerable:!1}),Object.defineProperty(g.Group.prototype,"types",{get:()=>["Object3D","Group"],configurable:!0,enumerable:!1}),Object.defineProperty(g.Group.prototype,"model",{get(){return this},configurable:!0,enumerable:!1}),g.Group.prototype.isUseAsset=function(e){return this.args?.uid===e},Object.defineProperty(g.Mesh.prototype,"types",{get:()=>["Object3D","Mesh"],configurable:!0,enumerable:!1}),g.Mesh.prototype.isUseAsset=function(e){return this.args?.uid===e},Object.defineProperty(g.DirectionalLight.prototype,"types",{get:()=>["Object3D","Light","DirectionalLight"],configurable:!0,enumerable:!1}),Object.defineProperty(g.AmbientLight.prototype,"types",{get:()=>["Object3D","Light","AmbientLight"],configurable:!0,enumerable:!1}),Object.defineProperty(g.Camera.prototype,"types",{get:()=>["Object3D","Camera"],configurable:!0,enumerable:!1}),Object.defineProperty(g.PerspectiveCamera.prototype,"types",{get:()=>["Object3D","Camera","PerspectiveCamera"],configurable:!0,enumerable:!1}),Object.defineProperty(g.OrthographicCamera.prototype,"types",{get:()=>["Object3D","Camera","OrthographicCamera"],configurable:!0,enumerable:!1});const V={Group:{type:"Group",label:"Group",isModel:!0,create:async(e,t,n)=>{if(e.children){const n=new g.Group;return n.data=t,e.children.forEach(e=>n.add(e)),n}if(e.isAsset){const n=await window.AssetsManager.FindAsset(e.uid),o=new g.Group;return o.add(n.resource.clone()),o.data=t,o.args=e,o}const o=new g.Group;return o.data=t,o},encode:e=>e.data},Mesh:{type:"Mesh",isModel:!0,label:"3D Object",types:["Object3D","Mesh"],create:async(e,t,n)=>{if(!e?.uid){const n=async()=>{const n=await z.assets.selectAsset(["model"]);if(!n)throw new Error("Need select asset");if(!(await window.AssetsManager.FindAsset(n.uid)).resource.isMesh)throw new Error("Wrong asset type for Mesh");e={uid:n.uid,isAsset:!0},t.args=e};await n()}const o=(await window.AssetsManager.FindAsset(e.uid)).resource,i=new g.Mesh(o.geometry,o.material);return i.args=e,i.data=t,i},remove:e=>{},encode:e=>e.data},PerspectiveCamera:{type:"PerspectiveCamera",label:"Perspective Camera",isModel:!0,create:(e={})=>new g.PerspectiveCamera(e.fov||75,e.aspect||1,e.near||.1,e.far||1e3),encode:e=>({fov:e.fov,aspect:e.aspect,near:e.near,far:e.far}),properties:{fov:{required:!1},aspect:{required:!1},near:{required:!1},far:{required:!1}},specificFields:{position:e=>({x:e.position.x,y:e.position.y,z:e.position.z}),rotation:e=>({x:e.rotation.x,y:e.rotation.y,z:e.rotation.z})},types:["Object3D","Camera","PerspectiveCamera"]},AmbientLight:{type:"AmbientLight",label:"Ambient Light",isModel:!0,create:(e={})=>(console.log("DL"),new g.AmbientLight(e.color||new g.Color,e.intensity||1))},DirectionalLight:{type:"DirectionalLight",label:"Directional Light",isModel:!0,module:g.DirectionalLight}};function B(e,t,n,o){e[t].copy(n),e.states[o][t]={type:"Color",args:["#"+n.getHexString()]}}const G={Object3D:[{label:"Transform",readonly:!0,content:{component:"TransformEdit",state:!0}},{label:"Visibility",data:{},head:{prop:"visible",component:"BoolEdit",state:!0}}],DirectionalLight:[{label:"Color",head:{component:"EditColor",prop:"color",state:!0,onupdate:B}},{label:"Intensity",head:{component:"Float",prop:"intensity",step:.1,min:0}},{label:"Shadow",data:{},head:{prop:"castShadow",component:"BoolEdit"}}],AmbientLight:[{label:"Color",head:{component:"EditColor",prop:"color",state:!0,onupdate:B}},{label:"Intensity",head:{component:"Float",prop:"intensity",step:.1,min:0,state:!0}}],Camera:[{label:"Far",head:{prop:"far",component:"Float",onupdate(e,t,n,o){e[t]=e.states[o][t]=n,e.updateProjectionMatrix(),window.Editor.CameraHelper.update()}}},{label:"Near",head:{prop:"near",component:"Float",state:!0,onupdate(e,t,n,o){e[t]=e.states[o][t]=n,e.updateProjectionMatrix(),window.Editor.CameraHelper.update()}}}],PerspectiveCamera:[{label:"FOV",head:{prop:"fov",component:"Float",onupdate(e,t,n,o){e[t]=e.states[o][t]=n,e.updateProjectionMatrix(),window.Editor.CameraHelper.update()}}}],OrthographicCamera:[{label:"Left",head:{prop:"left",component:"Float",onupdate(e,t,n,o){e[t]=e.states[o][t]=n,e.updateProjectionMatrix(),window.Editor.CameraHelper.update()}}},{label:"Top",head:{prop:"top",component:"Float",onupdate(e,t,n,o){e[t]=e.states[o][t]=n,e.updateProjectionMatrix(),window.Editor.CameraHelper.update()}}},{label:"Right",head:{prop:"right",component:"Float",onupdate(e,t,n,o){e[t]=e.states[o][t]=n,e.updateProjectionMatrix(),window.Editor.CameraHelper.update()}}},{label:"Bottom",head:{prop:"bottom",component:"Float",onupdate(e,t,n,o){e[t]=e.states[o][t]=n,e.updateProjectionMatrix(),window.Editor.CameraHelper.update()}}}]};class $ extends g.Object3D{static get IsElement(){return!0}constructor(e){super(),this.type="element",this.isElement=!0,this.isBase=!0,this.uid=e.uid,this.data={...e},this.path=e.path,this.paths=e.paths,this.state=null,this.actions=[]}exportData(e){const{model:t,children:n,...o}=this.data||e,i=JSON.parse(JSON.stringify(o));if(this.data.rotation&&(i.rotation={x:this.data.rotation.x,y:this.data.rotation.y,z:this.data.rotation.z}),n){i.children=[];for(let e=0;e<n.length;e++){const t=n[e],o=this.children.find(e=>e.uid===t.uid);i.children[e]=o.exportData?o.exportData():JSON.parse(JSON.stringify(o.data||{}))}}return i}get types(){return["Object3D","BaseElement"]}addAction(e){this.actions.push(e)}removeAction(e,t){const n=this.data.actions.findIndex(n=>n.uid===e&&n.hook===t);n>=0&&this.data.actions.splice(n,1)}get model(){return this}find(e){const t=e.split(".");let n=this;for(let e=0;e<t.length;e++)n=this.children.find(n=>n.uid===t[e]),list=n.children;return n}}const U=$,N={type:"Model",isModel:!1,nonlist:!0,add(){},label:"Model",template:{type:"Model",args:{source:{}}},module:class extends U{constructor(e,t){super(t),this.isElement=!0,this.isModel=!0,this.type="Model",this.state=null,this.add(e.clone())}encode(){return{args:this.data.args}}get model(){return this}get types(){return[...super.types,this.type]}}},H=class{constructor(){this._events={"*":[]}}subs(e,t,n){null==this._events[e]&&(this._events[e]=[]),this._events[e].push({handler:n,once:t})}on(e,t){this.subs(e,!1,t)}once(e,t){this.subs(e,!0,t)}off(e,t){const n=this._events[e];if(n){for(let e=n.length-1;e>=0;e--)n[e].handler===t&&n.splice(e,1);0===n.length&&delete this._events[e]}}clear(e){this._events[e]=[]}clearAll(){this._events={"*":[]}}emit(e,...t){const n=[];this._events[e]&&n.push(...this._events[e]),this._events["*"].length&&n.push(...this._events["*"].map(t=>({handler:t.handler.bind(this,e),once:t.once})));for(let e=n.length-1;e>=0;e--){const o=n[e];o.handler.apply(null,t),o.once&&n.splice(e,1)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}};class I extends U{constructor(e){return super(e),this.type="label2d",this.isUIElement=!0,this.isCSS2DObject=!0,this._emmiter=new H,this.data.onEvent=this.onEvent.bind(this),this.data.element||(this.data.element={text:{value:"Text",size:"3em"},styles:{width:"0px",height:"0px",color:"#474747ff","pointer-events":"none"},visible:!0},this.data.events={click:e=>{console.log(e),this._emmiter.emit("clicked")}}),this.updateVisible(),this.center=new g.Vector2(.5,.5),new Proxy(this,{set(e,t,n){return"visible"===t?(e.visible=n,n?e.showElement():e.hideElement(),!0):Reflect.set(...arguments)}})}encode(){return this._actions.some(e=>["mouse.click","mouse.enter","mouse.out"].includes(e.hook))?this.data.element.styles["pointer-events"]="all":this.data.element.styles["pointer-events"]="none",{...this.data}}get actions(){return this._actions}set actions(e){this._actions=e,this.data?.element&&this.updateVisible()}updateVisible(){this._actions.some(e=>["mouse.click","mouse.enter","mouse.out"].includes(e.hook))?this.data.element.styles["pointer-events"]="all":this.data.element.styles["pointer-events"]="none"}get types(){return[...super.types,this.type]}on(e,t){this._emmiter.on(e,t)}onEvent(e){this._emmiter.emit("click")}setElement(e,t){this.data.element=e,this.data.element.visible=!0,this.element=t}get text(){return this.data.element.text.value}set text(e){this.data.element.text.value=e}get size(){return this.data.element.text.size}set size(e){this.data.element.text.size=e}get width(){return this.data.element.styles.width}set width(e){this.data.element.styles.width=e}get height(){return this.data.element.styles.height}set height(e){this.data.element.styles.height=e}SetLabelColor(){this.data.element.styles.color="#ff0000"}get color(){return this.data.element.styles.color}set color(e){this.data.element.styles.color=e}hideElement(){!this.visible&&this.element&&(this.element.style.display="none")}showElement(){this.visible&&(this.element.style.display="block")}show(){this.visible=!0,this.showElement()}hide(){this.visible=!1,this.hideElement()}}const q={type:"label2d",isModel:!0,label:"2D Label",module:I,create:(e={})=>new I(e),types:["Object3D","element","label2d"]},J=[{label:"$$Size",content:{component:"DimensionsEdit",onupdate(e,t,n,o){console.log(t,n),e[t]=e.states[o][t]=n},state:!0}},{label:"$$Text",content:{prop:"text",component:"TextEdit",state:!0}},{label:"$$Color",head:{component:"TextColorEdit",prop:"color",state:!0}},{label:"$$Font size",head:{component:"FontSize",prop:"size",state:!0}}];g.Group,g.Group;const Q=i.default.default||i.default;function W(){window.isEditor&&(Q.translations.addTranslations("en","/mods/tools/contents/en.json"),Q.translations.addTranslations("ru","/mods/tools/contents/ru.json"));const e=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(818).then(n.t.bind(n,818,19));return e.default||e});if(window.vue.component("LoaderScreen",e),Object.keys(o).forEach(e=>{Q.engine.ActionsManager.RegisterHandler(e,o[e])}),Object.values(V).forEach(e=>{Q.engine.Factory.RegisterType(e)}),Q.engine.Factory.RegisterType(N),Q.engine.Factory.RegisterType(q),!window.isEditor)return void Q.menu.tools.children.unshift({icon:"camera",tooltip:"$$Screenshot",handler:s},{icon:"film",tooltip:"$$Video capture",handler:r},{icon:"enlarge",tooltip:"$$Screen switch",handler:l});Object.keys(G).forEach(e=>{Q.inspector.addToModels([e],G[e])}),Q.inspector.addToModels(["label2d"],J),Q.inspector.addToModels(["planeimg"],[{label:"URL",content:{prop:"url",component:"LabelEdit"}},{label:"Color",head:{component:"EditColor",prop:"color",state:!0}},{label:"Opacity",head:{component:"Float",prop:"opacity",step:.01,min:0,max:1,state:!0}},{label:"Image",content:{prop:"image",component:"AssetImage",onclean(e,t,n,o){e.image=null,delete e.properties.image,Q.models.save(e)},events:{select:async e=>{const t=await Q.assets.selectAsset("image");if(!t)return e.image=null,void delete e.properties.image;await Q.engine.AssetsManager.SetResourceTo(e,"image",t.uid),e.properties.image={asset:t.uid},Q.models.save(e)}}}}]),Q.inspector.addToModels(["circularimgs"],[]);const t=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(509).then(n.bind(n,509));return e.default||e});window.vue.component("CallFunction",t),Q.actions.register({component:"CallFunction",group:"base",name:"Call function",template:{name:"new CallFunction",slide:0},check:async()=>!0});const i=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(960).then(n.bind(n,960));return e.default||e});window.vue.component("GoTo",i),Q.actions.register({component:"GoTo",group:"base",name:"Slide switch",template:{name:"new GoTo",slide:0},check:async()=>!0});const c=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(884).then(n.bind(n,884));return e.default||e});window.vue.component("BackSlide",c),Q.actions.register({component:"BackSlide",group:"base",name:"Switch to back",template:{name:"BackSlide"},check:async()=>!0});const d=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(549).then(n.bind(n,549));return e.default||e});window.vue.component("NextSlide",d),Q.actions.register({component:"NextSlide",group:"base",name:"Slide to next",template:{name:"NextSlide"},check:async()=>!0}),Q.actions.register({component:"CamOrbit",group:"base",name:"Orbit Camera",description:"Lock camera when mouse moves. Applies to slide only",template:{name:"new CamOrbit"},check:async()=>!0});const p=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(139).then(n.bind(n,139));return e.default||e});window.vue.component("CamMover",p),Q.actions.register({component:"CamMover",group:"base",name:"Move Camera",description:"Move camera when mouse moves. Applies to slide only",template:{name:"new CamMover"},check:async()=>!0});const m=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(772).then(n.bind(n,772));return e.default||e});window.vue.component("VisibleSet",m),Q.actions.register({component:"VisibleSet",group:"base",name:"Set model visible",template:{name:"new VisibleSet",slide:0},check:async()=>!0});const u=(0,a.defineAsyncComponent)(async()=>{const e=await n.e(38).then(n.bind(n,657));return e.default||e});window.vue.component("UrlOpen",u),Q.actions.register({component:"UrlOpen",group:"base",name:"Open URL",description:"",template:{name:"UrlOpen"},check:async()=>!0}),Q.menu.add([{path:"tools.screenshot",icon:"camera",tooltip:"Screenshot",handler:s},{path:"tools.capturevideo",icon:"film",tooltip:"Capture video",handler:r},{path:"tools.screenswitch",icon:"enlarge",tooltip:"Screen switch",handler:l}])}console.log(G),Q.engine.ready?W():Q.engine.onInit(W)}}]);