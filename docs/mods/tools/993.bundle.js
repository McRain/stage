"use strict";(self.webpackChunk_reneos_3d_mods_tools=self.webpackChunk_reneos_3d_mods_tools||[]).push([[993],{428:(e,t,n)=>{var o={};n.r(o),n.d(o,{BackSlide:()=>p,CallFunction:()=>g,CamMover:()=>U,CubeTexture:()=>j,GoTo:()=>u,NextSlide:()=>w,UrlOpen:()=>L,VisibleSet:()=>R});var a=n(320),i=n(421);async function s(e,t,n){return/Mobi|Android/i.test(navigator.userAgent)?async function(e,t){t.getContext("2d").drawImage(document.documentElement,0,0,t.width,t.height);const n=t.toDataURL("image/png"),o=document.createElement("a");o.href=n,o.download=`${e}.png`,o.click()}(e,t):async function(e,t={}){try{const n=(await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"tabs"},audio:!1,selfBrowserSurface:"include",surfaceSwitching:"exclude",...t})).getVideoTracks()[0];let o=new ImageCapture(n);const a=await o.grabFrame(),i=document.createElement("canvas");i.width=a.width,i.height=a.height,i.getContext("2d").drawImage(a,0,0);const s=i.toDataURL("image/png"),c=document.createElement("a");c.href=s,c.download=`${e}.png`,c.click()}catch(e){console.warn(e)}}(e,n)}async function c(e="presentation"){const t=document.createElement("video");t.height=window.height,t.width=window.width;const n=t.srcObject=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"tabs"},audio:!1,selfBrowserSurface:"include",surfaceSwitching:"exclude"}),o=new MediaRecorder(n),a=[];o.ondataavailable=e=>a.push(e.data),o.onerror=e=>{console.warn(e.message)},o.onstop=()=>{const t=new Blob(a,{type:"mp4"});n.getVideoTracks()[0].stop();const o=`${e}.mp4`;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,o);else{const e=window.document.createElement("a");e.href=window.URL.createObjectURL(t),e.download=o,e.style="display: none",e.click()}},o.start()}function r(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}var l=n(890);a.default;const d=a.default||a;function u(e,t,n=!1){if(n)d.slides.goto(e.slide);else{let t=e.delay||0;setTimeout(()=>{d.engine.SlidesManager.GoTo(e.slide)},t)}}const m=a.default||a;function p(e,t,n){m.engine.getManager("SlidesManager").GoToBack()}const h=a.default||a;function w(e,t,n){n||h.engine.SlidesManager.GoToNext()}function g(e,t,n=!1){const o=e.target?e.target.split("."):"",a=window.Project.FindElement(o)||t.model;if(a){const t=e.arg,n=a[e.method];try{n.apply(a,[t])}catch(e){console.warn(e)}}}let y,f,v,b,S={camera:{range:{x:.015,y:.01},movespeed:{x:.03,y:.03},offset:{x:0,y:4,z:0}}},C=0,k=0,x=.03,E=.03,A=.001,M=.001;function _(e){const t=window.Project.Canvas.getBoundingClientRect(),n=e.clientX-t.left,o=e.clientY-t.top,a=t.width/2,i=t.height/2;C=(n-a)*A,k=-(o-i)*M}function T(){const e=v.x+C,t=v.y+k;f.position.x+=(e-f.position.x)*x,f.position.y+=(t-f.position.y)*E;const n=b.position.clone().add(S.camera.offset);y.lerp(n,.03),f.lookAt(y)}function U(e,t,n=!1,o){f=window.Project.Camera,f.mover?"slide.out"===e.hook&&(window.Project.RemoveFromUpdate(T),f.mover=!1):(f.mover=!0,v=f.position.clone(),b=window.Project.Root,y=new l.Vector3,f.setlook=e=>{b=window.Project.FindElement(e.split("."))},x=S.camera.movespeed.x,E=S.camera.movespeed.y,A=S.camera.range.x,M=S.camera.range.y,window.Project.Canvas.addEventListener("mousemove",_,!1),window.Project.AddToUpdate(T))}function L(e,t,n=!1){window.open(e.url,e.target||" _blank")}function R(e,t,n=!1){let o=t.model;if(e.paths)for(let t=0;t<e.paths.length;t++)o=o[e.paths[t]];if(e.target)for(let t=0;t<e.target.length;t++)o=o.children.find(n=>n.uid===e.target[t]);o.visible=e.value,o.traverse(t=>{t.isObject3D&&(t.visible=e.value)})}window.innerWidth,window.innerHeight;var P=n(487);function j(e,t,n=!1){return console.log("CUBE"),new Promise((e,t)=>{(new P.H).load("https://s3.eu-west-1.amazonaws.com/3dbuilder.reneos.com/hdr/Nebula_03_Cubemap.exr",t=>{t.mapping=l.EquirectangularReflectionMapping,window.Project.Scene.background=t,e(t)},void 0,t)})}function B(){return class extends l.Group{constructor(e){super(),this.type="planeimg",this.data={...e},this.geometry=new l.PlaneGeometry(1,1),this.material=new l.MeshBasicMaterial,this.mesh=new l.Mesh(this.geometry,this.material),this.data.url&&this.load(),this.add(this.mesh)}async load(){console.log("load");const e=await(new l.TextureLoader).load(this.data.url);this.material.map=e,this.material.needsUpdate=!0}get url(){return this.data.url}set url(e){this.data.url=e,this.data.url&&this.load()}get image(){return this.material.image}set image(e){this.material.map=new l.Texture(e)}get color(){return this._color}set color(e){this._color.copy(e),this._text.color=this._color.getHex(),this.data.color=this._color.getHex()}get outlinecolor(){return this._outcolor}set outlinecolor(e){this._outcolor.copy(e),this._text.outlineColor=this._outcolor.getHex()}getTypes(){return[...super.getTypes(),this.type]}}}function F(){return class extends l.Object3D{constructor(e){super(),this._url=e.url,this.type="AudioPlayer",this.audio=new Audio;const t=new SpeechSynthesisUtterance;t.text="Привет, это синтез речи в браузере",t.lang="ru-RU",t.rate=1,t.pitch=1,t.volume=1,window.speechSynthesis.onvoiceschanged=function(){const e=window.speechSynthesis.getVoices();console.log("Доступные голоса:"),e.forEach(e=>{if((e.lang.includes("ru")||e.lang.includes("RU"))&&e.name.includes("Google")){console.log(`${e.name} (${e.lang}) - ${e.localService?"Локальный":"Удаленный"}`);const t=new SpeechSynthesisUtterance("Со́лнечная систе́ма — планетная система, включающая в себя центральную звезду Солнце и все естественные космические объекты на гелиоцентрических орбитах. Она сформировалась путём гравитационного сжатия газопылевого облака примерно 4,57 млрд лет назад");t.voice=e,t.rate=1,t.pitch=.75}})}}getTypes(){return[...super.getTypes(),this.type]}get url(){return this._url}set url(e){console.log(e),this._url=e,this.audio.src=e}async play(){try{return await this.audio.play(),this.audio.addEventListener("ended",()=>{console.log("ended")}),void this.audio.addEventListener("error",e=>{console.warn("Ошибка аудио:",e)})}catch(e){if("NotAllowedError"!==e?.name&&!/user gesture|user interaction/i.test(e?.message||""))return void console.error("Ошибка аудио:",e)}const e=()=>{["click","keydown","touchstart"].forEach(t=>document.removeEventListener(t,e)),this.audio.muted=!1,this.play()};["click","keydown","touchstart"].forEach(t=>document.addEventListener(t,e,{once:!0,passive:!0}))}}}const O=a.default||a;function G(){const e=(0,i.defineAsyncComponent)(async()=>{const e=await n.e(818).then(n.t.bind(n,818,19));return e.default||e});if(window.vue.component("LoaderScreen",e),console.log("Set LoaderScreen"),Object.keys(o).forEach(e=>{O.engine.ActionsManager.RegisterAction(e,o[e])}),O.engine.Factory.RegisterElement("planeimg",B,{label:"Plane Image"}),O.engine.Factory.RegisterElement("AudioPlayer",F,{label:"Audio Player"}),!window.isEditor)return void O.menu.tools.list.unshift({icon:"camera",tooltip:"Screenshot",handler:s},{icon:"film",tooltip:"Video capture",handler:c},{icon:"enlarge",tooltip:"Screen switch",handler:r});O.inspector.addToModels(["planeimg"],[{label:"URL",content:{prop:"url",component:"LabelEdit"}},{label:"Image",content:{prop:"image",component:"ImageView"}}]),O.inspector.addToModels(["circularimgs"],[]),O.inspector.addToModels(["AudioPlayer"],[{label:"URL",content:{prop:"url",component:"LabelEdit",state:!0}},{label:"Audio Control",readonly:!0,content:{prop:"audio",component:"AudioControl"}}]);const t=(0,i.defineAsyncComponent)(async()=>{const e=await n.e(970).then(n.bind(n,970));return e.default||e});window.vue.component("CallFunction",t),O.actions.register({component:"CallFunction",type:"base",name:"Call function",template:{name:"new CallFunction",slide:0},check:async()=>!0});const a=(0,i.defineAsyncComponent)(async()=>{const e=await n.e(423).then(n.bind(n,423));return e.default||e});window.vue.component("GoTo",a),O.actions.register({component:"GoTo",type:"base",name:"Slide switch",template:{name:"new GoTo",slide:0},check:async()=>!0});const l=(0,i.defineAsyncComponent)(async()=>{const e=await n.e(609).then(n.bind(n,609));return e.default||e});window.vue.component("BackSlide",l),O.actions.register({component:"BackSlide",type:"base",name:"Switch to back",template:{name:"BackSlide"},check:async()=>!0});const d=(0,i.defineAsyncComponent)(async()=>{const e=await n.e(833).then(n.bind(n,833));return e.default||e});window.vue.component("NextSlide",d),O.actions.register({component:"NextSlide",type:"base",name:"Slide to next",template:{name:"NextSlide"},check:async()=>!0});const u=(0,i.defineAsyncComponent)(async()=>{const e=await n.e(680).then(n.bind(n,680));return e.default||e});window.vue.component("CamMover",u),O.actions.register({component:"CamMover",type:"base",name:"Move Camera",description:"Move camera when mouse moves. Applies to slide only",template:{name:"new CamMover"},check:async()=>!0});const m=(0,i.defineAsyncComponent)(async()=>{const e=await n.e(920).then(n.bind(n,920));return e.default||e});window.vue.component("VisibleSet",m),O.actions.register({component:"VisibleSet",type:"base",name:"Set model visible",template:{name:"new VisibleSet",slide:0},check:async()=>!0});const p=(0,i.defineAsyncComponent)(async()=>{const e=await n.e(459).then(n.bind(n,459));return e.default||e});window.vue.component("UrlOpen",p),O.actions.register({component:"UrlOpen",type:"base",name:"Open URL",description:"",template:{name:"UrlOpen"},check:async()=>!0}),O.menu.tools.list.unshift({icon:"camera",tooltip:"Screenshot",handler:s},{icon:"film",tooltip:"Capture video",handler:c},{icon:"enlarge",tooltip:"Screen switch",handler:r})}O.engine.ready?G():O.engine.onInit(G),console.log("Modul")}}]);