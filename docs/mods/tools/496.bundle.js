"use strict";(self.webpackChunk_reneos_slider_mods_tools=self.webpackChunk_reneos_slider_mods_tools||[]).push([[496],{24:(t,e,n)=>{n.d(e,{N:()=>f});var o=n(812);const i={type:"change"},s={type:"start"},a={type:"end"},r=new o.Ray,l=new o.Plane,h=Math.cos(70*o.MathUtils.DEG2RAD),c=new o.Vector3,u=2*Math.PI,p=-1,d=1e-6;class f extends o.Controls{constructor(t,e=null){super(t,e),this.state=p,this.target=new o.Vector3,this.cursor=new o.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:o.MOUSE.ROTATE,MIDDLE:o.MOUSE.DOLLY,RIGHT:o.MOUSE.PAN},this.touches={ONE:o.TOUCH.ROTATE,TWO:o.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new o.Vector3,this._lastQuaternion=new o.Quaternion,this._lastTargetPosition=new o.Vector3,this._quat=(new o.Quaternion).setFromUnitVectors(t.up,new o.Vector3(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new o.Spherical,this._sphericalDelta=new o.Spherical,this._scale=1,this._panOffset=new o.Vector3,this._rotateStart=new o.Vector2,this._rotateEnd=new o.Vector2,this._rotateDelta=new o.Vector2,this._panStart=new o.Vector2,this._panEnd=new o.Vector2,this._panDelta=new o.Vector2,this._dollyStart=new o.Vector2,this._dollyEnd=new o.Vector2,this._dollyDelta=new o.Vector2,this._dollyDirection=new o.Vector3,this._mouse=new o.Vector2,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=_.bind(this),this._onPointerDown=m.bind(this),this._onPointerUp=y.bind(this),this._onContextMenu=M.bind(this),this._onMouseWheel=g.bind(this),this._onKeyDown=v.bind(this),this._onTouchStart=E.bind(this),this._onTouchMove=S.bind(this),this._onMouseDown=b.bind(this),this._onMouseMove=w.bind(this),this._interceptControlDown=P.bind(this),this._interceptControlUp=R.bind(this),null!==this.domElement&&this.connect(this.domElement),this.update()}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){null!==this._domElementKeyEvents&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(i),this.update(),this.state=p}update(t=null){const e=this.object.position;c.copy(e).sub(this.target),c.applyQuaternion(this._quat),this._spherical.setFromVector3(c),this.autoRotate&&this.state===p&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,s=this.maxAzimuthAngle;isFinite(n)&&isFinite(s)&&(n<-Math.PI?n+=u:n>Math.PI&&(n-=u),s<-Math.PI?s+=u:s>Math.PI&&(s-=u),this._spherical.theta=n<=s?Math.max(n,Math.min(s,this._spherical.theta)):this._spherical.theta>(n+s)/2?Math.max(n,this._spherical.theta):Math.min(s,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),!0===this.enableDamping?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let a=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const t=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),a=t!=this._spherical.radius}if(c.setFromSpherical(this._spherical),c.applyQuaternion(this._quatInverse),e.copy(this.target).add(c),this.object.lookAt(this.target),!0===this.enableDamping?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let t=null;if(this.object.isPerspectiveCamera){const e=c.length();t=this._clampDistance(e*this._scale);const n=e-t;this.object.position.addScaledVector(this._dollyDirection,n),this.object.updateMatrixWorld(),a=!!n}else if(this.object.isOrthographicCamera){const e=new o.Vector3(this._mouse.x,this._mouse.y,0);e.unproject(this.object);const n=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),a=n!==this.object.zoom;const i=new o.Vector3(this._mouse.x,this._mouse.y,0);i.unproject(this.object),this.object.position.sub(i).add(e),this.object.updateMatrixWorld(),t=c.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;null!==t&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(t).add(this.object.position):(r.origin.copy(this.object.position),r.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(r.direction))<h?this.object.lookAt(this.target):(l.setFromNormalAndCoplanarPoint(this.object.up,this.target),r.intersectPlane(l,this.target))))}else if(this.object.isOrthographicCamera){const t=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),t!==this.object.zoom&&(this.object.updateProjectionMatrix(),a=!0)}return this._scale=1,this._performCursorZoom=!1,!!(a||this._lastPosition.distanceToSquared(this.object.position)>d||8*(1-this._lastQuaternion.dot(this.object.quaternion))>d||this._lastTargetPosition.distanceToSquared(this.target)>d)&&(this.dispatchEvent(i),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0)}_getAutoRotationAngle(t){return null!==t?u/60*this.autoRotateSpeed*t:u/60/60*this.autoRotateSpeed}_getZoomScale(t){const e=Math.abs(.01*t);return Math.pow(.95,this.zoomSpeed*e)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,e){c.setFromMatrixColumn(e,0),c.multiplyScalar(-t),this._panOffset.add(c)}_panUp(t,e){!0===this.screenSpacePanning?c.setFromMatrixColumn(e,1):(c.setFromMatrixColumn(e,0),c.crossVectors(this.object.up,c)),c.multiplyScalar(t),this._panOffset.add(c)}_pan(t,e){const n=this.domElement;if(this.object.isPerspectiveCamera){const o=this.object.position;c.copy(o).sub(this.target);let i=c.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*i/n.clientHeight,this.object.matrix),this._panUp(2*e*i/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(e*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,e){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),o=t-n.left,i=e-n.top,s=n.width,a=n.height;this._mouse.x=o/s*2-1,this._mouse.y=-i/a*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(u*this._rotateDelta.x/e.clientHeight),this._rotateUp(u*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let e=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(u*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),e=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-u*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),e=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(u*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),e=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-u*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(1===this._pointers.length)this._rotateStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),o=.5*(t.pageY+e.y);this._rotateStart.set(n,o)}}_handleTouchStartPan(t){if(1===this._pointers.length)this._panStart.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),o=.5*(t.pageY+e.y);this._panStart.set(n,o)}}_handleTouchStartDolly(t){const e=this._getSecondPointerPosition(t),n=t.pageX-e.x,o=t.pageY-e.y,i=Math.sqrt(n*n+o*o);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(1==this._pointers.length)this._rotateEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),o=.5*(t.pageY+e.y);this._rotateEnd.set(n,o)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const e=this.domElement;this._rotateLeft(u*this._rotateDelta.x/e.clientHeight),this._rotateUp(u*this._rotateDelta.y/e.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(1===this._pointers.length)this._panEnd.set(t.pageX,t.pageY);else{const e=this._getSecondPointerPosition(t),n=.5*(t.pageX+e.x),o=.5*(t.pageY+e.y);this._panEnd.set(n,o)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const e=this._getSecondPointerPosition(t),n=t.pageX-e.x,o=t.pageY-e.y,i=Math.sqrt(n*n+o*o);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const s=.5*(t.pageX+e.x),a=.5*(t.pageY+e.y);this._updateZoomParameters(s,a)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return void this._pointers.splice(e,1)}_isTrackingPointer(t){for(let e=0;e<this._pointers.length;e++)if(this._pointers[e]==t.pointerId)return!0;return!1}_trackPointer(t){let e=this._pointerPositions[t.pointerId];void 0===e&&(e=new o.Vector2,this._pointerPositions[t.pointerId]=e),e.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const e=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[e]}_customWheelEvent(t){const e=t.deltaMode,n={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(e){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100}return t.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function m(t){!1!==this.enabled&&(0===this._pointers.length&&(this.domElement.setPointerCapture(t.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._isTrackingPointer(t)||(this._addPointer(t),"touch"===t.pointerType?this._onTouchStart(t):this._onMouseDown(t)))}function _(t){!1!==this.enabled&&("touch"===t.pointerType?this._onTouchMove(t):this._onMouseMove(t))}function y(t){switch(this._removePointer(t),this._pointers.length){case 0:this.domElement.releasePointerCapture(t.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(a),this.state=p;break;case 1:const e=this._pointers[0],n=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:n.x,pageY:n.y})}}function b(t){let e;switch(t.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case o.MOUSE.DOLLY:if(!1===this.enableZoom)return;this._handleMouseDownDolly(t),this.state=1;break;case o.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===this.enablePan)return;this._handleMouseDownPan(t),this.state=2}else{if(!1===this.enableRotate)return;this._handleMouseDownRotate(t),this.state=0}break;case o.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===this.enableRotate)return;this._handleMouseDownRotate(t),this.state=0}else{if(!1===this.enablePan)return;this._handleMouseDownPan(t),this.state=2}break;default:this.state=p}this.state!==p&&this.dispatchEvent(s)}function w(t){switch(this.state){case 0:if(!1===this.enableRotate)return;this._handleMouseMoveRotate(t);break;case 1:if(!1===this.enableZoom)return;this._handleMouseMoveDolly(t);break;case 2:if(!1===this.enablePan)return;this._handleMouseMovePan(t)}}function g(t){!1!==this.enabled&&!1!==this.enableZoom&&this.state===p&&(t.preventDefault(),this.dispatchEvent(s),this._handleMouseWheel(this._customWheelEvent(t)),this.dispatchEvent(a))}function v(t){!1!==this.enabled&&this._handleKeyDown(t)}function E(t){switch(this._trackPointer(t),this._pointers.length){case 1:switch(this.touches.ONE){case o.TOUCH.ROTATE:if(!1===this.enableRotate)return;this._handleTouchStartRotate(t),this.state=3;break;case o.TOUCH.PAN:if(!1===this.enablePan)return;this._handleTouchStartPan(t),this.state=4;break;default:this.state=p}break;case 2:switch(this.touches.TWO){case o.TOUCH.DOLLY_PAN:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchStartDollyPan(t),this.state=5;break;case o.TOUCH.DOLLY_ROTATE:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchStartDollyRotate(t),this.state=6;break;default:this.state=p}break;default:this.state=p}this.state!==p&&this.dispatchEvent(s)}function S(t){switch(this._trackPointer(t),this.state){case 3:if(!1===this.enableRotate)return;this._handleTouchMoveRotate(t),this.update();break;case 4:if(!1===this.enablePan)return;this._handleTouchMovePan(t),this.update();break;case 5:if(!1===this.enableZoom&&!1===this.enablePan)return;this._handleTouchMoveDollyPan(t),this.update();break;case 6:if(!1===this.enableZoom&&!1===this.enableRotate)return;this._handleTouchMoveDollyRotate(t),this.update();break;default:this.state=p}}function M(t){!1!==this.enabled&&t.preventDefault()}function P(t){"Control"===t.key&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function R(t){"Control"===t.key&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}},487:(t,e,n)=>{n.d(e,{H:()=>U});var o=n(812),i=Uint8Array,s=Uint16Array,a=Int32Array,r=new i([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),l=new i([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),h=new i([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c=function(t,e){for(var n=new s(31),o=0;o<31;++o)n[o]=e+=1<<t[o-1];var i=new a(n[30]);for(o=1;o<30;++o)for(var r=n[o];r<n[o+1];++r)i[r]=r-n[o]<<5|o;return{b:n,r:i}},u=c(r,2),p=u.b,d=u.r;p[28]=258,d[258]=28;for(var f=c(l,0),m=f.b,_=(f.r,new s(32768)),y=0;y<32768;++y){var b=(43690&y)>>1|(21845&y)<<1;b=(61680&(b=(52428&b)>>2|(13107&b)<<2))>>4|(3855&b)<<4,_[y]=((65280&b)>>8|(255&b)<<8)>>1}var w=function(t,e,n){for(var o=t.length,i=0,a=new s(e);i<o;++i)t[i]&&++a[t[i]-1];var r,l=new s(e);for(i=1;i<e;++i)l[i]=l[i-1]+a[i-1]<<1;if(n){r=new s(1<<e);var h=15-e;for(i=0;i<o;++i)if(t[i])for(var c=i<<4|t[i],u=e-t[i],p=l[t[i]-1]++<<u,d=p|(1<<u)-1;p<=d;++p)r[_[p]>>h]=c}else for(r=new s(o),i=0;i<o;++i)t[i]&&(r[i]=_[l[t[i]-1]++]>>15-t[i]);return r},g=new i(288);for(y=0;y<144;++y)g[y]=8;for(y=144;y<256;++y)g[y]=9;for(y=256;y<280;++y)g[y]=7;for(y=280;y<288;++y)g[y]=8;var v=new i(32);for(y=0;y<32;++y)v[y]=5;var E=w(g,9,1),S=w(v,5,1),M=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},P=function(t,e,n){var o=e/8|0;return(t[o]|t[o+1]<<8)>>(7&e)&n},R=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},A=function(t){return(t+7)/8|0},C=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],D=function(t,e,n){var o=new Error(e||C[t]);if(o.code=t,Error.captureStackTrace&&Error.captureStackTrace(o,D),!n)throw o;return o},k=function(t,e,n,o){var s=t.length,a=o?o.length:0;if(!s||e.f&&!e.l)return n||new i(0);var c=!n,u=c||2!=e.i,d=e.i;c&&(n=new i(3*s));var f=function(t){var e=n.length;if(t>e){var o=new i(Math.max(2*e,t));o.set(n),n=o}},_=e.f||0,y=e.p||0,b=e.b||0,g=e.l,v=e.d,C=e.m,k=e.n,T=8*s;do{if(!g){_=P(t,y,1);var O=P(t,y+1,3);if(y+=3,!O){var x=t[(X=A(y)+4)-4]|t[X-3]<<8,U=X+x;if(U>s){d&&D(0);break}u&&f(b+x),n.set(t.subarray(X,U),b),e.b=b+=x,e.p=y=8*U,e.f=_;continue}if(1==O)g=E,v=S,C=9,k=5;else if(2==O){var L=P(t,y,31)+257,I=P(t,y+10,15)+4,z=L+P(t,y+5,31)+1;y+=14;for(var j=new i(z),N=new i(19),F=0;F<I;++F)N[h[F]]=P(t,y+3*F,7);y+=3*I;var H=M(N),V=(1<<H)-1,Y=w(N,H,1);for(F=0;F<z;){var X,Z=Y[P(t,y,V)];if(y+=15&Z,(X=Z>>4)<16)j[F++]=X;else{var B=0,G=0;for(16==X?(G=3+P(t,y,3),y+=2,B=j[F-1]):17==X?(G=3+P(t,y,7),y+=3):18==X&&(G=11+P(t,y,127),y+=7);G--;)j[F++]=B}}var W=j.subarray(0,L),K=j.subarray(L);C=M(W),k=M(K),g=w(W,C,1),v=w(K,k,1)}else D(1);if(y>T){d&&D(0);break}}u&&f(b+131072);for(var q=(1<<C)-1,Q=(1<<k)-1,$=y;;$=y){var J=(B=g[R(t,y)&q])>>4;if((y+=15&B)>T){d&&D(0);break}if(B||D(2),J<256)n[b++]=J;else{if(256==J){$=y,g=null;break}var tt=J-254;if(J>264){var et=r[F=J-257];tt=P(t,y,(1<<et)-1)+p[F],y+=et}var nt=v[R(t,y)&Q],ot=nt>>4;if(nt||D(3),y+=15&nt,K=m[ot],ot>3&&(et=l[ot],K+=R(t,y)&(1<<et)-1,y+=et),y>T){d&&D(0);break}u&&f(b+131072);var it=b+tt;if(b<K){var st=a-K,at=Math.min(K,it);for(st+b<0&&D(3);b<at;++b)n[b]=o[st+b]}for(;b<it;++b)n[b]=n[b-K]}}e.l=g,e.p=$,e.b=b,e.f=_,g&&(_=1,e.m=C,e.d=v,e.n=k)}while(!_);return b!=n.length&&c?function(t,e,n){return(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length),new i(t.subarray(e,n))}(n,0,b):n.subarray(0,b)},T=new i(0);function O(t,e){return k(t.subarray((n=t,o=e&&e.dictionary,(8!=(15&n[0])||n[0]>>4>7||(n[0]<<8|n[1])%31)&&D(6,"invalid zlib data"),(n[1]>>5&1)==+!o&&D(6,"invalid zlib data: "+(32&n[1]?"need":"unexpected")+" dictionary"),2+(n[1]>>3&4)),-4),{i:2},e&&e.out,e&&e.dictionary);var n,o}var x="undefined"!=typeof TextDecoder&&new TextDecoder;try{x.decode(T,{stream:!0})}catch(t){}"function"==typeof queueMicrotask?queueMicrotask:"function"==typeof setTimeout&&setTimeout;class U extends o.DataTextureLoader{constructor(t){super(t),this.type=o.HalfFloatType,this.outputFormat=o.RGBAFormat}parse(t){const e=65536,n=14,i=65537,s=Math.pow(2.7182818,2.2),a={l:0,c:0,lc:0};function r(t,e,n,o,i){for(;n<t;)e=e<<8|V(o,i),n+=8;n-=t,a.l=e>>n&(1<<t)-1,a.c=e,a.lc=n}const l=new Array(59);function h(t){return 63&t}function c(t){return t>>6}const u={c:0,lc:0};function p(t,e,n,o){t=t<<8|V(n,o),e+=8,u.c=t,u.lc=e}const d={c:0,lc:0};function f(t,e,n,o,i,s,a,r,l){if(t==e){o<8&&(p(n,o,i,s),n=u.c,o=u.lc);let t=n>>(o-=8);if(t=new Uint8Array([t])[0],r.value+t>l)return!1;const e=a[r.value-1];for(;t-- >0;)a[r.value++]=e}else{if(!(r.value<l))return!1;a[r.value++]=t}d.c=n,d.lc=o}function m(t){return 65535&t}function _(t){const e=m(t);return e>32767?e-65536:e}const y={a:0,b:0};function b(t,e){const n=_(t),o=_(e),i=n+(1&o)+(o>>1),s=i,a=i-o;y.a=s,y.b=a}function w(t,e){const n=m(t),o=m(e),i=n-(o>>1)&65535,s=o+i-32768&65535;y.a=s,y.b=i}function g(t,e,n,o,i,s,a){const r=a<16384,l=n>i?i:n;let h,c,u=1;for(;u<=l;)u<<=1;for(u>>=1,h=u,u>>=1;u>=1;){c=0;const a=c+s*(i-h),l=s*u,p=s*h,d=o*u,f=o*h;let m,_,g,v;for(;c<=a;c+=p){let i=c;const s=c+o*(n-h);for(;i<=s;i+=f){const n=i+d,o=i+l,s=o+d;r?(b(t[i+e],t[o+e]),m=y.a,g=y.b,b(t[n+e],t[s+e]),_=y.a,v=y.b,b(m,_),t[i+e]=y.a,t[n+e]=y.b,b(g,v),t[o+e]=y.a,t[s+e]=y.b):(w(t[i+e],t[o+e]),m=y.a,g=y.b,w(t[n+e],t[s+e]),_=y.a,v=y.b,w(m,_),t[i+e]=y.a,t[n+e]=y.b,w(g,v),t[o+e]=y.a,t[s+e]=y.b)}if(n&u){const n=i+l;r?b(t[i+e],t[n+e]):w(t[i+e],t[n+e]),m=y.a,t[n+e]=y.b,t[i+e]=m}}if(i&u){let i=c;const s=c+o*(n-h);for(;i<=s;i+=f){const n=i+d;r?b(t[i+e],t[n+e]):w(t[i+e],t[n+e]),m=y.a,t[n+e]=y.b,t[i+e]=m}}h=u,u>>=1}return c}function v(t,e,o,s,m,_){const y=o.value,b=H(e,o),w=H(e,o);o.value+=4;const g=H(e,o);if(o.value+=4,b<0||b>=i||w<0||w>=i)throw new Error("Something wrong with HUF_ENCSIZE");const v=new Array(i),E=new Array(16384);if(function(t){for(let e=0;e<16384;e++)t[e]={},t[e].len=0,t[e].lit=0,t[e].p=null}(E),function(t,e,n,o,s,h){const c=e;let u=0,p=0;for(;o<=s;o++){if(c.value-e.value>n)return!1;r(6,u,p,t,c);const i=a.l;if(u=a.c,p=a.lc,h[o]=i,63==i){if(c.value-e.value>n)throw new Error("Something wrong with hufUnpackEncTable");r(8,u,p,t,c);let i=a.l+6;if(u=a.c,p=a.lc,o+i>s+1)throw new Error("Something wrong with hufUnpackEncTable");for(;i--;)h[o++]=0;o--}else if(i>=59){let t=i-59+2;if(o+t>s+1)throw new Error("Something wrong with hufUnpackEncTable");for(;t--;)h[o++]=0;o--}}!function(t){for(let t=0;t<=58;++t)l[t]=0;for(let e=0;e<i;++e)l[t[e]]+=1;let e=0;for(let t=58;t>0;--t){const n=e+l[t]>>1;l[t]=e,e=n}for(let e=0;e<i;++e){const n=t[e];n>0&&(t[e]=n|l[n]++<<6)}}(h)}(t,o,s-(o.value-y),b,w,v),g>8*(s-(o.value-y)))throw new Error("Something wrong with hufUncompress");!function(t,e,o,i){for(;e<=o;e++){const o=c(t[e]),s=h(t[e]);if(o>>s)throw new Error("Invalid table entry");if(s>n){const t=i[o>>s-n];if(t.len)throw new Error("Invalid table entry");if(t.lit++,t.p){const e=t.p;t.p=new Array(t.lit);for(let n=0;n<t.lit-1;++n)t.p[n]=e[n]}else t.p=new Array(1);t.p[t.lit-1]=e}else if(s){let t=0;for(let a=1<<n-s;a>0;a--){const a=i[(o<<n-s)+t];if(a.len||a.p)throw new Error("Invalid table entry");a.len=s,a.lit=e,t++}}}}(v,b,w,E),function(t,e,o,i,s,a,r,l,m){let _=0,y=0;const b=r,w=Math.trunc(i.value+(s+7)/8);for(;i.value<w;)for(p(_,y,o,i),_=u.c,y=u.lc;y>=n;){const s=e[_>>y-n&16383];if(s.len)y-=s.len,f(s.lit,a,_,y,o,i,l,m,b),_=d.c,y=d.lc;else{if(!s.p)throw new Error("hufDecode issues");let e;for(e=0;e<s.lit;e++){const n=h(t[s.p[e]]);for(;y<n&&i.value<w;)p(_,y,o,i),_=u.c,y=u.lc;if(y>=n&&c(t[s.p[e]])==(_>>y-n&(1<<n)-1)){y-=n,f(s.p[e],a,_,y,o,i,l,m,b),_=d.c,y=d.lc;break}}if(e==s.lit)throw new Error("hufDecode issues")}}const g=8-s&7;for(_>>=g,y-=g;y>0;){const t=e[_<<n-y&16383];if(!t.len)throw new Error("hufDecode issues");y-=t.len,f(t.lit,a,_,y,o,i,l,m,b),_=d.c,y=d.lc}}(v,E,t,o,g,w,_,m,{value:0})}function E(t){for(let e=1;e<t.length;e++){const n=t[e-1]+t[e]-128;t[e]=n}}function S(t,e){let n=0,o=Math.floor((t.length+1)/2),i=0;const s=t.length-1;for(;!(i>s||(e[i++]=t[n++],i>s));)e[i++]=t[o++]}function M(t){let e=t.byteLength;const n=new Array;let o=0;const i=new DataView(t);for(;e>0;){const t=i.getInt8(o++);if(t<0){const s=-t;e-=s+1;for(let t=0;t<s;t++)n.push(i.getUint8(o++))}else{const s=t;e-=2;const a=i.getUint8(o++);for(let t=0;t<s+1;t++)n.push(a)}}return n}function P(t,e,n,o,i,s){const a=new DataView(s.buffer),r=n[t],l=r.width,h=r.height,c=Math.ceil(l/8),u=Math.ceil(h/8),p=Math.floor(l/8),d=l-8*(c-1),f=h-8*(u-1),m={value:0};let _=0;const y=new Float32Array(64),b=new Uint16Array(64),w=new Uint16Array(64*c);for(let n=0;n<u;++n){let s=8;n==u-1&&(s=f);for(let t=0;t<c;++t)b.fill(0),b[0]=i[_++],R(m,o,b),A(b,y),C(y),k(y,w,64*t);for(let o=8*n;o<8*n+s;++o){let n=e[t][o];for(let t=0;t<p;++t){const e=64*t+8*(7&o);for(let t=0;t<8;++t)a.setUint16(n+2*t*r.type,w[e+t],!0);n+=16*r.type}if(c!=p){const t=64*p+8*(7&o);for(let e=0;e<d;++e)a.setUint16(n+2*e*r.type,w[t+e],!0)}}}r.decoded=!0}function R(t,e,n){let o,i=1;for(;i<64;)o=e[t.value],65280==o?i=64:o>>8==255?i+=255&o:(n[i]=o,i++),t.value++}function A(t,e){e[0]=G(t[0]),e[1]=G(t[1]),e[2]=G(t[5]),e[3]=G(t[6]),e[4]=G(t[14]),e[5]=G(t[15]),e[6]=G(t[27]),e[7]=G(t[28]),e[8]=G(t[2]),e[9]=G(t[4]),e[10]=G(t[7]),e[11]=G(t[13]),e[12]=G(t[16]),e[13]=G(t[26]),e[14]=G(t[29]),e[15]=G(t[42]),e[16]=G(t[3]),e[17]=G(t[8]),e[18]=G(t[12]),e[19]=G(t[17]),e[20]=G(t[25]),e[21]=G(t[30]),e[22]=G(t[41]),e[23]=G(t[43]),e[24]=G(t[9]),e[25]=G(t[11]),e[26]=G(t[18]),e[27]=G(t[24]),e[28]=G(t[31]),e[29]=G(t[40]),e[30]=G(t[44]),e[31]=G(t[53]),e[32]=G(t[10]),e[33]=G(t[19]),e[34]=G(t[23]),e[35]=G(t[32]),e[36]=G(t[39]),e[37]=G(t[45]),e[38]=G(t[52]),e[39]=G(t[54]),e[40]=G(t[20]),e[41]=G(t[22]),e[42]=G(t[33]),e[43]=G(t[38]),e[44]=G(t[46]),e[45]=G(t[51]),e[46]=G(t[55]),e[47]=G(t[60]),e[48]=G(t[21]),e[49]=G(t[34]),e[50]=G(t[37]),e[51]=G(t[47]),e[52]=G(t[50]),e[53]=G(t[56]),e[54]=G(t[59]),e[55]=G(t[61]),e[56]=G(t[35]),e[57]=G(t[36]),e[58]=G(t[48]),e[59]=G(t[49]),e[60]=G(t[57]),e[61]=G(t[58]),e[62]=G(t[62]),e[63]=G(t[63])}function C(t){const e=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),o=.5*Math.cos(3.14159/8),i=.5*Math.cos(3*3.14159/16),s=.5*Math.cos(.981746875),a=.5*Math.cos(3*3.14159/8),r=.5*Math.cos(1.374445625),l=new Array(4),h=new Array(4),c=new Array(4),u=new Array(4);for(let p=0;p<8;++p){const d=8*p;l[0]=o*t[d+2],l[1]=a*t[d+2],l[2]=o*t[d+6],l[3]=a*t[d+6],h[0]=n*t[d+1]+i*t[d+3]+s*t[d+5]+r*t[d+7],h[1]=i*t[d+1]-r*t[d+3]-n*t[d+5]-s*t[d+7],h[2]=s*t[d+1]-n*t[d+3]+r*t[d+5]+i*t[d+7],h[3]=r*t[d+1]-s*t[d+3]+i*t[d+5]-n*t[d+7],c[0]=e*(t[d+0]+t[d+4]),c[3]=e*(t[d+0]-t[d+4]),c[1]=l[0]+l[3],c[2]=l[1]-l[2],u[0]=c[0]+c[1],u[1]=c[3]+c[2],u[2]=c[3]-c[2],u[3]=c[0]-c[1],t[d+0]=u[0]+h[0],t[d+1]=u[1]+h[1],t[d+2]=u[2]+h[2],t[d+3]=u[3]+h[3],t[d+4]=u[3]-h[3],t[d+5]=u[2]-h[2],t[d+6]=u[1]-h[1],t[d+7]=u[0]-h[0]}for(let p=0;p<8;++p)l[0]=o*t[16+p],l[1]=a*t[16+p],l[2]=o*t[48+p],l[3]=a*t[48+p],h[0]=n*t[8+p]+i*t[24+p]+s*t[40+p]+r*t[56+p],h[1]=i*t[8+p]-r*t[24+p]-n*t[40+p]-s*t[56+p],h[2]=s*t[8+p]-n*t[24+p]+r*t[40+p]+i*t[56+p],h[3]=r*t[8+p]-s*t[24+p]+i*t[40+p]-n*t[56+p],c[0]=e*(t[p]+t[32+p]),c[3]=e*(t[p]-t[32+p]),c[1]=l[0]+l[3],c[2]=l[1]-l[2],u[0]=c[0]+c[1],u[1]=c[3]+c[2],u[2]=c[3]-c[2],u[3]=c[0]-c[1],t[0+p]=u[0]+h[0],t[8+p]=u[1]+h[1],t[16+p]=u[2]+h[2],t[24+p]=u[3]+h[3],t[32+p]=u[3]-h[3],t[40+p]=u[2]-h[2],t[48+p]=u[1]-h[1],t[56+p]=u[0]-h[0]}function D(t){for(let e=0;e<64;++e){const n=t[0][e],o=t[1][e],i=t[2][e];t[0][e]=n+1.5747*i,t[1][e]=n-.1873*o-.4682*i,t[2][e]=n+1.8556*o}}function k(t,e,n){for(let i=0;i<64;++i)e[n+i]=o.DataUtils.toHalfFloat(T(t[i]))}function T(t){return t<=1?Math.sign(t)*Math.pow(Math.abs(t),2.2):Math.sign(t)*Math.pow(s,Math.abs(t)-1)}function x(t){return new DataView(t.array.buffer,t.offset.value,t.size)}function U(t){const e=t.viewer.buffer.slice(t.offset.value,t.offset.value+t.size),n=new Uint8Array(M(e)),o=new Uint8Array(n.length);return E(n),S(n,o),new DataView(o.buffer)}function L(t){const e=O(t.array.slice(t.offset.value,t.offset.value+t.size)),n=new Uint8Array(e.length);return E(e),S(e,n),new DataView(n.buffer)}function I(t){const n=t.viewer,o={value:t.offset.value},i=new Uint16Array(t.columns*t.lines*(t.inputChannels.length*t.type)),s=new Uint8Array(8192);let a=0;const r=new Array(t.inputChannels.length);for(let e=0,n=t.inputChannels.length;e<n;e++)r[e]={},r[e].start=a,r[e].end=r[e].start,r[e].nx=t.columns,r[e].ny=t.lines,r[e].size=t.type,a+=r[e].nx*r[e].ny*r[e].size;const l=W(n,o),h=W(n,o);if(h>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(l<=h)for(let t=0;t<h-l+1;t++)s[t+l]=Y(n,o);const c=new Uint16Array(e),u=function(t,n){let o=0;for(let i=0;i<e;++i)(0==i||t[i>>3]&1<<(7&i))&&(n[o++]=i);const i=o-1;for(;o<e;)n[o++]=0;return i}(s,c),p=H(n,o);v(t.array,n,o,p,i,a);for(let e=0;e<t.inputChannels.length;++e){const t=r[e];for(let n=0;n<r[e].size;++n)g(i,t.start+n,t.nx,t.size,t.ny,t.nx*t.size,u)}!function(t,e,n){for(let o=0;o<n;++o)e[o]=t[e[o]]}(c,i,a);let d=0;const f=new Uint8Array(i.buffer.byteLength);for(let e=0;e<t.lines;e++)for(let e=0;e<t.inputChannels.length;e++){const t=r[e],n=t.nx*t.size,o=new Uint8Array(i.buffer,2*t.end,2*n);f.set(o,d),d+=2*n,t.end+=n}return new DataView(f.buffer)}function z(t){const e=O(t.array.slice(t.offset.value,t.offset.value+t.size)),n=t.inputChannels.length*t.lines*t.columns*t.totalBytes,o=new ArrayBuffer(n),i=new DataView(o);let s=0,a=0;const r=new Array(4);for(let n=0;n<t.lines;n++)for(let n=0;n<t.inputChannels.length;n++){let o=0;switch(t.inputChannels[n].pixelType){case 1:r[0]=s,r[1]=r[0]+t.columns,s=r[1]+t.columns;for(let n=0;n<t.columns;++n)o+=e[r[0]++]<<8|e[r[1]++],i.setUint16(a,o,!0),a+=2;break;case 2:r[0]=s,r[1]=r[0]+t.columns,r[2]=r[1]+t.columns,s=r[2]+t.columns;for(let n=0;n<t.columns;++n)o+=e[r[0]++]<<24|e[r[1]++]<<16|e[r[2]++]<<8,i.setUint32(a,o,!0),a+=4}}return i}function j(t){const e=t.viewer,n={value:t.offset.value},o=new Uint8Array(t.columns*t.lines*(t.inputChannels.length*t.type*2)),i={version:X(e,n),unknownUncompressedSize:X(e,n),unknownCompressedSize:X(e,n),acCompressedSize:X(e,n),dcCompressedSize:X(e,n),rleCompressedSize:X(e,n),rleUncompressedSize:X(e,n),rleRawSize:X(e,n),totalAcUncompressedCount:X(e,n),totalDcUncompressedCount:X(e,n),acCompression:X(e,n)};if(i.version<2)throw new Error("EXRLoader.parse: "+ot.compression+" version "+i.version+" is unsupported");const s=new Array;let a=W(e,n)-2;for(;a>0;){const t=N(e.buffer,n),o=Y(e,n),i=o>>2&3,r=new Int8Array([(o>>4)-1])[0],l=Y(e,n);s.push({name:t,index:r,type:l,compression:i}),a-=t.length+3}const r=ot.channels,l=new Array(t.inputChannels.length);for(let e=0;e<t.inputChannels.length;++e){const n=l[e]={},o=r[e];n.name=o.name,n.compression=0,n.decoded=!1,n.type=o.pixelType,n.pLinear=o.pLinear,n.width=t.columns,n.height=t.lines}const h={idx:new Array(3)};for(let e=0;e<t.inputChannels.length;++e){const t=l[e];for(let n=0;n<s.length;++n){const o=s[n];t.name==o.name&&(t.compression=o.compression,o.index>=0&&(h.idx[o.index]=e),t.offset=e)}}let c,u,p;if(i.acCompressedSize>0)switch(i.acCompression){case 0:c=new Uint16Array(i.totalAcUncompressedCount),v(t.array,e,n,i.acCompressedSize,c,i.totalAcUncompressedCount);break;case 1:const o=O(t.array.slice(n.value,n.value+i.totalAcUncompressedCount));c=new Uint16Array(o.buffer),n.value+=i.totalAcUncompressedCount}if(i.dcCompressedSize>0){const e={array:t.array,offset:n,size:i.dcCompressedSize};u=new Uint16Array(L(e).buffer),n.value+=i.dcCompressedSize}i.rleRawSize>0&&(p=M(O(t.array.slice(n.value,n.value+i.rleCompressedSize)).buffer),n.value+=i.rleCompressedSize);let d=0;const f=new Array(l.length);for(let t=0;t<f.length;++t)f[t]=new Array;for(let e=0;e<t.lines;++e)for(let e=0;e<l.length;++e)f[e].push(d),d+=l[e].width*t.type*2;void 0!==h.idx[0]&&l[h.idx[0]]&&function(t,e,n,o,i,s){let a=new DataView(s.buffer);const r=n[t.idx[0]].width,l=n[t.idx[0]].height,h=Math.floor(r/8),c=Math.ceil(r/8),u=Math.ceil(l/8),p=r-8*(c-1),d=l-8*(u-1),f={value:0},m=new Array(3),_=new Array(3),y=new Array(3),b=new Array(3),w=new Array(3);for(let n=0;n<3;++n)w[n]=e[t.idx[n]],m[n]=n<1?0:m[n-1]+c*u,_[n]=new Float32Array(64),y[n]=new Uint16Array(64),b[n]=new Uint16Array(64*c);for(let e=0;e<u;++e){let s=8;e==u-1&&(s=d);let r=8;for(let t=0;t<c;++t){t==c-1&&(r=p);for(let t=0;t<3;++t)y[t].fill(0),y[t][0]=i[m[t]++],R(f,o,y[t]),A(y[t],_[t]),C(_[t]);D(_);for(let e=0;e<3;++e)k(_[e],b[e],64*t)}let l=0;for(let o=0;o<3;++o){const i=n[t.idx[o]].type;for(let t=8*e;t<8*e+s;++t){l=w[o][t];for(let e=0;e<h;++e){const n=64*e+8*(7&t);a.setUint16(l+0*i,b[o][n+0],!0),a.setUint16(l+2*i,b[o][n+1],!0),a.setUint16(l+4*i,b[o][n+2],!0),a.setUint16(l+6*i,b[o][n+3],!0),a.setUint16(l+8*i,b[o][n+4],!0),a.setUint16(l+10*i,b[o][n+5],!0),a.setUint16(l+12*i,b[o][n+6],!0),a.setUint16(l+14*i,b[o][n+7],!0),l+=16*i}}if(h!=c)for(let t=8*e;t<8*e+s;++t){const e=w[o][t]+8*h*2*i,n=64*h+8*(7&t);for(let t=0;t<r;++t)a.setUint16(e+2*t*i,b[o][n+t],!0)}}}const g=new Uint16Array(r);a=new DataView(s.buffer);for(let e=0;e<3;++e){n[t.idx[e]].decoded=!0;const o=n[t.idx[e]].type;if(2==n[e].type)for(let t=0;t<l;++t){const n=w[e][t];for(let t=0;t<r;++t)g[t]=a.getUint16(n+2*t*o,!0);for(let t=0;t<r;++t)a.setFloat32(n+2*t*o,G(g[t]),!0)}}}(h,f,l,c,u,o);for(let e=0;e<l.length;++e){const n=l[e];if(!n.decoded)switch(n.compression){case 2:let i=0,s=0;for(let a=0;a<t.lines;++a){let t=f[e][i];for(let e=0;e<n.width;++e){for(let e=0;e<2*n.type;++e)o[t++]=p[s+e*n.width*n.height];s++}i++}break;case 1:P(e,f,l,c,u,o);break;default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(o.buffer)}function N(t,e){const n=new Uint8Array(t);let o=0;for(;0!=n[e.value+o];)o+=1;const i=(new TextDecoder).decode(n.slice(e.value,e.value+o));return e.value=e.value+o+1,i}function F(t,e){const n=t.getInt32(e.value,!0);return e.value=e.value+4,n}function H(t,e){const n=t.getUint32(e.value,!0);return e.value=e.value+4,n}function V(t,e){const n=t[e.value];return e.value=e.value+1,n}function Y(t,e){const n=t.getUint8(e.value);return e.value=e.value+1,n}const X=function(t,e){let n;return n="getBigInt64"in DataView.prototype?Number(t.getBigInt64(e.value,!0)):t.getUint32(e.value+4,!0)+Number(t.getUint32(e.value,!0)<<32),e.value+=8,n};function Z(t,e){const n=t.getFloat32(e.value,!0);return e.value+=4,n}function B(t,e){return o.DataUtils.toHalfFloat(Z(t,e))}function G(t){const e=(31744&t)>>10,n=1023&t;return(t>>15?-1:1)*(e?31===e?n?NaN:1/0:Math.pow(2,e-15)*(1+n/1024):n/1024*6103515625e-14)}function W(t,e){const n=t.getUint16(e.value,!0);return e.value+=2,n}function K(t,e){return G(W(t,e))}function q(t,e,n,o,i){return"string"===o||"stringvector"===o||"iccProfile"===o?function(t,e,n){const o=(new TextDecoder).decode(new Uint8Array(t).slice(e.value,e.value+n));return e.value=e.value+n,o}(e,n,i):"chlist"===o?function(t,e,n,o){const i=n.value,s=[];for(;n.value<i+o-1;){const o=N(e,n),i=F(t,n),a=Y(t,n);n.value+=3;const r=F(t,n),l=F(t,n);s.push({name:o,pixelType:i,pLinear:a,xSampling:r,ySampling:l})}return n.value+=1,s}(t,e,n,i):"chromaticities"===o?function(t,e){return{redX:Z(t,e),redY:Z(t,e),greenX:Z(t,e),greenY:Z(t,e),blueX:Z(t,e),blueY:Z(t,e),whiteX:Z(t,e),whiteY:Z(t,e)}}(t,n):"compression"===o?function(t,e){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][Y(t,e)]}(t,n):"box2i"===o?function(t,e){return{xMin:F(t,e),yMin:F(t,e),xMax:F(t,e),yMax:F(t,e)}}(t,n):"envmap"===o?function(t,e){return["ENVMAP_LATLONG","ENVMAP_CUBE"][Y(t,e)]}(t,n):"tiledesc"===o?function(t,e){const n=H(t,e),o=H(t,e),i=Y(t,e);return{xSize:n,ySize:o,levelMode:["ONE_LEVEL","MIPMAP_LEVELS","RIPMAP_LEVELS"][15&i],roundingMode:["ROUND_DOWN","ROUND_UP"][i>>4]}}(t,n):"lineOrder"===o?function(t,e){return["INCREASING_Y","DECREASING_Y","RANDOM_Y"][Y(t,e)]}(t,n):"float"===o?Z(t,n):"v2f"===o?function(t,e){return[Z(t,e),Z(t,e)]}(t,n):"v3f"===o?function(t,e){return[Z(t,e),Z(t,e),Z(t,e)]}(t,n):"int"===o?F(t,n):"rational"===o?function(t,e){return[F(t,e),H(t,e)]}(t,n):"timecode"===o?function(t,e){return[H(t,e),H(t,e)]}(t,n):"preview"===o?(n.value+=i,"skipped"):void(n.value+=i)}function Q(t,e,n,o){const i=new Array(t);for(let s=0;s<t;s++){const t=1<<s;let a=e/t|0;"ROUND_UP"==o&&a*t<e&&(a+=1);const r=Math.max(a,1);i[s]=(r+n-1)/n|0}return i}function $(){const t=this,e=t.offset,n={value:0};for(let o=0;o<t.tileCount;o++){const o=F(t.viewer,e),i=F(t.viewer,e);e.value+=8,t.size=H(t.viewer,e);const s=o*t.blockWidth,a=i*t.blockHeight;t.columns=s+t.blockWidth>t.width?t.width-s:t.blockWidth,t.lines=a+t.blockHeight>t.height?t.height-a:t.blockHeight;const r=t.columns*t.totalBytes,l=t.size<t.lines*r?t.uncompress(t):x(t);e.value+=t.size;for(let e=0;e<t.lines;e++){const o=e*t.columns*t.totalBytes;for(let i=0;i<t.inputChannels.length;i++){const r=ot.channels[i].name,h=t.channelByteOffsets[r]*t.columns,c=t.decodeChannels[r];if(void 0===c)continue;n.value=o+h;const u=(t.height-(1+a+e))*t.outLineWidth;for(let e=0;e<t.columns;e++){const o=u+(e+s)*t.outputChannels+c;t.byteArray[o]=t.getter(l,n)}}}}}function J(){const t=this,e=t.offset,n={value:0};for(let o=0;o<t.height/t.blockHeight;o++){const i=F(t.viewer,e)-ot.dataWindow.yMin;t.size=H(t.viewer,e),t.lines=i+t.blockHeight>t.height?t.height-i:t.blockHeight;const s=t.columns*t.totalBytes,a=t.size<t.lines*s?t.uncompress(t):x(t);e.value+=t.size;for(let e=0;e<t.blockHeight;e++){const i=o*t.blockHeight,r=e+t.scanOrder(i);if(r>=t.height)continue;const l=e*s,h=(t.height-1-r)*t.outLineWidth;for(let e=0;e<t.inputChannels.length;e++){const o=ot.channels[e].name,i=t.channelByteOffsets[o]*t.columns,s=t.decodeChannels[o];if(void 0!==s){n.value=l+i;for(let e=0;e<t.columns;e++){const o=h+e*t.outputChannels+s;t.byteArray[o]=t.getter(a,n)}}}}}}const tt={value:0},et=new DataView(t),nt=new Uint8Array(t),ot=function(t,e,n){const o={};if(20000630!=t.getUint32(0,!0))throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");o.version=t.getUint8(4);const i=t.getUint8(5);o.spec={singleTile:!!(2&i),longName:!!(4&i),deepFormat:!!(8&i),multiPart:!!(16&i)},n.value=8;let s=!0;for(;s;){const i=N(e,n);if(""===i)s=!1;else{const s=N(e,n),a=q(t,e,n,s,H(t,n));void 0===a?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${s}'.`):o[i]=a}}if(-7&i)throw console.error("THREE.EXRHeader:",o),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return o}(et,t,tt),it=function(t,e,n,i,s,a){const r={size:0,viewer:e,array:n,offset:i,width:t.dataWindow.xMax-t.dataWindow.xMin+1,height:t.dataWindow.yMax-t.dataWindow.yMin+1,inputChannels:t.channels,channelByteOffsets:{},shouldExpand:!1,scanOrder:null,totalBytes:null,columns:null,lines:null,type:null,uncompress:null,getter:null,format:null,colorSpace:o.LinearSRGBColorSpace};switch(t.compression){case"NO_COMPRESSION":r.blockHeight=1,r.uncompress=x;break;case"RLE_COMPRESSION":r.blockHeight=1,r.uncompress=U;break;case"ZIPS_COMPRESSION":r.blockHeight=1,r.uncompress=L;break;case"ZIP_COMPRESSION":r.blockHeight=16,r.uncompress=L;break;case"PIZ_COMPRESSION":r.blockHeight=32,r.uncompress=I;break;case"PXR24_COMPRESSION":r.blockHeight=16,r.uncompress=z;break;case"DWAA_COMPRESSION":r.blockHeight=32,r.uncompress=j;break;case"DWAB_COMPRESSION":r.blockHeight=256,r.uncompress=j;break;default:throw new Error("EXRLoader.parse: "+t.compression+" is unsupported")}const l={};for(const e of t.channels)switch(e.name){case"Y":case"R":case"G":case"B":case"A":l[e.name]=!0,r.type=e.pixelType}let h=!1,c=!1;if(l.R&&l.G&&l.B)r.outputChannels=4;else{if(!l.Y)throw new Error("EXRLoader.parse: file contains unsupported data channels.");r.outputChannels=1}switch(r.outputChannels){case 4:a==o.RGBAFormat?(h=!l.A,r.format=o.RGBAFormat,r.colorSpace=o.LinearSRGBColorSpace,r.outputChannels=4,r.decodeChannels={R:0,G:1,B:2,A:3}):a==o.RGFormat?(r.format=o.RGFormat,r.colorSpace=o.LinearSRGBColorSpace,r.outputChannels=2,r.decodeChannels={R:0,G:1}):a==o.RedFormat?(r.format=o.RedFormat,r.colorSpace=o.LinearSRGBColorSpace,r.outputChannels=1,r.decodeChannels={R:0}):c=!0;break;case 1:a==o.RGBAFormat?(h=!0,r.format=o.RGBAFormat,r.colorSpace=o.LinearSRGBColorSpace,r.outputChannels=4,r.shouldExpand=!0,r.decodeChannels={Y:0}):a==o.RGFormat?(r.format=o.RGFormat,r.colorSpace=o.LinearSRGBColorSpace,r.outputChannels=2,r.shouldExpand=!0,r.decodeChannels={Y:0}):a==o.RedFormat?(r.format=o.RedFormat,r.colorSpace=o.LinearSRGBColorSpace,r.outputChannels=1,r.decodeChannels={Y:0}):c=!0;break;default:c=!0}if(c)throw new Error("EXRLoader.parse: invalid output format for specified file.");if(1==r.type)switch(s){case o.FloatType:r.getter=K;break;case o.HalfFloatType:r.getter=W}else{if(2!=r.type)throw new Error("EXRLoader.parse: unsupported pixelType "+r.type+" for "+t.compression+".");switch(s){case o.FloatType:r.getter=Z;break;case o.HalfFloatType:r.getter=B}}r.columns=r.width;const u=r.width*r.height*r.outputChannels;switch(s){case o.FloatType:r.byteArray=new Float32Array(u),h&&r.byteArray.fill(1,0,u);break;case o.HalfFloatType:r.byteArray=new Uint16Array(u),h&&r.byteArray.fill(15360,0,u);break;default:console.error("THREE.EXRLoader: unsupported type: ",s)}let p=0;for(const e of t.channels)void 0!==r.decodeChannels[e.name]&&(r.channelByteOffsets[e.name]=p),p+=2*e.pixelType;if(r.totalBytes=p,r.outLineWidth=r.width*r.outputChannels,"INCREASING_Y"===t.lineOrder?r.scanOrder=t=>t:r.scanOrder=t=>r.height-1-t,t.spec.singleTile){r.blockHeight=t.tiles.ySize,r.blockWidth=t.tiles.xSize;const n=function(t,e,n){let o=0;switch(t.levelMode){case"ONE_LEVEL":o=1;break;case"MIPMAP_LEVELS":o=function(t,e){const n=Math.log2(t);return"ROUND_DOWN"==e?Math.floor(n):Math.ceil(n)}(Math.max(e,n),t.roundingMode)+1;break;case"RIPMAP_LEVELS":throw new Error("THREE.EXRLoader: RIPMAP_LEVELS tiles currently unsupported.")}return o}(t.tiles,r.width,r.height),o=Q(n,r.width,t.tiles.xSize,t.tiles.roundingMode),s=Q(n,r.height,t.tiles.ySize,t.tiles.roundingMode);r.tileCount=o[0]*s[0];for(let t=0;t<n;t++)for(let n=0;n<s[t];n++)for(let n=0;n<o[t];n++)X(e,i);r.decode=$.bind(r)}else{r.blockWidth=r.width;const t=Math.ceil(r.height/r.blockHeight);for(let n=0;n<t;n++)X(e,i);r.decode=J.bind(r)}return r}(ot,et,nt,tt,this.type,this.outputFormat);if(it.decode(),it.shouldExpand){const t=it.byteArray;if(this.outputFormat==o.RGBAFormat)for(let e=0;e<t.length;e+=4)t[e+2]=t[e+1]=t[e];else if(this.outputFormat==o.RGFormat)for(let e=0;e<t.length;e+=2)t[e+1]=t[e]}return{header:ot,width:it.width,height:it.height,data:it.byteArray,format:it.format,colorSpace:it.colorSpace,type:this.type}}setDataType(t){return this.type=t,this}setOutputFormat(t){return this.outputFormat=t,this}load(t,e,n,i){return super.load(t,function(t,n){t.colorSpace=n.colorSpace,t.minFilter=o.LinearFilter,t.magFilter=o.LinearFilter,t.generateMipmaps=!1,t.flipY=!1,e&&e(t,n)},n,i)}}}}]);