(()=>{"use strict";var __webpack_modules__={307:(e,t,o)=>{var n={};o.r(n),o.d(n,{AudioControl:()=>Qa,BoolEdit:()=>Ta,Buttons:()=>Jn,ColorString:()=>Qs,CustomInput:()=>Un,DimensionsEdit:()=>Ur,EditColor:()=>Js,ElementView:()=>qn,EulerBlock:()=>Es,ExpandedButton:()=>en,ExtMenu:()=>Pn,FileSelect:()=>hr,Float:()=>qa,FloatBlock:()=>os,FontSize:()=>Xr,Icon:()=>an,ImageView:()=>nr,Int:()=>ja,ItemsLib:()=>bl,Label:()=>$r,LabelEdit:()=>Ps,LoginForm:()=>Ql,Modal:()=>un,ModalForm:()=>Vr,ModelPreview:()=>dr,PopupList:()=>fn,ProjectItem:()=>Sl,QuaternionBlock:()=>Bs,RadioButton:()=>na,Range:()=>tl,SearchFilter:()=>ca,SectionSelect:()=>wr,Selectable:()=>Sa,ShadowEdit:()=>Ar,SimpleButton:()=>bn,SlideBlock:()=>pa,Spinner:()=>Vn,TextColorEdit:()=>qr,TextEdit:()=>Ts,Toast:()=>Tn,Toasts:()=>$n,ToggleButton:()=>_n,TransformEdit:()=>Gs,TreeLi:()=>ga,TwoSideBool:()=>vr,UILabel:()=>ei,V2:()=>rs,V3:()=>ps,V3block:()=>vs,confirmform:()=>Ml,params:()=>Fa,queryform:()=>xl,vlist:()=>xa});var a={};o.r(a),o.d(a,{actions:()=>nd,analitycs:()=>sp,app:()=>ap,assets:()=>ep,engine:()=>rc,inspector:()=>pp,menu:()=>fp,modal:()=>fi,models:()=>Ri,modules:()=>Ci,prefabs:()=>yp,project:()=>Ap,projects:()=>Up,selection:()=>Hp,slides:()=>ec,storage:()=>Kp,templates:()=>Eu,toasts:()=>ui,translations:()=>xu,ui:()=>Au});var s=o(15);const r={class:"app-container canvas-container"},l={class:"workspace"},i={id:"editorcanvas",ref:"editorcanvas"},c={id:"playui",ref:"playui"},d={key:0,class:"splash"},p={class:"container"},u={class:"topline"},m={class:"title"},h={class:"info"},f=["onClick"],v={key:0},g={class:"element"},y=["innerHTML"],b=["onClick"],k={key:0},w={class:"panel-container"},E={class:"panel"},_={class:"header"},S={class:"content"},N={class:"footer"},V={props:{header:{type:Object,default:{label:""}},footer:{type:Object,default:{}}},data:()=>({visible:{heirarhy:!0}})};var C=o(262);const B=(0,C.A)(V,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",w,[(0,s.createElementVNode)("div",E,[(0,s.createElementVNode)("div",_,[(0,s.renderSlot)(e.$slots,"header")]),(0,s.createElementVNode)("div",S,[(0,s.renderSlot)(e.$slots,"default")]),(0,s.createElementVNode)("div",N,[(0,s.renderSlot)(e.$slots,"footer")])])])}]]),$={class:"slide-scroller",ref:"scroller"},x=["onClick","onDragstart","onDrop"],D={class:"title"},I=["src"],T=["src"],A={class:"overflow"},M=["src"],O={class:"overflow"},j=o.p+"assets/3d592ccd944e1f3ef7b0.png",P={props:{slides:{type:Array,required:!0},slide:{type:Object}},data:()=>({slideData:{name:{label:"Имя",value:""}},translateX:0,draggedIndex:null,cardbg:j}),watch:{slide(){this.centerSelectedImage()},slides(){this.slides.sort((e,t)=>e.index-t.index),this.centerSelectedImage()}},mounted(){this.slides.sort((e,t)=>e.index-t.index),this.centerSelectedImage(),this.observer=new ResizeObserver(this.centerSelectedImage.bind(this)),this.observer.observe(this.$refs.scroller)},beforeUnmount(){this.observer.disconnect()},methods:{onDragStart(e){this.draggedIndex=e},async onDrop(e){if(null===this.draggedIndex||this.draggedIndex===e)return;const t=this.slides.splice(this.draggedIndex,1)[0];this.slides.splice(e,0,t);const o=Math.min(this.draggedIndex,e),n=Math.max(this.draggedIndex,e);for(let e=o;e<=n;e++){const t=this.slides[e];t.index=e,await this.$app.slides.save(t)}this.draggedIndex=null,this.$nextTick(this.centerSelectedImage)},onScroll(e){e.deltaY>0?this.$app.slides.next():e.deltaY<0&&this.$app.slides.back()},addSlide(){const e=(0,s.reactive)({title:"Adding a slide",text:"Specify the slide title",answer:""}),t=(0,s.reactive)({label:"Create",class:"primary",disabled:e.answer.length<1,callback:async t=>{const o=await this.$app.slides.add({name:e.answer});this.$app.toasts.add({message:`Slide ${o.name} added`}),this.selectSlide(o),this.centerSelectedImage()}});this.$app.modal.queryText(e,[t],o=>{e.answer=o,t.disabled=e.answer.length<1})},removeSlide(){this.$app.modal.open({header:{value:"Delete slide",handler:()=>{this.$app.modal.close()}},content:{},footer:{buttons:[{label:"Delete",class:"secondary",handler:async()=>{this.$app.modal.close(),this.$app.slides.remove()}},{label:"Cancel",class:"primary",handler:async()=>{this.$app.modal.close()}}]}})},selectSlide(e){this.$app.slides.goto(e.uid)},centerSelectedImage(){this.$nextTick(()=>{const e=this.$refs.scroller.offsetWidth,t=this.$refs.scroller.querySelector(".slide-item.selected");if(t){const o=t.offsetWidth,n=t.offsetLeft;this.translateX=-(n-e/2+o/2)}else this.translateX=.5*e})}}},R=(0,C.A)(P,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",$,[(0,s.createElementVNode)("div",{class:"slide-container",onWheelPassive:t[3]||(t[3]=(...e)=>r.onScroll&&r.onScroll(...e)),style:(0,s.normalizeStyle)({transform:`translateX(${a.translateX}px)`})},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.slides,(e,n)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:n,class:(0,s.normalizeClass)(["slide-item",{selected:e===o.slide}]),onClick:t=>r.selectSlide(e),draggable:"true",onDragstart:e=>r.onDragStart(n),onDragover:t[0]||(t[0]=(0,s.withModifiers)(()=>{},["prevent"])),onDrop:e=>r.onDrop(n)},[(0,s.createElementVNode)("div",D,(0,s.toDisplayString)(e.name),1),(0,s.createElementVNode)("img",{src:a.cardbg,alt:"Image"},null,8,I)],42,x))),128)),(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"slide-item",onClick:t[1]||(t[1]=e=>r.addSlide())},[(0,s.createElementVNode)("img",{src:a.cardbg,alt:"Image"},null,8,T),(0,s.createElementVNode)("div",A,[(0,s.createVNode)(l,{value:"add_to_queue",size:"1em"})])])),[[i,"Add slide"]]),(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"slide-item",onClick:t[2]||(t[2]=e=>r.removeSlide())},[(0,s.createElementVNode)("img",{src:a.cardbg,alt:"Image"},null,8,M),(0,s.createElementVNode)("div",O,[(0,s.createVNode)(l,{value:"remove_from_queue",size:"1em"})])])),[[i,"Remove slide"]])],36)],512)}],["__scopeId","data-v-14c1e910"]]),L={class:"panel-container"},F={class:"panel"},U={key:0,class:"content"},z={class:"elements"},H={data:()=>({visible:!1})},q=(0,C.A)(H,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",L,[(0,s.createElementVNode)("div",F,[(0,s.createElementVNode)("div",{onClick:t[0]||(t[0]=e=>a.visible=!a.visible),class:"header"},"Hierarhy"),a.visible?((0,s.openBlock)(),(0,s.createElementBlock)("div",U,[(0,s.createElementVNode)("div",z,[(0,s.renderSlot)(e.$slots,"default",{},void 0,!0)])])):(0,s.createCommentVNode)("v-if",!0)])])}],["__scopeId","data-v-e71891a0"]]),G={key:0,class:"element"},W=["onClick"],K={key:1,class:"label"},J={class:"collapsible-panel"},Y={class:"panel-header"},X={key:1,class:"toggle-icon"},Q={class:"header-content"},Z={__name:"inspectorpanel",props:{label:{type:String,required:!0},tooltip:{type:String,default:""},stat:{type:Boolean,default:!1}},setup(e,{expose:t}){const o=(0,s.useSlots)(),n=(0,s.ref)(!1),a=(0,s.ref)(null),r=()=>{o.content&&(n.value=!n.value,console.log("toggle",n.value))};return t({togglePanel:r,openPanel:()=>{o.content&&(n.value=!0)},closePanel:()=>{o.content&&(n.value=!1)},isOpen:n}),(t,l)=>{const i=(0,s.resolveDirective)("translate"),c=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",J,[(0,s.createElementVNode)("div",Y,[(0,s.unref)(o).content?((0,s.openBlock)(),(0,s.createElementBlock)("span",{key:0,onClick:r,class:(0,s.normalizeClass)(["toggle-icon",{open:n.value}])},"▼",2)):((0,s.openBlock)(),(0,s.createElementBlock)("span",X)),(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",Q,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("span",{onClick:r,class:"label"},[(0,s.createTextVNode)((0,s.toDisplayString)(e.label),1)])),[[i,`$$inspector.${e.label}`]]),(0,s.createVNode)(s.Transition,{name:"fade"},{default:(0,s.withCtx)(()=>[(0,s.renderSlot)(t.$slots,"head",{label:e.label,togglePanel:r},()=>[(0,s.withDirectives)((0,s.createElementVNode)("div",{ref_key:"panelHeader",ref:a},null,512),[[s.vShow,!n.value]])])]),_:3})])),[[c,e.tooltip]]),(0,s.renderSlot)(t.$slots,"icons",{stat:e.stat,togglePanel:r})]),(0,s.createVNode)(s.Transition,{name:"slide",persisted:""},{default:(0,s.withCtx)(()=>[(0,s.withDirectives)((0,s.createElementVNode)("div",{class:"panel-content",style:(0,s.normalizeStyle)({overflow:n.value?"":"hidden"})},[(0,s.renderSlot)(t.$slots,"content",{togglePanel:r})],4),[[s.vShow,n.value]])]),_:3})])}}},ee=(0,C.A)(Z,[["__scopeId","data-v-09b67a80"]]),te={style:{display:"grid","grid-template-columns":"96px 1fr"}},oe=["value"],ne={key:1},ae={name:"ModelTypes",data:()=>({types:["model","camera","chart3d"]}),props:{selected:{type:Object}}},se=(0,C.A)(ae,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",te,[t[1]||(t[1]=(0,s.createElementVNode)("div",null,"Тип:",-1)),a.types.includes(o.selected.type)?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("select",{key:0,class:"typeslist","onUpdate:modelValue":t[0]||(t[0]=e=>o.selected.type=e)},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(a.types,e=>((0,s.openBlock)(),(0,s.createElementBlock)("option",{value:e},(0,s.toDisplayString)(e),9,oe))),256))],512)),[[s.vModelSelect,o.selected.type]]):((0,s.openBlock)(),(0,s.createElementBlock)("div",ne,(0,s.toDisplayString)(o.selected.type),1))])}]]),re={style:{display:"flex","flex-direction":"column"}},le={style:{display:"flex","justify-content":"center","margin-top":"10px"}},ie={class:"assetblock"},ce={key:0,class:"short"},de={class:"short-text"},pe={key:0,class:"assetcontent"},ue={class:"assetrow"},me={class:"assetrow"},he={name:"AssetView",props:{asset:{type:Object},label:{type:String}},mounted(){},data:()=>({view:!0}),computed:{src(){return this.$app.assets.list.find(e=>e.uid===this.asset.uid)},types(){return this.$app.assets.types}}},fe=(0,C.A)(he,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",ie,[(0,s.createElementVNode)("div",{onClick:t[0]||(t[0]=e=>a.view=!a.view),class:"title"},[(0,s.createCommentVNode)(' <div class="label">{{ label }}</div> '),a.view?(0,s.createCommentVNode)("v-if",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",ce,[(0,s.createTextVNode)((0,s.toDisplayString)(r.src.uid)+" : "+(0,s.toDisplayString)(r.src.type)+" : ",1),(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",de,[(0,s.createTextVNode)((0,s.toDisplayString)(r.src.url),1)])),[[i,r.src.url]])]))]),a.view?((0,s.openBlock)(),(0,s.createElementBlock)("div",pe,[(0,s.createElementVNode)("div",ue,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(r.src.type)+" : "+(0,s.toDisplayString)(r.src.name||r.src.uid),1),(0,s.createElementVNode)("div",null,[(0,s.createElementVNode)("button",{onClick:t[1]||(t[1]=t=>e.$emit("remove",o.asset))},[(0,s.createVNode)(l,{value:"bin",size:"1em"})])])]),(0,s.createCommentVNode)(' <div class="assetrow">\n                <div>URL:</div>\n                <div class="rowcontent">\n                    <LabelEdit :value="src.url"></LabelEdit>\n                </div>\n            </div> '),(0,s.createCommentVNode)(' <div class="assetrow" v-for="(param, key) in src.parameters">\n            <div>{{ key }}</div><div>{{ param }}</div>\n        </div> '),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.asset.parameters,(e,o)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",me,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(o),1),t[2]||(t[2]=(0,s.createElementVNode)("div",{class:"cell"},[(0,s.createCommentVNode)(' <LabelEdit @update:value="asset.parameters[key] = $event; $emit(\'changed\')" :value="param">\n                    </LabelEdit> ')],-1))]))),256))])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-eca41270"]]),ve={name:"AssetsView",data:()=>({selectedAsset:null,assetsData:{offtypes:["hdr"]}}),props:{modelValue:{type:Object},value:{type:Object}},methods:{async removeAsset(e){await this.$app.elements.removeAsset(this.value,e),this.$app.toasts.add({message:"Ресурс удален из модели"})},saveProp(){this.$app.toasts.add({message:"Параметр ресурса в элементе изменен"}),this.$app.engine.getManager().UpdateElement(this.value.path,{assets:this.value.assets})},async selectAsset(){const e=await this.$app.assets.selectAsset(["hdr","texture"]);if(e){const t=this.$app.engine.getManager("AssetsManager").GetAsset(e.uid);console.log(this.value),console.log(t),this.$app.assets.setAsset(this.value,t),this.$app.toasts.add({message:"Ресурс добавлен в модель"})}}},computed:{list(){return this.value?.data?.assets||this.value?.assets||[]}},components:{AssetView:fe}},ge=(0,C.A)(ve,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("AssetView"),i=(0,s.resolveComponent)("icon"),c=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",re,[t[1]||(t[1]=(0,s.createElementVNode)("div",null,"Ресурсы",-1)),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.list,(e,t)=>((0,s.openBlock)(),(0,s.createBlock)(l,{asset:e,key:t,onRemove:r.removeAsset,onChanged:r.saveProp},null,8,["asset","onRemove","onChanged"]))),128)),(0,s.createElementVNode)("div",le,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:"button normal",onClick:t[0]||(t[0]=(...e)=>r.selectAsset&&r.selectAsset(...e))},[(0,s.createVNode)(i,{value:"stack",size:"0.75em"})])),[[c,"Ресурсы"]])])])}]]),ye={class:"scenetools"},be={class:"camera-selector"};var ke=o(875);const we={name:"SceneTools",data:()=>({}),computed:{selectedCamera:{get(){return this.$app.slides.actived?.camera?.path||null},set(e){this.$app.slides.actived.camera.path=e,this.$app.slides.save()}},slide(){return this.$app.slides.actived},cameras(){return this.$app.project.findObjectsByType(ke.Camera)||[]}},mounted(){},methods:{saveSlide(){this.$app.slides.save(this.slide)},onCameraChange(){console.log("change");try{if(this.slide.camera?.path&&this.slide.camera?.path!==this.$app.engine.manager.Camera?.path){const e=this.slide.camera.path.split("."),t=this.$app.project.find(e);this.$app.engine.manager.SetCamera(t),t.updateProjectionMatrix()}}catch(e){console.warn(e.message)}}}},Ee=(0,C.A)(we,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("EditColor");return(0,s.openBlock)(),(0,s.createElementBlock)("div",be,[(0,s.createElementVNode)("div",null,[t[0]||(t[0]=(0,s.createElementVNode)("div",null," Background ",-1)),(0,s.createElementVNode)("div",null,[(0,s.createVNode)(l)])])])}],["__scopeId","data-v-7ab7797e"]]),_e={class:"slide-tools"},Se={key:0},Ne={key:0},Ve=["value"],Ce={key:1},Be={style:{display:"block",width:"100%"}},$e={class:"overleyicon"},xe={key:1,style:{display:"flex","justify-content":"center"}},De={name:"AssetView",props:{asset:{type:Object}},methods:{async showLib(){const e=await this.$app.assets.selectAsset(["hdr"]);this.$emit("setasset",e)}}},Ie=(0,C.A)(De,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,null,[(0,s.createCommentVNode)("assethdr"),(0,s.createElementVNode)("div",Be,[(0,s.createElementVNode)("div",$e,[o.asset?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:0,onClick:t[0]||(t[0]=(...e)=>r.showLib&&r.showLib(...e)),class:"text"},[(0,s.createTextVNode)((0,s.toDisplayString)(o.asset.name||o.asset.uid),1)])),[[l,o.asset.url]]):((0,s.openBlock)(),(0,s.createElementBlock)("div",xe,[(0,s.createElementVNode)("button",{onClick:t[1]||(t[1]=(...e)=>r.showLib&&r.showLib(...e))},"Select")]))])]),(0,s.createCommentVNode)("//assethdr")],2112)}]]),Te={name:"CameraSelector",props:{slide:{type:Object}},data:()=>({}),computed:{bgColor:{get(){return this.slide.background.color},set(e){this.slide.background.value=e.getStyle(),this.slide.background.setValue("color",this.slide.background.value),this.$app.slides.save(),this.$app.engine.getManager().Scene.background=e}},bgHdr:{get(){return this.slide.background.hdr}},selectedCamera:{get(){return this.slide.camera?.path||null},set(e){this.slide.camera.path=e,this.$app.slides.save()}},cameras(){return this.$app.project.findObjectsByType(ke.Camera)||[]}},mounted(){},methods:{save(){this.$app.slides.save(this.slide)},onBgChange(e){this.slide.background.setValue(e,this.slide.background[e]),this.$app.slides.save()},async onAssetChange(e){console.log(e.resource),this.slide.background.setValue("hdr",e.resource),this.slide.background.value=e.uid;const t=await this.$app.engine.getAssetsManager().FindAsset(e.uid);this.$app.engine.getManager().Scene.background=t.resource},saveSlide(){this.$app.slides.save(this.slide)},onCameraChange(){console.log("change");try{if(this.slide.camera?.path&&this.slide.camera?.path!==this.$app.engine.manager.Camera?.path){const e=this.slide.camera.path.split("."),t=this.$app.project.find(e);this.$app.engine.manager.SetCamera(t),t.updateProjectionMatrix()}}catch(e){console.warn(e.message)}}},components:{assethdr:Ie}},Ae=(0,C.A)(Te,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("LabelEdit"),i=(0,s.resolveComponent)("ActionsList");return(0,s.openBlock)(),(0,s.createElementBlock)("div",_e,[o.slide?((0,s.openBlock)(),(0,s.createElementBlock)("div",Se,[(0,s.createElementVNode)("div",null,[t[3]||(t[3]=(0,s.createElementVNode)("div",null,"Name:",-1)),(0,s.createVNode)(l,{modelValue:o.slide.name,"onUpdate:modelValue":[t[0]||(t[0]=e=>o.slide.name=e),r.save]},null,8,["modelValue","onUpdate:modelValue"])]),r.cameras.length>0?((0,s.openBlock)(),(0,s.createElementBlock)("div",Ne,[t[5]||(t[5]=(0,s.createElementVNode)("label",null,"Camera:",-1)),(0,s.withDirectives)((0,s.createElementVNode)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>r.selectedCamera=e),onChange:t[2]||(t[2]=(...e)=>r.onCameraChange&&r.onCameraChange(...e))},[t[4]||(t[4]=(0,s.createElementVNode)("option",{value:null},"No",-1)),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.cameras,e=>((0,s.openBlock)(),(0,s.createElementBlock)("option",{key:e.path,value:e.path}," ("+(0,s.toDisplayString)(e.type)+") "+(0,s.toDisplayString)(e.name||`Camera ${e.uid}`),9,Ve))),128))],544),[[s.vModelSelect,r.selectedCamera]])])):((0,s.openBlock)(),(0,s.createElementBlock)("div",Ce," There are no cameras available in the project. ")),(0,s.createElementVNode)("div",null,[t[6]||(t[6]=(0,s.createElementVNode)("div",null,"Slide Events:",-1)),(0,s.createVNode)(i,{"onUpdate:target":r.saveSlide,onSave:r.saveSlide,target:o.slide},null,8,["onUpdate:target","onSave","target"])]),(0,s.createCommentVNode)(' <div>\n                <div>Background</div>\n                <div>{{ slide.background.type }}\n                    <RadioButton v-model="slide.background.type" @change="onBgChange"\n                        :options="[{ value: \'color\', label: \'Color\' }, { value: \'hdr\', label: \'HDR\' }, { value: \'none\', label: \'No\' }]"\n                        name="array-group" />\n                </div>\n                <EditColor v-if="slide.background?.type === \'color\'" v-model="bgColor"></EditColor>\n                <assethdr v-if="slide.background?.type === \'hdr\'" v-model="bgHdr" @setasset="onAssetChange">\n                </assethdr>\n            </div> ')])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-7512016c"]]),Me={data:()=>({asset:{uid:"hdrscene"},view:!0}),name:"SceneTools",computed:{slides(){return this.$app.slides.children},slide(){return this.$app.slides.actived}},components:{slideTools:Ae,InspectorPanel:ee,scenetools:Ee},methods:{removeSlide(){this.$app.slides.remove()}}},Oe=(0,C.A)(Me,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("slideTools"),i=(0,s.resolveComponent)("InspectorPanel");return(0,s.openBlock)(),(0,s.createElementBlock)("div",ye,[(0,s.createVNode)(i,{label:"Slide Options"},(0,s.createSlots)({_:2},[r.slide?{name:"content",fn:(0,s.withCtx)(()=>[(0,s.createVNode)(l,{slide:r.slide},null,8,["slide"])]),key:"0"}:void 0]),1024),(0,s.createVNode)(i,{label:"Player Options"},(0,s.createSlots)({_:2},[r.slide?{name:"content",fn:(0,s.withCtx)(()=>[(0,s.createVNode)(l,{slide:r.slide},null,8,["slide"])]),key:"0"}:void 0]),1024)])}]]),je={methods:{getState(){return this.$app.models.getState(this.selected,this.slide)},getProp(e){const t=e.prop.split(".");let o=t[0],n=this.selected;for(let e=0;e<t.length-1;e++)n=n[t[e]],o=t[e+1];return n[o]},async saveElement(e,t){e.onupdate&&await e.onupdate(this.selected,null,null,this.slide),await this.$app.models.save(this.selected)},async setTargetProperty(e,t,o){if(e.onupdate){const n=await e.onupdate(this.selected,t,o,this.slide);if(!this.selected.isElement||n)return}else"state"in e&&!0!==e.state?this.selected[t]=o?.encode?o.encode():o:this.getState()[t]=o?.encode?o.encode():o;e.nosave||(this.selected.isElement?await this.$app.models.save(this.selected):this.selected.isAsset&&await this.$app.assets.save(this.selected))},async onComponentChanged(e,t,o,n){console.log(t,o),this.selected[t]=o,this.selected.isElement?this.setTargetProperty(e,t,o,n):e.onupdate&&await e.onupdate(this.selected,t,o,this.slide)},async onCleanStateValue(e,t,o){e.onclean?await e.onclean(this.selected,t,e,this.slide):t in this.getState()&&delete this.getState()[t],await this.$app.models.save(this.selected)}},computed:{selected(){return this.$app.selection.selected},selectedUID(){return this.$app.selection.uid},blocks(){return[{label:"Name",content:{component:"LabelEdit",prop:"name",state:!1},head:{component:"Label",prop:"name"}},{label:"Type",readonly:!0,head:{component:"Label",prop:"type"}},...this.$app.inspector.blocksFor(this.selected.types)]},slide(){return this.$app.slides.actived?.uid}},watch:{selected(e){console.log(e),e&&e.restore&&e.restore()}},components:{InspectorPanel:ee,modeltypes:se,assetsview:ge,ViewPanel:B,SceneTools:Oe}},Pe=(0,C.A)(je,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveComponent)("InspectorPanel"),c=(0,s.resolveComponent)("ViewPanel"),d=(0,s.resolveDirective)("tooltip"),p=(0,s.resolveDirective)("translate");return(0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,null,[(0,s.createVNode)(c,{class:"inspector"},{footer:(0,s.withCtx)(()=>[(0,s.createCommentVNode)(" <SceneTools></SceneTools> ")]),default:(0,s.withCtx)(()=>[r.selectedUID?((0,s.openBlock)(),(0,s.createElementBlock)("div",G,[(0,s.createCommentVNode)(" <div>{{ selected.paths.join('->') }}</div> "),(0,s.renderSlot)(e.$slots,"default",{},()=>[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.blocks,(e,t)=>((0,s.openBlock)(),(0,s.createBlock)(i,{label:e.label,tooltip:e.tooltip,stat:e.state,key:e.label},(0,s.createSlots)({_:2},[e.readonly?void 0:{name:"icons",fn:(0,s.withCtx)(({stat:t})=>[e.nonstate?(0,s.createCommentVNode)("v-if",!0):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("span",{key:0,onClick:t=>r.onCleanStateValue(e.head||e.content,e.head?e.head.prop:e.content.prop,e),class:"remove-icon"},[(0,s.createVNode)(l,{value:"bin"})],8,W)),[[d,"Очистить значение в слайде"]])]),key:"0"},e.head?{name:"head",fn:(0,s.withCtx)(({togglePanel:t})=>[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.head.component),(0,s.mergeProps)({ref_for:!0},e.head.props,{modelValue:r.selected[e.head.prop],"onUpdate:modelValue":[t=>r.selected[e.head.prop]=t,(...t)=>r.setTargetProperty(e.head,e.head.prop,...t)],value:r.selected,property:e.head,target:e.head.state?r.getState():r.selected,onClean:(...t)=>r.onCleanStateValue(e.head,...t),onSave:t=>r.saveElement(e.head),"onUpdate:target":(...t)=>r.setTargetProperty(e.head,...t),"onUpdate:value":(...t)=>r.onComponentChanged(e.head,e.head.prop,...t),onToggle:e=>t()},(0,s.toHandlers)(e.head.events||{})),null,16,["modelValue","onUpdate:modelValue","value","property","target","onClean","onSave","onUpdate:target","onUpdate:value","onToggle"]))]),key:"1"}:void 0,e.content?{name:"content",fn:(0,s.withCtx)(({togglePanel:t})=>[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.content.component),(0,s.mergeProps)({class:"blockcomponent"},{ref_for:!0},e.content.props||{},{value:r.selected,modelValue:r.selected[e.content.prop],"onUpdate:modelValue":[t=>r.selected[e.content.prop]=t,(...t)=>r.setTargetProperty(e.content,e.content.prop,...t)],property:e.content,target:e.content.state?r.getState():r.selected,options:{inspector:!0},onClean:(...t)=>r.onCleanStateValue(e.content,...t),onSave:t=>r.saveElement(e.content),"onUpdate:target":(...t)=>r.setTargetProperty(e.content,...t),"onUpdate:value":(...t)=>r.onComponentChanged(e.content,e.content.prop,...t),onToggle:e=>t()},(0,s.toHandlers)(e.content.events||{})),null,16,["value","modelValue","onUpdate:modelValue","property","target","onClean","onSave","onUpdate:target","onUpdate:value","onToggle"]))]),key:"2"}:void 0]),1032,["label","tooltip","stat"]))),128))])])):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",K,[...t[0]||(t[0]=[(0,s.createTextVNode)(" $$Select an model or asset ",-1)])])),[[p]])]),_:3}),(0,s.createCommentVNode)(' <div class="panel-container">\n        <div class="panel">\n            <div class="header">Inspector</div>\n            <div class="content">\n                \n            </div>\n            <div class="footer">\n\n            </div>\n        </div>\n    </div> ')],2112)}]]),Re={class:"hierarhy-view"},Le={class:"hierarhy-head"},Fe={class:"treeicon"},Ue=["draggable","droppable"],ze={class:"roottree"},He=["draggable"],qe={class:"tree-node-content"},Ge={class:"selector"},We=["checked"],Ke={key:0,class:"prepender"},Je=["title"],Ye={key:1,class:"appender"},Xe={key:0,class:"children"},Qe={key:1};function Ze(e,t){for(let o=0;o<e.length;o++)e[o].isSelected=t,e[o].children&&Ze(e[o].children,t)}const et={name:"TreeNode",props:{node:{type:Object,required:!0},selector:{type:Boolean,default:!0},index:{type:Number},focused:{type:Boolean,default:!1},childsFiled:{type:String,default:"childrens"},filter:{type:Function},draggable:{type:Boolean,default:!0},droppable:{type:Boolean,default:!0}},computed:{list(){return this.filter?this.filter(this.node[this.childsFiled]):this.node[this.childsFiled]}},data:()=>({expanded:{},childloaded:{},isLoading:!1,selectChangeEvent:(0,s.inject)("selectChangeEvent",null),clickNodeEvent:(0,s.inject)("clickNodeEvent",null),dropNodeEvent:(0,s.inject)("nodeDropEvent",null),isDragOver:!1}),methods:{onDragStart(e){this.$app.app.draggedNode=this.node,e.dataTransfer.items.add(JSON.stringify({uid:this.node.uid,type:this.node.type,isAsset:this.node.isAsset,isElement:this.node.isElement,isModel:this.node.isModel}),"application/json"),e.dataTransfer.effectAllowed="copy"},onDragOver(e){e.dataTransfer.dropEffect="copy",this.isDragOver=!0},onDragEnter(e){this.isDragOver=!0,!this.expanded[this.node.uid]&&this.node[this.childsFiled]?.length&&this.toggleExpand()},onDragLeave(){this.isDragOver=!1},onDrop(e){this.isDragOver=!1,this.dropNodeEvent({target:this.node,source:this.$app.app.draggedNode})},async toggleExpand(){this.node[this.childsFiled]&&0!==this.node[this.childsFiled].length&&(this.expanded[this.node.uid]=!this.expanded[this.node.uid],this.expanded[this.node.uid]&&!this.childloaded[this.node.uid]&&await this.loadChildren(),this.$emit("updateExpanded",this.node))},async loadChildren(){this.childloaded[this.node.uid]=!0},onChildSelectChange(e){},onCheckboxChange(e){e.isSelected=!e.isSelected,e[this.childsFiled]?.length&&Ze(e[this.childsFiled],e.isSelected),this.selectChangeEvent(this.node),this.$emit("changeSelection",this.node)},selectNode(e){this.clickNodeEvent(this.node)}}},tt={components:{TreeNode:(0,C.A)(et,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("TreeNode",!0);return(0,s.openBlock)(),(0,s.createElementBlock)("li",{class:(0,s.normalizeClass)(["tree-node",{"drag-over":a.isDragOver}]),draggable:o.draggable,onDragstart:t[3]||(t[3]=(0,s.withModifiers)(e=>o.draggable&&r.onDragStart(e),["stop"])),onDragover:t[4]||(t[4]=(0,s.withModifiers)((...e)=>r.onDragOver&&r.onDragOver(...e),["prevent"])),onDragenter:t[5]||(t[5]=(0,s.withModifiers)((...e)=>r.onDragEnter&&r.onDragEnter(...e),["prevent"])),onDragleave:t[6]||(t[6]=(...e)=>r.onDragLeave&&r.onDragLeave(...e)),onDrop:t[7]||(t[7]=(0,s.withModifiers)((...e)=>r.onDrop&&r.onDrop(...e),["prevent","stop"]))},[(0,s.createElementVNode)("div",qe,[(0,s.createElementVNode)("span",{class:"collapser",onClick:t[0]||(t[0]=(...e)=>r.toggleExpand&&r.toggleExpand(...e))},[r.list?.length?(0,s.renderSlot)(e.$slots,"icon",{key:0,node:o.node},()=>[(0,s.createTextVNode)((0,s.toDisplayString)(a.expanded[o.node.uid]?"▼":"▶"),1)],!0):(0,s.createCommentVNode)("v-if",!0)]),(0,s.createElementVNode)("span",Ge,[o.selector?(0,s.renderSlot)(e.$slots,"checkbox",{key:0},()=>[(0,s.createElementVNode)("input",{ref:"checkedInput",type:"checkbox",onChange:t[1]||(t[1]=e=>r.onCheckboxChange(o.node)),checked:o.node.isSelected},null,40,We)],!0):(0,s.createCommentVNode)("v-if",!0)]),e.$slots.prepend?((0,s.openBlock)(),(0,s.createElementBlock)("span",Ke,[(0,s.renderSlot)(e.$slots,"prepend",{node:o.node},void 0,!0)])):(0,s.createCommentVNode)("v-if",!0),(0,s.createElementVNode)("span",{class:"labeler",title:o.node.uid,onClick:t[2]||(t[2]=(...e)=>r.selectNode&&r.selectNode(...e))},[(0,s.renderSlot)(e.$slots,"label",{node:o.node},()=>[(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(o.node.uid)+"|",1)],!0)],8,Je),e.$slots.append?((0,s.openBlock)(),(0,s.createElementBlock)("span",Ye,[(0,s.renderSlot)(e.$slots,"append",{node:o.node,index:o.index},void 0,!0)])):(0,s.createCommentVNode)("v-if",!0)]),a.expanded[o.node.uid]&&Array.isArray(r.list)&&r.list.length?((0,s.openBlock)(),(0,s.createElementBlock)("ul",Xe,[a.childloaded[o.node.uid]?((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,{key:0},(0,s.renderList)(r.list,t=>((0,s.openBlock)(),(0,s.createBlock)(l,{draggable:o.draggable,onChangeSelection:r.onChildSelectChange,filter:o.filter,selector:o.selector,focused:t.focused,key:t.uid,node:t,childsFiled:o.childsFiled},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$slots,(t,o)=>({name:o,fn:(0,s.withCtx)(t=>[(0,s.renderSlot)(e.$slots,o,(0,s.mergeProps)({ref_for:!0},t),void 0,!0)])}))]),1032,["draggable","onChangeSelection","filter","selector","focused","node","childsFiled"]))),128)):((0,s.openBlock)(),(0,s.createElementBlock)("div",Qe," load... "))])):(0,s.createCommentVNode)("v-if",!0)],42,He)}],["__scopeId","data-v-9bb33550"]])},computed:{list(){return this.filter?this.filter(this.tree):this.tree}},data:()=>({expandeds:{},isDragOver:!1}),props:{tree:{type:Array,required:!0},selector:{type:Boolean,default:!1},focused:{type:Boolean,default:!1},childsFiled:{type:String,default:"children"},filter:{type:Function},draggable:{type:Boolean,default:!1},droppable:{type:Boolean,default:!1}},setup(e,{slots:t,emit:o}){(0,s.provide)("clickNodeEvent",e=>{o("clickNode",e)}),(0,s.provide)("selectChangeEvent",e=>{o("changeSelect",e)}),(0,s.provide)("nodeDropEvent",e=>{o("node-drop",e)})},methods:{onDragOver(e){e.dataTransfer.dropEffect="copy",this.isDragOver=!0},onDragEnter(e){this.isDragOver=!0},onDragLeave(){this.isDragOver=!1},onDrop(e){this.isDragOver=!1,console.log(e.dataTransfer?.items);for(let t of e.dataTransfer?.items)console.log(`Type: ${t.type}, Kind: ${t.kind}`),"text/plain"!==t.type&&"application/json"!==t.type||t.getAsString(e=>{const t=JSON.parse(e);this.$emit("node-drop",{target:null,source:t})})},onUpdateExpanded(e){},findNodeByUid(e,t){for(let o of e){if(o.uid===t)return o;if(o.children){let e=this.findNodeByUid(o.children,t);if(e)return e}}return null},removeNodeFromTree(e,t){for(let o=0;o<e.length;o++){if(e[o].uid===t)return e.splice(o,1),!0;if(e[o][this.childsFiled]&&this.removeNodeFromTree(e[o][this.childsFiled],t))return!0}return!1}}},ot=(0,C.A)(tt,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("TreeNode");return(0,s.openBlock)(),(0,s.createElementBlock)("div",{class:(0,s.normalizeClass)(["treecontainer",{"drag-over":a.isDragOver}]),draggable:o.draggable,droppable:o.droppable,onDrop:t[0]||(t[0]=(0,s.withModifiers)((...e)=>r.onDrop&&r.onDrop(...e),["prevent","stop"])),onDragover:t[1]||(t[1]=(0,s.withModifiers)((...e)=>r.onDragOver&&r.onDragOver(...e),["prevent"])),onDragenter:t[2]||(t[2]=(0,s.withModifiers)((...e)=>r.onDragEnter&&r.onDragEnter(...e),["prevent"])),onDragleave:t[3]||(t[3]=(...e)=>r.onDragLeave&&r.onDragLeave(...e))},[(0,s.createElementVNode)("ul",ze,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.list,(t,n)=>((0,s.openBlock)(),(0,s.createBlock)(l,{key:t.uid,filter:o.filter,selector:o.selector,node:t,index:n,focused:o.focused,childsFiled:o.childsFiled,onUpdateExpanded:r.onUpdateExpanded,draggable:o.draggable,droppable:o.droppable},(0,s.createSlots)({_:2},[(0,s.renderList)(e.$slots,(t,o)=>({name:o,fn:(0,s.withCtx)(t=>[(0,s.renderSlot)(e.$slots,o,(0,s.mergeProps)({ref_for:!0},t),void 0,!0)])}))]),1032,["filter","selector","node","index","focused","childsFiled","onUpdateExpanded","draggable","droppable"]))),128))])],42,Ue)}],["__scopeId","data-v-d3191960"]]),nt={name:"TreeAssets",props:{title:""},data:()=>({filtersView:!1,filterRect:{},focused:[],editform:!1,editedAsset:{},newAsset:!1,viewlib:!1,libButtons:{add:!0,save:!1}}),watch:{"assets.list"(e){console.log(e)}},computed:{models(){return this.$app.models},slide(){return this.$app.slides.actived},tree(){return this.$app.assets.list.reduce((e,t)=>{let o=e.find(e=>e.type===t.type);return o||(o={isgroup:!0,type:t.type,children:[],uid:t.type},e.push(o)),o.children.push(t),e},[])},assets(){return this.$app.assets},selected(){return this.$app.selection.selected}},methods:{onEdit(e,t){this.editedAsset[e]=t},editAsset(e){this.editedAsset=e?{...e,progress:0}:{uid:null,type:"model",name:"New asset",url:"https://",parameters:{},progress:0},this.$app.assets.editAsset(this.editedAsset)},insertAsset(e){this.$app.project.handleAsset({source:e,target:this.$app.selection.selected})},onUpdateExpanded(e){},onNodeClick(e){this.$app.selection.select(e.isgroup?null:e)},onChangeSelection(){},remove(e){this.$app.modal.confirmReq((0,s.reactive)({title:"Confirm asset remove",text:`Remove asset ${e.name||e.uid} ?`}),[{label:"YES",class:"primary",callback:async()=>{this.assets.remove(e)}},{label:"NO",class:"secondary",callback:async e=>{this.$app.modal.close()}}])}},components:{TreeView:ot}},at=(0,C.A)(nt,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveComponent)("TreeView"),c=(0,s.resolveDirective)("translate"),d=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Re,[(0,s.createElementVNode)("div",Le,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("span",null,[(0,s.createTextVNode)((0,s.toDisplayString)(o.title)+":",1)])),[[c]]),t[2]||(t[2]=(0,s.createTextVNode)()),(0,s.createElementVNode)("button",{onClick:t[0]||(t[0]=e=>r.assets.selectAsset([],!1))},[(0,s.createVNode)(l,{value:"plus",size:"0.75em"})])]),(0,s.createVNode)(i,{childsFiled:"children",tree:r.tree,onClickNode:r.onNodeClick,onChangeSelect:r.onChangeSelection,onUpdateExpanded:r.onUpdateExpanded,draggable:!0},{prepend:(0,s.withCtx)(({node:e})=>[e.isAsset?((0,s.openBlock)(),(0,s.createBlock)(l,{key:0,value:r.assets.icons[e.type],size:"1em"},null,8,["value"])):(0,s.createCommentVNode)("v-if",!0)]),append:(0,s.withCtx)(({node:e,index:t})=>[(0,s.createElementVNode)("div",Fe,[(0,s.createCommentVNode)(' <icon v-if="!node.isgroup" value="target" v-tooltip="\'Find\'" size="1em" @click="$emit(\'target\', node)"></icon> '),(0,s.createCommentVNode)(' <icon v-if="!node.isgroup" value="pencil" v-tooltip="\'Редактировать\'" size="1em" @click="editAsset(node)">\n          </icon> '),e.isModel&&r.slide?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createBlock)(l,{key:0,value:"download",size:"1em",onClick:t=>r.models.createFromAsset(e)},null,8,["onClick"])),[[d,"Insert to scene"]]):(0,s.createCommentVNode)("v-if",!0),e.isgroup?(0,s.createCommentVNode)("v-if",!0):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createBlock)(l,{key:1,value:"bin",size:"1em",onClick:t=>r.remove(e)},null,8,["onClick"])),[[d,"Delete"]])])]),label:(0,s.withCtx)(({node:o})=>[(0,s.createCommentVNode)(' <div @click="onSelectedNode" :class="{ \'focusedtree\': selected === node }"  class="label"\n          v-tooltip="`${node.url || node.type}`"> {{ node.name || node.uid }}</div> '),(0,s.createElementVNode)("div",{onClick:t[1]||(t[1]=(...t)=>e.onSelectedNode&&e.onSelectedNode(...t)),class:(0,s.normalizeClass)([{focusedtree:r.selected===o},"label"])},(0,s.toDisplayString)(o.name||o.uid),3)]),_:1},8,["tree","onClickNode","onChangeSelect","onUpdateExpanded"])])}],["__scopeId","data-v-4acc2793"]]),st={class:"hierarhy-view"},rt={class:"treeicon"},lt={class:"container"},it={class:"block"},ct={class:"content"},dt={class:"sub-content"},pt={class:"subtitle"},ut={class:"subtitle"},mt=["value"],ht={props:{callback:{type:Function},modelValue:{type:Object,default:()=>({label:"",type:"model"})},parent:{type:Object},list:{type:Array}},computed:{name:{get(){return this.modelValue.name},set(e){this.$emit("update:modelValue",{name:e,type:this.modelValue.type})}},type:{get(){return this.modelValue.type},set(e){this.$emit("update:modelValue",{name:this.modelValue.name,type:e})}}}},ft=(0,C.A)(ht,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveDirective)("translate");return(0,s.openBlock)(),(0,s.createElementBlock)("div",lt,[(0,s.createElementVNode)("div",it,[(0,s.createElementVNode)("div",ct,[(0,s.createElementVNode)("div",dt,[(0,s.createElementVNode)("div",pt,[(0,s.withDirectives)((0,s.createElementVNode)("input",{type:"text",placeholder:"Name","onUpdate:modelValue":t[0]||(t[0]=e=>r.name=e)},null,512),[[s.vModelText,r.name]])]),(0,s.createElementVNode)("div",ut,[(0,s.withDirectives)((0,s.createElementVNode)("select",{class:"typeslist","onUpdate:modelValue":t[1]||(t[1]=e=>r.type=e)},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.list,e=>(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("option",{value:e.type},[(0,s.createTextVNode)((0,s.toDisplayString)(e.label),1)],8,mt)),[[l,`elements.${e.label}`]])),256))],512),[[s.vModelSelect,r.type]])])])])])])}],["__scopeId","data-v-4e7f94d3"]]),vt={name:"TreeElement",props:{title:""},mounted(){},data:()=>({filtersView:!1,filterRect:{},requestRemove:!1,removeData:{text:""},newElementData:{},addElementView:!1}),computed:{selected(){return this.$app.selection.selected},selection(){return this.$app.selection},tree(){return this.$app.elements.children}},methods:{filterElements:e=>e,async insertToSlide(e){e.state?this.$app.toasts.add({message:"Элемент уже добавлен в этот слайд"}):await this.$app.slides.addState(e)},deleteElement(e){this.removeData.text=`Delete ${e.name} (${e.uid}) ?`,this.$app.modal.open({header:{value:"Delete item",handler:()=>{this.$app.modal.close(),this.requestRemove=!1}},content:{},footer:{buttons:[{label:"Delete",class:"secondary",handler:async()=>{this.$app.modal.close(),this.requestRemove=!1,this.$app.elements.remove(e),this.$app.toasts.add({message:`Элемент ${e.name} удален`})}},{label:"Cancel",class:"primary",handler:async()=>{this.$app.modal.close(),this.requestRemove=!1}}]}})},onUpdateExpanded(e){},onNodeClick(e){this.$app.selection.select(e)},onChangeSelection(){},addElement(){if(this.selected){const e=this.$app.elements.findElement(this.selected.paths);this.$app.selection.select(e)}let e;this.newElementData.name="New Element",this.newElementData.uid=`Element${Date.now()}`,this.newElementData.type="Group",this.newElementData.paths=[],this.selected&&this.selected.isElement&&(e=this.selected,this.newElementData.paths.push(...this.selected.paths)),this.newElementData.paths.push(this.newElementData.uid),this.newElementData.path=this.newElementData.paths.join("."),this.newElementData.props={visible:!0},this.$app.modal.open({header:{value:`Add element ${e?" to "+e.name||0:" scene"}`,handler:()=>{this.$app.modal.close(),this.addElementView=!1}},content:{},footer:{buttons:[{label:"Add",class:"secondary",handler:async()=>{await this.$app.elements.create(this.newElementData,e),this.$app.modal.close(),this.addElementView=!1}},{label:"Cancel",class:"primary",handler:async()=>{this.$app.modal.close(),this.addElementView=!1}}]}}),this.addElementView=!0}},components:{TreeView:ot,ElementAdd:ft}},gt=(0,C.A)(vt,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveComponent)("TreeView"),c=(0,s.resolveComponent)("ElementAdd"),d=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",st,[(0,s.createElementVNode)("div",null,[(0,s.createTextVNode)((0,s.toDisplayString)(o.title)+": ",1),(0,s.createElementVNode)("button",{onClick:t[0]||(t[0]=(...e)=>r.addElement&&r.addElement(...e))},[(0,s.createVNode)(l,{value:"plus",size:"0.75em"})])]),(0,s.createVNode)(i,{filter:r.filterElements,tree:r.tree,onClickNode:r.onNodeClick,onChangeSelect:r.onChangeSelection,childsFiled:"children",onUpdateExpanded:r.onUpdateExpanded,selector:!1},{append:(0,s.withCtx)(({node:e,index:t})=>[(0,s.createElementVNode)("div",rt,[(0,s.createCommentVNode)(' <icon value="target" v-tooltip="\'Фокус\'" size="1em" @click="$emit(\'target\', node)"></icon>'),(0,s.createCommentVNode)(" <icon v-tooltip=\"'Видимость'\" :value=\"node.show ? 'eye' : 'eye-blocked'\" size=\"1em\"\n            @click=\"node.visible = !node.visible\" :color=\"node.visible ? '#8ec58e' : '#8ec58e80'\">\n          </icon> "),e.parent?(0,s.createCommentVNode)("v-if",!0):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createBlock)(l,{key:0,value:"dice",size:"1em",onClick:t=>r.insertToSlide(e),color:e.state?"#8ec58e":"#8ec58e80"},null,8,["onClick","color"])),[[d,"Add to slide"]]),(0,s.withDirectives)((0,s.createVNode)(l,{onClick:t=>r.deleteElement(e),value:"bin",size:"1em"},null,8,["onClick"]),[[d,"Remove"]]),(0,s.createCommentVNode)(' <icon v-if="index === 0" size="100%" value="bin"></icon> ')])]),label:(0,s.withCtx)(({node:e})=>[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)([{focusedtree:r.selected===e},"label"])},(0,s.toDisplayString)(e.name||e.uid),3)]),_:1},8,["filter","tree","onClickNode","onChangeSelect","onUpdateExpanded"]),a.addElementView?((0,s.openBlock)(),(0,s.createBlock)(s.Teleport,{key:0,to:".modal-content"},[(0,s.createVNode)(c,{value:a.newElementData,"onUpdate:value":t[1]||(t[1]=e=>a.newElementData=e),parent:r.selected},null,8,["value","parent"])])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-3eac9d53"]]),yt={class:"hierarhy-view"},bt={class:"hierarhy-head"},kt=["onUpdate:modelValue","onChange"],wt={class:"treeicon"};var Et=o(996);const _t={name:"TreeElement",props:{title:""},data:()=>({filtersView:!1,filterRect:{},requestRemove:!1,removeData:{text:""}}),computed:{models(){return this.$app.models},selected(){return this.$app.selection.selected},selection(){return this.$app.selection},tree(){return this.$app.models.children}},methods:{showPrefab(e){e.isPrefab=!e.isPrefab},onDrop(e){if(e.source.isAsset)switch(e.source.type){case"model":case"image":const t=this.$app.assets.getAsset(e.source.uid);this.models.createFromAsset(t,e.target?.paths);break;default:this.$app.toasts.add({message:Et.rk.translateText("This type cannot be placed on stage")})}},async updateVisible(e){this.$app.models.getState(e,this.$app.slides.actived.uid).visible=e.visible,await this.$app.models.save(e)},filterElements:e=>e.filter(e=>e.isElement||e.isHepler),async insertToSlide(e){e.state?this.$app.toasts.add({message:"The element has already been added to this slide"}):await this.$app.slides.addState(e)},deleteElement(e){this.removeData.text=`Delete ${e.name} (${e.uid}) ?`,this.$app.modal.open({header:{value:"Delete item",handler:()=>{this.$app.modal.close(),this.requestRemove=!1}},content:{},footer:{buttons:[{label:"Delete",class:"secondary",handler:async()=>{this.$app.modal.close(),this.requestRemove=!1,this.$app.models.remove(e.paths),this.$app.toasts.add({message:`The element ${e.name} is deleted`})}},{label:"Cancel",class:"primary",handler:async()=>{this.$app.modal.close(),this.requestRemove=!1}}]}})},onUpdateExpanded(e){},onNodeClick(e){this.$app.selection.select(e)},onChangeSelection(){}},components:{TreeView:ot}},St=(0,C.A)(_t,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveComponent)("TreeView"),c=(0,s.resolveDirective)("translate"),d=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",yt,[(0,s.createElementVNode)("div",bt,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("span",null,[(0,s.createTextVNode)((0,s.toDisplayString)(o.title)+":",1)])),[[c]]),(0,s.createElementVNode)("button",{onClick:t[0]||(t[0]=e=>r.models.createTo(r.selected))},[(0,s.createVNode)(l,{value:"plus",size:"1em"})]),(0,s.createCommentVNode)(' <button v-if="selected" @click="showPrefab(selected)">\n        <icon value="link" size="1em"></icon>\n      </button> ')]),(0,s.createVNode)(i,{filter:r.filterElements,tree:r.tree,onClickNode:r.onNodeClick,onChangeSelect:r.onChangeSelection,childsFiled:"children",onUpdateExpanded:r.onUpdateExpanded,selector:!1,droppable:!0,onNodeDrop:r.onDrop},{prepend:(0,s.withCtx)(({node:e,index:t})=>[(0,s.createElementVNode)("div",null,[(0,s.withDirectives)((0,s.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t=>e.visible=t,onChange:t=>r.updateVisible(e)},null,40,kt),[[s.vModelCheckbox,e.visible]])])]),append:(0,s.withCtx)(({node:e,index:t})=>[(0,s.createElementVNode)("div",wt,[(0,s.createCommentVNode)(' <icon value="target" v-tooltip="\'Фокус\'" size="1em" @click="$emit(\'target\', node)"></icon>'),(0,s.createCommentVNode)(" <icon v-tooltip=\"'Видимость'\" :value=\"node.show ? 'eye' : 'eye-blocked'\" size=\"1em\"\n            @click=\"node.visible = !node.visible\" :color=\"node.visible ? '#8ec58e' : '#8ec58e80'\">\n          </icon> "),e.isPrefab?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createBlock)(l,{key:0,value:"link",size:"1em"},null,512)),[[d,"Prefab"]]):(0,s.createCommentVNode)("v-if",!0),e.parent?(0,s.createCommentVNode)("v-if",!0):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createBlock)(l,{key:1,value:"dice",size:"1em",onClick:t=>r.insertToSlide(e),color:e.state?"#8ec58e":"#8ec58e80"},null,8,["onClick","color"])),[[d,"Add to slide"]]),(0,s.withDirectives)((0,s.createVNode)(l,{onClick:t=>r.deleteElement(e),value:"bin",size:"1em"},null,8,["onClick"]),[[d,"Remove"]]),(0,s.createCommentVNode)(' <icon v-if="index === 0" size="100%" value="bin"></icon> ')])]),label:(0,s.withCtx)(({node:e})=>[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)([{focusedtree:r.selected===e},"label"])},(0,s.toDisplayString)(e.name||e.uid),3)]),_:1},8,["filter","tree","onClickNode","onChangeSelect","onUpdateExpanded","onNodeDrop"])])}],["__scopeId","data-v-328725bc"]]),Nt={class:"hierarhy-view"},Vt={class:"treeicon"},Ct={name:"Hierarhy",props:{title:""},data:()=>({filtersView:!1,filterRect:{}}),computed:{selected(){return this.$app.selection.selected},slide(){return this.$app.slides.actived||{children:[]}}},methods:{getElement(){},removeSlide(){this.$app.slides.remove(this.$app.slides.actived.uid)},removeState(e){this.$app.slides.removeState(e.paths),this.$app.toasts.add({message:`${e.data.name||e.uid} удален`})},onNodeClick(e){this.$app.selection.select(e)},onChangeSelection(){},onUpdateExpanded(){},assState(){"block"===this.$app.selection.element?.type||this.$app.toasts.add({message:"Только типы block можно добавлять в состояния"})}},components:{TreeView:ot}},Bt=(0,C.A)(Ct,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveComponent)("TreeView"),c=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Nt,[(0,s.createElementVNode)("div",null,[(0,s.createTextVNode)((0,s.toDisplayString)(o.title)+" : "+(0,s.toDisplayString)(r.slide.name)+" ",1),(0,s.withDirectives)((0,s.createVNode)(l,{onClick:t[0]||(t[0]=e=>r.removeSlide()),value:"bin",size:"1em"},null,512),[[c,"Delete slide"]])]),(0,s.createVNode)(i,{tree:r.slide.children,onClickNode:r.onNodeClick,onChangeSelect:r.onChangeSelection,onUpdateExpanded:r.onUpdateExpanded,selector:!1},{checkbox:(0,s.withCtx)(()=>[...t[1]||(t[1]=[(0,s.createElementVNode)("span",null,[(0,s.createElementVNode)("input",{type:"checkbox"})],-1)])]),append:(0,s.withCtx)(({node:e,index:t})=>[(0,s.createCommentVNode)(' <div class="filters" v-if="index === 0">\n                    <button v-tooltip="\'Change filters\'"  @click="viewFilters" class="filterbutton">\n                        <icon v-for="v in target.filters" :value="v.props.value" :color="v.props.color" size="1em"></icon>\n                    </button>\n                    <PopupList v-if="filtersView" :rect="filterRect" :values="target.filters" @callback="filtersView = false"></PopupList>\n                </div> '),(0,s.createElementVNode)("div",Vt,[(0,s.createCommentVNode)(' <icon value="target" v-tooltip="\'Fit\'" size="1em" @click="$emit(\'target\', node)"></icon>\n          <icon v-tooltip="\'Visible\'" :value="node.isVisible ? \'eye\' : \'eye-blocked\'" size="1em"\n            @click="$emit(\'visible\', node)">\n          </icon> '),e.isBlock?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createBlock)(l,{key:0,onClick:t=>r.removeState(e),value:"bin",size:"1em"},null,8,["onClick"])),[[c,"Remove element from slide"]]):(0,s.createCommentVNode)("v-if",!0)])]),label:(0,s.withCtx)(({node:e})=>[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)([{focusedtree:r.selected===e},"label"])},(0,s.toDisplayString)(e.name||e.element.uid),3)]),_:1},8,["tree","onClickNode","onChangeSelect","onUpdateExpanded"])])}],["__scopeId","data-v-6bf93691"]]),$t={class:"transformer"},xt={class:"icons"};var Dt=o(24),It=o(0);function Tt(e){return 180*e/Math.PI}function At(e){return e*Math.PI/180}function Mt(e){const t=new WeakSet;return JSON.stringify(e,(e,o)=>{if("object"==typeof o&&null!==o&&!Array.isArray(o)){if(t.has(o))return console.log("Exist ",o),o.encode?o.encode():void 0;t.add(o)}return o})}function Ot(e,t){let o=1,n=e;for(;t.includes(n);)n=`${e}_${o}`,o++;return n}let jt,Pt,Rt;function Lt(){console.log("focus");const e=Pt.object;jt.update();let t=!1;if(e.traverse(e=>{e.isMesh&&(t=!0)}),t){const t=new ke.Box3;e.traverse(e=>{t.expandByObject(e)});const o=new ke.Sphere;t.getBoundingSphere(o),Ft.FitTo(o)}else Ft.FitTo({center:e.position,radius:.25})}class Ft{static FocusToSelect(){Pt.object&&Lt()}static FocusTo(e){jt.target.copy(e.isObject3D?e.position:e)}static MoveTo(e,t){const o={position:new ke.Vector3,time:1e3,...e,control:!1},n={position:new ke.Vector3,time:1e3,...t,control:!1};jt.enabled=!1;const a=Workspace.Camera.position.clone(),s=jt.target.clone();o.control=o.time>n.time,n.control=n.time>=o.time;const r=new Tween(a).to(o.position,o.time).easing(Easing.Quadratic.InOut).onUpdate(()=>{Workspace.Camera.position.copy(a),Workspace.Camera.updateProjectionMatrix(),jt.update()}).onComplete(()=>{o.control&&(jt.enabled=!0),tweengroup.remove(r)}).start(),l=new Tween(s).to(n.position,n.time).easing(Easing.Quadratic.InOut).onUpdate(()=>{jt.target.copy(s),jt.getPolarAngle()>jt.maxPolarAngle&&jt.target.setY(center.y+Math.cos(jt.maxPolarAngle)*distance)}).onComplete(()=>{n.control&&(jt.enabled=!0),tweengroup.remove(l)}).start();tweengroup.add(r,l)}static SetState(e){jt.enabled=e}static Init({canvas:e},t,o){Rt=t,jt=new Dt.N(t,e),jt.enabled=!0,jt.enableDamping=!0,jt.dampingFactor=.25,jt.screenSpacePanning=!1,jt.minDistance=.01,jt.maxDistance=1e3,Pt=new It.ZU(t,e),Pt.addEventListener("dragging-changed",e=>{jt.enabled=!e.value,e.target.object&&e.target.object.onTransform&&e.target.object.onTransform()});const n=Pt.getHelper();o.add(n),Pt.getRaycaster().layers.set(1),n.traverse(e=>{e.layers.set(1)}),window.addEventListener("keydown",e=>{switch(jt.enabled=!e.ctrlKey,e.code){case"KeyQ":Pt.setSpace("local"===Pt.space?"world":"local");break;case"Shift":Pt.setTranslationSnap(1),Pt.setRotationSnap(ke.MathUtils.degToRad(15)),Pt.setScaleSnap(.25);break;case"KeyW":Pt.setMode("translate");break;case"KeyE":Pt.setMode("rotate");break;case"KeyR":Pt.setMode("scale");break;case"KeyF":Pt.object&&Lt();break;case"KeyC":case"KeyV":case"KeyX":case"KeyY":case"KeyZ":case" ":case"Escape":break;case"+":case"=":Pt.setSize(Pt.size+.1);break;case"-":case"_":Pt.setSize(Math.max(Pt.size-.1,.1))}}),window.addEventListener("keyup",e=>{jt.enabled=!e.ctrlKey,"Shift"===e.key&&(Pt.setTranslationSnap(null),Pt.setRotationSnap(null),Pt.setScaleSnap(null))})}static get Transformer(){return Pt}static Select(e){e?(Pt.attach(e),e.onSelect&&e.onSelect()):Pt.detach()}static Update(e){jt.update(e)}static FitTo({center:e,radius:t}){const o=At(Rt.fov),n=Math.max(t,.25)/Math.sin(o/2),a=(new ke.Vector3).subVectors(Rt.position,e).normalize();!function(e,t,o=1){jt.enabled=!1;const n=o,a=Rt.position.clone(),s=jt.target.clone(),r=Date.now();!function o(){const l=(Date.now()-r)/(1e3*n);if(l>=1)return Rt.position.copy(e),jt.enabled=!0,jt.target.copy(t),void jt.update();Rt.position.lerpVectors(a,e,l),jt.target.lerpVectors(s,t,l),jt.update(),requestAnimationFrame(o)}()}(e.clone().add(a.multiplyScalar(n)),e,.5)}}const Ut=Ft,zt={props:{children:{type:Array},options:{size:"1.5em"}},methods:{setSpace(){Ut.Transformer.setSpace("local"===Ut.Transformer.space?"world":"local")},setMode(e){Ut.Transformer.setMode(e)}}},Ht=(0,C.A)(zt,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",$t,[(0,s.createElementVNode)("div",xt,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.children,(e,t)=>(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createBlock)(l,{key:t,size:o.options.size,value:e.icon,onClick:e.handler},null,8,["size","value","onClick"])),[[i,e.hint]])),128))])])}]]),qt={class:"horizontal-menu"},Gt={href:"#"},Wt={class:"submenu"},Kt={href:"#"},Jt={class:"submenu"},Yt={href:"#"},Xt={mounted(){}},Qt=(0,C.A)(Xt,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon");return(0,s.openBlock)(),(0,s.createElementBlock)("ul",qt,[t[7]||(t[7]=(0,s.createElementVNode)("li",null,[(0,s.createElementVNode)("a",{href:"#"},[(0,s.createElementVNode)("i",{class:"fas fa-home menu-icon"}),(0,s.createElementVNode)("span",{class:"menu-text"},"Главная")])],-1)),(0,s.createElementVNode)("li",null,[(0,s.createElementVNode)("a",Gt,[(0,s.createVNode)(l,{value:"folder",size:"1em"}),t[0]||(t[0]=(0,s.createElementVNode)("span",{class:"menu-text"},"Товары",-1)),t[1]||(t[1]=(0,s.createElementVNode)("i",{class:"fas fa-chevron-down menu-arrow"},null,-1))]),(0,s.createElementVNode)("ul",Wt,[(0,s.createElementVNode)("li",null,[(0,s.createElementVNode)("a",Kt,[(0,s.createVNode)(l,{value:"bell",size:"1em"}),t[2]||(t[2]=(0,s.createElementVNode)("span",{class:"menu-text"},"Электроника",-1)),t[3]||(t[3]=(0,s.createElementVNode)("i",{class:"fas fa-chevron-right menu-arrow"},null,-1))]),(0,s.createElementVNode)("ul",Jt,[(0,s.createElementVNode)("li",null,[(0,s.createElementVNode)("a",Yt,[(0,s.createVNode)(l,{value:"cog",size:"1em"}),t[4]||(t[4]=(0,s.createElementVNode)("span",{class:"menu-text"},"Смартфоны",-1))])]),t[5]||(t[5]=(0,s.createElementVNode)("li",null,[(0,s.createElementVNode)("a",{href:"#"},[(0,s.createElementVNode)("i",{class:"fas fa-tablet-alt menu-icon"}),(0,s.createElementVNode)("span",{class:"menu-text"},"Планшеты")])],-1))])]),t[6]||(t[6]=(0,s.createElementVNode)("li",null,[(0,s.createElementVNode)("a",{href:"#"},[(0,s.createElementVNode)("i",{class:"fas fa-tshirt menu-icon"}),(0,s.createElementVNode)("span",{class:"menu-text"},"Одежда")])],-1))])]),t[8]||(t[8]=(0,s.createStaticVNode)('<li data-v-202d206c><a href="#" data-v-202d206c><i class="fas fa-info-circle menu-icon" data-v-202d206c></i><span class="menu-text" data-v-202d206c>О нас</span><i class="fas fa-chevron-down menu-arrow" data-v-202d206c></i></a><ul class="submenu" data-v-202d206c><li data-v-202d206c><a href="#" data-v-202d206c><i class="fas fa-history menu-icon" data-v-202d206c></i><span class="menu-text" data-v-202d206c>История</span></a></li><li data-v-202d206c><a href="#" data-v-202d206c><i class="fas fa-users menu-icon" data-v-202d206c></i><span class="menu-text" data-v-202d206c>Команда</span></a></li></ul></li><li data-v-202d206c><a href="#" data-v-202d206c><i class="fas fa-envelope menu-icon" data-v-202d206c></i><span class="menu-text" data-v-202d206c>Контакты</span></a></li>',2))])}],["__scopeId","data-v-202d206c"]]),Zt={class:"horizontal-menu"},eo={class:"menu-text"},to={key:0,class:"submenu"},oo={name:"MenuItem",props:{item:{type:Object,required:!0}},methods:{onClick(e){console.log(e),!e.children&&e.handler&&e.handler()}}},no={components:{MenuItem:(0,C.A)(oo,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveComponent)("MenuItem",!0),c=(0,s.resolveDirective)("translate"),d=(0,s.resolveDirective)("tooltip");return(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("li",{class:(0,s.normalizeClass)({"has-children":o.item.children})},[(0,s.createElementVNode)("div",{class:"item",onClick:t[0]||(t[0]=e=>r.onClick(o.item))},[(0,s.createVNode)(l,{value:o.item.children?"folder":o.item.icon,size:"1em"},null,8,["value"]),(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("span",eo,[(0,s.createTextVNode)((0,s.toDisplayString)(o.item.text),1)])),[[c,`$$menu.${o.item.text}`]])]),o.item.children?((0,s.openBlock)(),(0,s.createElementBlock)("ul",to,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.item.children,(e,t)=>((0,s.openBlock)(),(0,s.createBlock)(i,{key:t,item:e},null,8,["item"]))),128))])):(0,s.createCommentVNode)("v-if",!0)],2)),[[d,o.item.tooltip]])}],["__scopeId","data-v-72ce0a21"]])},props:{menu:{type:Object}}},ao=(0,C.A)(no,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("MenuItem");return(0,s.openBlock)(),(0,s.createElementBlock)("ul",Zt,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.menu,(e,t)=>((0,s.openBlock)(),(0,s.createBlock)(l,{key:t,item:e},null,8,["item"]))),128))])}],["__scopeId","data-v-88afb356"]]);var so=o(320);const ro={class:"dropdown"},lo={key:0,class:"dropdown-menu"},io=["onClick"],co={__name:"userpanel",setup(e){const t=so.default.default||so.default,o=(0,s.ref)(!1),n=(0,s.computed)(()=>t.app.user.registered?[{label:"Options",handler:()=>{}},{label:"Logout",handler:t.app.logout}]:[{label:"Login",handler:i}]),a=()=>{o.value=!o.value},r=(0,s.useTemplateRef)("dropdown"),l=e=>{r.value?.contains(e.target)||(o.value=!1)};(0,s.watch)(o,e=>{e?window.addEventListener("click",l):window.removeEventListener("click",l)});const i=()=>{t.modal.open({header:{value:"Login",handler:()=>{t.modal.close()}},content:{component:"LoginForm",props:{},events:{success:()=>{t.modal.close(),t.app.init()}}},footer:{buttons:[]}})};return(e,l)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",ro,[(0,s.createCommentVNode)(" Триггер для открытия меню "),(0,s.createElementVNode)("div",{ref_key:"dropdown",ref:r,class:"dropdown-trigger",onClick:a},(0,s.toDisplayString)((0,s.unref)(t).app.user.name),513),(0,s.createCommentVNode)(" Выпадающее меню "),(0,s.createVNode)(s.Transition,{name:"fade"},{default:(0,s.withCtx)(()=>[o.value?((0,s.openBlock)(),(0,s.createElementBlock)("div",lo,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(n.value,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("a",{key:t,class:"dropdown-item",onClick:t=>(e=>{o.value=!1,e.handler()})(e)},(0,s.toDisplayString)(e.label),9,io))),128))])):(0,s.createCommentVNode)("v-if",!0)]),_:1})]))}},po=(0,C.A)(co,[["__scopeId","data-v-4594b897"]]),uo={name:"UI",props:{element:null},data(){return{version:"0.0.11",ui:{blocks:[{component:"AssetsTree",data:{title:"$$Assets"},onSelect:this.onSelectAsset},{component:"ModelsTree",data:{title:"$$Models"},onSelect:()=>{}}],header:{buttons:this.$app.menu.hierarhy.children}},name:"",selectedSlide:null,selectedNodes:[]}},methods:{onButtonClick(e){e.handler&&e.handler()},onSelectAsset(e){},onSelectedNodesUpdate(){},camChange(e){const t=e.target.value,o=this.cameras.find(e=>e.uid===t);o&&"function"==typeof o.handler?o.handler():console.warn(`No handler found for camera with UID: ${t}`)},handleSlideSelected(e){this.selectedSlide=e},activateInMenu(e,t){if(!t)return this.menu.actived[e]=null,void("main"===e&&(this.menu.ext.length=0));this.menu.actived[e]=t.id,"main"===e&&(this.menu.ext.length=0,this.menu.ext.push(...t.ext||[]))},handleNodeDrop({sourceNodeUid:e,targetNodeUid:t,sourceTree:o}){console.log(e);const n="TreeViewLeft"===o?this.leftTree:this.rightTree,a="TreeViewLeft"===o?this.rightTree:this.leftTree,s=this.findNodeInTree(n,e),r=this.findNodeInTree(a,t);s&&r&&(this.removeNodeFromTree(n,e),r.children||this.$set(r,"children",[]),r.children.push(s),"TreeViewLeft"===o?(this.leftTree=[...this.leftTree],this.rightTree=[...this.rightTree]):(this.rightTree=[...this.rightTree],this.leftTree=[...this.leftTree]))},findNodeInTree(e,t){console.log(e)},removeNodeFromTree(e,t){console.log(e)}},computed:{project(){return this.$app.project},projectMenu(){return this.$app.menu.app.children},topMenu(){return this.$app.menu.top},headMenu(){return this.$app.menu.hierarhy.children},footerMenu(){return this.$app.menu.tools.children},viewTransform(){return this.$app.selection.selected?.isElement||this.$app.selection.selected?.isState},slide(){return this.$app.slides.actived},selected(){return this.$app.selection.element},slides(){return this.$app.slides.children},cameras(){return this.$app.app.cameras},leftpanel(){return this.$app.app.leftpanel},rightpanel(){return this.$app.app.rightpanel},options(){return this.$app.options},menu(){return this.$app.menu},app(){return this.$app.app},tools:()=>toolse,models(){return this.$app.models},ready(){return this.$app.engine.ready},toasts(){return this.$app.toasts},modal(){return this.$app.modal},translations(){return this.$app.translations},options(){return this.$app.project.options||{}},info(){return this.$app.project.info||{}}},components:{UserPanel:po,ModelsTree:St,horizontalmenu:ao,Topmenu:Qt,ViewPanel:B,Sliders:R,HierarhyUI:q,InspectorUI:Pe,AssetsTree:at,ElementsTree:gt,StatesTree:Bt,Transformer:Ht}},mo=(0,C.A)(uo,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("horizontalmenu"),i=(0,s.resolveComponent)("icon"),c=(0,s.resolveComponent)("SectionSelect"),d=(0,s.resolveComponent)("InspectorUI"),w=(0,s.resolveComponent)("ViewPanel"),E=(0,s.resolveComponent)("Sliders"),_=(0,s.resolveComponent)("Transformer"),S=(0,s.resolveDirective)("tooltip"),N=(0,s.resolveDirective)("translate");return(0,s.openBlock)(),(0,s.createElementBlock)("div",p,[(0,s.createElementVNode)("div",u,[(0,s.createVNode)(l,{menu:r.projectMenu},null,8,["menu"]),(0,s.createElementVNode)("div",m,(0,s.toDisplayString)(r.info.name),1),(0,s.createElementVNode)("div",h,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:"square large",onClick:t[0]||(t[0]=e=>r.project.play())},[(0,s.createVNode)(i,{value:"play3"})])),[[S,"Play project"]]),(0,s.createVNode)(c,{modelValue:r.translations.lang,"onUpdate:modelValue":[t[1]||(t[1]=e=>r.translations.lang=e),r.translations.change],list:r.translations.languages},null,8,["modelValue","list","onUpdate:modelValue"]),(0,s.createCommentVNode)(" <UserPanel /> "),(0,s.createCommentVNode)(' <div class="icon">\n                    <icon value="cog"></icon>\n                </div> '),(0,s.createTextVNode)(" v "+(0,s.toDisplayString)(a.version),1)])]),(0,s.createCommentVNode)(" <Topmenu></Topmenu> "),(0,s.createVNode)(d,{selected:r.selected,class:"inspector"},null,8,["selected"]),r.app.ready?((0,s.openBlock)(),(0,s.createBlock)(w,{key:0,class:"project",header:a.ui.header,footer:a.ui.footer},{header:(0,s.withCtx)(()=>[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.headMenu,e=>(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:(0,s.normalizeClass)(e.class),onClick:t=>r.onButtonClick(e)},[e.label?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("span",v,[(0,s.createTextVNode)((0,s.toDisplayString)(e.label||"Close"),1)])),[[N]]):(0,s.createCommentVNode)("v-if",!0),e.icon?((0,s.openBlock)(),(0,s.createBlock)(i,{key:1,value:e.icon,size:"1.5em"},null,8,["value"])):(0,s.createCommentVNode)("v-if",!0)],10,f)),[[S,e.tooltip]])),256))]),footer:(0,s.withCtx)(()=>[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.footerMenu,e=>(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:(0,s.normalizeClass)(e.class),onClick:t=>r.onButtonClick(e)},[e.label?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("span",k,[(0,s.createTextVNode)((0,s.toDisplayString)(e.label||"Close"),1)])),[[N]]):(0,s.createCommentVNode)("v-if",!0),e.icon?((0,s.openBlock)(),(0,s.createBlock)(i,{key:1,value:e.icon,size:"1.5em"},null,8,["value"])):(0,s.createCommentVNode)("v-if",!0)],10,b)),[[S,e.tooltip]])),256))]),default:(0,s.withCtx)(()=>[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(a.ui.blocks,o=>((0,s.openBlock)(),(0,s.createElementBlock)("div",g,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(o.component||"div"),(0,s.mergeProps)({class:"elementContent"},{ref_for:!0},o.component?o.data:null,{onSelect:o.onSelect,onNodeDrop:r.handleNodeDrop,"onUpdate:tree":t[2]||(t[2]=t=>e.leftTree=t)}),{default:(0,s.withCtx)(()=>[(0,s.createElementVNode)("div",{class:"content-value",innerHTML:o.value||""},null,8,y)]),_:2},1040,["onSelect","onNodeDrop"]))]))),256))]),_:1},8,["header","footer"])):(0,s.createCommentVNode)("v-if",!0),(0,s.createVNode)(E,{slides:r.slides,slide:r.slide,onSlideselect:r.handleSlideSelected,class:"sliders"},null,8,["slides","slide","onSlideselect"]),r.viewTransform?((0,s.openBlock)(),(0,s.createBlock)(_,(0,s.normalizeProps)((0,s.mergeProps)({key:1},r.topMenu)),null,16)):(0,s.createCommentVNode)("v-if",!0),(0,s.renderSlot)(e.$slots,"default",{},void 0,!0)])}],["__scopeId","data-v-f5035b78"]]),ho=new ke.Raycaster;ho.layers.enableAll();const fo=new class{constructor(){this._events={"*":[]}}subs(e,t,o){null==this._events[e]&&(this._events[e]=[]),this._events[e].push({handler:o,once:t})}on(e,t){this.subs(e,!1,t)}once(e,t){this.subs(e,!0,t)}off(e,t){const o=this._events[e];if(o){for(let e=o.length-1;e>=0;e--)o[e].handler===t&&o.splice(e,1);0===o.length&&delete this._events[e]}}clear(e){this._events[e]=[]}clearAll(){this._events={"*":[]}}emit(e,...t){const o=[];this._events[e]&&o.push(...this._events[e]),this._events["*"].length&&o.push(...this._events["*"].map(t=>({handler:t.handler.bind(this,e),once:t.once})));for(let e=o.length-1;e>=0;e--){const n=o[e];n.handler.apply(null,t),n.once&&o.splice(e,1)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}};let vo,go,yo;const bo={x:0,y:0};let ko,wo=.03,Eo=.03,_o=.01,So=.01,No=window.innerWidth/2,Vo=window.innerHeight/2;function Co(e){for(;e;){if(e.isElement||e.isHelper)return e;e=e.parent}return null}function Bo(e){}function $o(e){bo.x=e.clientX,bo.y=e.clientY,ko=Date.now()}function xo(e){if(Math.abs(bo.x-e.clientX)>10||Math.abs(bo.y-e.clientY)>10||Date.now()-ko>500)return;const t=new ke.Vector2,o=yo.getBoundingClientRect(),n=e.clientX-o.left,a=e.clientY-o.top;t.x=n/yo.clientWidth*2-1,t.y=-a/yo.clientHeight*2+1,ho.setFromCamera(t,go);const s=ho.intersectObjects(vo.children,!0);if(0!==s.length)for(let e=0;e<s.length;e++){const t=s[e].object;if(t.nonClick)continue;const o=Co(t);if(o?.visible)return fo.emit("click",o),void(o.onClick&&o.onClick())}else fo.emit("click",null)}const Do=new Proxy(class{static get Control(){return Control}static Init(e,t,o,n,a){const s={camera:{range:{x:.01,y:.01},movespeed:{x:.03,y:.03}},...a};vo=n,go=t,yo=e,wo=s.camera.movespeed.x,Eo=s.camera.movespeed.y,_o=s.camera.range.x,So=s.camera.range.y,No=window.innerWidth/2,Vo=window.innerHeight/2,e.addEventListener("click",xo.bind(null)),e.addEventListener("mousemove",Bo,!1),e.addEventListener("mousedown",$o,!1)}static Update(e){}static SetCamera(e){go=e}},{get:(e,t)=>t in e?e[t]:fo[t]}),Io=so.default.default||so.default;let To,Ao,Mo,Oo,jo;function Po(e){Ao.render(To,Mo)}class Ro{static get CameraHelper(){return jo}static async Init(e){Oo=e;const{Project:t,Factory:o}=Io.modules.getMod("engine");To=t.Scene,Ao=new THREE.WebGLRenderer({canvas:e,alpha:!0,powerPreference:"high-performance",antialias:!0,stencil:!1});const n=Oo.clientWidth,a=Oo.clientHeight;Ao.setSize(n,a,!1),Ao.setPixelRatio(window.devicePixelRatio),Ao.shadowMap.enabled=!0,Ao.shadowMap.type=THREE.PCFSoftShadowMap,t.on("setcamera",()=>{jo&&(To.remove(jo),jo.dispose()),jo=new THREE.CameraHelper(t.Camera),jo.layers.set(1),To.add(jo)}),jo=new THREE.CameraHelper(t.Camera),jo.layers.set(1),To.add(jo),Mo=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.01,5e3),Mo.layers.enable(1),Mo.uid="EditorCamera",To.add(Mo),Mo.position.set(5,3,20),Ao.setAnimationLoop(Po),o.on("create",(e,t)=>{e.type}),Ut.Init({canvas:Oo},Mo,t.Scene),Ut.FocusTo(t.Root),Do.Init(Oo,Mo,To,t.Root),Do.on("click",Io.selection.select)}}window.Editor=Ro;const Lo=Ro;let Fo="defaultDB",Uo=null,zo=[],Ho="uid";class qo{constructor(e,t,o="id"){this.dbName=e,this._storages=t,this._key=o,this.db=null}async openDatabase(e){return new Promise((t,o)=>{const n=indexedDB.open(this.dbName);n.onupgradeneeded=e=>{const t=e.target.result;for(let e=0;e<this._storages.length;e++)t.objectStoreNames.contains(this._storages[e])||t.createObjectStore(this._storages[e],{keyPath:this._key,autoIncrement:!1})},n.onsuccess=n=>{if(this.db=n.target.result,this.db.objectStoreNames.contains(e))t(this.db);else{this.db.close();const n=this.db.version+1,a=indexedDB.open(this.dbName,n);a.onupgradeneeded=t=>{t.target.result.createObjectStore(e,{keyPath:"id",autoIncrement:!0})},a.onsuccess=e=>{this.db=e.target.result,t(this.db)},a.onerror=e=>{o(e.target.error)}}},n.onerror=e=>{o(e.target.error)}})}async addItem(e,t){const o=(await this.openDatabase(e)).transaction(e,"readwrite");return o.objectStore(e).add(t),new Promise(e=>{o.oncomplete=()=>e(),o.onerror=()=>e()})}async addItems(e,t){const o=[];for(let n=0;n<t.length;n++)o.push(this.addItem(e,t[n]));await Promise.all(o)}async getItem(e,t){const o=(await this.openDatabase(e)).transaction(e,"readonly").objectStore(e);return new Promise((e,n)=>{const a=o.get(t);a.onsuccess=()=>e(a.result),a.onerror=()=>e()})}async deleteItem(e,t){const o=(await this.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,n)=>{const a=o.delete(t);a.onsuccess=()=>e(),a.onerror=()=>n()})}async getAllItems(e){const t=(await this.openDatabase(e)).transaction(e,"readonly").objectStore(e);return new Promise((e,o)=>{const n=t.getAll();n.onsuccess=()=>e(n.result),n.onerror=()=>e()})}async updateItem(e,t){const o=(await this.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,n)=>{const a=o.put(t);a.onsuccess=()=>e(t),a.onerror=()=>n()})}async updateItemProperties(e,t,o){const n=(await this.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,a)=>{const s=n.get(t);s.onsuccess=()=>{const t=s.result;if(t){Object.assign(t,o);const s=n.put(t);s.onsuccess=()=>e(),s.onerror=()=>a()}else a("Item not found")},s.onerror=()=>a()})}async upsertItemProperties(e,t,o){console.log(e);const n=(await this.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,a)=>{const s=n.get(t);s.onsuccess=()=>{let r=s.result;if(r){Object.assign(r,o);const t=n.put(r);t.onsuccess=()=>e(),t.onerror=()=>a()}else{const s={...o,id:t},r=n.add(s);r.onsuccess=()=>e(),r.onerror=()=>a()}},s.onerror=()=>a()})}static async GetList(){try{return await indexedDB.databases()}catch(e){return[]}}static GetStoragesData(e){indexedDB.open(e).onsuccess=function(e){const t=e.target.result,o=t.transaction(t.objectStoreNames,"readonly");t.objectStoreNames.forEach(e=>{const t=o.objectStore(e);console.log("Хранилище:",e),console.log("КлюPath:",t.keyPath),console.log("Автоинкремент:",t.autoIncrement)}),t.close()}}static GetStorages(e){return new Promise((t,o)=>{const n=indexedDB.open(e);n.onsuccess=e=>{const o=e.target.result,n=[];for(let e=0;e<o.objectStoreNames.length;e++)n.push(o.objectStoreNames[e]);o.close(),t(n)},n.onerror=e=>{o(`Ошибка открытия БД: ${e.target.error}`)},n.onupgradeneeded=e=>{console.log("БД требует обновления")}})}static Create(e,t,o=!1){return new Promise((n,a)=>{const s=indexedDB.open(e,1);s.onupgradeneeded=function(e){const n=e.target.result,a=Object.keys(t);for(let e=0;e<a.length;e++){const t=a[e];if(!n.objectStoreNames.contains(t)){const e=n.createObjectStore(t,{keyPath:"uid"});o&&e.createIndex("uid","uid",{unique:!0})}}},s.onsuccess=function(e){const o=e.target.result,s=Object.keys(t),r=o.transaction(s,"readwrite");for(let e=0;e<s.length;e++){const o=s[e],n=r.objectStore(o);if(Array.isArray(t[o]))for(let e=0;e<t[o].length;e++)n.put(t[o][e]);else n.put(t[o])}r.oncomplete=function(){n()},r.onerror=function(){a()}},s.onerror=function(e){a(e.target.error)}})}static async GetFromAll(e,t){try{const e=await indexedDB.databases(),t=[],o=e.map(e=>new Promise((o,n)=>{const a=e.name,s=indexedDB.open(a);s.onsuccess=function(e){const n=e.target.result;if(n.objectStoreNames.contains("project")){const e=n.transaction("project","readonly").objectStore("project").get("info");e.onsuccess=()=>{t.push(e.result),o()},e.onerror=()=>{o()}}else o()},s.onerror=function(){console.error(`Ошибка при открытии базы данных: ${a}`),n()}}));return await Promise.all(o),t}catch(e){console.error("Ошибка при получении списка баз данных:",e)}}static DeleteDatabase(e){return new Promise((t,o)=>{Uo.close();const n=indexedDB.deleteDatabase(e);n.onsuccess=function(){t()},n.onerror=function(){console.warn(`Ошибка при удалении базы данных ${e}.`),o()},n.onblocked=async function(){console.warn(`Blocked ${e}.`),t()}})}static Init(e,t,o="uid"){Fo=e,zo=t,Ho=o}static async openDatabase(e){return new Promise((t,o)=>{const n=indexedDB.open(Fo);n.onupgradeneeded=e=>{const t=e.target.result;for(let e=0;e<zo.length;e++)t.objectStoreNames.contains(zo[e])||t.createObjectStore(zo[e],{keyPath:Ho,autoIncrement:!1})},n.onsuccess=n=>{if(Uo=n.target.result,Uo.objectStoreNames.contains(e))t(Uo);else{Uo.close();const n=Uo.version+1,a=indexedDB.open(Fo,n);a.onupgradeneeded=t=>{t.target.result.createObjectStore(e,{keyPath:"id",autoIncrement:!0})},a.onsuccess=e=>{Uo=e.target.result,t(Uo)},a.onerror=e=>{o(e.target.error)}}},n.onerror=e=>{o(e.target.error)}})}static async addItem(e,t){const o=(await qo.openDatabase(e)).transaction(e,"readwrite");return o.objectStore(e).add(t),new Promise(e=>{o.oncomplete=()=>e(),o.onerror=()=>e()})}static async addItems(e,t){const o=[];for(let n=0;n<t.length;n++)o.push(qo.addItem(e,t[n]));await Promise.all(o)}static async getItem(e,t){const o=(await qo.openDatabase(e)).transaction(e,"readonly").objectStore(e);return new Promise((e,n)=>{const a=o.get(t);a.onsuccess=()=>e(a.result),a.onerror=()=>e()})}static async deleteItem(e,t){const o=(await this.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,n)=>{const a=o.delete(t);a.onsuccess=()=>e(),a.onerror=()=>n()})}static async getAllItems(e){const t=(await qo.openDatabase(e)).transaction(e,"readonly").objectStore(e);return new Promise((e,o)=>{const n=t.getAll();n.onsuccess=()=>e(n.result),n.onerror=()=>o})}static async updateItem(e,t){const o=(await qo.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,n)=>{const a=o.put(t);a.onsuccess=()=>e(t),a.onerror=()=>n()})}static async updateItemProperties(e,t,o){const n=(await qo.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,a)=>{const s=n.get(t);s.onsuccess=()=>{const t=s.result;if(t){Object.assign(t,o);const s=n.put(t);s.onsuccess=()=>e(),s.onerror=()=>a()}else a("Item not found")},s.onerror=()=>a()})}static async upsertMany(e,t,o="id"){const n=[];for(let a=0;a<t.length;a++){const s=t[a];n.push(qo.upsertItemProperties(e,s[o],s))}await Promise.all(n)}static async upsertItemProperties(e,t,o){console.log(e);const n=(await qo.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,a)=>{const s=n.get(t);s.onsuccess=()=>{let r=s.result;if(r){r={...r,...o};const t=n.put(r);t.onsuccess=()=>e(),t.onerror=()=>a()}else{const s={...o,id:t,uid:t},r=n.add(s);r.onsuccess=()=>e(),r.onerror=()=>a()}},s.onerror=()=>a()})}static getVersion(e){return new Promise(t=>{const o=indexedDB.open(e);o.onsuccess=e=>{const o=e.target.result,n=o.version;o.close(),t(n)},o.onerror=e=>{console.error("Ошибка при открытии БД:",e.target.error),t(null)}})}static exportToJson(e){return new Promise(async(t,o)=>{const n=await qo.getVersion(e),a=indexedDB.open(e,n);a.onerror=e=>{o(`Ошибка открытия базы данных: ${e.target.error}`)},a.onsuccess=e=>{const n=e.target.result,a={},s=n.objectStoreNames,r=n.transaction(s,"readonly"),l=[];for(let e=0;e<s.length;e++){const t=s[e],o=r.objectStore(t);l.push(new Promise(e=>{const n=[],a=o.openCursor();a.onerror=()=>{console.error(`Ошибка чтения хранилища ${t}`),e({[t]:[]})},a.onsuccess=o=>{const a=o.target.result;a?(n.push(a.value),a.continue()):e({[t]:n})}}))}Promise.all(l).then(e=>{e.forEach(e=>{const t=Object.keys(e)[0];a[t]=e[t]}),t(a)}).catch(o),r.oncomplete=()=>{n.close()}},a.onupgradeneeded=e=>{0===e.target.result.objectStoreNames.length&&t({})}})}}const Go=qo,Wo=["actions","assets","models","modules","project","slides"],Ko={data:()=>({playFit:!0,selectedElement:null,loadComponent:"div",modulesLoaded:!1,progress:0}),computed:{ui(){return this.$app.ui},hierarhyAllow(){return this.$app.engine.instances.length>0},options(){return this.$app.options},app(){return this.$app.app},tools:()=>toolse,models(){return this.$app.models},ready(){return this.$app.app.ready},modal(){return this.$app.modal}},methods:{changePlaySize(){this.playFit=!this.playFit;const e=this.$refs.playcanvas;this.$nextTick(()=>{const t=e.clientWidth,o=e.clientHeight;this.$app.engine.CssManager.SetScale(t,o)})},async start(){this.$app.app.ready=!0},waitCanvasSize(e){const t=window.devicePixelRatio||1;e.forEach(e=>{e.width=e.clientWidth*t,e.height=e.clientHeight*t})}},async mounted(){document.documentElement.setAttribute("data-theme","dark"),window.THREE=ke,await Promise.all([this.$app.app.init(),this.$app.translations.init()]),await this.$app.modules.init();const e=this.$refs.editorcanvas,t=this.$refs.playcanvas;this.waitCanvasSize([e,t]);const o=new URLSearchParams(window.location.search),n=o.get("src");let a;switch(n){case"db":default:this.$app.project.uid=o.get("db")||"empty",await Go.Init(this.$app.project.uid,Wo,"uid");const e=[];for(let t=0;t<Wo.length;t++){const o=await Go.getAllItems(Wo[t]);e.push(o)}const[t=[],n=[],s=[],r=[],l={uid:this.$app.project.uid},i=[]]=e;a={actions:t,assets:n,models:s,modules:r,project:l,slides:i};break;case"url":const c=await fetch(o.get("url"));a=await c.json(),this.$app.project.uid=a.project.uid,await Go.Init(this.$app.project.uid,Wo,"uid")}this.$app.project.init(a.project),this.$app.projects.init(this.$app.project.uid),await new Promise(e=>{this.$nextTick(e)}),this.loadComponent="LoaderScreen",console.log("---LOAD ENGINE---"),await this.$app.engine.load(),console.log("---LOAD MODULES---"),await this.$app.modules.loadUserModules(a.modules),console.log("---LOAD ASSETS AND ACTIONS---"),await Promise.all([this.$app.assets.init(a.assets,e=>{this.progress=e}),this.$app.actions.init(a.actions)]),console.log("---LOAD END---"),this.$app.engine.manager.Init(t),this.$app.engine.manager.Start(),console.log("---BUILD SCENES---"),await Lo.Init(e),await this.$app.engine.start();const s=this.$app.engine.CssManager;await s.Init(this.$refs.playui,t),this.$app.models.on("create",e=>{s.OnCreate(e,this.$app.ui,this.$app.slides)}),this.$app.models.on("remove",(e,t)=>{s.OnRemove(t,this.$app.ui)});try{console.log("---INSTANCED MODELS---"),await this.$app.models.load(a.models)}catch(e){n&&"db"!==n||(console.warn(e),this.$app.toasts.add({message:"Error loading project",type:"alerticon",timehide:!0}))}if(console.log("---BUILD SLIDES---"),0===a.slides.length){const e=await this.$app.slides.add({name:"Main",props:{},actions:[]});a.slides.push(e)}await this.$app.slides.load(a.slides),this.progress=100,a.slides.length>0&&(console.log("---ACTIVATE FIRST SLIDE---"),this.$app.slides.goto(0)),console.log("---READY---"),this.app.ready=!0},components:{UI:mo}},Jo=(0,C.A)(Ko,[["render",function(e,t,o,n,a,p){const u=(0,s.resolveComponent)("icon"),m=(0,s.resolveComponent)("UI"),h=(0,s.resolveComponent)("Modal"),f=(0,s.resolveComponent)("Toasts");return(0,s.openBlock)(),(0,s.createElementBlock)("div",r,[(0,s.createElementVNode)("div",l,[(0,s.createElementVNode)("canvas",i,null,512),(0,s.createElementVNode)("canvas",{id:"playcanvas",style:(0,s.normalizeStyle)({width:a.playFit?"512px":"128px"}),ref:"playcanvas"},null,4),(0,s.createElementVNode)("div",c,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(p.ui.elements,(e,t)=>((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.component),(0,s.mergeProps)({onMounted:p.ui.onElementMount,key:t},(0,s.toHandlers)(e.events||{}),{ref_for:!0},e.data),null,16,["onMounted"]))),128))],512),(0,s.createVNode)(m,{element:a.selectedElement},{default:(0,s.withCtx)(()=>[(0,s.createElementVNode)("button",{onClick:t[0]||(t[0]=(...e)=>p.changePlaySize&&p.changePlaySize(...e)),style:{"pointer-events":"all",position:"absolute",top:"55px",right:"265px",opacity:"0.75"},class:"large square"},[(0,s.createVNode)(u,{value:a.playFit?"shrink2":"enlarge2",size:"2em"},null,8,["value"])])]),_:1},8,["element"])]),p.ready?(0,s.createCommentVNode)("v-if",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",d,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(a.loadComponent),{loadingProgress:a.progress,onClick:p.start},null,8,["loadingProgress","onClick"]))])),p.modal.isVisible?((0,s.openBlock)(),(0,s.createBlock)(h,{key:1})):(0,s.createCommentVNode)("v-if",!0),(0,s.createVNode)(f)])}]]),Yo={class:"overbutton"},Xo={class:"menulabel"},Qo={class:"btnicon"},Zo={name:"ExpandedButton",props:{label:"",icon:"",color:"rgb(0,0,0)"}},en=(0,C.A)(Zo,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon");return(0,s.openBlock)(),(0,s.createElementBlock)("button",Yo,[(0,s.createElementVNode)("div",Xo,(0,s.toDisplayString)(o.label),1),(0,s.createElementVNode)("div",Qo,[(0,s.createVNode)(l,{size:"100%",color:o.color,value:o.icon},null,8,["color","value"])])])}]]),tn=["fill","x","href"],on=o.p+"assets/7913cbce5c9640a64e47.svg",nn={name:"Icon",props:{value:{type:String,default:()=>"icon-checkmark"},size:{type:String,default:()=>null},color:{type:String,default:()=>null},offset:{type:Number}},computed:{style(){return this.size?{width:`${this.size}`,height:`${this.size}`}:{width:"1em",height:"1em"}},val(){return`${on}#s-${this.value.replace("p-","")}`}}},an=(0,C.A)(nn,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("svg",{preserveAspectRatio:"xMidYMid meet",class:"svgicon",style:(0,s.normalizeStyle)(r.style)},[(0,s.createElementVNode)("use",{class:"svguse",width:"100%",height:"100%",viewBox:"0 0 32 32",fill:o.color,x:o.offset,href:r.val},[(0,s.createElementVNode)("title",null,[(0,s.renderSlot)(e.$slots,"default",{},void 0,!0)])],8,tn)],4)}],["__scopeId","data-v-a13b2ade"]]),sn={class:"modal-header"},rn={class:"modal-content"},ln=["innerHTML"],cn={class:"modal-footer"},dn=["disabled","onClick"],pn={computed:{modal(){return this.$app.modal},header(){return this.modal.header},content(){return this.modal.content},footer(){return this.modal.footer}},methods:{onSelf(){this.modal.values.closable&&this.modal.close()},onClick(e){"function"==typeof e&&e()},closeModal(e){"function"!=typeof e?this.modal.close():e()}}},un=(0,C.A)(pn,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveDirective)("translate");return(0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"modal-overlay",onClick:t[3]||(t[3]=(0,s.withModifiers)((...e)=>r.onSelf&&r.onSelf(...e),["self"]))},[(0,s.createElementVNode)("div",{class:"modal",onClick:t[2]||(t[2]=(0,s.withModifiers)(()=>{},["stop"]))},[(0,s.createElementVNode)("header",sn,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(r.header.component||"div"),(0,s.mergeProps)({class:"header"},r.header.component?r.header:null),{default:(0,s.withCtx)(()=>[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("h3",null,[(0,s.createTextVNode)((0,s.toDisplayString)(r.header.value),1)])),[[l,`$$title.${r.header.value}`]]),(0,s.createElementVNode)("button",{class:"close-btn",onClick:t[0]||(t[0]=e=>r.closeModal(r.header.handler))},"×")]),_:1},16))]),(0,s.createElementVNode)("main",rn,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(r.content.component||"div"),(0,s.mergeProps)({class:"content"},r.content.component?r.content.props:null,(0,s.toHandlers)(r.content.events||{})),(0,s.createSlots)({default:(0,s.withCtx)(()=>[(0,s.createElementVNode)("div",{class:"content-value",innerHTML:r.content.value||""},null,8,ln)]),_:2},[(0,s.renderList)(r.content.slots,(e,t)=>({name:t,fn:(0,s.withCtx)(t=>[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.component),(0,s.mergeProps)(t,(0,s.toHandlers)(e.events||{})),(0,s.createSlots)({_:2},[(0,s.renderList)(t.slots,(e,t)=>({name:t,fn:(0,s.withCtx)(t=>[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.component),(0,s.normalizeProps)((0,s.guardReactiveProps)(t)),null,16))])}))]),1040))])}))]),1040))]),(0,s.createElementVNode)("footer",cn,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(r.footer.component||"div"),(0,s.mergeProps)({class:"footer"},r.footer.component?r.footer.props:null,{onClose:r.closeModal}),{default:(0,s.withCtx)(()=>[r.footer.buttons?((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,{key:0},(0,s.renderList)(r.footer.buttons,e=>((0,s.openBlock)(),(0,s.createElementBlock)("div",null,[e.hidden?(0,s.createCommentVNode)("v-if",!0):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:0,class:(0,s.normalizeClass)(e.class),disabled:e.disabled,onClick:t=>r.onClick(e.handler)},[(0,s.createTextVNode)((0,s.toDisplayString)(e.label||"Close"),1)],10,dn)),[[l,`$$buttons.${e.label}`]])]))),256)):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:1,class:(0,s.normalizeClass)(r.footer.class),onClick:t[1]||(t[1]=e=>r.closeModal(r.footer.handler))},[(0,s.createTextVNode)((0,s.toDisplayString)(r.footer.label||"Close"),1)],2)),[[l,`$$buttons.${r.footer.label}`]])]),_:1},16,["onClose"]))])])])}],["__scopeId","data-v-bf7c1aea"]]),mn=["onClick"],hn={props:{values:{type:Array},rect:{type:Object},size:{type:Object,default:{width:200,height:100}}},data:()=>({popupStyle:{}}),methods:{togglePopup(e){const t=window.innerWidth;let o=this.rect.top+window.scrollY,n=this.rect.left+window.scrollX;n+this.size.width>t&&(n=this.rect.right-this.size.width+window.scrollX),this.popupStyle={position:"absolute",top:`${o}px`,left:`${n}px`,width:`${this.size.width}px`},this.isPopupVisible=!0},hidePopup(){this.$emit("callback")}}},fn=(0,C.A)(hn,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"popup",style:(0,s.normalizeStyle)(a.popupStyle)},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.values,(t,o)=>(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("p",{class:"element",key:o,onClick:o=>t.handler?t.handler(t):e.$emit("click",t)},[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(t.component||"div"),(0,s.mergeProps)({ref_for:!0},t.props),{default:(0,s.withCtx)(()=>[(0,s.createTextVNode)((0,s.toDisplayString)(t.props),1)]),_:2},1040))],8,mn)),[[l,t.tooltip]])),128)),(0,s.createElementVNode)("button",{onClick:t[0]||(t[0]=(...e)=>r.hidePopup&&r.hidePopup(...e))},"ОК")],4)}],["__scopeId","data-v-1591e2fe"]]),vn={key:0,class:"menulabel"},gn={key:1,class:"btnicon"},yn={name:"SimpleButton",props:{label:{type:String},icon:{type:Object},tooltip:{type:String},handlers:{type:Object,required:!0}},methods:{onClick(){this.handlers?.click?this.handlers.click(this):this.$emit("click",this)}}},bn=(0,C.A)(yn,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveDirective)("tooltip");return(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:"small-btn simple",onClick:t[0]||(t[0]=(...e)=>r.onClick&&r.onClick(...e))},[o.label?((0,s.openBlock)(),(0,s.createElementBlock)("div",vn,(0,s.toDisplayString)(o.label),1)):(0,s.createCommentVNode)("v-if",!0),o.icon?((0,s.openBlock)(),(0,s.createElementBlock)("div",gn,[(0,s.createVNode)(l,{size:o.icon.size||"100%",value:o.icon.value},null,8,["size","value"])])):(0,s.createCommentVNode)("v-if",!0)])),[[i,o.tooltip]])}],["__scopeId","data-v-7f0518be"]]),kn={key:0,class:"menulabel"},wn={key:1,class:"btnicon"},En={name:"ToggleButton",props:{id:{type:String,required:!0},label:{type:String},icon:{type:Object},group:{type:Object},handlers:{type:Object,required:!0},tooltip:{type:String}},computed:{isActive(){return this.group.activeId===this.id}},mounted(){this.handlers.activate&&this.handlers.activate(this)},beforeUnmount(){this.handlers.deactivate&&this.handlers.deactivate(this)},methods:{onClick(){this.handlers.click?this.handlers.click(this):this.$emit("click",this)}}},_n=(0,C.A)(En,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveDirective)("translate"),c=(0,s.resolveDirective)("tooltip");return(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:(0,s.normalizeClass)(["small-btn simple",{active:r.isActive}]),onClick:t[0]||(t[0]=(...e)=>r.onClick&&r.onClick(...e))},[o.label?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",kn,[(0,s.createTextVNode)((0,s.toDisplayString)(o.label),1)])),[[i,`$$buttons.${o.label}`]]):(0,s.createCommentVNode)("v-if",!0),o.icon?((0,s.openBlock)(),(0,s.createElementBlock)("div",wn,[(0,s.createVNode)(l,{size:o.icon.size||"100%",value:o.icon.value},null,8,["size","value"])])):(0,s.createCommentVNode)("v-if",!0)],2)),[[c,o.tooltip]])}],["__scopeId","data-v-5b95ca11"]]),Sn={class:"spinner"},Nn={name:"Spinner"},Vn=(0,C.A)(Nn,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Sn)}],["__scopeId","data-v-4736cf19"]]),Cn={class:"toast-container"},Bn={computed:{list(){return this.$app.toasts.list}},methods:{onClick(e){e.onclick&&e.onclick()}}},$n=(0,C.A)(Bn,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Cn,[(0,s.createVNode)(s.TransitionGroup,{name:"toast",tag:"div"},{default:(0,s.withCtx)(()=>[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.list,t=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t.id,class:"toast"},[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(t.component||"div"),(0,s.mergeProps)({class:"toastview"},{ref_for:!0},t.data,{onClick:e=>r.onClick(t)}),{default:(0,s.withCtx)(()=>[t.component?(0,s.createCommentVNode)("v-if",!0):(0,s.renderSlot)(e.$slots,"default",{key:0},()=>[(0,s.createTextVNode)((0,s.toDisplayString)(t.data.message),1)],!0)]),_:2},1040,["onClick"]))]))),128))]),_:3})])}],["__scopeId","data-v-49ca426e"]]),xn={class:"alert"},Dn={class:"text"},In={name:"Label",props:{icon:{type:String,default:"notification"},message:{type:String,default:""},type:{type:String,default:"info"}}},Tn=(0,C.A)(In,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createElementVNode)("div",xn,[(0,s.createVNode)(l,{class:(0,s.normalizeClass)(`${o.type}icon`),size:"3em",value:o.icon},null,8,["class","value"]),(0,s.createElementVNode)("span",Dn,(0,s.toDisplayString)(o.message),1)])])}]]),An={class:"menu-container"},Mn={key:0,class:"menublock"},On={name:"ExtMenu",props:{list:{type:Array,default:[]},actived:{type:String}},computed:{menu(){return this.$app.menu}},methods:{onClick(e){const t=this.list.find(e=>e.id===this.actived);t&&(t.handlers?.disable?.(),t===e)?this.$emit("activate",null):(e.handler?.(e)||e.handlers?.enable?.(e)||this.$emit("click",e),this.$emit("activate",e))}}},jn=(0,C.A)(On,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("ExpandedButton");return(0,s.openBlock)(),(0,s.createElementBlock)("div",An,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.list,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t,class:(0,s.normalizeClass)([e.class,"menu-item"])},[e.hidden?(0,s.createCommentVNode)("v-if",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",Mn,[(0,s.createVNode)(l,{onClick:(0,s.withModifiers)(t=>r.onClick(e),["stop"]),label:e.label,color:e.id&&o.actived===e.id?"#ffff00":null,icon:e.icon},null,8,["onClick","label","color","icon"])]))],2))),128))])}]]),Pn=jn,Rn={class:"input-wrapper"},Ln=["type","value","placeholder"],Fn={name:"MinimalInput",props:{type:{type:String,default:"text"},value:{type:[String,Number],default:""},placeholder:{type:String,default:""}},emits:["update:value"]},Un=(0,C.A)(Fn,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Rn,[(0,s.createElementVNode)("input",{type:o.type,value:o.value,onInput:t[0]||(t[0]=t=>e.$emit("update:value",t.target.value)),placeholder:o.placeholder,class:"input-field"},null,40,Ln)])}],["__scopeId","data-v-f47b63dc"]]),zn=["value"],Hn={name:"Elements",props:{modelValue:{type:String}},data:()=>({element:null,list:[]}),mounted(){this.list=this.$app.engine.getFactory().Elements},computed:{val:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}},qn=(0,C.A)(Hn,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.withDirectives)((0,s.createElementVNode)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.val=e),class:"form-select"},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(a.list,e=>((0,s.openBlock)(),(0,s.createElementBlock)("option",{value:e.path},(0,s.toDisplayString)(e.name),9,zn))),256))],512),[[s.vModelSelect,r.val]])])}]]),Gn={class:"radio-group"},Wn=["onClick"],Kn={name:"RadioButton",props:{buttons:{type:Array,required:!0},value:{type:Object}}},Jn=(0,C.A)(Kn,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Gn,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.buttons,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:t,class:"btn",onClick:t=>e.handler(o.value)},(0,s.toDisplayString)(e.label),9,Wn))),128))])}],["__scopeId","data-v-48e97626"]]),Yn={class:"radio-group"},Xn={class:"radio-label"},Qn=["name","value","checked","disabled","onChange"],Zn={class:"radio-custom"},ea={class:"radio-text"},ta={class:"radio-default-label"},oa={name:"RadioButton",props:{options:{type:[Array,Number],required:!0,validator:e=>Array.isArray(e)||"number"==typeof e&&e>0},modelValue:{type:[String,Number,Boolean,Object],default:null},name:{type:String,default:"radio-group"},disabled:{type:Boolean,default:!1},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"}},emits:["update:modelValue","change"],computed:{normalizedOptions(){return"number"==typeof this.options?Array.from({length:this.options},(e,t)=>t+1):this.options}},methods:{getOptionValue(e){return"object"==typeof e&&null!==e&&(e[this.valueKey]||e.value)||e},getOptionLabel(e){return"object"==typeof e&&null!==e?e[this.labelKey]||e.label||this.getOptionValue(e):e},isChecked(e){return this.getOptionValue(e)===this.modelValue},handleChange(e){const t=this.getOptionValue(e);this.$emit("update:modelValue",t),this.$emit("change",t)}}},na=(0,C.A)(oa,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Yn,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.options,(t,n)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:n,class:(0,s.normalizeClass)(["radio-item",{"radio-item--disabled":o.disabled}])},[(0,s.createElementVNode)("label",Xn,[(0,s.createElementVNode)("input",{type:"radio",name:o.name,value:r.getOptionValue(t),checked:r.isChecked(t),disabled:o.disabled,onChange:e=>r.handleChange(t),class:"radio-input"},null,40,Qn),(0,s.createCommentVNode)(" Кастомная кнопка через слот "),(0,s.createElementVNode)("span",Zn,[(0,s.renderSlot)(e.$slots,"button",{option:t,index:n,checked:r.isChecked(t)},()=>[(0,s.createElementVNode)("span",{class:(0,s.normalizeClass)(["radio-default-button",{"radio-default-button--checked":r.isChecked(t)}])},null,2)],!0)]),(0,s.createCommentVNode)(" Кастомная надпись через слот "),(0,s.createElementVNode)("span",ea,[(0,s.renderSlot)(e.$slots,"label",{option:t,index:n,checked:r.isChecked(t)},()=>[(0,s.createElementVNode)("span",ta,(0,s.toDisplayString)(r.getOptionLabel(t)),1)],!0)])])],2))),128))])}],["__scopeId","data-v-65d75466"]]),aa={class:"search-filter"},sa={class:"search-input-container"},ra=["placeholder"],la=["disabled"],ia={name:"SearchFilter",props:{value:{type:String,default:""},placeholder:{type:String,default:"Enter text to search..."},debounce:{type:Number,default:300},label:{type:String,default:""},button:{type:String,default:"Search"},reactive:{type:Boolean,default:!1}},data(){return{searchValue:this.value,debounceTimer:null}},watch:{value(e){this.searchValue=e}},methods:{handleInput(){console.log("Search input "),this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.$emit("entry",this.searchValue)},this.debounce)},handleSearch(){console.log("Search handle "),this.searchValue.trim()&&(this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),this.$emit("search",this.searchValue))},beforeUnmount(){this.debounceTimer&&clearTimeout(this.debounceTimer)}}},ca=(0,C.A)(ia,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveDirective)("translate");return(0,s.openBlock)(),(0,s.createElementBlock)("div",aa,[(0,s.createElementVNode)("div",sa,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(o.label),1),(0,s.withDirectives)((0,s.createElementVNode)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.searchValue=e),type:"text",class:"search-input",placeholder:o.placeholder,onInput:t[1]||(t[1]=(0,s.withModifiers)((...e)=>r.handleInput&&r.handleInput(...e),["stop"])),onKeyup:t[2]||(t[2]=(0,s.withKeys)((...e)=>r.handleSearch&&r.handleSearch(...e),["enter"]))},null,40,ra),[[s.vModelText,a.searchValue],[l]]),o.reactive?((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:0,class:"search-button",onClick:t[3]||(t[3]=t=>{a.searchValue="",e.$emit("clean")})},[(0,s.renderSlot)(e.$slots,"button-content",{},()=>[(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(o.button),1)],!0)])):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{key:1,class:"search-button",onClick:t[4]||(t[4]=(...e)=>r.handleSearch&&r.handleSearch(...e)),disabled:!a.searchValue.trim()},[(0,s.renderSlot)(e.$slots,"button-content",{},()=>[(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(o.button),1)],!0)],8,la)),[[l,`$$buttons.${o.button}`]])])])}],["__scopeId","data-v-d5c853e2"]]),da={name:"SliderBlock",props:{value:{type:Boolean,default:()=>!1},property:{type:String,default:"top"},shift:{type:Number,default:100},zero:{type:Number,default:0}},computed:{style(){return{[this.property]:this.value?`${this.shift}px`:`${this.zero}px`}}},mounted(){"right"===this.property||"left"===this.property?this.$el.style.width=this.shift-this.zero+"px":this.$el.style.height=this.shift-this.zero+"px"}},pa=(0,C.A)(da,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"slider",style:(0,s.normalizeStyle)(r.style)},[(0,s.renderSlot)(e.$slots,"default",{},void 0,!0),(0,s.createElementVNode)("div",{onClick:t[0]||(t[0]=t=>e.$emit("revert"))},[(0,s.renderSlot)(e.$slots,"button",{},void 0,!0)])],4)}],["__scopeId","data-v-b3fc2cec"]]),ua={key:0},ma={key:1},ha={key:2,class:"child-list"},fa={key:0},va={name:"TreeLi",props:["value"],data:()=>({childshow:!1})},ga=(0,C.A)(va,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("TreeLi",!0);return(0,s.openBlock)(),(0,s.createElementBlock)("li",null,[o.value.children?(0,s.createCommentVNode)("v-if",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",ua,[...t[1]||(t[1]=[(0,s.createElementVNode)("svg",{class:"edicon ics-spinner10"},[(0,s.createElementVNode)("use",{"xlink:href":"#ics-spinner10"})],-1)])])),o.value.children?((0,s.openBlock)(),(0,s.createElementBlock)("div",ha,[(0,s.createElementVNode)("span",{onClick:t[0]||(t[0]=t=>e.childshow=!e.childshow)},[t[3]||(t[3]=(0,s.createElementVNode)("input",{type:"checkbox"},null,-1)),(0,s.createTextVNode)((0,s.toDisplayString)(o.value.name),1)]),e.childshow?((0,s.openBlock)(),(0,s.createElementBlock)("ul",fa,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.value.children,(e,t)=>((0,s.openBlock)(),(0,s.createBlock)(l,{key:t,value:e},null,8,["value"]))),128))])):(0,s.createCommentVNode)("v-if",!0)])):((0,s.openBlock)(),(0,s.createElementBlock)("span",ma,[t[2]||(t[2]=(0,s.createElementVNode)("input",{type:"checkbox"},null,-1)),(0,s.createTextVNode)((0,s.toDisplayString)(o.value.name),1)]))])}],["__scopeId","data-v-562df7a6"]]),ya={class:"selectable-container"},ba={class:"list"},ka={class:"grid"},wa=["onClick"],Ea={key:0,class:"info"},_a={name:"ActionsLib",data:()=>({current:null}),props:{list:{type:Array},selected:{type:Object}},watch:{selected(e,t){this.current=e}},emits:["selectItem"],methods:{onItemSelect(e){this.$emit("selectItem",e)}}},Sa=(0,C.A)(_a,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",ya,[(0,s.createElementVNode)("div",ba,[(0,s.createElementVNode)("div",ka,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.list,(t,o)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{onClick:e=>r.onItemSelect(t),class:"grid-element",key:o},[(0,s.renderSlot)(e.$slots,"item",{item:t})],8,wa))),128))])]),a.current?((0,s.openBlock)(),(0,s.createElementBlock)("div",Ea,[(0,s.renderSlot)(e.$slots,"selected",{item:a.current})])):(0,s.createCommentVNode)("v-if",!0)])}]]),Na={class:"vlist-container"},Va={class:"list"},Ca={class:"vlist"},Ba=["onClick"],$a={name:"ActionsLib",data:()=>({current:null}),props:{list:{type:Array},selected:{type:Object}},watch:{selected(e,t){this.current=e}},emits:["selectItem"],methods:{onItemSelect(e){this.$emit("selectItem",e)}}},xa=(0,C.A)($a,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Na,[(0,s.createElementVNode)("div",Va,[(0,s.createElementVNode)("div",Ca,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.list,(t,o)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{onClick:e=>r.onItemSelect(t),class:"vlist-element",key:o},[(0,s.renderSlot)(e.$slots,"item",{item:t})],8,Ba))),128))])])])}]]),Da={style:{"text-align":"right"}},Ia={name:"BoolEdit",props:{modelValue:{type:Boolean}},computed:{val:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}},Ta=(0,C.A)(Ia,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Da,[(0,s.withDirectives)((0,s.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>r.val=e)},null,512),[[s.vModelCheckbox,r.val]])])}]]),Aa={class:"comma-number-input-wrapper"},Ma={class:"arrow-buttons"},Oa={name:"input-float",props:{value:Object,modelValue:Number,step:{type:Number,default:1},min:{type:Number,default:Number.MIN_SAFE_INTEGER},max:{type:Number,default:Number.MAX_SAFE_INTEGER}},data:()=>({interval:null,separator:",",isPressed:!1,changeSpeed:100}),computed:{formattedValue:{get(){return this.modelValue},set(e){console.log(e),this.parseNumber(e),this.$emit("update:modelValue",e)}}},mounted(){const e=(new Intl.NumberFormat).format(this.modelValue);this.separator=e.charAt(1),this.$refs.input.addEventListener("wheel",this.onWheel,{passive:!1})},beforeDestroy(){this.$refs.input.removeEventListener("wheel",this.onWheel)},methods:{onFocus(){this.$nextTick(()=>{this.$refs.input.select()})},parseNumber(e){try{const t=parseFloat(e.replace(",","."));return isNaN(t)?this.modelValue:t}catch(e){return this.modelValue}},formatNumber:e=>parseFloat(e).toFixed(0).replace(".",","),onInput(e){this.formattedValue=e.target.modelValue},onWheel(e){e.preventDefault(),e.stopPropagation(),document.activeElement===this.$refs.input&&this.changeValue(e.deltaY>0?-this.step:this.step)},onKeyDown(e){"ArrowUp"===e.key?(this.changeValue(this.step),e.preventDefault()):"ArrowDown"===e.key&&(this.changeValue(-this.step),e.preventDefault())},changeValue(e){let t=(this.modelValue||0)+e;t=Math.max(Math.min(t,this.max),this.min),this.$emit("update:modelValue",parseFloat(t.toFixed(0)))},startIncrement(){this.interval&&clearInterval(this.interval),this.isPressed=!0,this.changeValue(this.step),setTimeout(()=>{this.isPressed&&(this.interval=setInterval(()=>this.changeValue(this.step),50))},400)},startDecrement(){this.interval&&clearInterval(this.interval),this.isPressed=!0,this.changeValue(-this.step),setTimeout(()=>{this.isPressed&&(this.interval=setInterval(()=>this.changeValue(-this.step),50))},400)},stopChange(){this.isPressed=!1,clearInterval(this.interval)}}},ja=(0,C.A)(Oa,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Aa,[(0,s.withDirectives)((0,s.createElementVNode)("input",{ref:"input","onUpdate:modelValue":t[0]||(t[0]=e=>r.formattedValue=e),onKeydown:t[1]||(t[1]=(...e)=>r.onKeyDown&&r.onKeyDown(...e)),onDblclick:t[2]||(t[2]=(...e)=>r.onFocus&&r.onFocus(...e)),class:"comma-number-input"},null,544),[[s.vModelText,r.formattedValue,void 0,{number:!0}]]),(0,s.createElementVNode)("div",Ma,[(0,s.createElementVNode)("button",{onMousedown:t[3]||(t[3]=(...e)=>r.startIncrement&&r.startIncrement(...e)),onMouseup:t[4]||(t[4]=(...e)=>r.stopChange&&r.stopChange(...e)),onMouseleave:t[5]||(t[5]=(...e)=>r.stopChange&&r.stopChange(...e))},"▲",32),(0,s.createElementVNode)("button",{onMousedown:t[6]||(t[6]=(...e)=>r.startDecrement&&r.startDecrement(...e)),onMouseup:t[7]||(t[7]=(...e)=>r.stopChange&&r.stopChange(...e)),onMouseleave:t[8]||(t[8]=(...e)=>r.stopChange&&r.stopChange(...e))},"▼",32)])])}]]),Pa=["onUpdate:modelValue"],Ra=["onUpdate:modelValue"],La={name:"NameEditor",data:()=>({properties:[{property:"envMap",value:null}]}),methods:{updateAsset(){for(let e=0;e<this.properties.length;e++){const t=this.properties[e];this.selected[t.property],this.$app.assets.updateAsset(this.selected,t.property,()=>{})}}},props:{selected:{type:Object}}},Fa=(0,C.A)(La,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(a.properties,e=>((0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.withDirectives)((0,s.createElementVNode)("input",{"onUpdate:modelValue":t=>e.property=t},null,8,Pa),[[s.vModelText,e.property]]),(0,s.withDirectives)((0,s.createElementVNode)("input",{"onUpdate:modelValue":t=>o.selected[e.property]=t},null,8,Ra),[[s.vModelText,o.selected[e.property]]])]))),256)),(0,s.createElementVNode)("div",null,[(0,s.createElementVNode)("button",{class:"btn",onClick:t[0]||(t[0]=(...e)=>r.updateAsset&&r.updateAsset(...e))},"Update")])])}]]),Ua={class:"comma-number-input-wrapper"},za={class:"arrow-buttons"},Ha={name:"CommaNumberInput",props:{modelValue:Number,step:{type:Number,default:.1},min:{type:Number,default:Number.MIN_SAFE_INTEGER},max:{type:Number,default:Number.MAX_SAFE_INTEGER},decimals:{type:Number,default:2}},data:()=>({interval:null,separator:",",isPressed:!1,changeSpeed:100}),computed:{formattedValue:{get(){return this.modelValue},set(e){const t=this.parseNumber(e);this.$emit("update:modelValue",t)}}},mounted(){const e=(new Intl.NumberFormat).format(this.modelValue);this.separator=e.charAt(1),this.$refs.input.addEventListener("wheel",this.onWheel,{passive:!1})},beforeDestroy(){this.$refs.input.removeEventListener("wheel",this.onWheel)},methods:{onFocus(){this.$nextTick(()=>{this.$refs.input.select()})},parseNumber(e){try{const t=parseFloat(e.replace(",","."));return isNaN(t)?this.modelValue:t}catch(e){return this.modelValue}},formatNumber(e){return parseFloat(e).toFixed(this.decimals).replace(".",",")},onInput(e){this.formattedValue=e.target.modelValue},onWheel(e){e.preventDefault(),e.stopPropagation(),document.activeElement===this.$refs.input&&this.changeValue(e.deltaY>0?-this.step:this.step)},onKeyDown(e){"ArrowUp"===e.key?(this.changeValue(this.step),e.preventDefault()):"ArrowDown"===e.key&&(this.changeValue(-this.step),e.preventDefault())},changeValue(e){let t=(this.modelValue||0)+e;t=Math.max(Math.min(t,this.max),this.min),this.$emit("update:modelValue",parseFloat(t.toFixed(this.decimals)))},startIncrement(){this.interval&&clearInterval(this.interval),this.isPressed=!0,this.changeValue(this.step),setTimeout(()=>{this.isPressed&&(this.interval=setInterval(()=>this.changeValue(this.step),50))},400)},startDecrement(){this.interval&&clearInterval(this.interval),this.isPressed=!0,this.changeValue(-this.step),setTimeout(()=>{this.isPressed&&(this.interval=setInterval(()=>this.changeValue(-this.step),50))},400)},stopChange(){this.isPressed=!1,clearInterval(this.interval)}}},qa=(0,C.A)(Ha,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Ua,[(0,s.withDirectives)((0,s.createElementVNode)("input",{ref:"input",type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>r.formattedValue=e),onKeydown:t[1]||(t[1]=(...e)=>r.onKeyDown&&r.onKeyDown(...e)),onDblclick:t[2]||(t[2]=(...e)=>r.onFocus&&r.onFocus(...e)),class:"comma-number-input"},null,544),[[s.vModelText,r.formattedValue]]),(0,s.createElementVNode)("div",za,[(0,s.createElementVNode)("button",{onMousedown:t[3]||(t[3]=(...e)=>r.startIncrement&&r.startIncrement(...e)),onMouseup:t[4]||(t[4]=(...e)=>r.stopChange&&r.stopChange(...e)),onMouseleave:t[5]||(t[5]=(...e)=>r.stopChange&&r.stopChange(...e))},"▲",32),(0,s.createElementVNode)("button",{onMousedown:t[6]||(t[6]=(...e)=>r.startDecrement&&r.startDecrement(...e)),onMouseup:t[7]||(t[7]=(...e)=>r.stopChange&&r.stopChange(...e)),onMouseleave:t[8]||(t[8]=(...e)=>r.stopChange&&r.stopChange(...e))},"▼",32)])])}]]),Ga={class:"control-container"},Wa=["max"],Ka={class:"buttons"},Ja=["disabled"],Ya=["disabled"],Xa={__name:"playcontrol",props:{modelValue:{type:Object},selected:{type:Object},value:{type:Object},target:{type:Object},property:{type:Object}},setup(e){const t=e,o=(0,s.ref)(!1),n=(0,s.ref)(0),a=(0,s.ref)(0),r=(0,s.ref)(0),l=(0,s.ref)(!1),i=(0,s.ref)(!1);function c(){const e=t.modelValue;i.value?e.pause():e.play()}function d(){t.modelValue.pause(),t.modelValue.currentTime=0}function p(){l.value=!1;const e=t.modelValue;if(o.value&&r.value<=e.duration)if(e.readyState<2){const t=()=>{e.currentTime=r.value,e.removeEventListener("canplay",t)};e.addEventListener("canplay",t),e.load()}else e.currentTime=r.value}function u(e){return!e||isNaN(e)?"0:00":`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}return(0,s.onMounted)(()=>{const e=t.modelValue,c=()=>{e.readyState>=1&&(n.value=e.duration,o.value=!0)},d=()=>{l.value||(a.value=e.currentTime,r.value=e.currentTime)},p=()=>i.value=!0,u=()=>i.value=!1,m=()=>i.value=!1;e.addEventListener("loadedmetadata",c),e.addEventListener("canplay",c),e.addEventListener("timeupdate",d),e.addEventListener("play",p),e.addEventListener("playing",p),e.addEventListener("pause",u),e.addEventListener("ended",m),c(),(0,s.onUnmounted)(()=>{e.removeEventListener("loadedmetadata",c),e.removeEventListener("canplay",c),e.removeEventListener("timeupdate",d),e.removeEventListener("play",p),e.removeEventListener("playing",p),e.removeEventListener("pause",u),e.removeEventListener("ended",m)})}),(e,t)=>{const m=(0,s.resolveComponent)("icon");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Ga,[(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(u(a.value))+" / "+(0,s.toDisplayString)(u(n.value)),1),(0,s.withDirectives)((0,s.createElementVNode)("input",{type:"range",min:"0",max:n.value,step:"0.01","onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),onMousedown:t[1]||(t[1]=e=>l.value=!0),onMouseup:p,onTouchstart:t[2]||(t[2]=e=>l.value=!0),onTouchend:p},null,40,Wa),[[s.vModelText,r.value,void 0,{number:!0}]]),(0,s.createElementVNode)("div",Ka,[(0,s.createElementVNode)("button",{class:"btn square",onClick:c,disabled:!o.value},[(0,s.createVNode)(m,{value:i.value?"pause2":"play3"},null,8,["value"])],8,Ja),(0,s.createCommentVNode)(' <button class="btn square" @click="pause" :disabled="!ready">\n                <icon value="pause2"></icon>\n            </button> '),(0,s.createElementVNode)("button",{class:"btn square",onClick:d,disabled:!o.value},[(0,s.createVNode)(m,{value:"stop2"})],8,Ya)])])}}},Qa=(0,C.A)(Xa,[["__scopeId","data-v-ae734b3c"]]),Za={style:{display:"grid","grid-template-columns":"96px 1fr"}},es={style:{"text-align":"center"}},ts={props:{selected:{type:Object},label:{type:String},value:{type:Number},property:{type:Object}},computed:{val:{get(){return this.value},set(e){this.$emit("update:value",e)}}}},os=(0,C.A)(ts,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("FloatInput");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Za,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(o.label),1),(0,s.createElementVNode)("div",es,[(0,s.createVNode)(l,{min:o.property.min||0,step:o.property.step||.01,value:r.val,onChanged:t[0]||(t[0]=e=>r.val=e)},null,8,["min","step","value"])])])}]]),ns={class:"v2value"},as={class:"v2label"},ss={props:{modelValue:{type:Object,default:new ke.Vector2},decimals:{type:Number,default:4},step:{type:Number,default:1},styles:{type:Object,default:{"justify-content":"space-around"}}},computed:{value:{get(){return this.modelValue}}},methods:{updateValue(e,t){"number"==typeof t&&this.$emit("update:modelValue",{...this.value,[e]:t})}}},rs=(0,C.A)(ss,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("float");return(0,s.openBlock)(),(0,s.createElementBlock)("div",{style:(0,s.normalizeStyle)(o.styles),class:"v2"},[((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(["x","y"],e=>(0,s.createElementVNode)("div",ns,[(0,s.createElementVNode)("label",as,(0,s.toDisplayString)(e),1),(0,s.createVNode)(l,{modelValue:r.value[e],"onUpdate:modelValue":[t=>r.value[e]=t,t=>r.updateValue(e,t)],decimals:o.decimals,step:o.step},null,8,["modelValue","onUpdate:modelValue","decimals","step"])])),64))],4)}]]),ls={class:"v3"},is={class:"v3value"},cs={class:"v3label"},ds={props:{modelValue:{type:Object,default:new ke.Vector3},decimals:{type:Number,default:4},step:{type:Number,default:1}},computed:{value:{get(){return this.modelValue}}},methods:{updateValue(e,t){"number"==typeof t&&this.$emit("update:modelValue",{...this.value,[e]:t})}}},ps=(0,C.A)(ds,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("float");return(0,s.openBlock)(),(0,s.createElementBlock)("div",ls,[((0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(["x","y","z"],e=>(0,s.createElementVNode)("div",is,[(0,s.createElementVNode)("label",cs,(0,s.toDisplayString)(e),1),(0,s.createVNode)(l,{modelValue:r.value[e],"onUpdate:modelValue":[t=>r.value[e]=t,t=>r.updateValue(e,t)],decimals:o.decimals,step:o.step},null,8,["modelValue","onUpdate:modelValue","decimals","step"])])),64))])}]]),us={style:{display:"flex","align-items":"center",gap:"1px","flex-direction":"column"}},ms={key:0,class:"tools"},hs={key:1,class:"titleinfo"},fs={data:()=>({expanded:!0}),props:{label:String,modelValue:{type:Object,default:new ke.Vector3},decimals:{type:Number,default:2},step:{type:Number,default:1}},computed:{value:{get(){return this.modelValue}}},watch:{values(e,t){}},methods:{onUpdate(e){const t=new CustomEvent("update:modelValue",{detail:e,bubbles:!1});this.$emit("update:modelValue",t.detail)}}},vs=(0,C.A)(fs,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("V3");return(0,s.openBlock)(),(0,s.createElementBlock)("div",us,[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["title",a.expanded?"":"min"])},[(0,s.createElementVNode)("div",{class:"label",onClick:t[0]||(t[0]=e=>a.expanded=!a.expanded)},(0,s.toDisplayString)(a.expanded?"▼":"▶")+" "+(0,s.toDisplayString)(o.label),1),a.expanded?((0,s.openBlock)(),(0,s.createElementBlock)("div",ms,[(0,s.renderSlot)(e.$slots,"tools",{},void 0,!0)])):((0,s.openBlock)(),(0,s.createElementBlock)("div",hs,"x:"+(0,s.toDisplayString)(o.modelValue.x.toFixed(o.decimals))+",y:"+(0,s.toDisplayString)(o.modelValue.y.toFixed(o.decimals))+",z:"+(0,s.toDisplayString)(o.modelValue.z.toFixed(o.decimals)),1))],2),a.expanded?((0,s.openBlock)(),(0,s.createBlock)(l,{key:0,modelValue:r.value,decimals:o.decimals,step:o.step,"onUpdate:modelValue":r.onUpdate},null,8,["modelValue","decimals","step","onUpdate:modelValue"])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-6e23d76e"]]),gs={style:{display:"flex","align-items":"center",gap:"3px","flex-direction":"column"}},ys={class:"label"},bs={key:0,class:"tools"},ks={key:1,class:"titleinfo"},ws={data:()=>({expanded:!0,vprops:["x","y","z"]}),props:{rotation:{type:Object,default:{x:0,y:0,z:0}},quaternion:Object,label:String,modelValue:Object,decimals:{type:Number,default:2},step:{type:Number,default:1}},methods:{onChangeVal(e){e.x>359&&(e.x=0),e.x<-359&&(e.x=0),e.y>359&&(e.y=0),e.y<-359&&(e.y=0),e.z>359&&(e.z=0),e.z<-359&&(e.z=0);const t=new CustomEvent("update:modelValue",{detail:new ke.Euler(At(Math.round(e.x)),At(Math.round(e.y)),At(Math.round(e.z)),"XYZ"),bubbles:!1});this.$emit("update:rotation",t.detail)}},computed:{formattedValue:{get(){return{x:Math.round(Tt(this.rotation.x)),y:Math.round(Tt(this.rotation.y)),z:Math.round(Tt(this.rotation.z))}}}}},Es=(0,C.A)(ws,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("V3");return(0,s.openBlock)(),(0,s.createElementBlock)("div",gs,[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["title",a.expanded?"":"min"]),onClick:t[0]||(t[0]=e=>a.expanded=!a.expanded)},[(0,s.createElementVNode)("div",ys,(0,s.toDisplayString)(a.expanded?"▼":"▶")+" "+(0,s.toDisplayString)(o.label),1),a.expanded?((0,s.openBlock)(),(0,s.createElementBlock)("div",bs,[(0,s.renderSlot)(e.$slots,"tools",{},void 0,!0)])):((0,s.openBlock)(),(0,s.createElementBlock)("div",ks,"x:"+(0,s.toDisplayString)(r.formattedValue.x)+",y:"+(0,s.toDisplayString)(r.formattedValue.y)+",z:"+(0,s.toDisplayString)(r.formattedValue.z),1))],2),a.expanded?((0,s.openBlock)(),(0,s.createBlock)(l,{key:0,modelValue:r.formattedValue,decimals:o.decimals,step:o.step,"onUpdate:modelValue":r.onChangeVal},null,8,["modelValue","decimals","step","onUpdate:modelValue"])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-b8974312"]]),_s={style:{display:"flex","align-items":"center",gap:"1px","flex-direction":"column"}},Ss={class:"label"},Ns={key:0,class:"tools"},Vs={key:1,class:"titleinfo"},Cs={name:"QuaternionEditor",props:{modelValue:{type:Object,required:!0},decimals:{type:Number,default:2},step:{type:Number,default:1}},data:()=>({expanded:!0,x:0,y:0,z:0}),computed:{formattedValue(){return{x:this.roundValue(this.x),y:this.roundValue(this.y),z:this.roundValue(this.z)}}},watch:{modelValue:{handler(e){this.updateEulerFromQuaternion(e)},immediate:!0,deep:!0}},methods:{updateEulerFromQuaternion(e){const t=(new ke.Euler).setFromQuaternion((new ke.Quaternion).copy(e),"XYZ");this.x=this.roundValue(ke.MathUtils.radToDeg(t.x)),this.y=this.roundValue(ke.MathUtils.radToDeg(t.y)),this.z=this.roundValue(ke.MathUtils.radToDeg(t.z))},updateQuaternion(e){const t=new ke.Euler(ke.MathUtils.degToRad(e.x),ke.MathUtils.degToRad(e.y),ke.MathUtils.degToRad(e.z),"XYZ"),o=(new ke.Quaternion).setFromEuler(t);this.$emit("update:modelValue",o)},roundValue(e){const t=Math.pow(10,this.decimals);return Math.round(e*t)/t}}},Bs=(0,C.A)(Cs,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("V3");return(0,s.openBlock)(),(0,s.createElementBlock)("div",_s,[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["title",a.expanded?"":"min"]),onClick:t[0]||(t[0]=e=>a.expanded=!a.expanded)},[(0,s.createElementVNode)("div",Ss,(0,s.toDisplayString)(a.expanded?"▼":"▶"),1),a.expanded?((0,s.openBlock)(),(0,s.createElementBlock)("div",Ns,[(0,s.renderSlot)(e.$slots,"tools",{},void 0,!0)])):((0,s.openBlock)(),(0,s.createElementBlock)("div",Vs,"x:"+(0,s.toDisplayString)(r.formattedValue.x)+",y:"+(0,s.toDisplayString)(r.formattedValue.y)+",z:"+(0,s.toDisplayString)(r.formattedValue.z),1))],2),a.expanded?((0,s.openBlock)(),(0,s.createBlock)(l,{key:0,modelValue:{x:a.x,y:a.y,z:a.z},decimals:o.decimals,step:o.step,"onUpdate:modelValue":r.updateQuaternion},null,8,["modelValue","decimals","step","onUpdate:modelValue"])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-7c6347e9"]]),$s={class:"block_container"},xs={key:0,class:"editrow"},Ds={class:"label"},Is={name:"LabelEditor",props:{modelValue:{type:String,default:""},label:{type:String,default:""},tooltip:{type:String,default:""}},data:()=>({editMode:!1,val:""}),watch:{modelValue(){this.editMode=!1}},methods:{startEdit(){this.val=this.modelValue,this.editMode=!0,this.$nextTick(()=>{this.$refs.editInput.focus()})},complete(e){console.log(e),e.ctrlKey||e.shiftKey||(e&&e.preventDefault(),this.$emit("update:modelValue",this.val),this.editMode=!1)},endEdit(){return this.editMode?(this.editMode=!1,this.val):this.modelValue}},mounted(){}},Ts=(0,C.A)(Is,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createElementVNode)("div",$s,[e.editMode?((0,s.openBlock)(),(0,s.createElementBlock)("div",xs,[(0,s.withDirectives)((0,s.createElementVNode)("textarea",{rows:"10",cols:"33",ref:"editInput",class:"editinput","onUpdate:modelValue":t[0]||(t[0]=t=>e.val=t),onKeyup:t[1]||(t[1]=(0,s.withKeys)((...e)=>r.complete&&r.complete(...e),["enter"]))},null,544),[[s.vModelText,e.val]]),(0,s.createVNode)(l,{class:"okicon",value:"checkmark",size:"1em",onClick:r.complete},null,8,["onClick"])])):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"editrow",onClick:t[2]||(t[2]=(...e)=>r.startEdit&&r.startEdit(...e)),key:"tooltip-"+o.modelValue},[(0,s.createElementVNode)("span",Ds,(0,s.toDisplayString)(o.modelValue),1),(0,s.createVNode)(l,{value:"pencil",size:"1em"})])),[[i,o.tooltip||o.modelValue]])])])}],["__scopeId","data-v-44f8aea6"]]),As={class:"block_container"},Ms={key:0,class:"editrow"},Os={class:"label"},js={name:"LabelEditor",props:{modelValue:{type:String,default:""},label:{type:String,default:""},tooltip:{type:String,default:""}},data:()=>({editMode:!1,val:""}),watch:{modelValue(){this.editMode=!1}},methods:{startEdit(){this.val=this.modelValue,this.editMode=!0,this.$nextTick(()=>{this.$refs.editInput.focus()})},complete(e){e&&e.preventDefault(),this.$emit("update:modelValue",this.val),this.editMode=!1},endEdit(){return this.editMode?(this.editMode=!1,this.val):this.modelValue}},mounted(){}},Ps=(0,C.A)(js,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createElementVNode)("div",As,[e.editMode?((0,s.openBlock)(),(0,s.createElementBlock)("div",Ms,[(0,s.withDirectives)((0,s.createElementVNode)("input",{ref:"editInput",class:"editinput","onUpdate:modelValue":t[0]||(t[0]=t=>e.val=t),onKeyup:t[1]||(t[1]=(0,s.withKeys)((...e)=>r.complete&&r.complete(...e),["enter"]))},null,544),[[s.vModelText,e.val]]),(0,s.createVNode)(l,{class:"okicon",value:"checkmark",size:"1em",onClick:r.complete},null,8,["onClick"])])):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"editrow",onClick:t[2]||(t[2]=(...e)=>r.startEdit&&r.startEdit(...e)),key:"tooltip-"+o.modelValue},[(0,s.createElementVNode)("span",Os,(0,s.toDisplayString)(o.modelValue),1),(0,s.createVNode)(l,{value:"pencil",size:"1em"})])),[[i,o.tooltip||o.modelValue]])])])}],["__scopeId","data-v-1e1887cc"]]),Rs={class:"transform-container"},Ls={class:"label"},Fs={class:"transforms"},Us={key:1},zs={key:3},Hs={key:5},qs={props:{modelValue:{type:Object,default:{}},value:{type:Object,default:{}},target:{type:Object}},beforeUnmount(){this.value&&Ut.Transformer.removeEventListener("objectChange",this.onTransformerEvent)},mounted(){Ut.Transformer.addEventListener("objectChange",this.onTransformerEvent)},methods:{assignFromModel(e){this.value&&this.value[e]?(this.target[e]={x:this.value[e].x,y:this.value[e].y,z:this.value[e].z},this.$emit("save")):console.warn(`Value or property ${e} is undefined`)},removeTransform(e){this.target&&this.target[e]&&this.target[e]&&(delete this.target[e],"rotation"===e&&this.value.rotation.set(0,0,0,"XYZ"),this.$emit("save"))},onTransformerEvent(e){switch(console.log(Ut.Transformer,this.target,this.value.rotation),Ut.Transformer.mode){case"translate":this.target.position={...this.value.position};break;case"rotate":this.target.rotation={x:this.value.rotation.x,y:this.value.rotation.y,z:this.value.rotation.z};break;case"scale":this.target.scale={...this.value.scale}}this.$emit("save")},async onChangeTransform(e,t){switch(e){case"position":this.value.position.copy(t),this.target.position={x:t.x||0,y:t.y||0,z:t.z||0};break;case"rotation":this.value.rotation.set(t.x,t.y,t.z,"XYZ"),this.target.rotation={x:t.x,y:t.y,z:t.z};break;case"scale":this.value.scale.copy(t),this.target.scale={x:t.x,y:t.y,z:t.z}}this.$emit("save",e)}}},Gs=(0,C.A)(qs,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveComponent)("V3block"),c=(0,s.resolveComponent)("EulerBlock"),d=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",null,[(0,s.createElementVNode)("div",Rs,[(0,s.createElementVNode)("div",Ls,[(0,s.createCommentVNode)("v-if",!0)]),(0,s.createElementVNode)("div",Fs,[o.target.position?((0,s.openBlock)(),(0,s.createBlock)(i,{key:0,"onUpdate:modelValue":t[3]||(t[3]=e=>r.onChangeTransform("position",e)),label:"Position",step:.1,modelValue:o.target.position,decimals:4},{tools:(0,s.withCtx)(()=>[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:"square",onClick:t[2]||(t[2]=e=>r.removeTransform("position"))},[(0,s.createVNode)(l,{value:"bin",size:"1em"})])),[[d,"Delete position"]])]),_:1},8,["modelValue"])):((0,s.openBlock)(),(0,s.createElementBlock)("div",Us,[(0,s.createElementVNode)("button",{class:"copybutton",onClick:t[4]||(t[4]=e=>r.assignFromModel("position"))},"Copy model position")])),o.target.rotation?((0,s.openBlock)(),(0,s.createBlock)(c,{key:2,"onUpdate:rotation":t[6]||(t[6]=e=>r.onChangeTransform("rotation",e)),label:"Rotation",step:1,decimals:0,rotation:o.target.rotation},{tools:(0,s.withCtx)(()=>[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:"square",onClick:t[5]||(t[5]=e=>r.removeTransform("rotation"))},[(0,s.createVNode)(l,{value:"bin",size:"1em"})])),[[d,"Remove rotation"]])]),_:1},8,["rotation"])):((0,s.openBlock)(),(0,s.createElementBlock)("div",zs,[(0,s.createElementVNode)("button",{class:"copybutton",onClick:t[7]||(t[7]=e=>r.assignFromModel("rotation"))},"Copy model rotation")])),o.target.scale?((0,s.openBlock)(),(0,s.createBlock)(i,{key:4,"onUpdate:modelValue":t[9]||(t[9]=e=>r.onChangeTransform("scale",e)),label:"Scale",step:.01,modelValue:o.target.scale},{tools:(0,s.withCtx)(()=>[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{class:"square",onClick:t[8]||(t[8]=e=>r.removeTransform("scale"))},[(0,s.createVNode)(l,{value:"bin",size:"1em"})])),[[d,"Remove size"]])]),_:1},8,["modelValue"])):((0,s.openBlock)(),(0,s.createElementBlock)("div",Hs,[(0,s.createElementVNode)("button",{class:"copybutton",onClick:t[10]||(t[10]=e=>r.assignFromModel("scale"))},"Copy model scale")]))])])])}]]),Ws={style:{display:"grid","grid-template-columns":"96px 1fr"}},Ks={name:"EditColor",props:{modelValue:{type:Object}},computed:{val:{get(){return`#${this.modelValue?.getHexString()||"ffffff"}`},set(e){this.modelValue&&this.modelValue.set(e),this.$emit("update:modelValue",this.modelValue||new ke.Color(e))}}}},Js=(0,C.A)(Ks,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Ws,[(0,s.withDirectives)((0,s.createElementVNode)("input",{style:{width:"100%"},ref:"col",type:"color","onUpdate:modelValue":t[0]||(t[0]=e=>r.val=e)},null,512),[[s.vModelText,r.val]])])}]]),Ys={style:{display:"grid","grid-template-columns":"96px 1fr"}},Xs={name:"ColorString",props:{modelValue:{type:String}},computed:{val:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}},Qs=(0,C.A)(Xs,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Ys,[(0,s.withDirectives)((0,s.createElementVNode)("input",{style:{width:"100%"},ref:"col",type:"color","onUpdate:modelValue":t[0]||(t[0]=e=>r.val=e)},null,512),[[s.vModelText,r.val]])])}]]),Zs={class:"image-container"},er={ref:"canva"},tr={key:0,class:"selector"},or={props:{modelValue:{type:Object,default:null},value:{type:Object},label:{type:String,default:""},tooltip:{type:String,default:""},selectable:{type:Boolean}},data:()=>({txtr:null}),watch:{value(e){this.redraw()}},methods:{onUpdate({result:e,file:t}){console.log(e);const o=new Blob([e],{type:t.type}),n=URL.createObjectURL(o);this.txtr=n;const a=(new THREE.TextureLoader).load(n,()=>{URL.revokeObjectURL(n)});this.$emit("update:modelValue",a.image),this.$app.storage.writeFile("texture.png",e)},redraw(){const e=this.$refs.canva,t=e.getContext("2d");if(t.clearRect(0,0,e.width,e.height),this.value?.resource?.image)try{const o=this.value.resource.image;e.width=o.width,e.height=o.height,t.drawImage(o,0,0)}catch(e){}}},mounted(){this.redraw()}},nr=(0,C.A)(or,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Zs,[(0,s.createElementVNode)("canvas",er,null,512),o.selectable?((0,s.openBlock)(),(0,s.createElementBlock)("div",tr,[(0,s.createElementVNode)("button",{onClick:t[0]||(t[0]=t=>e.$emit("select"))},"SELECT")])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-37652e71"]]),ar={class:"image-container"},sr=["src"];var rr=o(92);const lr=new class{constructor(){this.renderer=null,this.scene=null,this.camera=null,this.canvas=null,this.db=null,this.dbName="ModelPreviews",this.dbVersion=1,this.storeName="previews",this.initDatabase(),this.initThreeJS()}async initDatabase(){return new Promise((e,t)=>{const o=indexedDB.open(this.dbName,this.dbVersion);o.onerror=()=>t(o.error),o.onsuccess=()=>{this.db=o.result,e()},o.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:"id"})}})}initThreeJS(){this.canvas=document.createElement("canvas"),this.canvas.width=256,this.canvas.height=256,this.renderer=new ke.WebGLRenderer({canvas:this.canvas,antialias:!0,preserveDrawingBuffer:!0,alpha:!0}),this.renderer.setSize(this.canvas.width,this.canvas.height),this.renderer.setClearColor(0,0),this.scene=new ke.Scene;const e=new ke.AmbientLight(16777215,.6);this.scene.add(e);const t=new ke.DirectionalLight(16777215,.8);t.position.set(1,1,1),this.scene.add(t)}async loadModel(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.blob(),n=URL.createObjectURL(o);let a;if(!e.toLowerCase().endsWith(".glb")&&!e.toLowerCase().endsWith(".gltf"))throw new Error("Unsupported format. Only GLB/GLTF supported");return a=await this.loadGLTF(n),URL.revokeObjectURL(n),a}catch(e){throw console.error("Error loading model:",e),e}}loadGLTF(e){return new Promise((t,o)=>{(new rr.B).load(e,e=>t(e.scene),null,e=>o(e))})}fitCameraToObject(e,t){const o=(new ke.Box3).setFromObject(e),n=o.getCenter(new ke.Vector3),a=o.getSize(new ke.Vector3),s=Math.max(a.x,a.y,a.z),r=t.fov*(Math.PI/180);let l=Math.abs(s/Math.sin(r/2));return l*=1.5,t.position.set(n.x,n.y,n.z+l),t.lookAt(n),{center:n,size:a}}async generatePreview(e){try{const t=await this.loadModel(e);this.scene.add(t),this.camera=new ke.PerspectiveCamera(45,this.canvas.width/this.canvas.height,.1,1e3),this.fitCameraToObject(t,this.camera),this.renderer.render(this.scene,this.camera);const o=this.canvas.toDataURL("image/png"),n=this.generateId();return await this.saveToDatabase(n,o,e),this.scene.remove(t),n}catch(e){throw console.error("Error generating preview:",e),e}}generateId(){return`preview_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async saveToDatabase(e,t,o){return new Promise((n,a)=>{const s=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName),r={id:e,screenshot:t,originalUrl:o,createdAt:(new Date).toISOString()},l=s.add(r);l.onsuccess=()=>n(e),l.onerror=()=>a(l.error)})}async getPreview(e){return new Promise((t,o)=>{const n=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);n.onsuccess=()=>{n.result?t(n.result):o(new Error("Preview not found"))},n.onerror=()=>o(n.error)})}async deletePreview(e){return new Promise((t,o)=>{const n=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);n.onsuccess=()=>t(),n.onerror=()=>o(n.error)})}async getAllPreviews(){return new Promise((e,t)=>{const o=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();o.onsuccess=()=>e(o.result),o.onerror=()=>t(o.error)})}async clearAllPreviews(){return new Promise((e,t)=>{const o=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();o.onsuccess=()=>e(),o.onerror=()=>t(o.error)})}},ir=lr,cr={props:{modelValue:{type:[Object,String],default:null},value:{type:Object},label:{type:String,default:""},image:{type:String},tooltip:{type:String,default:""},selectable:{type:Boolean}},computed:{isString(){return"string"==typeof this.modelValue}},data:()=>({img:null}),watch:{modelValue(e){this.redraw()}},methods:{async redraw(){if(this.img=null,this.value[this.image])return void(this.img=this.value[this.image]);const e=await ir.generatePreview(this.modelValue),t=await ir.getPreview(e);this.img=t.screenshot}},mounted(){this.redraw()}},dr=(0,C.A)(cr,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",ar,[a.img?((0,s.openBlock)(),(0,s.createElementBlock)("img",{key:0,style:{width:"100%",height:"100%"},src:a.img},null,8,sr)):(0,s.createCommentVNode)("v-if",!0)])}]]),pr={class:"image-uploader"},ur=["accept"],mr={name:"FileSelect",props:{buttonText:{type:String,default:"Select Image"},maxFileSize:{type:Number,default:5242880},acceptedTypes:{type:String,default:"image/*"}},methods:{triggerFileInput(){this.$refs.fileInput.click()},handleFileSelect(e){const t=e.target.files[0];if(!t)return;if(console.log(t),!t.type.match(this.acceptedTypes.replace("*",".*")))return void this.$emit("error","Invalid file type");if(t.size>this.maxFileSize)return void this.$emit("error",`File is too large (max ${this.maxFileSize/1024/1024}MB)`);const o=new FileReader;o.onload=e=>{this.$emit("update:modelValue",{result:e.target.result,file:t})},o.onerror=()=>this.$emit("error","Failed to read file"),o.readAsArrayBuffer(t),e.target.value=""}}},hr=(0,C.A)(mr,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",pr,[(0,s.createElementVNode)("button",{onClick:t[0]||(t[0]=(...e)=>r.triggerFileInput&&r.triggerFileInput(...e)),class:"upload-button"},(0,s.toDisplayString)(o.buttonText),1),(0,s.createElementVNode)("input",{type:"file",ref:"fileInput",accept:o.acceptedTypes,onChange:t[1]||(t[1]=(...e)=>r.handleFileSelect&&r.handleFileSelect(...e)),style:{display:"none"}},null,40,ur)])}]]),fr={__name:"twosidebool",props:{modelValue:{type:Boolean,default:!1},labels:{type:Array}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,n=t,a=()=>{n("update:modelValue",!o.modelValue)};return(t,o)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"toggle-switch",onClick:a},[(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["slider",{active:e.modelValue}])},[(0,s.createElementVNode)("span",{class:(0,s.normalizeClass)(["left-label",{active:!e.modelValue}])},[(0,s.renderSlot)(t.$slots,"left",{},()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.labels[0]),1)])],2),o[0]||(o[0]=(0,s.createElementVNode)("span",{class:"knob"},null,-1)),(0,s.createElementVNode)("span",{class:(0,s.normalizeClass)(["right-label",{active:e.modelValue}])},[(0,s.renderSlot)(t.$slots,"right",{},()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.labels[1]),1)])],2)],2)]))}},vr=(0,C.A)(fr,[["__scopeId","data-v-27cb6eff"]]),gr={class:"selected-value"},yr={class:"select-dropdown"},br=["onClick"],kr={__name:"sectionselect",props:{modelValue:{type:String,default:""},list:{type:Array,default:()=>[]},placeholder:{type:String,default:"Выберите вариант"}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,n=t,a=(0,s.ref)(o.modelValue),r=(0,s.ref)(!1),l=(0,s.ref)(null),i=(0,s.computed)(()=>o.list.map(e=>void 0===e.label?{...e,label:c(e.value)}:e)),c=e=>e?e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim():"",d=(0,s.computed)(()=>{const e=i.value.find(e=>e.value===a.value);return e?e.label:o.placeholder});(0,s.watch)(()=>o.modelValue,e=>{e!==a.value&&(a.value=e)});const p=()=>{r.value=!r.value},u=()=>{setTimeout(()=>{r.value=!1},150)},m=e=>{l.value&&!l.value.contains(e.target)&&(r.value=!1)};return(0,s.onMounted)(()=>{document.addEventListener("click",m)}),(0,s.onUnmounted)(()=>{document.removeEventListener("click",m)}),(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{class:(0,s.normalizeClass)(["custom-select",{"select-open":r.value}]),ref_key:"selectElement",ref:l},[(0,s.createElementVNode)("div",{class:"select-header",onClick:p,onBlur:u,tabindex:"0"},[(0,s.createElementVNode)("span",gr,(0,s.toDisplayString)(d.value),1),(0,s.createElementVNode)("div",{class:(0,s.normalizeClass)(["select-arrow",{rotated:r.value}])},[...t[0]||(t[0]=[(0,s.createElementVNode)("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none"},[(0,s.createElementVNode)("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],2)],32),(0,s.createVNode)(s.Transition,{name:"slide-fade",persisted:""},{default:(0,s.withCtx)(()=>[(0,s.withDirectives)((0,s.createElementVNode)("div",yr,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(i.value,e=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:e.value,class:(0,s.normalizeClass)(["select-option",{selected:a.value===e.value}]),onClick:t=>(e=>{a.value=e.value,n("update:modelValue",e.value),r.value=!1})(e)},(0,s.toDisplayString)(e.label),11,br))),128))],512),[[s.vShow,r.value]])]),_:1})],2))}},wr=(0,C.A)(kr,[["__scopeId","data-v-2710c4e8"]]),Er={class:"property-form"},_r={class:"label"},Sr={class:"editor"},Nr={name:"PropertyForm",props:{model:{type:Object,required:!0},properties:{type:Array,required:!0}},methods:{updateValue(e,t){!function(e,t,o){const n=t.split("."),a=n.pop();let s=e;for(const e of n)e in s||(s[e]={}),s=s[e];s[a]=o}(this.model,e,t),this.$emit("update:"+e,t),this.$emit("update:model",e,t)},getValue(e){return t=this.model,e.split(".").reduce((e,t)=>e?e[t]:void 0,t);var t}}},Vr=(0,C.A)(Nr,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveDirective)("translate");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Er,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.properties,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t,class:"row"},[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",_r,[(0,s.createTextVNode)((0,s.toDisplayString)(e.label||e.key),1)])),[[l,`inspector.${e.label||e.key}`]]),(0,s.createElementVNode)("div",Sr,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.component),{modelValue:r.getValue(e.prop),"onUpdate:modelValue":t=>r.updateValue(e.prop,t)},null,8,["modelValue","onUpdate:modelValue"])),(0,s.createCommentVNode)(' <component v-if="prop.type === \'custom\'" :is="prop.component" v-model="model[prop.key]"\n                    @update:modelValue="updateValue(prop.key, $event)" />\n\n                <input v-else-if="prop.type === \'string\'" type="text" v-model="model[prop.key]"\n                    @input="updateValue(prop.key, $event.target.value)" />\n\n                <input v-else-if="prop.type === \'int\'" type="number" step="1" v-model.number="model[prop.key]"\n                    @input="updateValue(prop.key, parseInt($event.target.value))" />\n\n                <input v-else-if="prop.type === \'float\'" type="number" step="0.01" v-model.number="model[prop.key]"\n                    @input="updateValue(prop.key, parseFloat($event.target.value))" />\n\n                <select v-else-if="prop.type === \'select\'" v-model="model[prop.key]"\n                    @change="updateValue(prop.key, $event.target.value)">\n                    <option v-for="(opt, i) in prop.options" :key="i" :value="opt.value ?? opt">\n                        {{ opt.label ?? opt }}\n                    </option>\n                </select>\n\n                <input v-else-if="prop.type === \'checkbox\'" type="checkbox" v-model="model[prop.key]"\n                    @change="updateValue(prop.key, $event.target.checked)" />\n\n                <div v-else-if="prop.type === \'radio\'">\n                    <label v-for="(opt, i) in prop.options" :key="i">\n                        <input type="radio" :value="opt.value ?? opt" v-model="model[prop.key]"\n                            @change="updateValue(prop.key, $event.target.value)" />\n                        {{ opt.label ?? opt }}\n                    </label>\n                </div> ')])]))),128))])}],["__scopeId","data-v-59b50a68"]]),Cr={class:"labelField"},Br={name:"Label",props:{modelValue:{type:String},value:{type:Object}}},$r=(0,C.A)(Br,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveDirective)("tooltip");return(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",Cr,[(0,s.createTextVNode)((0,s.toDisplayString)(o.modelValue||""),1)])),[[l,o.modelValue]])}],["__scopeId","data-v-45c328bf"]]),xr={style:{display:"flex","flex-direction":"column"}},Dr={style:{display:"flex","flex-direction":"row","justify-content":"space-between"}},Ir={style:{display:"flex","flex-direction":"row","justify-content":"space-between"}},Tr={props:{modelValue:{type:Object,default:{cast:!1,receive:!1}}},computed:{cast:{get(){return!!this.modelValue&&this.modelValue.cast},set(e){this.$emit("update:modelValue",{...this.modelValue?this.modelValue:{},cast:e})}},receive:{get(){return!!this.modelValue&&this.modelValue.receive},set(e){this.$emit("update:modelValue",{...this.modelValue?this.modelValue:{},receive:e})}}}},Ar=(0,C.A)(Tr,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("BoolEdit"),i=(0,s.resolveDirective)("translate");return(0,s.openBlock)(),(0,s.createElementBlock)("div",xr,[(0,s.createElementVNode)("div",Dr,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",null,[...t[2]||(t[2]=[(0,s.createTextVNode)("$$Cast:",-1)])])),[[i]]),(0,s.createVNode)(l,{modelValue:r.cast,"onUpdate:modelValue":t[0]||(t[0]=e=>r.cast=e),"update:modelValue":"cast=$event"},null,8,["modelValue"])]),(0,s.createElementVNode)("div",Ir,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",null,[...t[3]||(t[3]=[(0,s.createTextVNode)("$$Receive:",-1)])])),[[i]]),(0,s.createVNode)(l,{modelValue:r.receive,"onUpdate:modelValue":t[1]||(t[1]=e=>r.receive=e),"update:modelValue":"receive=$event"},null,8,["modelValue"])])])}]]),Mr={class:"dimension-control"},Or={class:"controls"},jr={class:"control-group"},Pr={class:"control-row"},Rr={class:"control-group"},Lr={class:"control-row"},Fr={name:"DimensionControl",props:{value:{type:Object,default:{}},target:{type:Object}},emits:["update:target"],setup(e,{emit:t}){const o=e=>{if("number"==typeof e)return{value:e,unit:"px"};if("auto"===e||"fit-content"===e||"min-content"===e||"max-content"===e)return{value:0,unit:e};const t=e.match(/^([\d.]+)(\D+)$/);return t?{value:parseFloat(t[1]),unit:t[2]}:{value:0,unit:"px"}},n=o(e.target.width||"100px"),a=(0,s.ref)(n.value),r=(0,s.ref)(n.unit),l=o(e.target.height||"100px"),i=(0,s.ref)(l.value),c=(0,s.ref)(l.unit),d=(e,t)=>["auto","fit-content","min-content","max-content","none"].includes(t)?t:`${e}${t}`;return(0,s.watch)([a,r],()=>{t("update:target","width",d(a.value,r.value))}),(0,s.watch)([i,c],()=>{t("update:target","height",d(i.value,c.value))}),(0,s.watch)(()=>e.target.width,e=>{const t=o(e||"100px");a.value=t.value,r.value=t.unit}),(0,s.watch)(()=>e.target.height,e=>{const t=o(e||"100px");i.value=t.value,c.value=t.unit}),{widthValue:a,widthUnit:r,heightValue:i,heightUnit:c}}},Ur=(0,C.A)(Fr,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Mr,[(0,s.createElementVNode)("div",Or,[(0,s.createElementVNode)("div",jr,[t[5]||(t[5]=(0,s.createElementVNode)("span",null,"Width",-1)),(0,s.createElementVNode)("div",Pr,[(0,s.withDirectives)((0,s.createElementVNode)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.widthUnit=e)},[...t[4]||(t[4]=[(0,s.createStaticVNode)('<option value="px" data-v-f12dc314>px</option><option value="%" data-v-f12dc314>%</option><option value="em" data-v-f12dc314>em</option><option value="rem" data-v-f12dc314>rem</option><option value="vh" data-v-f12dc314>vh</option><option value="vw" data-v-f12dc314>vw</option><option value="auto" data-v-f12dc314>auto</option><option value="fit-content" data-v-f12dc314>fit-content</option><option value="min-content" data-v-f12dc314>min-content</option><option value="max-content" data-v-f12dc314>max-content</option>',10)])],512),[[s.vModelSelect,n.widthUnit]]),["auto","fit-content","min-content","max-content"].includes(n.widthUnit)?(0,s.createCommentVNode)("v-if",!0):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("input",{key:0,"onUpdate:modelValue":t[1]||(t[1]=e=>n.widthValue=e),type:"number",min:"0"},null,512)),[[s.vModelText,n.widthValue,void 0,{number:!0}]])])]),(0,s.createElementVNode)("div",Rr,[t[7]||(t[7]=(0,s.createElementVNode)("span",null,"Height",-1)),(0,s.createElementVNode)("div",Lr,[(0,s.withDirectives)((0,s.createElementVNode)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.heightUnit=e)},[...t[6]||(t[6]=[(0,s.createStaticVNode)('<option value="px" data-v-f12dc314>px</option><option value="%" data-v-f12dc314>%</option><option value="em" data-v-f12dc314>em</option><option value="rem" data-v-f12dc314>rem</option><option value="vh" data-v-f12dc314>vh</option><option value="vw" data-v-f12dc314>vw</option><option value="auto" data-v-f12dc314>auto</option><option value="fit-content" data-v-f12dc314>fit-content</option><option value="min-content" data-v-f12dc314>min-content</option><option value="max-content" data-v-f12dc314>max-content</option>',10)])],512),[[s.vModelSelect,n.heightUnit]]),["auto","fit-content","min-content","max-content"].includes(n.heightUnit)?(0,s.createCommentVNode)("v-if",!0):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("input",{key:0,"onUpdate:modelValue":t[3]||(t[3]=e=>n.heightValue=e),type:"number",min:"0"},null,512)),[[s.vModelText,n.heightValue,void 0,{number:!0}]])])])])])}],["__scopeId","data-v-f12dc314"]]),zr={class:"text-color-editor"},Hr={name:"TextColorEditor",props:{modelValue:{type:String}},data:()=>({defaultColor:"#000000"}),computed:{textColor:{get(){return this.modelValue||"#000000"},set(e){this.$emit("update:modelValue",e)}}},emits:["update:modelValue"]},qr=(0,C.A)(Hr,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",zr,[(0,s.withDirectives)((0,s.createElementVNode)("input",{type:"color",id:"colorPicker","onUpdate:modelValue":t[0]||(t[0]=e=>r.textColor=e)},null,512),[[s.vModelText,r.textColor]])])}],["__scopeId","data-v-73332108"]]),Gr={class:"font-size-editor"},Wr={class:"controls"},Kr={class:"size-control"},Jr=["value"],Yr={name:"FontSizeEditor",data:()=>({fontSizeValue:16,fontSizeUnit:"px",defaultSize:"16px",availableUnits:["px","em","rem","pt","pc","in","cm","mm","ex","ch","vw","vh","vmin","vmax","%"],sizePresets:[{label:"Маленький (12px)",value:"12px"},{label:"Средний (16px)",value:"16px"},{label:"Большой (24px)",value:"24px"},{label:"Заголовок (32px)",value:"32px"}]}),computed:{currentFontSize(){return`${this.fontSizeValue}${this.fontSizeUnit}`}},methods:{updateFontSize(){this.$emit("update:modelValue",this.currentFontSize)},resetSize(){const e=this.defaultSize.match(/(\d+\.?\d*)(\D+)/);e?(this.fontSizeValue=parseFloat(e[1]),this.fontSizeUnit=e[2]):(this.fontSizeValue=16,this.fontSizeUnit="px"),this.updateFontSize()},applyPreset(e){const t=e.match(/(\d+\.?\d*)(\D+)/);t&&(this.fontSizeValue=parseFloat(t[1]),this.fontSizeUnit=t[2],this.updateFontSize())},parseSize(e){const t=e.match(/(\d+\.?\d*)(\D+)/);return t?{value:parseFloat(t[1]),unit:t[2]}:null},init(){const e=this.parseSize(this.modelValue);e&&(this.fontSizeValue=e.value,this.fontSizeUnit=e.unit,this.defaultSize=this.modelValue)}},emits:["update:modelValue"],props:{modelValue:{type:String,default:"16px",validator:e=>/^\d*\.?\d+(px|em|rem|pt|pc|in|cm|mm|ex|ch|vw|vh|vmin|vmax|%)$/.test(e)}},watch:{modelValue(){this.init()}},created(){this.init()}},Xr=(0,C.A)(Yr,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Gr,[(0,s.createElementVNode)("div",Wr,[(0,s.createElementVNode)("div",Kr,[(0,s.withDirectives)((0,s.createElementVNode)("input",{type:"number",id:"fontSizeValue","onUpdate:modelValue":t[0]||(t[0]=e=>a.fontSizeValue=e),min:"0",step:"0.1",onInput:t[1]||(t[1]=(...e)=>r.updateFontSize&&r.updateFontSize(...e))},null,544),[[s.vModelText,a.fontSizeValue,void 0,{number:!0}]]),(0,s.withDirectives)((0,s.createElementVNode)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>a.fontSizeUnit=e),onChange:t[3]||(t[3]=(...e)=>r.updateFontSize&&r.updateFontSize(...e))},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(a.availableUnits,e=>((0,s.openBlock)(),(0,s.createElementBlock)("option",{value:e,key:e},(0,s.toDisplayString)(e),9,Jr))),128))],544),[[s.vModelSelect,a.fontSizeUnit]])])])])}],["__scopeId","data-v-f859e98c"]]),Qr={class:"comma-number-input-wrapper"},Zr=["value","min","max","step"],el={name:"InputFloat",props:{modelValue:Number,step:{type:Number,default:.1},min:{type:Number,default:0},max:{type:Number,default:1},decimals:{type:Number,default:1}},data(){return{interval:null,isPressed:!1,changeSpeed:100,internalValue:this.modelValue||0}},computed:{formattedDisplayValue(){return this.formatNumber(this.modelValue)}},watch:{modelValue(e){this.internalValue=e}},mounted(){this.$refs.input.addEventListener("wheel",this.onWheel,{passive:!1}),this.$refs.input.addEventListener("mousedown",this.onMouseDown),document.addEventListener("mouseup",this.onMouseUp)},beforeDestroy(){this.$refs.input.removeEventListener("wheel",this.onWheel),this.$refs.input.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("mouseup",this.onMouseUp),this.stopChange()},methods:{onInput(e){const t=parseFloat(e.target.value);this.internalValue=t,this.$emit("update:modelValue",t)},onChange(e){const t=parseFloat(e.target.value);this.internalValue=t,this.$emit("update:modelValue",t),this.$emit("change",t)},formatNumber(e){if(null==e)return"0";const t=parseFloat(e);return isNaN(t)?"0":t.toFixed(this.decimals).replace(".",",")},onWheel(e){if(e.preventDefault(),e.stopPropagation(),document.activeElement!==this.$refs.input)return;const t=e.deltaY>0?-this.step:this.step;this.changeValue(t)},changeValue(e){let t=(this.internalValue||0)+e;t=Math.max(Math.min(t,this.max),this.min),t=parseFloat(t.toFixed(this.decimals+2)),this.internalValue=t,this.$emit("update:modelValue",t),this.$refs.input&&(this.$refs.input.value=t)},startIncrement(){this.stopChange(),this.isPressed=!0,this.changeValue(this.step),setTimeout(()=>{this.isPressed&&(this.interval=setInterval(()=>this.changeValue(this.step),50))},400)},startDecrement(){this.stopChange(),this.isPressed=!0,this.changeValue(-this.step),setTimeout(()=>{this.isPressed&&(this.interval=setInterval(()=>this.changeValue(-this.step),50))},400)},stopChange(){this.isPressed=!1,this.interval&&(clearInterval(this.interval),this.interval=null)},setValue(e){const t=this.parseNumber(e),o=Math.max(Math.min(t,this.max),this.min);this.internalValue=o,this.$emit("update:modelValue",o)}}},tl=(0,C.A)(el,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Qr,[(0,s.createElementVNode)("input",{ref:"input",type:"range",value:o.modelValue,onInput:t[0]||(t[0]=(...e)=>r.onInput&&r.onInput(...e)),onChange:t[1]||(t[1]=(...e)=>r.onChange&&r.onChange(...e)),class:"comma-number-input",min:o.min,max:o.max,step:o.step},null,40,Zr)])}]]),ol={class:"container"},nl={class:"list-container"},al={class:"list-head"},sl={class:"list-slider"},rl={key:0},ll={key:1,class:"grid"},il=["onClick"],cl={class:"grid-item"},dl={class:"textwrap tcenter w100"},pl={class:"textwrap w100"},ul={style:{display:"flex","justify-content":"center"}},ml={key:0,class:"extension"},hl={class:"form-block"},fl={class:"form-row"},vl={name:"LibForm",props:{modelValue:{type:Object},rows:{type:Array}},computed:{val(){return this.modelValue}}},gl=(0,C.A)(vl,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",hl,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.rows,e=>((0,s.openBlock)(),(0,s.createElementBlock)("div",fl,[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(e.label),1),((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.component),(0,s.mergeProps)({class:"form-component"},{ref_for:!0},e.props,{value:r.val,modelValue:r.val[e.prop],"onUpdate:modelValue":t=>r.val[e.prop]=t}),null,16,["value","modelValue","onUpdate:modelValue"]))]))),256))])}]]),yl={name:"ItemsLib",props:{selected:{type:Object},selectedIndex:{type:Number},rows:{type:Array},list:{type:Array},head:{type:Object,default:{}},styles:{type:Object,default:{item:{width:"72px",height:"72px"}}},icons:{type:Object,default:{}},options:{type:Object,default:{id:"uid",name:"name",icon:"icon",icontip:"tooltip"}},busy:{type:Boolean,default:!1}},computed:{target(){return this.selected}},mounted(){this.$emit("open")},components:{LibForm:gl}},bl=(0,C.A)(yl,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("Spinner"),i=(0,s.resolveComponent)("icon"),c=(0,s.resolveComponent)("LibForm"),d=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",ol,[(0,s.createElementVNode)("div",nl,[(0,s.createElementVNode)("div",al,[(0,s.renderSlot)(e.$slots,"head",(0,s.normalizeProps)((0,s.guardReactiveProps)(o.head)),()=>[(0,s.createElementVNode)("div",null,(0,s.toDisplayString)(o.head.title),1)],!0)]),(0,s.createElementVNode)("div",sl,[o.busy?((0,s.openBlock)(),(0,s.createElementBlock)("div",rl,[(0,s.createVNode)(l)])):((0,s.openBlock)(),(0,s.createElementBlock)("div",ll,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.list,(t,n)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{onClick:o=>e.$emit("selected",t,n),class:(0,s.normalizeClass)([{selected:o.selected===t||o.selectedIndex===n},"grid-element"])},[(0,s.renderSlot)(e.$slots,"item",{item:t},()=>[(0,s.createElementVNode)("div",cl,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",dl,[(0,s.createTextVNode)((0,s.toDisplayString)(t[o.options.name]||t[o.options.id]),1)])),[[d,t[o.options.name]||t[o.options.id]]]),(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",pl,[(0,s.createTextVNode)((0,s.toDisplayString)(t.url),1)])),[[d,t.url]]),(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",ul,[(0,s.createVNode)(i,{value:o.icons[t.type],size:"2em"},null,8,["value"])])),[[d,t[o.options.icontip]]])])],!0)],10,il))),256))]))])]),o.selected?((0,s.openBlock)(),(0,s.createElementBlock)("div",ml,[(0,s.renderSlot)(e.$slots,"edit",{selected:o.selected,rows:o.rows},()=>[(0,s.createVNode)(c,{modelValue:r.target,"onUpdate:modelValue":t[0]||(t[0]=e=>r.target=e),rows:o.rows},null,8,["modelValue","rows"])],!0)])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-4b86ff9e"]]),kl={class:"pitem"},wl={class:"textwrap w100 tcenter"},El={style:{display:"flex","justify-content":"center"},class:"tcenter"},_l={props:{item:{type:Object}},computed:{date(){return new Date(this.item.created).toLocaleString()}}},Sl=(0,C.A)(_l,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",kl,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",wl,[(0,s.createTextVNode)((0,s.toDisplayString)(o.item.name),1)])),[[l,o.item.name]]),(0,s.createElementVNode)("div",El,(0,s.toDisplayString)(r.date),1)])}],["__scopeId","data-v-a84bc2fe"]]),Nl={class:"container"},Vl={class:"block"},Cl={class:"label"},Bl={class:"value"},$l={data:()=>({result:""}),props:{text:{type:String}},emits:["update:text"]},xl=(0,C.A)($l,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveDirective)("translate");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Nl,[(0,s.createElementVNode)("div",Vl,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",Cl,[(0,s.createTextVNode)(" $$"+(0,s.toDisplayString)(o.text),1)])),[[l]]),(0,s.createElementVNode)("div",Bl,[(0,s.withDirectives)((0,s.createElementVNode)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.result=e),onInput:t[1]||(t[1]=t=>e.$emit("update:text",a.result))},null,544),[[s.vModelText,a.result]])])])])}],["__scopeId","data-v-3bf1bb00"]]),Dl={class:"container"},Il={class:"block"},Tl={class:"label"},Al={data:()=>({result:""}),props:{text:{type:String}}},Ml=(0,C.A)(Al,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Dl,[(0,s.createElementVNode)("div",Il,[(0,s.createElementVNode)("div",Tl,(0,s.toDisplayString)(o.text),1)])])}],["__scopeId","data-v-11e695e2"]]),Ol={class:"form-group"},jl=["disabled"],Pl={key:0,class:"form-group"},Rl=["disabled"],Ll={key:1,class:"form-group"},Fl=["disabled"],Ul={key:2,class:"form-group"},zl=["disabled"],Hl=["disabled"],ql={class:"form-actions"},Gl=["disabled"],Wl=["disabled"],Kl={key:3,class:"helper-actions"},Jl={key:4,class:"info-message"},Yl={key:5,class:"error-message"},Xl={__name:"auth",emits:["success"],setup(e,{emit:t}){const o=so.default.default||so.default,n=t,a=(0,s.ref)("login"),r=(0,s.ref)(!1),l=(0,s.ref)(""),i=(0,s.ref)(""),c=(0,s.reactive)({email:"",password:"",code:"",newPassword:"",confirmPassword:""}),d=(0,s.computed)(()=>{switch(a.value){case"login":return"Login";case"recover":return"Отправить код";case"verify":return"Подтвердить код";case"reset":return"Установить пароль"}}),p=(0,s.computed)(()=>"login"===a.value?"Cancel":"Назад"),u=(0,s.computed)(()=>{switch(a.value){case"login":return"Вход...";case"recover":return"Отправка...";case"verify":return"Проверка...";case"reset":return"Сохранение..."}});function m(){f(),a.value="recover",c.password="",c.code="",c.newPassword="",c.confirmPassword=""}function h(){f(),"login"===a.value?(c.email="",c.password=""):(a.value="login",c.code="",c.newPassword="",c.confirmPassword="")}function f(){l.value="",i.value=""}async function v(){if(f(),c.email)try{if(r.value=!0,"login"===a.value){const e=await fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:c.email,password:c.password})});if(!e.ok)throw await g(e);const t=await e.json();n("success",t)}else if("recover"===a.value){const e=await fetch("/auth/recovery",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:c.email})});if(!e.ok)throw await g(e);i.value="Код отправлен на указанный email",a.value="verify"}else if("verify"===a.value){if(!c.code)return void(l.value="Код обязателен");const e=await fetch("/auth/check",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:c.email,code:c.code})});if(!e.ok)throw await g(e);i.value="Код подтверждён. Введите новый пароль.",a.value="reset"}else if("reset"===a.value){if(!c.newPassword||!c.confirmPassword)return void(l.value="Заполните оба поля пароля");if(c.newPassword!==c.confirmPassword)return void(l.value="Пароли не совпадают");console.log(c.newPassword),await o.app.setPassword(c.newPassword),i.value="Пароль изменён.",a.value="login",c.password="",c.newPassword="",c.confirmPassword="",c.code=""}}catch(e){l.value="string"==typeof e?e:e?.message||"Ошибка сервера"}finally{r.value=!1}else l.value="Email обязателен"}async function g(e){try{const t=await e.json();return t?.message||t?.error||`HTTP ${e.status}`}catch{return`HTTP ${e.status}`}}return(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("form",{onSubmit:(0,s.withModifiers)(v,["prevent"]),class:"login-form"},[(0,s.createElementVNode)("div",Ol,[t[5]||(t[5]=(0,s.createElementVNode)("label",{for:"email"},"Email:",-1)),(0,s.withDirectives)((0,s.createElementVNode)("input",{id:"email",type:"email","onUpdate:modelValue":t[0]||(t[0]=e=>c.email=e),required:"",placeholder:"Введите email",disabled:r.value},null,8,jl),[[s.vModelText,c.email]])]),(0,s.createCommentVNode)(" LOGIN: email + password "),"login"===a.value?((0,s.openBlock)(),(0,s.createElementBlock)("div",Pl,[t[6]||(t[6]=(0,s.createElementVNode)("label",{for:"password"},"Пароль:",-1)),(0,s.withDirectives)((0,s.createElementVNode)("input",{id:"password",type:"password","onUpdate:modelValue":t[1]||(t[1]=e=>c.password=e),required:"",placeholder:"Введите пароль",disabled:r.value},null,8,Rl),[[s.vModelText,c.password]])])):(0,s.createCommentVNode)("v-if",!0),(0,s.createCommentVNode)(" VERIFY CODE "),"verify"===a.value?((0,s.openBlock)(),(0,s.createElementBlock)("div",Ll,[t[7]||(t[7]=(0,s.createElementVNode)("label",{for:"code"},"Код из письма:",-1)),(0,s.withDirectives)((0,s.createElementVNode)("input",{id:"code",type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>c.code=e),required:"",placeholder:"Введите код",disabled:r.value},null,8,Fl),[[s.vModelText,c.code]])])):(0,s.createCommentVNode)("v-if",!0),(0,s.createCommentVNode)(" RESET PASSWORD "),"reset"===a.value?((0,s.openBlock)(),(0,s.createElementBlock)("div",Ul,[t[8]||(t[8]=(0,s.createElementVNode)("label",{for:"newPassword"},"Новый пароль:",-1)),(0,s.withDirectives)((0,s.createElementVNode)("input",{id:"newPassword",type:"password","onUpdate:modelValue":t[3]||(t[3]=e=>c.newPassword=e),required:"",placeholder:"Введите новый пароль",disabled:r.value},null,8,zl),[[s.vModelText,c.newPassword]]),t[9]||(t[9]=(0,s.createElementVNode)("label",{for:"confirmPassword",style:{"margin-top":"8px"}},"Повтор пароля:",-1)),(0,s.withDirectives)((0,s.createElementVNode)("input",{id:"confirmPassword",type:"password","onUpdate:modelValue":t[4]||(t[4]=e=>c.confirmPassword=e),required:"",placeholder:"Повторите пароль",disabled:r.value},null,8,Hl),[[s.vModelText,c.confirmPassword]])])):(0,s.createCommentVNode)("v-if",!0),(0,s.createElementVNode)("div",ql,[(0,s.createElementVNode)("button",{type:"submit",disabled:r.value},(0,s.toDisplayString)(r.value?u.value:d.value),9,Gl),(0,s.createCommentVNode)(" Cancel / Back "),(0,s.createElementVNode)("button",{type:"button",onClick:h,disabled:r.value},(0,s.toDisplayString)(p.value),9,Wl)]),"login"===a.value?((0,s.openBlock)(),(0,s.createElementBlock)("div",Kl,[(0,s.createElementVNode)("a",{href:"#",onClick:(0,s.withModifiers)(m,["prevent"])},"Забыли пароль?")])):(0,s.createCommentVNode)("v-if",!0),i.value?((0,s.openBlock)(),(0,s.createElementBlock)("div",Jl,(0,s.toDisplayString)(i.value),1)):(0,s.createCommentVNode)("v-if",!0),l.value?((0,s.openBlock)(),(0,s.createElementBlock)("div",Yl,(0,s.toDisplayString)(l.value),1)):(0,s.createCommentVNode)("v-if",!0)],32))}},Ql=(0,C.A)(Xl,[["__scopeId","data-v-867ec93e"]]),Zl={props:{text:{type:Object,default:{value:"TEXT",size:"1em"}},path:{type:String},visible:{type:Boolean},styles:{type:Object}},mounted(){this.$emit("mounted",{path:this.path,element:this.$refs.container})}},ei=(0,C.A)(Zl,[["render",function(e,t,o,n,a,r){return(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{ref:"container",class:"cardroot",style:(0,s.normalizeStyle)({fontSize:o.text.size,...o.styles})},(0,s.toDisplayString)(o.text.value),5)),[[s.vShow,o.visible]])}],["__scopeId","data-v-4de6bc04"]]);var ti=o(828);const oi={class:"toastcontainer"},ni={class:"alert"},ai={class:"text"},si={class:"buttons"},ri=["onClick"],li={name:"QueryToast",props:{icon:{type:String,default:"notification"},message:{type:String,default:""},type:{type:String,default:"info"},buttons:{type:Array}}},ii=(0,C.A)(li,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon");return(0,s.openBlock)(),(0,s.createElementBlock)("div",oi,[(0,s.createElementVNode)("div",ni,[(0,s.createVNode)(l,{class:(0,s.normalizeClass)(`${o.type}icon`),size:"3em",value:o.icon},null,8,["class","value"]),(0,s.createElementVNode)("span",ai,(0,s.toDisplayString)(o.message),1)]),(0,s.createElementVNode)("div",si,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.buttons,e=>((0,s.openBlock)(),(0,s.createElementBlock)("button",{onClick:e.handler,class:"btn"},(0,s.toDisplayString)(e.label),9,ri))),256))])])}]]),ci=so.default.default||so.default;let di=0;const pi=(0,s.reactive)({list:[],add({message:e,icon:t,onclick:o,timehide:n=!0,type:a,...r},l=(0,s.markRaw)(Tn)){const i=(0,s.reactive)({id:di++,data:{message:e,icon:t,type:a,...r},component:l});return n&&(i.timeout=setTimeout(()=>{pi.remove(i.id)},3e3)),i.onclick=o||pi.remove.bind(this,i.id),pi.list.push(i),i},remove(e){for(let t=pi.list.length-1;t>=0;t--)pi.list[t].id===e&&pi.list.splice(t,1)}});ci.On("init",()=>{window.vue.component("QueryToast",ii)});const ui=pi,mi=(0,s.ref)(!1),hi=(0,s.reactive)({isVisible:!1,header:null,content:null,footer:null,values:null,open({header:e,content:t,footer:o,...n}){hi.header=e||{},hi.content=t||{},hi.footer=o||{},hi.values={closable:!1,...n},mi.value=!0},close(e){e||(mi.value=!1)},get isVisible(){return mi.value},queryText(e,t,o){hi.open({header:{value:e.title,handler:hi.close},content:{component:"queryform",props:e,events:{"update:text":o}},footer:{buttons:[...t.map(t=>(t.handler=()=>{t.callback(e.answer),hi.close()},t)),{label:"Close",class:"additional",handler:hi.close}]}})},confirmReq(e,t){hi.open({header:{value:e.title,handler:hi.close},content:{component:"confirmform",props:e},footer:{buttons:[...t.map(t=>(t.handler=()=>{t.callback(e.answer),hi.close()},t))]}})}}),fi=hi,vi=so.default.default||so.default;class gi extends Error{constructor(){super("Not all required parameters are specified."),this.isReqError=!0}}class yi extends Error{constructor(){super("This module has already been added."),this.isExistError=!0}}const bi=[{name:"engine",entry:"/editor/engine/mf.js",index:"engine",system:!0},{name:"tools",entry:"/mods/tools/mf.js",index:"tools",system:!0}],ki=[],wi={};function Ei(e){return new Promise(t=>{(0,ti.loadRemote)(`${e.name}/${e.index}`).then(async o=>{console.log(e.name),ki.push({name:e.name,index:e.index,entry:e.entry,title:e.title||e.name,id:e.id,uid:e.uid,global:e.global,description:e.description}),wi[e.name]=o,o.Init&&await o.Init(),t()})})}async function _i(e){if(e.uid=`${e.index}:${e.entry}`,!e.name?.length||!e.index?.length||!e.entry?.length)throw new gi;if(ki.find(t=>t.uid===e.uid))throw new yi;try{(0,ti.registerRemotes)([{...e}],{force:!0}),await Ei(e)}catch(e){throw e}return await async function(e){const t={id:e.entry,...e};return await Go.upsertItemProperties("modules",t.uid,t),t}(e)}function Si(){const e=(0,s.reactive)({selected:null,list:ki,processed:!1,styles:{item:{width:"128px",height:"128px"}},title:"Project modules"}),t={label:"Add",class:"secondary",hidden:(0,s.computed)(()=>!e.selected||e.selected.uid||e.processed),handler:async()=>{e.processed=!0;try{console.log("try"),e.selected=await _i(e.selected),console.log("try OK")}catch(t){return console.log(t.message),t.isReqError?ui.add({message:"Not all required fields are filled in"}):ui.add({message:"Error adding module"}),e.processed=!1,void(e.selected.uid=null)}ui.add({message:"The module has been loaded successfully."})}},o={label:"Registration",class:"secondary",hidden:(0,s.computed)(()=>e.selected&&!e.selected.uid),handler:()=>{e.selected=(0,s.reactive)({name:"",entry:"",index:""})}},n={label:"Report",class:"primary",hidden:(0,s.computed)(()=>!e.selected||!e.selected.uid),handler:()=>{e.selected=null}},a={label:"Remove",class:"additional",hidden:(0,s.computed)(()=>!e.selected?.id),handler:async()=>{const t=`${e.selected.index}:${e.selected.entry}`,o=ki.findIndex(e=>`${e.index}:${e.entry}`===t);if(o>=0){const t=wi[e.selected.name];if(t.Remove){const e=await t.Remove();if(e)return void vi.toasts.add({message:e})}const n=ki.splice(o,1);await Go.deleteItem("modules",n[0].uid),vi.toasts.add({message:"The module has been removed and will not be loaded the next time you use it.\nPlease refresh the page to take effect."}),e.selected=null}}},r={label:"Close",class:"primary",handler:async()=>{fi.close()}},l=(0,s.reactive)([o,a,t,n,r]);fi.open({header:{value:"Managing modules",handler:()=>{fi.close()}},content:{component:"ItemsLib",props:e,events:{selected:t=>{e.selected=t,console.log(e.selected)}},slots:{item:{component:"ModuleItem"},edit:{component:"ModuleEdit",props:e,events:{edit:(t,o)=>{e.selected[t]=o}}}}},footer:{buttons:l}})}async function Ni(){const e=(0,s.reactive)({selected:null,list:[],processed:!1,canadd:!1,styles:{item:{width:"128px",height:"128px"}},head:{title:""}}),t={label:"Add to project",class:"secondary",hidden:(0,s.computed)(()=>e.processed||!e.selected||!e.canadd),handler:async()=>{e.processed=!0;try{await _i({...e.selected})}catch(t){return t.isExistError?ui.add({message:t.message}):ui.add({message:"Error adding module"}),void(e.processed=!1)}e.canadd=-1===ki.findIndex(t=>t.uid===e.selected.uid),ui.add({message:"The module has been added to project."}),e.processed=!1}},o={label:"Close",class:"primary",handler:async()=>{fi.close()}},n=(0,s.reactive)([t,o]),a=async(t="")=>{const o=await fetch("https://s3.eu-west-1.amazonaws.com/3dbuilder.reneos.com/mods/modules.json"),n=await o.json();e.list=n.filter(e=>e.name.includes(t)||e.description.includes(t))};fi.open({header:{value:"Global modules",handler:()=>{fi.close()}},content:{component:"ItemsLib",props:e,events:{selected:t=>{e.selected=t,e.canadd=-1===ki.findIndex(t=>t.uid===e.selected.uid),console.log(e.selected,e.canadd)}},slots:{head:{component:"SearchFilter",events:{search(t){e.selected=null,e.canadd=!e.selected||-1===ki.findIndex(t=>t.uid===e.selected.uid),a(t)},entry(t){t||(e.selected=null,e.canadd=!e.selected||-1===ki.findIndex(t=>t.uid===e.selected.uid),a())}}},item:{component:"ModuleItem"},edit:{component:"ModuleView",props:e}}},footer:{buttons:n}}),a()}const Vi=(0,s.reactive)({init:async function(){(0,ti.createInstance)({name:"slider.editor",remotes:[]}),ki.length=0,await(0,ti.registerRemotes)([...bi]),await Promise.all(bi.map(e=>new Promise(t=>{(0,ti.loadRemote)(`${e.name}/${e.index}`).then(o=>{wi[e.name]=o,t()})})))},showLib:Si,getMod:function(e){return wi[e]},loadUserModules:async function(e){console.log(e),await(0,ti.registerRemotes)(e),await Promise.all(e.map(e=>Ei(e)))},AddModules:async function(e){for(let t=0;t<e.length;t++){const o=e[t];try{await _i(o)}catch(e){continue}}}});vi.On("init",()=>{vi.menu.add([{path:"hierarhy.modules",icon:"plug",tooltip:"Modules",handler:Si}]),window.vue.component("ModuleEdit",(0,s.defineAsyncComponent)(async()=>{const e=await o.e(689).then(o.bind(o,689));return e.default||e})),window.vue.component("ModuleItem",(0,s.defineAsyncComponent)(async()=>{const e=await o.e(920).then(o.bind(o,920));return e.default||e})),window.vue.component("ModuleView",(0,s.defineAsyncComponent)(async()=>{const e=await o.e(833).then(o.bind(o,833));return e.default||e})),vi.menu.add([{path:"app.libraries.modules",icon:"plug",text:"Modules",handler:Ni}])});const Ci=Vi,Bi=class{constructor(){this._events={"*":[]}}subs(e,t,o){null==this._events[e]&&(this._events[e]=[]),this._events[e].push({handler:o,once:t})}on(e,t){this.subs(e,!1,t)}once(e,t){this.subs(e,!0,t)}off(e,t){const o=this._events[e];if(o){for(let e=o.length-1;e>=0;e--)o[e].handler===t&&o.splice(e,1);0===o.length&&delete this._events[e]}}clear(e){this._events[e]=[]}clearAll(){this._events={"*":[]}}emit(e,...t){const o=[];this._events[e]&&o.push(...this._events[e]),this._events["*"].length&&o.push(...this._events["*"].map(t=>({handler:t.handler.bind(this,e),once:t.once})));for(let e=o.length-1;e>=0;e--){const n=o[e];n.handler.apply(null,t),n.once&&o.splice(e,1)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}},$i=so.default.default||so.default,{translateText:xi}=Et.rk,Di=new Bi;let Ii;async function Ti(e,t,o){if(!t)return;if(o[t.uid])return o[t.uid];const n=t.parent;let a=o[n];a||(a=await Ti(e,e.find(e=>e.uid===n),o));const s=await Ai(t,a);return o[s.uid]=s,s}async function Ai(e,t){const o=await Ii.BuildElement(e,t||$i.engine.getManager().Root);if(!o)return;const n=(0,s.reactive)(o);return(t||Pi).add(n),Di.emit("create",n),o.visible=!1,n}async function Mi(e){console.log(e);try{const t=Ii.exportToJSON(e),o=JSON.parse(Mt({name:e.name,paths:e.paths,path:e.paths.join("."),parent:e.parent?.uid||null,actions:e.actions||[],states:e.states,type:e.type,uid:e.uid,...t}));await Go.upsertItemProperties("models",e.uid,o)}catch(e){console.warn(e)}}function Oi(e){let t=Pi;for(let o=0;o<e.length;o++)t=t.children.find(t=>t.uid===e[o]);return t}function ji(e,t,o=[]){for(let n=0;n<e.length;n++){const a=e[n];a.isElement&&a.states[t]&&o.push(a),a.children?a.children.length&&ji(a.children,t,o):console.warn("No child")}}const Pi=(0,s.reactive)({add(e){Pi.children.push(e)},load:async function(e){Ii=$i.engine.getFactory(),Ii.on("error",e=>{console.log(e)});const t={};for(let o=e.length-1;o>=0;o--){const n=e[o],a=await Ti(e,n,t),s=e.findIndex(e=>e.uid===a.uid);s>=0&&e.splice(s,1)}},createElement:Ai,save:Mi,remove:async function e(t){let o=Pi,n=Pi;for(let e=0;e<t.length;e++)o=n,n=o.children.find(o=>o.uid===t[e]);$i.selection.selected===n&&$i.selection.select(null);const a=o.children.findIndex(e=>e===n);if(a>=0){for(let t=0;t<n.children.length;t++){const o=n.children[t];o.isElement&&e(o.paths)}o.children.splice(a,1),n.parent&&n.parent.remove(n),Go.deleteItem("models",n.uid),Ii.RemoveInstance(n.uid),Di.emit("remove",t,n)}},createFromAsset:async function(e,t){if(console.log("createFromAsset",e),!$i.slides.actived)return void $i.toasts.add({message:"You need to create a slide first",key:"slideNeed"});let o;o=t?Oi(t):$i.selection.selected?.isElement?Oi($i.selection.selected.paths):null;const n={name:Ot(e.name||"asset",Array.from(Ii.instances.values().map(e=>e.name))),...e.toModel()},a=await Ai(n,o);$i.assets.useAsset(e.uid,a.uid),Mi(a)},createTo:function(e){console.log("createTo",e);const t={uid:`Element${Date.now()}`,name:"Element",type:"Group",paths:[],path:""};e&&e.isElement&&t.paths.push(...e.paths),t.paths.push(t.uid),t.path=t.paths.join(".");const o={parent:e,modelValue:t,list:$i.app.types.filter(e=>e.isModel).sort((e,t)=>e.label.localeCompare(t.label))};$i.modal.open({header:{value:xi("addelement.header",{"#suffix":e?xi("addelement.header.v1",{"#parentname":e.name||e.uid}):xi("addelement.header.v2")}),handler:()=>{$i.modal.close()}},content:{component:"ElementAdd",props:o,events:{"update:modelValue":e=>{Object.keys(e).forEach(o=>{t[o]=e[o]})}}},footer:{buttons:[{label:"Add",class:"secondary",handler:async()=>{const o=$i.engine.getFactory().getTypeConfig(t.type);o.template&&Object.keys(o.template).forEach(e=>{t[e]=o.template[e]});try{const o=await Ai(t,e);o&&await Mi(o)}catch(e){$i.toasts.add({message:`Error on create ${t.type}:\n${e.message}`})}$i.modal.close()}},{label:"Cancel",class:"primary",handler:async()=>{$i.modal.close()}}]}})},find:Oi,getState:function(e,t){return e.states[t]||(e.states[t]={actions:[]},Di.emit("stateadd",t,e.paths)),e.states[t]},findStates:function(e){const t=[];return ji(Pi.children,e,t),t},findObjectsByType:function(e){const t=[];return function o(n){n instanceof e&&t.push({type:n.type,name:n.name,path:n.path}),n.children&&Array.isArray(n.children)&&n.children.forEach(e=>o(e))}(Pi),t},getInstances:function(){return Ii.instances},children:[],uid:null,data:{},on:Di.on.bind(Di),off:Di.off.bind(Di)});$i.On("init",()=>{$i.slides.on("change",e=>{ji(Pi.children,e,[])}),$i.slides.on("remove",e=>{const t=[];ji(Pi.children,e,t);for(let o=0;o<t.length;o++)delete t[o].states[e]})});const Ri=Pi,Li={class:"slide-tools"},Fi={key:0},Ui=["value"],zi={key:1},Hi={name:"CameraSelector",props:{modelValue:{type:String}},computed:{selectedCamera:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},cameras(){return this.$app.models.findObjectsByType(ke.Camera)||[]}}},qi=(0,C.A)(Hi,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveDirective)("translate");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Li,[r.cameras.length>0?((0,s.openBlock)(),(0,s.createElementBlock)("div",Fi,[(0,s.withDirectives)((0,s.createElementVNode)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.selectedCamera=e)},[t[1]||(t[1]=(0,s.createElementVNode)("option",{value:null},"No",-1)),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.cameras,e=>((0,s.openBlock)(),(0,s.createElementBlock)("option",{key:e.path,value:e.path}," ("+(0,s.toDisplayString)(e.type)+") "+(0,s.toDisplayString)(e.name||`Camera ${e.uid}`),9,Ui))),128))],512),[[s.vModelSelect,r.selectedCamera]])])):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",zi,[...t[2]||(t[2]=[(0,s.createTextVNode)(" There are no cameras available in the project. ",-1)])])),[[l,"No cam in project"]])])}]]),Gi=so.default.default||so.default,Wi=new Bi;async function Ki(e){const t=e||Qi.actived,o={actions:t.actions,name:t.name,index:t.index,camera:t.camera,uid:t.uid,props:t.props,background:t.background,environment:t.environment},n=JSON.parse(Mt(o));try{await Go.upsertItemProperties("slides",o.uid,n)}catch(e){console.warn(e)}}function Ji(e){const t=Qi.actived;Qi.actived="number"==typeof e?Qi.children[e]:Qi.children.find(t=>t.uid===e),Qi.actived&&(Wi.emit("change",Qi.actived.uid),async function(e,t){let o=[],n=Ri.findStates(e.uid);t&&(o=Ri.findStates(t.uid),await async function(e,t,o){const n=[],a=[];for(let e=0;e<t.length;e++){const s=t[e];o.findIndex(e=>e.uid===s.model.uid)>=0?n.push(s):a.push(s)}const s=[...a,...n];await Promise.all([Gi.engine.ActionsManager.Execute(s,"slide.out",nd.force),Gi.engine.ActionsManager.Run(e.actions,e,"slide.out",nd.force)]),await Gi.engine.ActionsManager.Execute(a,"disable.on",nd.force);for(let e=0;e<a.length;e++)Xi(a[e])}(t,o,n)),await async function(e,t,o){const n=[],a=[];for(let e=0;e<t.length;e++){const s=t[e];o.findIndex(e=>e.uid===s.uid)>=0?a.push(s):n.push(s)}console.log("Slide In");try{if(e.camera?.path&&e.camera?.path!==Gi.engine.getManager().Camera?.path){const t=e.camera.path.split("."),o=Ri.find(t);o&&(Gi.engine.getManager().SetCamera(o),o.updateProjectionMatrix())}console.log(e.background),e.background&&(e.background.isAsset?Gi.engine.getManager().Scene.background=e.background.resource:Gi.engine.getManager().Scene.background=e.background)}catch(e){console.warn(e)}const s=[...n,...a],r=s.map(t=>({...t.states[e.uid],model:t}));await Promise.all([Gi.engine.ActionsManager.Execute(r,"slide.in.before",nd.force),Gi.engine.ActionsManager.Run(e.actions,e,"slide.in.before",nd.force)]),await Gi.engine.ActionsManager.Execute(n,"enable.on",nd.force),await Promise.all([Gi.engine.ActionsManager.Execute(r,"slide.in",nd.force),Gi.engine.ActionsManager.Run(e.actions,e,"slide.in",nd.force)]);const l=[];for(let t=0;t<s.length;t++)l.push(Yi(s[t],e.uid));await Promise.all(l),await Promise.all([Gi.engine.ActionsManager.Execute(r,"slide.in.after",nd.force),Gi.engine.ActionsManager.Run(e.actions,e,"slide.in.after",nd.force)])}(e,n,o)}(Qi.actived,t))}async function Yi(e,t){const{position:o,rotation:n,scale:a,actions:s=[],visible:r=!1,...l}=e.states[t];o&&e.position.copy(o),n&&e.rotation.setFromVector3(n,"XYZ"),a&&e.scale.copy(a);const i=Object.keys(l).map(async t=>{const o=t.split("."),n=l[t];let a=o[0],s=e;try{for(let e=0;e<o.length-1;e++)s=s[o[e]],a=o[e+1];return s[a]=await Gi.engine.getFactory().CreateValue(n),{success:!0,key:t}}catch(e){return console.warn(e),{success:!1,key:t,error:e}}});await Promise.all(i),e.visible=r,e.state=e.states[t]||{model:e}}function Xi(e,t){console.log(e),e.visible=!1;const{actions:o=[],model:n}=e;Gi.engine.ActionsManager.Stop(o,e)}const Qi=(0,s.reactive)({load:async function(e){Qi.children.length=0;const t=e.sort((e,t)=>e.index-t.index);for(let e=0;e<t.length;e++){const o={name:"",camera:{path:null},actions:[],index:e,props:{},background:null,environment:{},...t[e]};Qi.children.push(o)}Ri.on("remove",e=>{const t=e.join(".");Gi.engine.manager.Camera?.path===t&&Gi.engine.manager.ResetCamera();for(let e=0;e<Qi.children.length;e++){const o=Qi.children[e];o.camera?.path===t&&(o.camera.path=null,Ki(o))}})},add:async function(e){const t=`sl${Date.now()}`,o={index:Qi.children.length,name:t,uid:t,background:null,environment:{},camera:{path:null},props:{},actions:[],...e};return Qi.children.push(o),await Ki(o),Wi.emit("add",o.uid),o},remove:async function(e){console.log("remove");let t=e||Qi.actived.uid;const o=Qi.children.findIndex(e=>e.uid===t);if(o>=0){Qi.actived.uid===t&&(0===o?await Ji(1):await Ji(o-1)),Qi.children.splice(o,1),await Go.deleteItem("slides",t);const e=Qi.children.find(e=>e.next===t);e&&Qi.children.length>=o&&(e.next=Qi.children[o].uid),Wi.emit("remove",t)}},save:Ki,actived:null,children:[],GoToNext(){Qi.next()},goto:Ji,next(){const e=Qi.children.findIndex(e=>e.uid===Qi.actived.uid);e>=Qi.children.length-1||Qi.goto(e+1)},back(){const e=Qi.children.findIndex(e=>e.uid===Qi.actived.uid);0!==e&&Qi.goto(e-1)},on:Wi.on.bind(Wi),off:Wi.off.bind(Wi)});function Zi(){Gi.engine.getFactory().on("remove",e=>{console.log(e);for(let t=0;t<Qi.children.length;t++){const o=Qi.children[t];o.camera.path===e.path&&(o.camera.path=null,Ki(o))}})}Gi.On("init",()=>{Gi.engine.ready?Zi():Gi.engine.onload(Zi),window.vue.component("CameraSelector",qi),Gi.menu.add([{path:"hierarhy.slide",icon:"dvr",tooltip:"Slide options",handler:()=>{var e;e=Qi.actived,Gi.modal.open({header:{value:"Slide options",handler:()=>{Gi.modal.close()}},content:{component:"ModalForm",props:(0,s.reactive)({model:e,properties:[{label:"Name",prop:"name",component:"LabelEdit"},{label:"Camera",prop:"camera.path",component:"CameraSelector"}],head:{title:""}}),events:{"update:model":(t,o)=>{Ki(e)},"update:camera.path":t=>{if(console.log(t),e.camera.path!==Gi.engine.getManager().Camera?.path){if(!t)return void Gi.engine.getManager().ResetCamera();const e=t.split("."),o=Ri.find(e);Gi.engine.getManager().SetCamera(o),o.updateProjectionMatrix()}}}},footer:{buttons:(0,s.reactive)([{label:"Close",class:"primary",handler:async()=>{Gi.modal.close()}}])}})}}])});const ec=Qi;let tc;const oc={},nc=[],ac=[],sc=(0,s.reactive)({ready:!1,get manager(){return tc},getAssetsManager:()=>oc.AssetsManager,getSlidesManager:()=>oc.SlidesManager,getFactory:()=>oc.Factory,getManager:e=>oc[e]||tc,async load(){console.log("Engine load");const{AssetsManager:e,CssManager:t,MouseManager:o,ActionsManager:n,Project:a,Factory:s}=Ci.getMod("engine");oc.AssetsManager=e,oc.SlidesManager=ec,oc.Factory=s,oc.MouseManager=o,oc.ActionsManager=n,oc.CssManager=t,oc.Project=tc=a,console.log("Engine load complete"),console.log(ac);const r=[];for(let e=0;e<ac.length;e++)r.push(ac[e](tc));ac.length=0,await Promise.all(r)},async start(){sc.ready=!0;const e=[];for(let t=0;t<nc.length;t++)e.push(nc[t](tc));return nc.length=0,await Promise.all(e),console.log(tc),tc},onload(e){nc.push(e)},onInit(e){ac.push(e)}}),rc=new Proxy(sc,{get:(e,t)=>t in e?e[t]:oc[t]}),lc={class:"blocks-container"},ic={class:"blockslabel"},cc={key:0,class:"blocks"},dc={class:"blocklabel"},pc={class:"blocktitle"},uc=["onClick"],mc={class:"actionview"},hc={key:0,class:"actionrow"},fc={key:1,class:"actionform"},vc={class:"actionline",style:{display:"flex","justify-content":"center"}},gc={key:2,class:"actionline",style:{display:"flex","justify-content":"center"}},yc={name:"ActionIspector",provide(){return{action:this.action}},props:{value:{type:Object,default:{uid:"",hook:""}},isState:{type:Boolean,default:!1},target:{type:Object},state:{type:Object}},data:()=>({expanded:!1,played:!1}),computed:{action(){return this.$app.actions.list.find(e=>e.uid===this.value.uid)}},methods:{onUpdate(e,t){const o=e.split(".");let n=this.action;for(let e=0;e<o.length-1;e++){const t=o[e];n[t]||(n[t]={}),n=n[t]}n[o[o.length-1]]=t,this.$emit("update:action",{[e]:t})},async remove(){this.$app.modal.confirmReq((0,s.reactive)({title:`Remove action '${this.action.name}' ?`,text:"",answer:"",template:""}),[{label:"YES",class:"primary",callback:e=>{this.$emit("remove")}},{label:"NO",class:"secondary",callback:e=>{}}])},async play(){this.$app.engine.getManager("ActionsManager").Call(this.action,this.target,!0)},stop(){this.action.worker()},reset(){}}},bc=(0,C.A)(yc,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",mc,[r.action?((0,s.openBlock)(),(0,s.createElementBlock)("div",hc,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"label",onClick:t[0]||(t[0]=e=>a.expanded=!a.expanded)},[(0,s.createElementVNode)("span",null,(0,s.toDisplayString)(a.expanded?"▼":"▶"),1),(0,s.createTextVNode)(" "+(0,s.toDisplayString)(r.action.name||r.action.uid),1)])),[[i,r.action.type]]),(0,s.createElementVNode)("button",{onClick:t[1]||(t[1]=(...e)=>r.remove&&r.remove(...e))},[(0,s.createVNode)(l,{value:"bin",size:"1em"})])])):(0,s.createCommentVNode)("v-if",!0),r.action?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",fc,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(r.action.type),{onUpdate:r.onUpdate,onPlay:r.play,onReset:r.reset,options:{inspector:!0,expanded:a.expanded},name:r.action.name},{inspector:(0,s.withCtx)(()=>[(0,s.createElementVNode)("div",vc,[(0,s.createElementVNode)("button",{class:"square",onClick:t[2]||(t[2]=(...e)=>r.play&&r.play(...e))},[(0,s.createVNode)(l,{value:"play3",size:"1.2em"})]),(0,s.createElementVNode)("button",{class:"square",onClick:t[3]||(t[3]=(...e)=>r.stop&&r.stop(...e))},[(0,s.createVNode)(l,{value:"stop2"})])])]),_:1},40,["onUpdate","onPlay","onReset","options","name"]))],512)),[[s.vShow,a.expanded]]):(0,s.createCommentVNode)("v-if",!0),a.expanded?(0,s.createCommentVNode)("v-if",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",gc))])}]]),kc=["onMouseover","onClick"],wc={props:["items","x","y"],data:()=>({isActive:!1,highlightedIndex:null}),methods:{highlight(e){this.highlightedIndex=e},deactivate(){this.highlightedIndex=null,this.$emit("select",null)},selectItem(e){this.$emit("select",e)}}},Ec=(0,C.A)(wc,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",{class:"menu",onMouseleave:t[0]||(t[0]=(...e)=>r.deactivate&&r.deactivate(...e)),style:(0,s.normalizeStyle)({top:o.y-3+"px",left:o.x+"px"})},[(0,s.createElementVNode)("ul",null,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.items,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("li",{key:t,onMouseover:e=>r.highlight(t),onClick:t=>r.selectItem(e),class:(0,s.normalizeClass)({highlighted:a.highlightedIndex===t})},(0,s.toDisplayString)(e),43,kc))),128))])],36)}],["__scopeId","data-v-56d3c090"]]),_c={name:"ActionsIspector",props:{modelValue:{type:Object,default:{}},value:{type:Object,default:{data:{}}},target:{type:Object,default:null},property:{type:Object}},computed:{eventTypes(){return this.$app.events.types},actions(){return this.$app.actions},hooks(){return this.$app.actions.hooks.filter(e=>!this.getActionsHooks().includes(e))}},methods:{async addEvent(e){this.events.length=0,this.events.push(...["create.on","enable.on","disable.on","mouse.over","mouse.out"].filter(e=>!this.getActionsHooks().includes(e))),this.menuX=e.clientX,this.menuY=e.clientY,this.listshow=!0,await this.$nextTick();const t=this.$refs.hooksList.$el.offsetHeight,o=window.innerHeight;this.menuY+t>o&&(this.menuY=o-t-10)},onSelectEvent(e){this.listshow=!1,e&&this.openActionsList(e)},openActionsList(e){this.$app.actions.showLib(async t=>{t&&(this.target.actions.push({uid:t.uid,hook:e}),this.$emit("save"))})},onRemove(e,t){console.log(e,t);const o=this.target.actions.findIndex(o=>o.uid===e.uid&&o.hook===t);o>=0&&(this.target.actions.splice(o,1),this.$app.actions.removeFrom(this.target,e),this.$emit("update:target",null,null))},getActionsHooks(){return[...new Set(this.target.actions.map(e=>e.hook))]},async reset(e){},async play(e){},onEdit(e,t){this.$app.actions.save({uid:e.uid,...t})}},data:()=>({eventType:"",listshow:!1,show:!0,events:[],menuX:0,menuY:0,played:!1}),components:{Action:bc,HooksList:Ec}},Sc=(0,C.A)(_c,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveComponent)("Action"),c=(0,s.resolveComponent)("HooksList");return(0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,null,[(0,s.createCommentVNode)("Actions View"),(0,s.createElementVNode)("div",lc,[(0,s.createElementVNode)("div",ic,[(0,s.createElementVNode)("div",{onClick:t[0]||(t[0]=e=>a.show=!a.show)},"Add : "),(0,s.createElementVNode)("button",{onClick:t[1]||(t[1]=(...e)=>r.addEvent&&r.addEvent(...e))},[(0,s.createVNode)(l,{value:"plus",size:"0.9em"})])]),a.show?((0,s.openBlock)(),(0,s.createElementBlock)("div",cc,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.getActionsHooks(),(e,n)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:n,class:"block"},[(0,s.createElementVNode)("div",dc,[(0,s.createElementVNode)("div",pc,(0,s.toDisplayString)(e),1),(0,s.createCommentVNode)("play block for all actions in hook"),t[2]||(t[2]=(0,s.createElementVNode)("div",{style:{display:"flex","justify-content":"center",gap:"5px"}},[(0,s.createCommentVNode)('LATER <button class="square" @click="play(eventType)">\n                            <icon :value="played ? \'stop2\' : \'play3\'" size="1em"></icon>\n                        </button>\n                        <button class="square" @click="reset(eventType)">\n                            <icon value="undo" size="1em"></icon>\n                        </button> ')],-1)),(0,s.createElementVNode)("button",{onClick:t=>r.openActionsList(e)},[(0,s.createVNode)(l,{value:"plus",size:"0.9em"})],8,uc)]),(0,s.createCommentVNode)("Models actions"),(0,s.createCommentVNode)(' <Action :value="action" :target="value"\n                    v-for="(action, index) in value.model.data.actions.filter(a => a.hook === eventType)"\n                    :ref="`action${action.uid}`" :key="index"\n                    @update:action="onEdit(action,$event)">\n                </Action> '),(0,s.createCommentVNode)("States actions"),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.target.actions.filter(t=>t.hook===e),(t,n)=>((0,s.openBlock)(),(0,s.createBlock)(i,{value:t,target:o.value,isState:o.target.isState,state:o.target.state||o.target,ref_for:!0,ref:`action${t.uid}`,key:n,"onUpdate:action":e=>r.onEdit(t,e),onRemove:o=>r.onRemove(t,e)},null,8,["value","target","isState","state","onUpdate:action","onRemove"]))),128))]))),128))])):(0,s.createCommentVNode)("v-if",!0),a.listshow?((0,s.openBlock)(),(0,s.createBlock)(s.Teleport,{key:1,to:"body"},[(0,s.createVNode)(c,{ref:"hooksList",x:a.menuX,y:a.menuY,items:r.hooks,onSelect:r.onSelectEvent},null,8,["x","y","items","onSelect"])])):(0,s.createCommentVNode)("v-if",!0)]),(0,s.createCommentVNode)(" // Actions View")],2112)}]]),Nc={class:"form-container"},Vc={class:"form-column"},Cc={class:"row"},Bc={class:"rowlabel"},$c={class:"rowvalue"},xc={key:0},Dc=["value"],Ic={key:0,class:"row"},Tc={class:"rowlabel"},Ac={class:"rowvalue"},Mc=["value"],Oc={key:1},jc={class:"row"},Pc={class:"rowlabel"},Rc={class:"rowvalue"},Lc={key:1,class:"row"},Fc={class:"rowlabel"},Uc={class:"rowvalue"},zc={key:2,class:"bottomform"},Hc={key:0},qc={name:"ActionLibSelect",provide(){return{action:(0,s.computed)(()=>this.selected)}},data:()=>({selectedGroup:null}),props:{selected:{type:Object},progress:{type:Number}},computed:{types(){return this.$app.actions.library.filter(e=>e.group===this.selectedGroup)},groups(){return this.$app.actions.groups},selectedType(){return this.$app.actions.library.find(e=>e.component===this.selected.type)},selectType:{get(){return this.selected.type},set(e){this.$emit("change:type",e)}}},methods:{onUpdate(e,t){this.$emit("edit",e,t)},end(){this.$emit("edit","name",this.$refs.nameeditor.endEdit()),this.$emit("edit","url",this.$refs.urleditor.endEdit())}},mounted(){this.selectedGroup=this.selected.group}},Gc=(0,C.A)(qc,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("LabelEdit"),i=(0,s.resolveDirective)("translate");return(0,s.openBlock)(),(0,s.createElementBlock)("div",Nc,[(0,s.createElementVNode)("div",Vc,[(0,s.createElementVNode)("div",Cc,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",Bc,[...t[4]||(t[4]=[(0,s.createTextVNode)("$$Group:",-1)])])),[[i]]),(0,s.createElementVNode)("div",$c,[o.selected.uid?((0,s.openBlock)(),(0,s.createElementBlock)("div",xc,(0,s.toDisplayString)(o.selected.group),1)):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("select",{key:1,style:{width:"100%"},"onUpdate:modelValue":t[0]||(t[0]=e=>a.selectedGroup=e)},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.groups,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("option",{key:t,value:e},(0,s.toDisplayString)(e),9,Dc))),128))],512)),[[s.vModelSelect,a.selectedGroup]])])]),a.selectedGroup?((0,s.openBlock)(),(0,s.createElementBlock)("div",Ic,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",Tc,[...t[5]||(t[5]=[(0,s.createTextVNode)("$$Type:",-1)])])),[[i]]),(0,s.createElementVNode)("div",Ac,[o.selected.uid?((0,s.openBlock)(),(0,s.createElementBlock)("div",Oc,(0,s.toDisplayString)(r.selectedType.name),1)):(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("select",{key:0,style:{width:"100%"},"onUpdate:modelValue":t[1]||(t[1]=e=>r.selectType=e)},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.types,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("option",{key:t,value:e.component},(0,s.toDisplayString)(e.name),9,Mc))),128))],512)),[[s.vModelSelect,r.selectType]])])])):(0,s.createCommentVNode)("v-if",!0),(0,s.createElementVNode)("div",jc,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",Pc,[...t[6]||(t[6]=[(0,s.createTextVNode)("$$Name:",-1)])])),[[i]]),(0,s.createElementVNode)("div",Rc,[(0,s.createVNode)(l,{style:{width:"100%"},ref:"nameeditor","onUpdate:modelValue":t[2]||(t[2]=t=>e.$emit("edit","name",t)),modelValue:o.selected.name},null,8,["modelValue"])])]),o.selected.description?((0,s.openBlock)(),(0,s.createElementBlock)("div",Lc,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",Fc,[...t[7]||(t[7]=[(0,s.createTextVNode)("$$Description:",-1)])])),[[i]]),(0,s.createElementVNode)("div",Uc,(0,s.toDisplayString)(o.selected.description),1)])):(0,s.createCommentVNode)("v-if",!0),((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(o.selected.type),{class:"vertflex",onUpdate:r.onUpdate},null,40,["onUpdate"])),t[9]||(t[9]=(0,s.createElementVNode)("span",{style:{flex:"1"}},null,-1)),o.selected.uid?(0,s.createCommentVNode)("v-if",!0):((0,s.openBlock)(),(0,s.createElementBlock)("div",zc,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("button",{onClick:t[3]||(t[3]=t=>e.$emit("save")),class:"primary"},[...t[8]||(t[8]=[(0,s.createTextVNode)("SAVE",-1)])])),[[i,"buttons.Save"]])]))]),o.progress>0?((0,s.openBlock)(),(0,s.createElementBlock)("div",Hc,(0,s.toDisplayString)(o.progress),1)):(0,s.createCommentVNode)("v-if",!0)])}]]),Wc={class:"itemElement"},Kc={class:"itemrow"},Jc={props:{item:{type:Object}}},Yc=(0,C.A)(Jc,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Wc,[(0,s.createElementVNode)("div",Kc,(0,s.toDisplayString)(o.item.name),1)])}]]),Xc=so.default.default||so.default;let Qc;function Zc(e){const t=(0,s.reactive)({selected:null,list:od.list,used:[],head:{reactive:!0,button:"X",slots:{"button-content":{}}}}),o={label:"Close",class:"secondary",handler:async()=>{t.selected=null,fi.close(),e&&e()}},n=(0,s.reactive)({label:"Create",class:"primary",handler:async()=>{const e=od.library[0];t.selected={type:e.component,group:e.group,targets:["*"],description:e.description,...e.template}}}),a={label:"Delete",class:"additional",hidden:(0,s.computed)(()=>!t.selected||!t.selected.uid),handler:async()=>{t.used.length>0?Xc.toasts.add({message:"Action in used"}):(await async function(e){const t=od.list.findIndex(t=>t.uid===e);if(t>=0)return ed(t.uid).length>0?void Xc.toasts.add({message:"Action in used"}):(od.list.splice(t,1),await Go.deleteItem("actions",e),Xc.toasts.add({message:"Action removed"}),!0);Xc.toasts.add({message:"Action not exists"})}(t.selected.uid),t.selected=null)}},r={label:"Select",class:"additional",hidden:(0,s.computed)(()=>!t.selected||!t.selected.uid||!e),handler:async()=>{e(t.selected),fi.close()}},l=(0,s.reactive)([r,n,a,o]);fi.open({header:{value:e?"Select an action":"Action Library",handler:()=>{fi.close()}},content:{component:"ItemsLib",props:t,events:{selected:e=>{console.log(e),e.uid?(t.selected=e,t.used=ed(t.selected.uid)):t.used.length=0}},slots:{head:{component:"SearchFilter",props:{reactive:!0},events:{clean(){t.list=od.list},entry(e){t.list=e?od.list.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())):od.list}}},item:{component:"ActionItem"},edit:{component:"ActionLibSelect",props:{selected:t.selected},events:{"change:type":e=>{const o=od.library.find(t=>t.component===e);t.selected={...o.template,type:o.component,group:o.group,description:o.description}},save:async()=>{const e=od.library.find(e=>e.component===t.selected.type);!e.check||await e.check(t.selected)?(Object.keys(e.template).forEach(o=>{o in t.selected||(t.selected[o]=JSON.parse(JSON.stringify(e.template[o])))}),t.selected.uid=`${t.selected.type}${Date.now()}`,await td(t.selected),await Qc.Add(t.selected)):ui.add({message:"Неверные параметры"})},edit:(e,o)=>{const n=e.split(".");let a=t.selected;for(let e=0;e<n.length-1;e++){const t=n[e];a[t]||(a[t]={}),a=a[t]}a[n[n.length-1]]=o,td(t.selected)}}}}},footer:{buttons:l}})}function ed(e){const t=[];return Xc.models.getInstances().forEach((o,n)=>{if(console.log(`Ключ: ${n}, Значение: ${o}`),o.actions.length>0)for(let a=0;a<o.actions.length;a++)o.actions[a].uid===e&&t.push({type:"model",model:n,name:o.name});Object.keys(o.states).forEach(a=>{const s=o.states[a];if(s.actions.length>0)for(let r=0;r<s.actions.length;r++)s.actions[r].uid===e&&t.push({type:"state",model:n,name:o.name,state:a})})}),t}async function td(e){e.uid&&await Go.upsertItemProperties("actions",e.uid,JSON.parse(JSON.stringify({id:e.uid,...e})))}new Bi;const od=(0,s.reactive)({init:async function(e){Qc||(Qc=rc.ActionsManager,await Qc.Init((0,s.reactive)(e)),Qc.on("add",e=>{od.list.push(e)}),Qc.on("remove",e=>{}),Qc.on("register",e=>{}),od.list.push(...Qc.Actions))},register:function(e){od.library.push(e)},save:td,showLib:Zc,exportData:async function(){return await Go.getAllItems("actions")},removeFrom:async function(e,{hook:t,uid:o}){Qc.Stop(o,e.uid)},findByType:function(e){return od.list.filter(t=>t.type===e)},get force(){return Qc.force},set force(e){Qc.force=e},hooks:["enable.on","slide.in.before","slide.in","slide.in.after","slide.out.before","slide.out","slide.out.after","disable.on","mouse.in","mouse.click","mouse.out"],list:[],library:[],get groups(){return od.library.reduce((e,t)=>(e.includes(t.group)||e.push(t.group),e),[])},get values(){return Object.values(od.list)}});Xc.On("init",()=>{window.vue.component("ActionsList",Sc),window.vue.component("ActionLibSelect",Gc),window.vue.component("ActionItem",Yc),Xc.menu.add([{path:"hierarhy.actions",icon:"dice",tooltip:"Actions",handler:Zc}]),Xc.inspector.addToModels(["Object3D"],[{label:"Models actions",readonly:!0,content:{prop:"actions",component:"ActionsList",state:!1}},{label:"States actions",readonly:!0,content:{prop:"actions",component:"ActionsList",state:!0}}])});const nd=od,ad={class:"assetblock"},sd={name:"AssetView",data:()=>({cmps:{hdr:"assethdr"}}),props:{value:{type:Object},modelValue:{type:String},property:{type:Object}},methods:{onAssetChange(e){e&&this.$emit("update:value",e.uid)},cleanProp(){delete this.value[this.property.prop],this.$emit("update:value",null)}},computed:{val(){return this.value[this.property.prop]},asset(){return this.val?this.$app.assets.list.find(e=>e.uid===this.val):null}},components:{assethdr:Ie}},rd=(0,C.A)(sd,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("icon"),i=(0,s.resolveDirective)("tooltip");return(0,s.openBlock)(),(0,s.createElementBlock)("div",ad,[((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(a.cmps[o.property.type]),{onSetasset:r.onAssetChange,asset:r.asset},null,40,["onSetasset","asset"])),r.asset?(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createBlock)(l,{key:0,onClick:r.cleanProp,class:"icon",value:"bin",size:"1em"},null,8,["onClick"])),[[i,"Удалить"]]):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-5867b901"]]),ld={class:"image-container"},id={ref:"canva"},cd={class:"selector"},dd={props:{modelValue:{type:Object,default:null},value:{type:Object},label:{type:String,default:""},tooltip:{type:String,default:""},selectable:{type:Boolean}},data:()=>({txtr:null}),watch:{value(e){this.redraw()},modelValue(e){this.redraw()}},methods:{onUpdate({result:e,file:t}){console.log(e);const o=new Blob([e],{type:t.type}),n=URL.createObjectURL(o);this.txtr=n;const a=(new THREE.TextureLoader).load(n,()=>{URL.revokeObjectURL(n)});this.$emit("update:modelValue",a.image),this.$app.storage.writeFile("texture.png",e)}},methods:{redraw(){const e=this.$refs.canva,t=e.getContext("2d");if(t.clearRect(0,0,e.width,e.height),this.modelValue)try{const o=this.modelValue.image;e.width=o.width,e.height=o.height,t.drawImage(o,0,0)}catch(e){}}},mounted(){console.log(this.modelValue,this.value),this.redraw()}},pd=(0,C.A)(dd,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",ld,[(0,s.createElementVNode)("canvas",id,null,512),(0,s.createElementVNode)("div",cd,[(0,s.createElementVNode)("button",{class:"btn",onClick:t[0]||(t[0]=t=>e.$emit("select",o.value))},"SELECT")])])}]]),ud={class:"form-container"},md={class:"info"},hd={class:"row"},fd={class:"rowlabel"},vd={class:"rowvalue"},gd={class:"row"},yd={class:"rowlabel"},bd={class:"rowvalue"},kd=["value"],wd=["value"],Ed={key:1},_d={class:"rowlabel"},Sd={key:0},Nd={name:"AssetEdit",props:{selected:{type:Object,default:{name:"-"}},progress:{type:Number}},computed:{types(){return this.$app.assets.types},inspector(){return this.$app.inspector.blocksFor(["asset",this.selected.type]).filter(e=>!e.inspectorOnly)}},methods:{updateInspector(e){this.inspector=this.$app.inspector.blocksFor(this.selected.getTypes())},onChange(e,t){console.log(e,t),this.$emit("edit",e,t)},end(){this.$emit("edit","name",this.$refs.nameeditor.endEdit()),this.$emit("edit","url",this.$refs.urleditor.endEdit())},async onComponentUpdate(e,t){if(t.onupdate)await t.onupdate(this.selected,e,t,()=>{this.$emit("edit",t.prop,e)});else{const o=t.prop.split(".");let n=o[0],a=this.selected;for(let e=0;e<o.length-1;e++)a=a[o[e]],n=o[e+1];a[n]=e,this.$emit("edit",t.prop,e)}},onComponentChange(){_saveHandler(this.selected)}}},Vd=(0,C.A)(Nd,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("LabelEdit"),i=(0,s.resolveDirective)("translate");return(0,s.openBlock)(),(0,s.createElementBlock)("div",ud,[(0,s.createElementVNode)("div",md,[(0,s.createElementVNode)("div",hd,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",fd,[...t[3]||(t[3]=[(0,s.createTextVNode)("$$Name:",-1)])])),[[i]]),(0,s.createElementVNode)("div",vd,[(0,s.createVNode)(l,{style:{width:"100%"},ref:"nameeditor","onUpdate:modelValue":[t[0]||(t[0]=e=>r.onChange("name",e)),t[1]||(t[1]=e=>o.selected.name=e)],modelValue:o.selected.name},null,8,["modelValue"])])]),(0,s.createElementVNode)("div",gd,[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",yd,[...t[4]||(t[4]=[(0,s.createTextVNode)("$$Type:",-1)])])),[[i]]),(0,s.createElementVNode)("div",bd,[o.selected.uid?((0,s.openBlock)(),(0,s.createElementBlock)("div",Ed,(0,s.toDisplayString)(o.selected.type),1)):((0,s.openBlock)(),(0,s.createElementBlock)("select",{key:0,class:"typeslist",value:o.selected.type,onChange:t[2]||(t[2]=e=>r.onChange("type",e.target.value))},[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.types,e=>((0,s.openBlock)(),(0,s.createElementBlock)("option",{value:e},(0,s.toDisplayString)(e),9,wd))),256))],40,kd))])]),(0,s.createCommentVNode)(' <div class="row">\n                <div class="rowlabel">URL</div>\n                <div class="rowvalue">\n                    <LabelEdit style="width: 100%;" ref="urleditor" @update:value="onChange(\'url\', $event)"\n                        :value="selected.url">\n                    </LabelEdit>\n                </div>\n            </div> '),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(r.inspector,(e,t)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:t,class:"row"},[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createElementBlock)("div",_d,[(0,s.createTextVNode)((0,s.toDisplayString)(e.label),1)])),[[i]]),e.content?((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.content.component),(0,s.mergeProps)({key:0,class:"rowvalue",value:o.selected,modelValue:o.selected[e.content.prop],"onUpdate:modelValue":[t=>o.selected[e.content.prop]=t,t=>r.onComponentUpdate(t,e.content)],property:e.content},{ref_for:!0},e.content.props,{onModify:t=>r.onComponentChange(t,e.content)}),null,16,["value","modelValue","onUpdate:modelValue","property","onModify"])):(0,s.createCommentVNode)("v-if",!0),e.head?((0,s.openBlock)(),(0,s.createBlock)((0,s.resolveDynamicComponent)(e.head.component),(0,s.mergeProps)({key:1,class:"rowvalue",value:o.selected,modelValue:o.selected[e.head.prop],"onUpdate:modelValue":[t=>o.selected[e.head.prop]=t,t=>r.onComponentUpdate(t,e.head)],property:e.head},{ref_for:!0},e.head.props,{onModify:t=>r.onComponentChange(t,e.head)}),null,16,["value","modelValue","onUpdate:modelValue","property","onModify"])):(0,s.createCommentVNode)("v-if",!0)]))),128)),t[5]||(t[5]=(0,s.createElementVNode)("div",null,null,-1))]),(0,s.createElementVNode)("div",null,[o.progress>0?((0,s.openBlock)(),(0,s.createElementBlock)("div",Sd,(0,s.toDisplayString)(o.progress),1)):(0,s.createCommentVNode)("v-if",!0)])])}],["__scopeId","data-v-d1f2452c"]]),Cd={class:"moditem"},Bd={class:"title"},$d={class:"image"},xd=["src"],Dd={name:"AssetItem",props:["item"]},Id=(0,C.A)(Dd,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Cd,[(0,s.createElementVNode)("div",Bd,(0,s.toDisplayString)(o.item.name),1),(0,s.createElementVNode)("div",$d,[o.item.images?((0,s.openBlock)(),(0,s.createElementBlock)("img",{key:0,src:o.item.images[0].url},null,8,xd)):(0,s.createCommentVNode)("v-if",!0)])])}],["__scopeId","data-v-e24059a8"]]),Td={class:"form-container"},Ad={class:"info"},Md={class:"row"},Od={class:"rowvalue"},jd={class:"line"},Pd=["src"],Rd={key:0},Ld={name:"AssetView",props:{selected:{type:Object,default:{name:"-"}},progress:{type:Number}},computed:{types(){return this.$app.assets.types},inspector(){return this.$app.inspector.blocksFor(["asset",this.selected.type]).filter(e=>!e.inspectorOnly)}},methods:{updateInspector(e){this.inspector=this.$app.inspector.blocksFor(this.selected.getTypes())},onChange(e,t){this.$emit("edit",e,t)},end(){this.$emit("edit","name",this.$refs.nameeditor.endEdit()),this.$emit("edit","url",this.$refs.urleditor.endEdit())},async onComponentUpdate(e,t){if(t.onupdate)await t.onupdate(this.selected,e,t,()=>{this.$emit("edit",t.prop,e)});else{const o=t.prop.split(".");let n=o[0],a=this.selected;for(let e=0;e<o.length-1;e++)a=a[o[e]],n=o[e+1];a[n]=e,this.$emit("edit",t.prop,e)}},onComponentChange(){_saveHandler(this.selected)}}},Fd=(0,C.A)(Ld,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Td,[(0,s.createElementVNode)("div",Ad,[(0,s.createElementVNode)("div",Md,[t[0]||(t[0]=(0,s.createElementVNode)("div",{class:"rowlabel"},"Name",-1)),(0,s.createElementVNode)("div",Od,(0,s.toDisplayString)(o.selected.name),1)]),(0,s.createElementVNode)("div",jd,[(0,s.createElementVNode)("img",{src:o.selected.images[0].url},null,8,Pd)])]),(0,s.createElementVNode)("div",null,[o.progress>0?((0,s.openBlock)(),(0,s.createElementBlock)("div",Rd,(0,s.toDisplayString)(o.progress),1)):(0,s.createCommentVNode)("v-if",!0)])])}],["__scopeId","data-v-321414c5"]]),Ud=so.default.default||so.default,zd={asset:[{label:"URL:",content:{prop:"url",component:"LabelEdit",onupdate(e,t,o,n){Gd.Update(e,t,o)}}},{label:"$$Clone:",head:{component:"BoolEdit",prop:"clone",async onupdate(e,t,o,n){await Gd.Update(e,t,o)}}}],model:[{label:"$$Shadow:",content:{component:"ShadowEdit",prop:"shadow",onupdate:async(e,t,o,n)=>{await Gd.Update(e,t,o)}}},{label:"$$Environment map",inspectorOnly:!0,content:{component:"AssetSelector",prop:"envMap",type:"hdr",onupdate:async(e,t,o,n)=>{await Gd.Update(e,t,o)}}}],image:[{label:"Image",content:{inspectorOnly:!0,prop:"img",component:"ImageView",props:{acceptedTypes:"image/*",selectable:!1},async onupdate(e,t,o){console.log(t),e.img=t}}}],hdr:[]},Hd={model:()=>!0},qd={model:"codepen",image:"image",hdr:"loop2",video:"film"};let Gd;function Wd(e=[]){return console.log(e),Zd.list.filter(t=>0===e.length||e.includes(t.type)).map(e=>({...e.data}))}async function Kd(e){e.uid||(e.uid=`asset_${Date.now()}`);const t=Gd.Add(e);await t.load(e=>{console.log(`${t.uid}:${e}%`)}),t.on("update",()=>{Jd(t)}),Zd.list.push(t),await Go.addItem("assets",JSON.parse(JSON.stringify(e)))}async function Jd(e){console.log("Save asset");try{if(!e.uid)return;await Go.updateItem("assets",JSON.parse(JSON.stringify({id:e.uid,...e.data})))}catch(e){console.error("Error saving asset:",e),Ud.toasts.add({message:"Error saving asset"})}}async function Yd(e){switch(e.type){case"model":if(Ud.models.children.some(t=>t.isUseAsset&&t.isUseAsset(e.uid)))return Ud.toasts.add({message:"Cannot delete, asset in use"}),!1;break;case"hdr":if(Zd.list.find(t=>t.data.envMap===e.uid))return Ud.toasts.add({message:"Cannot delete, asset in use"}),!1}const t=Zd.list.findIndex(t=>t.uid===e.uid);return t>=0&&(Zd.list.splice(t,1),Gd.Remove(e.uid),await Go.deleteItem("assets",e.uid)),!0}function Xd(e,t=!0){return new Promise(o=>{const n=(0,s.reactive)({selected:null,list:Wd(e),icons:qd}),a=(0,s.reactive)([{label:"Select",class:"primary",hidden:(0,s.computed)(()=>!t||!n.selected),handler:async()=>{fi.close(),o(n.selected)}},{label:"Remove",class:"additional",hidden:(0,s.computed)(()=>!n.selected?.uid),handler:async()=>{Yd(n.selected)&&(n.selected=null,n.list=Wd(e))}},{label:"Save",class:"primary",hidden:(0,s.computed)(()=>!n.selected||n.selected.uid||n.busy),handler:async()=>{if(!Hd[n.selected.type]||await Hd[n.selected.type](n.selected)){Ud.toasts.add({message:"Start load asset"});try{n.selected=await Kd(n.selected)}catch(e){return Ud.toasts.add({message:e.message}),void(n.selected.uid=null)}n.list=Wd(e),Ud.toasts.add({message:"Asset saved"})}}},{label:"Create",class:"secondary",handler:async()=>{n.selected={name:"",type:Zd.types[0],url:""}}},{label:"Close",class:"additional",handler:async()=>{fi.close(),o()}}]);fi.open({header:{value:t?"Select asset":"Project assets",handler:()=>{fi.close()}},content:{component:"ItemsLib",props:n,events:{selected:e=>{n.selected=e}},slots:{edit:{component:"AssetEdit",props:{selected:n.selected},events:{edit:(e,t)=>{n.selected[e]=t,n.selected.uid&&Jd({data:n.selected})}}}}},footer:{buttons:a}})})}async function Qd(){const e=[{label:"Name",prop:"name",component:"Label"}],t={model:[{label:"Preview",component:"ModelPreview",prop:"url",props:{image:"preview"}}],hdr:[],image:[],video:[]},o=(0,s.reactive)({selected:null,selectedIndex:-1,list:[],busy:!1,styles:{item:{width:"128px",height:"128px"}},icons:qd,head:{title:""},rows:[]});async function n(e){o.busy=!0;const t=await fetch("https://s3.eu-west-1.amazonaws.com/3dbuilder.reneos.com/assets/assets.json",{cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}}),n=await t.json();o.list=n.map(e=>({...e,name:e.name||e.uid})).filter(t=>!e||t.name.includes(e)),o.busy=!1}const a={label:"Add to project",class:"secondary",hidden:(0,s.computed)(()=>o.processed||o.selectedIndex<0||!o.canadd),handler:async()=>{o.processed=!0;try{const{name:e,url:t,type:n}=o.selected;await Kd({uid:Ot(o.selected.uid,Zd.list.map(e=>e.name)),name:e,url:t,type:n})}catch(e){return e.isExistError?Ud.toasts.add({message:e.message}):Ud.toasts.add({message:"Error adding asset"}),void(o.processed=!1)}o.canadd=-1===Zd.list.findIndex(e=>e.uid===o.selected.uid),Ud.toasts.add({message:"The asset has been added to project."}),o.processed=!1}},r={label:"Close",class:"primary",handler:async()=>{fi.close()}},l=(0,s.reactive)([a,r]);fi.open({header:{value:"Global assets",handler:()=>{fi.close()}},content:{component:"ItemsLib",props:o,events:{open:()=>{n()},selected:(n,a)=>{o.selected=n,o.selectedIndex=a,o.rows=[...e,...t[o.selected.type]],o.canadd=-1===Zd.list.findIndex(e=>e.uid===o.selected.uid)}},slots:{head:{component:"SearchFilter",events:{search(e){n(e)},entry(e){e||n()}}},item:{component:"AssetItem"}}},footer:{buttons:l}})}const Zd=(0,s.reactive)({init:async function(e,t){console.log("Init assets"),Gd=rc.getManager("AssetsManager");for await(const t of Gd.Init(e));const o=Array.from(Gd.Assets.values());o.forEach(e=>{e.on("update",()=>{Jd(e)})}),Zd.list.push(...o)},create:Kd,update:async function(e,t,o){await Gd.Update(e,t,o)},save:Jd,selectAsset:Xd,editAsset:function(e){const t=(0,s.reactive)({current:e}),o=(0,s.reactive)([{label:"Save",class:"secondary",handler:async()=>{e.uid?await Jd({data:e}):await Kd(e),fi.close()}},{label:"Cancel",class:"primary",handler:async()=>{fi.close()}}]);fi.open({header:{value:"Select asset",handler:()=>{fi.close()}},content:{component:"AssetEdit",props:t,events:{edit:(t,o)=>{e[t]=o}}},footer:{buttons:o}})},remove:Yd,setAsset:function(e,t){e.assets||(e.assets=[]),e.assets.push({uid:t.uid}),Ud.engine.getFactory().AddAsset(e.uid,t)},openAssetsLib:Qd,useAsset:function(e,t){const o=Zd.list.find(t=>t.uid===e);o&&o.uses.add(t)},getAsset:function(e){return Zd.list.find(t=>t.uid===e)},types:["model","hdr","image"],icons:qd,list:[],exportData:async()=>Array.from(Gd.Assets.values()),get inspector(){return zd},getInspector:e=>zd[e]||[],getManager:()=>Gd});Ud.On("init",()=>{Ud.menu.add([{path:"hierarhy.assets",icon:"cube",tooltip:"Assets",handler:()=>{Xd([],!1)}}]),Ud.menu.add([{path:"app.libraries.assets",icon:"cube",text:"Assets",handler:async()=>{Qd()}}]),window.vue.component("AssetView",Fd),window.vue.component("AssetItem",Id),window.vue.component("AssetSelector",rd),window.vue.component("AssetEdit",Vd),window.vue.component("AssetImage",pd),Object.keys(zd).forEach(e=>{Ud.inspector.addToModels([e],zd[e])})});const ep=Zd,tp=(Boolean,so.default.default||so.default);let op;const np=(0,s.reactive)({init:async function(){console.log("app init"),op=new Go("slider",["data","templates"]),await op.openDatabase("slider")},save:async function(){const e={uid:"currproject",id:"currproject",actions:nd.exportData(),assets:ep.exportData(),elements:Elements.exportData()};return await Go.updateItem("projects",e),e.uid},saveData:function(e,t,o){return op.upsertItemProperties(e,t,o)},readData:function(e,t){return op.getItem(e,t)},GetDB:function(){return op},draggedNode:null,ready:!1,cameras:[],get types(){return tp.engine.getFactory().GetTypes()},user:{registered:!1,name:"Guest",options:{manual:"false"!==localStorage.getItem("options.manual")}},setPassword:async function(e){try{const{error:t,me:o}=await gqlc.Set({me:[{password:[{$args:{value:e}}]}]})}catch(e){tp.toasts.add({message:"Error on change password"})}},async logout(){const e=await fetch("/auth/logout"),t=await e.json();console.log(t),window.location.reload()}});tp.On("init",async()=>{tp.menu.add([{path:"app.help.channel",icon:"bullhorn",text:"Channel",handler:async()=>{window.open("https://t.me/webslider","_blank")}},{path:"app.help.chat",icon:"bubbles",text:"Chat",tooltip:"Discuss",handler:()=>{window.open("https://t.me/chatslider","_blank")}},{path:"app.help.docs",icon:"books",text:"Documents",tooltip:"Documents",handler:()=>{window.open("/docs/","_blank")}}]),setTimeout(async()=>{},7e3)});const ap=np,sp=(so.default.default||so.default,(0,s.reactive)({event(e,t){gtag("event",e,t)}})),rp=[],lp=[],ip={},cp={},dp={},pp=(0,s.reactive)({ready:!1,cameras:[],blocksFor:e=>e.flatMap(e=>cp[e]||[]),handlers:dp,setHandler(e,t){dp[e]=t},getHandlers:()=>dp,addBlocks(e,t){Object.keys(_blocks).forEach(o=>{t(o)&&_blocks[o].push(...e)})},addToAssets(e,t){for(let o=0;o<e.length;o++){const n=e[o];"*"!==n?(ip[n]||(ip[n]=[]),ip[n].push(...t)):lp.push(...t)}},addToModels(e,t){for(let o=0;o<e.length;o++){const n=e[o];"*"!==n?(cp[n]||(cp[n]=[]),cp[n].push(...t)):rp.push(...t)}}}),up=so.default.default||so.default;function mp(e){Ut.Transformer.setMode(e)}const hp=(0,s.reactive)({add:function e(t){for(let o=0;o<t.length;o++){const n=t[o],a=n.path.split("."),s=a[0];let r=hp[s];if(!r){console.warn(`Root menu '${s}' not found`);continue}let l=s,i=r;for(let e=1;e<a.length-1;e++){const t=a[e];l+="."+t;let o=i.children.find(e=>e.path===l);o||(o={path:l},i.children.push(o)),o.children||(o.children=[]),i=o}const c=n.path,d=i.children.findIndex(e=>e.path===c);if(d>=0){const t=i.children[d];Object.keys(n).forEach(e=>{"path"!==e&&(t[e]=n[e])}),n.children&&n.children.length>0&&(t.children||(t.children=[]),e(n.children))}else{const t={...n};n.children&&n.children.length>0&&(t.children||(t.children=[]),e(n.children)),i.children.push(t)}}},app:{children:[{path:"app.project",icon:"",text:"Project",link:"#",children:[]},{path:"app.libraries",icon:"",text:"Libraries",link:"#",children:[]},{path:"app.help",icon:"question",text:"Help",link:"#",children:[]}]},top:{children:[{icon:"sphere",hint:"Local/global space",handler:function(){Ut.Transformer.setSpace("local"===Ut.Transformer.space?"world":"local")}},{icon:"move",hint:"Moving",handler:mp.bind(null,"translate")},{icon:"loop2",hint:"Rotation",handler:mp.bind(null,"rotate")},{icon:"enlarge2",hint:"Scale",handler:mp.bind(null,"scale")},{icon:"target",hint:"Zoom in on selected",handler:Ut.FocusToSelect},{icon:"cross",hint:"Deselect",handler:()=>{up.selection.select(null)}}],options:{size:"1.5em"}},hierarhy:{children:[],options:{}},tools:{children:[]}}),fp=hp,vp=so.default.default||so.default;function gp(e,t){const o=vp.engine.getFactory().exportToJSON(e),n=JSON.parse(Mt({name:e.name,paths:e.paths,path:e.paths.join("."),parent:e.parent?.uid||null,actions:e.actions||[],states:e.states,type:e.type,uid:e.uid,...o}));t.push(n);const a=e.children.filter(e=>e.isElement);for(let e=0;e<a.length;e++)gp(a[e],t)}const yp=(0,s.reactive)({create:function(e){const t=[];gp(e,t),console.log(t)}}),bp={class:"importer"},kp={class:"row"},wp={class:"row"},Ep={class:"label"},_p={class:"row"},Sp={class:"label"},Np={class:"row"},Vp={class:"label"},Cp={class:"row"},Bp={class:"label"},$p={name:"Importer",data:()=>({merge:!1,assets:new Set,models:new Set,slides:new Set,modules:new Set}),methods:{onChangeElements(e){e.isSelected?this.models.add(e.path):this.models.delete(e.path),this.$emit("changelist",{assets:this.assets,models:this.models,slides:this.slides,modules:this.modules})},onChangeModules(e){e.isSelected?this.modules.add(e.name):this.modules.delete(e.name),this.$emit("changelist",{assets:this.assets,models:this.models,slides:this.slides,modules:this.modules})},onChangeSlides(e){e.isSelected?this.slides.add(e.uid):this.slides.delete(e.uid),this.$emit("changelist",{assets:this.assets,models:this.models,slides:this.slides,modules:this.modules})},onChangeAssets(e){e.isgroup?e.isSelected?e.children.map(e=>this.assets.add(e.uid)):this.assets.clear():e.isSelected?this.assets.add(e.uid):this.assets.delete(e.uid),this.$emit("changelist",{assets:this.assets,models:this.models,slides:this.slides,modules:this.modules})}},props:{project:{type:Object}},components:{TreeView:ot},computed:{assetsTree(){return this.project.assets.reduce((e,t)=>{let o=e.find(e=>e.type===t.type);return o||(o={isgroup:!0,type:t.type,children:[],uid:t.type},e.push(o)),o.children.push(t),e},[])}}},xp=(0,C.A)($p,[["render",function(e,t,o,n,a,r){const l=(0,s.resolveComponent)("TreeView");return(0,s.openBlock)(),(0,s.createElementBlock)("div",bp,[(0,s.createElementVNode)("div",kp,[(0,s.createElementVNode)("div",null,[t[2]||(t[2]=(0,s.createTextVNode)("Импортировать в текущий проект ",-1)),(0,s.withDirectives)((0,s.createElementVNode)("input",{type:"checkbox",onChange:t[0]||(t[0]=t=>e.$emit("options",{merge:a.merge})),"onUpdate:modelValue":t[1]||(t[1]=e=>a.merge=e)},null,544),[[s.vModelCheckbox,a.merge]])])]),(0,s.createElementVNode)("div",wp,[t[3]||(t[3]=(0,s.createElementVNode)("div",{class:"title"},"Assets",-1)),(0,s.createElementVNode)("div",null,[(0,s.createVNode)(l,{childsFiled:"children",tree:r.assetsTree,onChangeSelect:r.onChangeAssets},{label:(0,s.withCtx)(({node:e})=>[(0,s.createElementVNode)("div",Ep,(0,s.toDisplayString)(e.name||e.uid),1)]),_:1},8,["tree","onChangeSelect"])])]),(0,s.createElementVNode)("div",_p,[t[4]||(t[4]=(0,s.createElementVNode)("div",{class:"title"},"Модули",-1)),(0,s.createElementVNode)("div",null,[(0,s.createVNode)(l,{childsFiled:"childrenz",tree:o.project.modules,onChangeSelect:r.onChangeModules},{label:(0,s.withCtx)(({node:e})=>[(0,s.createElementVNode)("div",Sp,(0,s.toDisplayString)(e.name||e.uid),1)]),_:1},8,["tree","onChangeSelect"])])]),(0,s.createElementVNode)("div",Np,[t[5]||(t[5]=(0,s.createElementVNode)("div",{class:"title"},"Элементы",-1)),(0,s.createElementVNode)("div",null,[(0,s.createVNode)(l,{childsFiled:"childrenz",tree:o.project.models,onChangeSelect:r.onChangeElements},{label:(0,s.withCtx)(({node:e})=>[(0,s.createElementVNode)("div",Vp,(0,s.toDisplayString)(e.name||e.uid),1)]),_:1},8,["tree","onChangeSelect"])])]),(0,s.createElementVNode)("div",Cp,[t[6]||(t[6]=(0,s.createElementVNode)("div",{class:"title"},"Слайды",-1)),(0,s.createElementVNode)("div",null,[(0,s.createVNode)(l,{childsFiled:"childrenz",tree:o.project.slides,onChangeSelect:r.onChangeSlides},{label:(0,s.withCtx)(({node:e})=>[(0,s.createElementVNode)("div",Bp,(0,s.toDisplayString)(e.name||e.uid),1)]),_:1},8,["tree","onChangeSelect"])])])])}]]),Dp=so.default.default||so.default,Ip=new Bi;const Tp=(0,s.reactive)({uid:null,init:function(e){for(let t=0;t<e.length;t++){const o=e[t];Tp.data[o.uid]=o}Tp.options=Tp.data.options||{fullscreen:!1,showslides:!0},Tp.info=Tp.data.info||{name:"Project"}},data:{},exportToJson:async function(){const e=await Go.exportToJson(Tp.uid),t=new Blob([JSON.stringify(e)],{type:"application/json"}),o=`project${Tp.uid}.json`;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,o);else{const e=window.document.createElement("a");e.href=window.URL.createObjectURL(t),e.download=o,e.style="display: none",e.click()}},importProject:async function(){try{const e=await function(e=".json"){return new Promise(t=>{const o=document.createElement("input");o.type="file",o.accept=e,o.style.display="none",o.addEventListener("change",()=>{o.files&&o.files[0]&&t(o.files[0]),document.body.removeChild(o)}),document.body.appendChild(o),o.click()})}(),t=await function(e){return new Promise((t,o)=>{if(!e.name.endsWith(".json"))return void o(new Error("Выберите файл с расширением .json"));const n=new FileReader;n.onload=e=>{try{const o=JSON.parse(e.target.result);t(o)}catch(e){o(new Error("Ошибка парсинга JSON: "+e.message))}},n.onerror=()=>{o(new Error("Ошибка чтения файла"))},n.readAsText(e)})}(e);(0,s.reactive)({actions:{},assets:{},elements:{},slides:{},modules:{}}),await Go.addItems("actions",t.actions),await Go.addItems("assets",t.assets),await Go.addItems("models",t.models),await Go.addItems("slides",t.slides),await Go.addItems("modules",t.modules),await Go.addItems("project",t.project);const o=new URL(window.location.href);return window.location.href=o.toString(),t}catch(e){throw console.error("Ошибка:",e.message),e}},play:async function(e="data"){Dp.analitycs.event("project_play");const t=await Go.exportToJson(Tp.uid);let o=`../player?src=${e}`;"db"===e&&(o+=`&db=${Tp.uid}`);const n=window.open(o,"Player");if(n){if("data"===e){const e=async(o=0)=>{try{if(n.closed)return void console.error("Окно плеера было закрыто");const e={};Object.keys(t).forEach(o=>{console.log(o),e[o]=structuredClone(t[o])}),n.postMessage({type:"INIT_DATA",payload:e},window.location.origin)}catch(t){console.error("Ошибка при отправке данных:",t),o<5&&setTimeout(()=>e(o+1),500*(o+1))}};setTimeout(e,3e3)}}else console.error("Не удалось открыть окно. Возможно, браузер заблокировал pop-up.")},children:[],on:Ip.on.bind(Ip),off:Ip.off.bind(Ip),options:{fullscreen:!1,showslides:!0},info:{name:"Project"}});Dp.On("init",()=>{window.vue.component("Importer",xp),window.vue.component("ElementAdd",ft),Dp.menu.add([{path:"hierarhy.project",icon:"equalizer2",tooltip:"Project options",handler:()=>{!function(){const e=(0,s.reactive)({model:Tp.options,properties:[{label:"Show slides",prop:"showslides",component:"BoolEdit"},{label:"Fullscreen",prop:"fullscreen",component:"BoolEdit"}],head:{title:""}}),t={label:"Close",class:"primary",handler:async()=>{Dp.modal.close()}},o=(0,s.reactive)([t]);Dp.modal.open({header:{value:"Project options",handler:()=>{Dp.modal.close()}},content:{component:"ModalForm",props:e,events:{"update:model":(e,t)=>{!async function(){await Go.upsertItemProperties("project","options",JSON.parse(Mt(Tp.options)))}()}}},footer:{buttons:o}})}()}}]),Dp.menu.add([{path:"app.project",icon:"",text:"Project",link:"#",children:[{path:"app.project.create",icon:"file-empty",text:"Create",handler:async()=>{Dp.projects.create()}},{path:"app.project.open",icon:"menu",text:"Open",tooltip:"Open project",handler:()=>{Dp.projects.open()}},{path:"app.project.export",icon:"download",text:"Export",tooltip:"Export project",handler:()=>{Dp.project.exportToJson()}},{path:"app.project.import",icon:"upload",text:"Import",link:"#",tooltip:"Import project",handler:()=>{Dp.project.importProject()}},{path:"app.project.remove",icon:"bin",text:"Delete",handler:()=>{Dp.projects.remove()}}]}])});const Ap=Tp,Mp=so.default.default||so.default,Op=[];let jp="";function Pp(e={}){return new Promise(t=>{const o=(0,s.reactive)({title:"Creating a project",text:"Please enter the project name *",answer:"",template:""}),n=(0,s.reactive)({label:"Create",class:"primary",disabled:o.answer.length<1,callback:async o=>{const n=`project${Date.now()}`;await Go.Create(n,{project:[{uid:"info",id:n,name:o,created:Date.now(),last:Date.now()},{uid:"options",showslides:!0}],assets:e.assets||[],actions:e.actions||[],models:e.models||[],slides:e.slides||[],modules:e.modules||[]}),Mp.analitycs.event("project_create"),t(n)}});fi.queryText(o,[n],e=>{o.answer=e,n.disabled=o.answer.length<1})})}async function Rp(e){const t=new URL(window.location.href);t.searchParams.set("src","db"),t.searchParams.set("db",e),window.location.href=t.toString()}async function Lp(){const e=await Go.GetFromAll("project","info");return Fp.list.length=0,Fp.list.push(...e.filter(e=>void 0!==e).map(e=>(e.uid=e.id,e))),Fp.list}const Fp=(0,s.reactive)({init:async function(e){console.log(e),jp=e},create:async function(){const e=await Pp();e&&Rp(e)},createProject:Pp,open:async function(){const e=await Lp(),t=(0,s.reactive)({list:e.filter(e=>e.uid!==Mp.project.uid)});fi.open({header:{value:"Open project",handler:fi.close},content:{component:"ItemsLib",props:t,events:{selected:e=>{Rp(e.id),fi.close()}},slots:{item:{component:"ProjectItem"}}},footer:{buttons:[{label:"Close",class:"primary",handler:fi.close}]}})},goto:Rp,remove:async function(e){console.log(e);const t=e||jp;console.log(t),await Go.DeleteDatabase(t),console.log("Removed");const o=Fp.list.findIndex(e=>e.uid===t);o>=0&&Fp.list.splice(o,1),window.location.href=new URL(`${window.location.origin}${window.location.pathname}`).toString()},getList:Lp,loadExample:async function(e){const t=(await Op[e]()).default,o=`project${e}`;await Go.Init(o,["project","assets","models","slides","actions","modules"],"uid"),await Go.addItems("actions",t.actions),await Go.addItems("assets",t.assets),await Go.addItems("models",t.models),await Go.addItems("modules",t.modules),await Go.addItems("project",t.project),await Go.addItems("slides",t.slides);const n=new URL(window.location.href);n.searchParams.set("project",o),window.location.href=n.toString()},play:async function(e="data"){const t=await Go.exportToJson(jp);console.log(t),t.project={ui:{slides:!0,fullscreen:!0}};let o=`../player?target=${e}`;"src"===e&&(o+=`&src=${jp}`);const n=window.open(o,"Player");if(n){if("data"===e){const e=async(o=0)=>{try{if(n.closed)return void console.error("Окно плеера было закрыто");n.postMessage({type:"INIT_DATA",payload:t},window.location.origin),console.log("Данные отправлены")}catch(t){console.error("Ошибка при отправке данных:",t),o<5&&setTimeout(()=>e(o+1),500*(o+1))}};setTimeout(e,1e3)}}else console.error("Не удалось открыть окно. Возможно, браузер заблокировал pop-up.")},importProject:async function(){try{const e=await function(e=".json"){return new Promise(t=>{const o=document.createElement("input");o.type="file",o.accept=e,o.style.display="none",o.addEventListener("change",()=>{o.files&&o.files[0]&&t(o.files[0]),document.body.removeChild(o)}),document.body.appendChild(o),o.click()})}(),t=await function(e){return new Promise((t,o)=>{if(!e.name.endsWith(".json"))return void o(new Error("Выберите файл с расширением .json"));const n=new FileReader;n.onload=e=>{try{const o=JSON.parse(e.target.result);t(o)}catch(e){o(new Error("Ошибка парсинга JSON: "+e.message))}},n.onerror=()=>{o(new Error("Ошибка чтения файла"))},n.readAsText(e)})}(e);let o=!1;const n=(0,s.reactive)({actions:{},assets:{},elements:{},slides:{},modules:{}});return fi.open({header:{value:"Импорт",handler:()=>{fi.close()}},content:{component:"Importer",props:{project:t},events:{options:e=>{o=e.merge},changelist:e=>{Object.keys(e).forEach(t=>{n[t]=e[t]})}}},footer:{buttons:[{label:"Импорт",class:"secondary",handler:async()=>{const e=`project${Date.now()}`;await Go.Init(e,["project","assets","elements","slides","actions","modules"],"uid"),await Go.addItems("actions",t.actions),await Go.addItems("assets",t.assets),await Go.addItems("elements",t.elements),await Go.addItems("slides",t.slides),await Go.addItems("modules",t.modules),await Go.addItems("project",t.project);const o=new URL(window.location.href);o.searchParams.set("project",e),window.location.href=o.toString(),fi.close()}},{label:"Отмена",class:"primary",handler:async()=>{fi.close()}}]}}),t}catch(e){throw console.error("Ошибка:",e.message),e}},load:async function(){},player:null,list:[]}),Up=Fp,zp=(0,s.reactive)({uid:"",selected:null,Control:Ut,slide:{},select(e){if(!e)return zp.selected=null,zp.uid=null,void Ut.Select(null);e.nonSelect||(zp.selected=e,zp.uid=e.uid),e.isObject3D&&Ut.Select(e)}}),Hp=zp,qp=so.default.default||so.default,Gp=new class{#e=null;get handle(){return this.#e}async requestAccess(){this.#e=await window.showDirectoryPicker({mode:"readwrite"}),await Go.upsertItemProperties("project","storage",{handle:this.#e})}updateHandle(e){this.#e=e}async writeFile(e,t){this.#t();const o=await this.#e.getFileHandle(e,{create:!0}),n=await o.createWritable();await n.write(t),await n.close()}async readFile(e){this.#t();const t=await this.#e.getFileHandle(e),o=await t.getFile();return await o.text()}async listFiles(){this.#t();const e=[];for await(const[t,o]of this.#e.entries())"file"===o.kind&&e.push(t);return e}#t(){if(!this.#e)throw new Error("Folder access not granted")}};let Wp;const Kp=(0,s.reactive)({getHandle:()=>Gp.handle,init:async function(){const e=await Go.getItem("project","storage");if(e)Gp.updateHandle(e.handle);else{const e=(0,s.reactive)({title:"Укажите папку для хранения моделей",text:"",answer:"",template:""}),t=(0,s.reactive)({label:"ОК",class:"primary",callback:async e=>{await Gp.requestAccess(),Wp&&Wp()}});qp.modal.confirmReq(e,[t])}},requestAccess:Gp.requestAccess.bind(Gp),writeFile:Gp.writeFile.bind(Gp),readFile:Gp.readFile.bind(Gp),listFiles:Gp.listFiles.bind(Gp),access:()=>new Promise(e=>{Wp=e})}),Jp={class:"itemElement"},Yp={class:"itemrow"},Xp={class:"itemrow"},Qp={class:"itemrow"},Zp={props:{item:{type:Object}}},eu=(0,C.A)(Zp,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",Jp,[(0,s.createElementVNode)("div",Yp,(0,s.toDisplayString)(o.item.title),1),(0,s.createElementVNode)("div",Xp,(0,s.toDisplayString)(o.item.price),1),(0,s.createElementVNode)("div",Qp,(0,s.toDisplayString)(o.item.autor?.name),1)])}]]),tu={class:"product-card"},ou={class:"product-title"},nu={key:0,class:"card-section"},au={class:"card-value"},su={class:"card-section"},ru={class:"card-image"},lu=["src","alt"],iu={class:"card-section"},cu={key:0,class:"carousel"},du={class:"carousel-container"},pu=["src","onClick","alt"],uu={class:"card-section"},mu={class:"card-value"},hu=["href"],fu={key:1,class:"card-section"},vu={class:"card-value"},gu=(0,s.defineComponent)({name:"ProductCard",props:{selected:{type:Object,required:!0,validator:e=>!0}},computed:{data(){return this.selected}},data:()=>({img:0}),setup:e=>({formattedPrice:(0,s.computed)(()=>void 0===e.selected.price||null===e.selected.price?"Цена не указана":new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e.selected.price))}),methods:{onImageClick(e){this.img=e}}}),yu=(0,C.A)(gu,[["render",function(e,t,o,n,a,r){return(0,s.openBlock)(),(0,s.createElementBlock)("div",tu,[(0,s.createCommentVNode)(" Заголовок "),(0,s.createElementVNode)("h2",ou,(0,s.toDisplayString)(e.data.title),1),e.data.description?((0,s.openBlock)(),(0,s.createElementBlock)("div",nu,[(0,s.createElementVNode)("span",au,(0,s.toDisplayString)(e.data.description),1)])):(0,s.createCommentVNode)("v-if",!0),(0,s.createCommentVNode)(" Основное изображение "),(0,s.createElementVNode)("div",su,[(0,s.createElementVNode)("div",ru,[e.data.images&&e.data.images.length?((0,s.openBlock)(),(0,s.createElementBlock)("img",{key:0,src:e.data.images[e.img],alt:e.data.title,class:"image-preview"},null,8,lu)):(0,s.createCommentVNode)("v-if",!0)])]),(0,s.createCommentVNode)(" Карусель изображений "),(0,s.createElementVNode)("div",iu,[e.data.images&&e.data.images.length?((0,s.openBlock)(),(0,s.createElementBlock)("div",cu,[(0,s.createElementVNode)("div",du,[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(e.data.images,(t,o)=>((0,s.openBlock)(),(0,s.createElementBlock)("div",{key:o,class:"carousel-item"},[(0,s.createElementVNode)("img",{src:t,onClick:t=>e.onImageClick(o),alt:`${e.data.title} - изображение ${o+1}`,class:"carousel-image"},null,8,pu)]))),128))])])):(0,s.createCommentVNode)("v-if",!0)]),(0,s.createElementVNode)("div",uu,[t[0]||(t[0]=(0,s.createElementVNode)("span",{class:"card-label"},null,-1)),(0,s.createElementVNode)("span",mu,[(0,s.createElementVNode)("a",{href:"../player?src=url&url="+e.data.url,target:"_blank"},"Preview",8,hu)])]),(0,s.createCommentVNode)(" Цена "),(0,s.createCommentVNode)(' <div class="card-section">\n            <span class="card-label">Price:</span>\n            <span class="card-value">{{ formattedPrice }}</span>\n        </div> '),(0,s.createCommentVNode)(" Автор "),e.data.autor?((0,s.openBlock)(),(0,s.createElementBlock)("div",fu,[t[1]||(t[1]=(0,s.createElementVNode)("span",{class:"card-label"},"Autor:",-1)),(0,s.createElementVNode)("span",vu,(0,s.toDisplayString)(e.data.autor.name),1)])):(0,s.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-73ea6e84"]]),bu=so.default.default||so.default;async function ku(){const[e,t]=await Promise.all([fetch("https://s3.eu-west-1.amazonaws.com/3dbuilder.reneos.com/templates/index.json",{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},cache:"no-store"}).then(e=>e.json()),bu.app.GetDB().getAllItems("templates")]);return[...e,...t]}const wu=(0,s.reactive)({loadList:ku});bu.On("init",()=>{window.vue.component("TemplateItem",eu),window.vue.component("TemplateView",yu),bu.menu.add([{path:"app.libraries.templates",icon:"codepen",text:"Templates",handler:async()=>{!async function(){const e=(0,s.reactive)({selected:null,list:[],busy:!0}),t={label:"Close",class:"secondary",handler:async()=>{e.selected=null,bu.modal.close()}},o={label:"Use",class:"additional",hidden:(0,s.computed)(()=>!e.selected),handler:async()=>{const t=await fetch(e.selected.url,{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},cache:"no-store"}),o=await t.json(),n=await bu.projects.createProject(o);bu.projects.goto(n)}},n=(0,s.reactive)([o,t]);bu.modal.open({header:{value:"Templates",handler:()=>{bu.modal.close()}},content:{component:"ItemsLib",props:e,events:{selected:async t=>{e.selected=t},open:async()=>{e.list.length=0,e.busy=!0;try{const t=await ku();e.list.push(...t)}catch(e){}e.busy=!1}},slots:{item:{component:"TemplateItem"},edit:{component:"TemplateView",props:{data:e.selected},events:{"change:type":t=>{const o=wu.library.find(e=>e.component===t);e.selected={...o.template,type:o.component,group:o.type,description:o.description}},edit:(t,o)=>{const n=t.split(".");let a=e.selected;for(let e=0;e<n.length-1;e++){const t=n[e];a[t]||(a[t]={}),a=a[t]}a[n[n.length-1]]=o,save(e.selected)}}}}},footer:{buttons:n}})}()}}])});const Eu=wu,{setLanguage:_u,setTranslations:Su,getCurrentLanguage:Nu,updateTranslations:Vu}=(so.default.default||so.default,Et.rk),Cu={ru:[],en:[]};async function Bu(e){const t=await fetch(`contents/${e}.json`),o=await t.json();Su(e,o);for(let t=0;t<Cu[e].length;t++){const o=await fetch(Cu[e][t]),n=await o.json();Vu(e,n)}_u(e),$u.lang=e}const $u=(0,s.reactive)({init:async function(e="en"){await Bu(e)},addTranslations:async function(e,t){if(Cu[e].push(t),e===Nu()){const o=await fetch(t),n=await o.json();Vu(e,n)}},change:Bu,languages:[{label:"English",value:"en"},{label:"Русский",value:"ru"}],lang:"en"}),xu=$u,Du=so.default.default||so.default,Iu={},Tu=(0,s.reactive)({elements:[],onElementMount(e){Iu[e.path]&&(Iu[e.path](e.element),delete Iu[e.path])},addElement(e,t){return console.log(e),new Promise((o,n)=>{if(!window.vue._context.components[e])return Du.toasts.add({message:`Component "${e}" is not registered`}),void n(new Error(`Component "${e}" is not registered`));const a=(0,s.reactive)(t.data),r={component:e,data:a,events:t.events};this.elements.push(r),Iu[t.data.path]=e=>{r.element=e,o({data:a,element:e})}})},removeElement(e){const t=this.elements.findIndex(t=>t.element===e);t>=0&&this.elements.splice(t,1)}});Du.On("init",()=>{Tu.elements.length=0});const Au=Tu,Mu=so.default.default||so.default;console.log=()=>{};const Ou=window.vue=(0,s.createApp)(Jo);Ou.use(e=>{e.config.globalProperties.$app=Mu.Init(a)}),Object.keys(n).forEach(e=>{Ou.component(e,n[e])}),Ou.provide("globalComponents",Ou._context.components),Ou.directive("tooltip",Et.dg),Ou.directive("translate",Et.rk.directive),Ou.mount("#app"),window.isEditor=!0},615:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Al:()=>getResourceUrl,Bb:()=>isDebugMode,Jn:()=>generateSnapshotFromManifest,ML:()=>safeToString,OL:()=>isBrowserEnv,R8:()=>warn,Tr:()=>isManifestProvider,d:()=>createLink,e4:()=>decodeName,h:()=>createLogger,k0:()=>loadScript,lG:()=>composeKeyWithSeparator,oe:()=>loadScriptNode,so:()=>createScript,tf:()=>isReactNativeEnv,yq:()=>ENCODE_NAME_PREFIX});const FederationModuleManifest="federation-manifest.json",MANIFEST_EXT=".json",BROWSER_LOG_KEY="FEDERATION_DEBUG",NameTransformSymbol={AT:"@",HYPHEN:"-",SLASH:"/"},NameTransformMap={[NameTransformSymbol.AT]:"scope_",[NameTransformSymbol.HYPHEN]:"_",[NameTransformSymbol.SLASH]:"__"},EncodedNameTransformMap={[NameTransformMap[NameTransformSymbol.AT]]:NameTransformSymbol.AT,[NameTransformMap[NameTransformSymbol.HYPHEN]]:NameTransformSymbol.HYPHEN,[NameTransformMap[NameTransformSymbol.SLASH]]:NameTransformSymbol.SLASH},SEPARATOR=":",ManifestFileName="mf-manifest.json",StatsFileName="mf-stats.json",MFModuleType={NPM:"npm",APP:"app"},MODULE_DEVTOOL_IDENTIFIER="__MF_DEVTOOLS_MODULE_INFO__",ENCODE_NAME_PREFIX="ENCODE_NAME_PREFIX",TEMP_DIR=".federation",MFPrefetchCommon={identifier:"MFDataPrefetch",globalKey:"__PREFETCH__",library:"mf-data-prefetch",exportsKey:"__PREFETCH_EXPORTS__",fileName:"bootstrap.js"};var ContainerPlugin=Object.freeze({__proto__:null}),ContainerReferencePlugin=Object.freeze({__proto__:null}),ModuleFederationPlugin=Object.freeze({__proto__:null}),SharePlugin=Object.freeze({__proto__:null});function isBrowserEnv(){return"undefined"!=typeof window&&void 0!==window.document}function isReactNativeEnv(){return"undefined"!=typeof navigator&&"ReactNative"===navigator?.product}function isBrowserDebug(){try{if(isBrowserEnv()&&window.localStorage)return Boolean(localStorage.getItem(BROWSER_LOG_KEY))}catch(e){return!1}return!1}function isDebugMode(){return"undefined"!=typeof process&&process.env&&process.env.FEDERATION_DEBUG?Boolean(process.env.FEDERATION_DEBUG):!("undefined"==typeof FEDERATION_DEBUG||!Boolean(FEDERATION_DEBUG))||isBrowserDebug()}const getProcessEnv=function(){return"undefined"!=typeof process&&process.env?process.env:{}},LOG_CATEGORY="[ Federation Runtime ]",parseEntry=(e,t,o=SEPARATOR)=>{const n=e.split(o),a="development"===getProcessEnv().NODE_ENV&&t,s=e=>e.startsWith("http")||e.includes(MANIFEST_EXT);if(n.length>=2){let[t,...r]=n;e.startsWith(o)&&(t=n.slice(0,2).join(o),r=[a||n.slice(2).join(o)]);let l=a||r.join(o);return s(l)?{name:t,entry:l}:{name:t,version:l||"*"}}if(1===n.length){const[e]=n;return a&&s(a)?{name:e,entry:a}:{name:e,version:a||"*"}}throw`Invalid entry value: ${e}`},composeKeyWithSeparator=function(...e){return e.length?e.reduce((e,t)=>t?e?`${e}${SEPARATOR}${t}`:t:e,""):""},encodeName=function(e,t="",o=!1){try{const n=o?".js":"";return`${t}${e.replace(new RegExp(`${NameTransformSymbol.AT}`,"g"),NameTransformMap[NameTransformSymbol.AT]).replace(new RegExp(`${NameTransformSymbol.HYPHEN}`,"g"),NameTransformMap[NameTransformSymbol.HYPHEN]).replace(new RegExp(`${NameTransformSymbol.SLASH}`,"g"),NameTransformMap[NameTransformSymbol.SLASH])}${n}`}catch(e){throw e}},decodeName=function(e,t,o){try{let n=e;if(t){if(!n.startsWith(t))return n;n=n.replace(new RegExp(t,"g"),"")}return n=n.replace(new RegExp(`${NameTransformMap[NameTransformSymbol.AT]}`,"g"),EncodedNameTransformMap[NameTransformMap[NameTransformSymbol.AT]]).replace(new RegExp(`${NameTransformMap[NameTransformSymbol.SLASH]}`,"g"),EncodedNameTransformMap[NameTransformMap[NameTransformSymbol.SLASH]]).replace(new RegExp(`${NameTransformMap[NameTransformSymbol.HYPHEN]}`,"g"),EncodedNameTransformMap[NameTransformMap[NameTransformSymbol.HYPHEN]]),o&&(n=n.replace(".js","")),n}catch(e){throw e}},generateExposeFilename=(e,t)=>{if(!e)return"";let o=e;return"."===o&&(o="default_export"),o.startsWith("./")&&(o=o.replace("./","")),encodeName(o,"__federation_expose_",t)},generateShareFilename=(e,t)=>e?encodeName(e,"__federation_shared_",t):"",getResourceUrl=(e,t)=>{if("getPublicPath"in e){let o;return o=e.getPublicPath.startsWith("function")?new Function("return "+e.getPublicPath)()():new Function(e.getPublicPath)(),`${o}${t}`}return"publicPath"in e?isBrowserEnv()||isReactNativeEnv()||!("ssrPublicPath"in e)?`${e.publicPath}${t}`:`${e.ssrPublicPath}${t}`:(console.warn("Cannot get resource URL. If in debug mode, please ignore.",e,t),"")},assert=(e,t)=>{e||error(t)},error=e=>{throw new Error(`${LOG_CATEGORY}: ${e}`)},warn=e=>{console.warn(`${LOG_CATEGORY}: ${e}`)};function safeToString(e){try{return JSON.stringify(e,null,2)}catch(e){return""}}const VERSION_PATTERN_REGEXP=/^([\d^=v<>~]|[*xX]$)/;function isRequiredVersion(e){return VERSION_PATTERN_REGEXP.test(e)}const simpleJoinRemoteEntry=(e,t)=>{if(!e)return t;const o=(e=>{if("."===e)return"";if(e.startsWith("./"))return e.replace("./","");if(e.startsWith("/")){const t=e.slice(1);return t.endsWith("/")?t.slice(0,-1):t}return e})(e);return o?o.endsWith("/")?`${o}${t}`:`${o}/${t}`:t};function inferAutoPublicPath(e){return e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/")}function generateSnapshotFromManifest(e,t={}){const{remotes:o={},overrides:n={},version:a}=t;let s;const r=()=>"publicPath"in e.metaData?"auto"===e.metaData.publicPath&&a?inferAutoPublicPath(a):e.metaData.publicPath:e.metaData.getPublicPath,l=Object.keys(n);let i={};Object.keys(o).length||(i=e.remotes?.reduce((e,t)=>{let o;const a=t.federationContainerName;return o=l.includes(a)?n[a]:"version"in t?t.version:t.entry,e[a]={matchedVersion:o},e},{})||{}),Object.keys(o).forEach(e=>i[e]={matchedVersion:l.includes(e)?n[e]:o[e]});const{remoteEntry:{path:c,name:d,type:p},types:u,buildInfo:{buildVersion:m},globalName:h,ssrRemoteEntry:f}=e.metaData,{exposes:v}=e;let g={version:a||"",buildVersion:m,globalName:h,remoteEntry:simpleJoinRemoteEntry(c,d),remoteEntryType:p,remoteTypes:simpleJoinRemoteEntry(u.path,u.name),remoteTypesZip:u.zip||"",remoteTypesAPI:u.api||"",remotesInfo:i,shared:e?.shared.map(e=>({assets:e.assets,sharedName:e.name,version:e.version})),modules:v?.map(e=>({moduleName:e.name,modulePath:e.path,assets:e.assets}))};if(e.metaData?.prefetchInterface){const t=e.metaData.prefetchInterface;g={...g,prefetchInterface:t}}if(e.metaData?.prefetchEntry){const{path:t,name:o,type:n}=e.metaData.prefetchEntry;g={...g,prefetchEntry:simpleJoinRemoteEntry(t,o),prefetchEntryType:n}}if(s="publicPath"in e.metaData?{...g,publicPath:r(),ssrPublicPath:e.metaData.ssrPublicPath}:{...g,getPublicPath:r()},f){const e=simpleJoinRemoteEntry(f.path,f.name);s.ssrRemoteEntry=e,s.ssrRemoteEntryType=f.type||"commonjs-module"}return s}function isManifestProvider(e){return!(!("remoteEntry"in e)||!e.remoteEntry.includes(MANIFEST_EXT))}const PREFIX="[ Module Federation ]",DEFAULT_DELEGATE=console,LOGGER_STACK_SKIP_TOKENS=["logger.ts","logger.js","captureStackTrace","Logger.emit","Logger.log","Logger.info","Logger.warn","Logger.error","Logger.debug"];function captureStackTrace(){try{const e=(new Error).stack;if(!e)return;const[,...t]=e.split("\n"),o=t.filter(e=>!LOGGER_STACK_SKIP_TOKENS.some(t=>e.includes(t)));if(!o.length)return;return`Stack trace:\n${o.slice(0,5).join("\n")}`}catch{return}}class Logger{constructor(e,t=DEFAULT_DELEGATE){this.prefix=e,this.delegate=t??DEFAULT_DELEGATE}setPrefix(e){this.prefix=e}setDelegate(e){this.delegate=e??DEFAULT_DELEGATE}emit(e,t){const o=this.delegate,n=isDebugMode()?captureStackTrace():void 0,a=n?[...t,n]:t,s=(()=>{switch(e){case"log":return["log","info"];case"info":return["info","log"];case"warn":return["warn","info","log"];case"error":return["error","warn","log"];default:return["debug","log"]}})();for(const e of s){const t=o[e];if("function"==typeof t)return void t.call(o,this.prefix,...a)}for(const e of s){const t=DEFAULT_DELEGATE[e];if("function"==typeof t)return void t.call(DEFAULT_DELEGATE,this.prefix,...a)}}log(...e){this.emit("log",e)}warn(...e){this.emit("warn",e)}error(...e){this.emit("error",e)}success(...e){this.emit("info",e)}info(...e){this.emit("info",e)}ready(...e){this.emit("info",e)}debug(...e){isDebugMode()&&this.emit("debug",e)}}function createLogger(e){return new Logger(e)}function createInfrastructureLogger(e){const t=new Logger(e);return Object.defineProperty(t,"__mf_infrastructure_logger__",{value:!0,enumerable:!1,configurable:!1}),t}function bindLoggerToCompiler(e,t,o){if(e.__mf_infrastructure_logger__&&t?.getInfrastructureLogger)try{const n=t.getInfrastructureLogger(o);!n||"object"!=typeof n||"function"!=typeof n.log&&"function"!=typeof n.info&&"function"!=typeof n.warn&&"function"!=typeof n.error||e.setDelegate(n)}catch{e.setDelegate(void 0)}}const logger=createLogger(PREFIX),infrastructureLogger=createInfrastructureLogger(PREFIX);async function safeWrapper(e,t){try{return await e()}catch(e){return void(!t&&warn(e))}}function isStaticResourcesEqual(e,t){const o=/^(https?:)?\/\//i;return e.replace(o,"").replace(/\/$/,"")===t.replace(o,"").replace(/\/$/,"")}function createScript(e){let t,o=null,n=!0,a=2e4;const s=document.getElementsByTagName("script");for(let t=0;t<s.length;t++){const a=s[t],r=a.getAttribute("src");if(r&&isStaticResourcesEqual(r,e.url)){o=a,n=!1;break}}if(!o){const t=e.attrs;let n;o=document.createElement("script"),o.type="module"===t?.type?"module":"text/javascript",e.createScriptHook&&(n=e.createScriptHook(e.url,e.attrs),n instanceof HTMLScriptElement?o=n:"object"==typeof n&&("script"in n&&n.script&&(o=n.script),"timeout"in n&&n.timeout&&(a=n.timeout))),o.src||(o.src=e.url),t&&!n&&Object.keys(t).forEach(e=>{o&&("async"===e||"defer"===e?o[e]=t[e]:o.getAttribute(e)||o.setAttribute(e,t[e]))})}const r=async(n,a)=>{clearTimeout(t);const s=()=>{"error"===a?.type?e?.onErrorCallback&&e?.onErrorCallback(a):e?.cb&&e?.cb()};if(o&&(o.onerror=null,o.onload=null,safeWrapper(()=>{const{needDeleteScript:t=!0}=e;t&&o?.parentNode&&o.parentNode.removeChild(o)}),n&&"function"==typeof n)){const e=n(a);if(e instanceof Promise){const t=await e;return s(),t}return s(),e}s()};return o.onerror=r.bind(null,o.onerror),o.onload=r.bind(null,o.onload),t=setTimeout(()=>{r(null,new Error(`Remote script "${e.url}" time-outed.`))},a),{script:o,needAttach:n}}function createLink(e){let t=null,o=!0;const n=document.getElementsByTagName("link");for(let a=0;a<n.length;a++){const s=n[a],r=s.getAttribute("href"),l=s.getAttribute("rel");if(r&&isStaticResourcesEqual(r,e.url)&&l===e.attrs.rel){t=s,o=!1;break}}if(!t){let o;t=document.createElement("link"),t.setAttribute("href",e.url);const n=e.attrs;e.createLinkHook&&(o=e.createLinkHook(e.url,n),o instanceof HTMLLinkElement&&(t=o)),n&&!o&&Object.keys(n).forEach(e=>{t&&!t.getAttribute(e)&&t.setAttribute(e,n[e])})}const a=(o,n)=>{const a=()=>{"error"===n?.type?e?.onErrorCallback&&e?.onErrorCallback(n):e?.cb&&e?.cb()};if(t&&(t.onerror=null,t.onload=null,safeWrapper(()=>{const{needDeleteLink:o=!0}=e;o&&t?.parentNode&&t.parentNode.removeChild(t)}),o)){const e=o(n);return a(),e}a()};return t.onerror=a.bind(null,t.onerror),t.onload=a.bind(null,t.onload),{link:t,needAttach:o}}function loadScript(e,t){const{attrs:o={},createScriptHook:n}=t;return new Promise((t,a)=>{const{script:s,needAttach:r}=createScript({url:e,cb:t,onErrorCallback:a,attrs:{fetchpriority:"high",...o},createScriptHook:n,needDeleteScript:!0});r&&document.head.appendChild(s)})}const sdkImportCache=new Map;function importNodeModule(e){if(!e)throw new Error("import specifier is required");if(sdkImportCache.has(e))return sdkImportCache.get(e);const t=new Function("name","return import(name)")(e).then(e=>e).catch(t=>{throw console.error(`Error importing module ${e}:`,t),sdkImportCache.delete(e),t});return sdkImportCache.set(e,t),t}const loadNodeFetch=async()=>{const e=await importNodeModule("node-fetch");return e.default||e},lazyLoaderHookFetch=async(e,t,o)=>{const n=await((e,t)=>o.lifecycle.fetch.emit(e,t))(e,t||{});return n&&n instanceof Response?n:("undefined"==typeof fetch?await loadNodeFetch():fetch)(e,t||{})},createScriptNode="undefined"==typeof ENV_TARGET||"web"!==ENV_TARGET?(url,cb,attrs,loaderHook)=>{if(loaderHook?.createScriptHook){const e=loaderHook.createScriptHook(url);e&&"object"==typeof e&&"url"in e&&(url=e.url)}let urlObj;try{urlObj=new URL(url)}catch(e){return console.error("Error constructing URL:",e),void cb(new Error(`Invalid URL: ${e}`))}const getFetch=async()=>loaderHook?.fetch?(e,t)=>lazyLoaderHookFetch(e,t,loaderHook):"undefined"==typeof fetch?loadNodeFetch():fetch,handleScriptFetch=async(f,urlObj)=>{try{const res=await f(urlObj.href),data=await res.text(),[path,vm]=await Promise.all([importNodeModule("path"),importNodeModule("vm")]),scriptContext={exports:{},module:{exports:{}}},urlDirname=urlObj.pathname.split("/").slice(0,-1).join("/"),filename=path.basename(urlObj.pathname),script=new vm.Script(`(function(exports, module, require, __dirname, __filename) {${data}\n})`,{filename,importModuleDynamically:vm.constants?.USE_MAIN_CONTEXT_DEFAULT_LOADER??importNodeModule});script.runInThisContext()(scriptContext.exports,scriptContext.module,eval("require"),urlDirname,filename);const exportedInterface=scriptContext.module.exports||scriptContext.exports;if(attrs&&exportedInterface&&attrs.globalName){const e=exportedInterface[attrs.globalName]||exportedInterface;return void cb(void 0,e)}cb(void 0,exportedInterface)}catch(e){cb(e instanceof Error?e:new Error(`Script execution error: ${e}`))}};getFetch().then(async e=>{if("esm"===attrs?.type||"module"===attrs?.type)return loadModule(urlObj.href,{fetch:e,vm:await importNodeModule("vm")}).then(async e=>{await e.evaluate(),cb(void 0,e.namespace)}).catch(e=>{cb(e instanceof Error?e:new Error(`Script execution error: ${e}`))});handleScriptFetch(e,urlObj)}).catch(e=>{cb(e)})}:(e,t,o,n)=>{t(new Error("createScriptNode is disabled in non-Node.js environment"))},loadScriptNode="undefined"==typeof ENV_TARGET||"web"!==ENV_TARGET?(e,t)=>new Promise((o,n)=>{createScriptNode(e,(e,a)=>{if(e)n(e);else{const e=globalThis[t?.attrs?.globalName||`__FEDERATION_${t?.attrs?.name}:custom__`]=a;o(e)}},t.attrs,t.loaderHook)}):(e,t)=>{throw new Error("loadScriptNode is disabled in non-Node.js environment")},esmModuleCache=new Map;async function loadModule(e,t){if(esmModuleCache.has(e))return esmModuleCache.get(e);const{fetch:o,vm:n}=t,a=await o(e),s=await a.text(),r=new n.SourceTextModule(s,{importModuleDynamically:async(o,n)=>loadModule(new URL(o,e).href,t)});return esmModuleCache.set(e,r),await r.link(async o=>{const n=new URL(o,e).href;return await loadModule(n,t)}),r}function normalizeOptions(e,t,o){return function(n){if(!1===n)return!1;if(void 0===n)return!!e&&t;if(!0===n)return t;if(n&&"object"==typeof n)return{...t,...n};throw new Error(`Unexpected type for \`${o}\`, expect boolean/undefined/object, got: ${typeof n}`)}}const createModuleFederationConfig=e=>e},651:(e,t,o)=>{var n=o(828);const a=["script"];var s=o(615);function r(e){e.S&&!e.federation.hasAttachShareScopeMap&&e.federation.instance&&e.federation.instance.shareScopeMap&&(e.S=e.federation.instance.shareScopeMap,e.federation.hasAttachShareScopeMap=!0)}function l(e){const{webpackRequire:t,moduleToHandlerMapping:o}=e,{consumesLoadingData:n,initializeSharingData:a}=t;if(n&&!n._updated){const{moduleIdToConsumeDataMapping:t={},initialConsumes:a=[],chunkMapping:s={}}=n;if(Object.entries(t).forEach(([e,t])=>{o[e]||(o[e]={getter:t.fallback,shareInfo:{shareConfig:{requiredVersion:t.requiredVersion,strictVersion:t.strictVersion,singleton:t.singleton,eager:t.eager,layer:t.layer},scope:Array.isArray(t.shareScope)?t.shareScope:[t.shareScope||"default"]},shareKey:t.shareKey})}),"initialConsumes"in e){const{initialConsumes:t=[]}=e;a.forEach(e=>{t.includes(e)||t.push(e)})}if("chunkMapping"in e){const{chunkMapping:t={}}=e;Object.entries(s).forEach(([e,o])=>{t[e]||(t[e]=[]),o.forEach(o=>{t[e].includes(o)||t[e].push(o)})})}n._updated=1}if(a&&!a._updated){const{federation:e}=t;if(!e.instance||!a.scopeToSharingDataMapping)return;const o={};for(let[e,t]of Object.entries(a.scopeToSharingDataMapping))for(let n of t)if("object"==typeof n&&null!==n){const{name:t,version:a,factory:s,eager:r,singleton:l,requiredVersion:i,strictVersion:c}=n,d={requiredVersion:`^${a}`},p=function(e){return void 0!==e};p(l)&&(d.singleton=l),p(i)&&(d.requiredVersion=i),p(r)&&(d.eager=r),p(c)&&(d.strictVersion=c);const u={version:a,scope:[e],shareConfig:d,get:s};o[t]?o[t].push(u):o[t]=[u]}e.instance.registerShared(o),a._updated=1}}const i={runtime:n,instance:void 0,initOptions:void 0,bundlerRuntime:{remotes:function(e){!function(e){const{webpackRequire:t,idToExternalAndNameMapping:o={},idToRemoteMap:n={},chunkMapping:a={}}=e,{remotesLoadingData:s}=t,r=t.federation?.bundlerRuntimeOptions?.remotes?.remoteInfos;if(!s||s._updated||!r)return;const{chunkMapping:l,moduleIdToRemoteDataMapping:i}=s;if(l&&i){for(let[e,t]of Object.entries(i))if(o[e]||(o[e]=[t.shareScope,t.name,t.externalModuleId]),!n[e]&&r[t.remoteName]){const o=r[t.remoteName];n[e]||=[],o.forEach(t=>{n[e].includes(t)||n[e].push(t)})}a&&Object.entries(l).forEach(([e,t])=>{a[e]||(a[e]=[]),t.forEach(t=>{a[e].includes(t)||a[e].push(t)})}),s._updated=1}}(e);const{chunkId:t,promises:o,webpackRequire:n,chunkMapping:l,idToExternalAndNameMapping:i,idToRemoteMap:c}=e;r(n),n.o(l,t)&&l[t].forEach(e=>{let t=n.R;t||(t=[]);const r=i[e],l=c[e]||[];if(t.indexOf(r)>=0)return;if(t.push(r),r.p)return o.push(r.p);const d=t=>{t||(t=new Error("Container missing")),"string"==typeof t.message&&(t.message+=`\nwhile loading "${r[1]}" from ${r[2]}`),n.m[e]=()=>{throw t},r.p=0},p=(e,t,n,a,s,l)=>{try{const i=e(t,n);if(!i||!i.then)return s(i,a,l);{const e=i.then(e=>s(e,a),d);if(!l)return e;o.push(r.p=e)}}catch(e){d(e)}};var u=(e,o,n)=>p(o.get,r[1],t,0,m,n),m=t=>{r.p=1,n.m[e]=e=>{e.exports=t()}};1===l.length&&a.includes(l[0].externalType)&&l[0].name?p(()=>{try{const e=(0,s.e4)(l[0].name,s.yq)+r[1].slice(1),t=n.federation.instance,o=()=>n.federation.instance.loadRemote(e,{loadFactory:!1,from:"build"});return"version-first"===t.options.shareStrategy?Promise.all(t.sharedHandler.initializeSharing(r[0])).then(()=>o()):o()}catch(e){d(e)}},r[2],0,0,m,1):p(n,r[2],0,0,(e,t,o)=>e?p(n.I,r[0],0,e,u,o):d(),1)})},consumes:function(e){l(e);const{chunkId:t,promises:o,installedModules:n,webpackRequire:a,chunkMapping:s,moduleToHandlerMapping:i}=e;r(a),a.o(s,t)&&s[t].forEach(e=>{if(a.o(n,e))return o.push(n[e]);const t=t=>{n[e]=0,a.m[e]=o=>{delete a.c[e];const n=t(),{shareInfo:s}=i[e];if(s?.shareConfig?.layer&&n&&"object"==typeof n)try{n.hasOwnProperty("layer")&&void 0!==n.layer||(n.layer=s.shareConfig.layer)}catch(e){}o.exports=n}},s=t=>{delete n[e],a.m[e]=o=>{throw delete a.c[e],t}};try{const r=a.federation.instance;if(!r)throw new Error("Federation instance not found!");const{shareKey:l,getter:c,shareInfo:d}=i[e],p=r.loadShare(l,{customShareInfo:d}).then(e=>!1===e?c():e);p.then?o.push(n[e]=p.then(t).catch(s)):t(p)}catch(e){s(e)}})},I:function({shareScopeName:e,webpackRequire:t,initPromises:o,initTokens:n,initScope:s}){const l=Array.isArray(e)?e:[e];var i=[];return l.forEach(l=>{i.push(function(l){s||(s=[]);const i=t.federation.instance;var c=n[l];if(c||(c=n[l]={from:i.name}),s.indexOf(c)>=0)return;s.push(c);const d=o[l];if(d)return d;var p=o=>{var n=e=>{return t="Initialization of sharing external failed: "+e,"undefined"!=typeof console&&console.warn&&console.warn(t);var t};try{var a=t(o);if(!a)return;var r=o=>o&&o.init&&o.init(t.S[l],s,{shareScopeMap:t.S||{},shareScopeKeys:e});if(a.then)return u.push(a.then(r,n));var i=r(a);if(i&&"boolean"!=typeof i&&i.then)return u.push(i.catch(n))}catch(e){n(e)}};const u=i.initializeSharing(l,{strategy:i.options.shareStrategy,initScope:s,from:"build"});r(t);const m=t.federation.bundlerRuntimeOptions.remotes;return m&&Object.keys(m.idToRemoteMap).forEach(e=>{const t=m.idToRemoteMap[e],o=m.idToExternalAndNameMapping[e][2];if(t.length>1)p(o);else if(1===t.length){const e=t[0];a.includes(e.externalType)||p(o)}}),u.length?o[l]=Promise.all(u).then(()=>o[l]=!0):o[l]=!0}(l))}),Promise.all(i).then(()=>!0)},S:{},installInitialConsumes:function(e){const{webpackRequire:t}=e;l(e);const{initialConsumes:o,moduleToHandlerMapping:n,installedModules:a}=e;o.forEach(e=>{t.m[e]=o=>{a[e]=0,delete t.c[e];const s=function(e){const{moduleId:t,moduleToHandlerMapping:o,webpackRequire:n}=e,a=n.federation.instance;if(!a)throw new Error("Federation instance not found!");const{shareKey:s,shareInfo:r}=o[t];try{return a.loadShareSync(s,{customShareInfo:r})}catch(e){throw console.error('loadShareSync failed! The function should not be called unless you set "eager:true". If you do not set it, and encounter this issue, you can check whether an async boundary is implemented.'),console.error("The original error message is as follows: "),e}}({moduleId:e,moduleToHandlerMapping:n,webpackRequire:t});if("function"!=typeof s)throw new Error(`Shared module is not available for eager consumption: ${e}`);const r=s(),{shareInfo:l}=n[e];if(l?.shareConfig?.layer&&r&&"object"==typeof r)try{r.hasOwnProperty("layer")&&void 0!==r.layer||(r.layer=l.shareConfig.layer)}catch(e){}o.exports=r}})},initContainerEntry:function(e){const{webpackRequire:t,shareScope:o,initScope:n,shareScopeKey:a,remoteEntryInitOptions:s}=e;if(!t.S)return;if(!t.federation||!t.federation.instance||!t.federation.initOptions)return;const r=t.federation.instance;r.initOptions({name:t.federation.initOptions.name,remotes:[],...s});const l=s?.shareScopeKeys,i=s?.shareScopeMap;if(a&&"string"!=typeof a)a.forEach(e=>{if(!l||!i)return void r.initShareScopeMap(e,o,{hostShareScopeMap:s?.shareScopeMap||{}});i[e]||(i[e]={});const t=i[e];r.initShareScopeMap(e,t,{hostShareScopeMap:s?.shareScopeMap||{}})});else{const e=a||"default";Array.isArray(l)?l.forEach(e=>{i[e]||(i[e]={});const t=i[e];r.initShareScopeMap(e,t,{hostShareScopeMap:s?.shareScopeMap||{}})}):r.initShareScopeMap(e,o,{hostShareScopeMap:s?.shareScopeMap||{}})}return t.federation.attachShareScopeMap&&t.federation.attachShareScopeMap(t),"function"==typeof t.federation.prefetch&&t.federation.prefetch(),Array.isArray(a)?Boolean(t.federation.initOptions.shared)?t.I(a,n):Promise.all(a.map(e=>t.I(e,n))).then(()=>!0):t.I(a||"default",n)}},attachShareScopeMap:r,bundlerRuntimeOptions:{}};if(!o.federation.runtime){var c=o.federation;for(var d in o.federation={},i)o.federation[d]=i[d];for(var d in c)o.federation[d]=c[d]}o.federation.instance||(o.federation.instance=o.federation.runtime.init(o.federation.initOptions),o.federation.attachShareScopeMap&&o.federation.attachShareScopeMap(o),o.federation.installInitialConsumes&&o.federation.installInitialConsumes(),!o.federation.isMFRemote&&o.federation.prefetch&&o.federation.prefetch())},828:(e,t,o)=>{o.r(t),o.d(t,{Module:()=>Je,ModuleFederation:()=>pt,createInstance:()=>ut,getInstance:()=>wt,getRemoteEntry:()=>qe,getRemoteInfo:()=>Ge,init:()=>ht,loadRemote:()=>ft,loadScript:()=>n.k0,loadScriptNode:()=>n.oe,loadShare:()=>vt,loadShareSync:()=>gt,preloadRemote:()=>yt,registerGlobalPlugins:()=>L,registerPlugins:()=>kt,registerRemotes:()=>bt,registerShared:()=>Et});var n=o(615);const a="RUNTIME-001",s="RUNTIME-002",r="RUNTIME-003",l="RUNTIME-004",i="RUNTIME-005",c="RUNTIME-006",d="RUNTIME-007",p="RUNTIME-008",u="RUNTIME-009",m=(e,t,o,n)=>{const a=[`${[t[e]]} #${e}`];return o&&a.push(`args: ${JSON.stringify(o)}`),a.push((e=>`View the docs to see how to solve: https://module-federation.io/guide/troubleshooting/${e.split("-")[0].toLowerCase()}/${e}`)(e)),n&&a.push(`Original Error Message:\n ${n}`),a.join("\n")},h={[a]:"Failed to get remoteEntry exports.",[s]:'The remote entry interface does not contain "init"',[r]:"Failed to get manifest.",[l]:"Failed to locate remote.",[i]:"Invalid loadShareSync function call from bundler runtime",[c]:"Invalid loadShareSync function call from runtime",[d]:"Failed to get remote snapshot.",[p]:"Failed to load script resources.",[u]:"Please call createInstance first."},f="[ Federation Runtime ]",v=(0,n.h)(f);function g(e,t){e||y(t)}function y(e){if(e instanceof Error)throw e.message.startsWith(f)||(e.message=`${f}: ${e.message}`),e;throw new Error(`${f}: ${e}`)}function b(e){e instanceof Error?(e.message.startsWith(f)||(e.message=`${f}: ${e.message}`),v.warn(e)):v.warn(e)}function k(e,t){return-1===e.findIndex(e=>e===t)&&e.push(t),e}function w(e){return"version"in e&&e.version?`${e.name}:${e.version}`:"entry"in e&&e.entry?`${e.name}:${e.entry}`:`${e.name}`}function E(e){return void 0!==e.entry}function _(e){return!e.entry.includes(".json")}function S(e){return e&&"object"==typeof e}const N=Object.prototype.toString;function V(e){return Array.isArray(e)?e:[e]}function C(e){const t={url:"",type:"global",globalName:""};return(0,n.OL)()||(0,n.tf)()?"remoteEntry"in e?{url:e.remoteEntry,type:e.remoteEntryType,globalName:e.globalName}:t:"ssrRemoteEntry"in e?{url:e.ssrRemoteEntry||t.url,type:e.ssrRemoteEntryType||t.type,globalName:e.globalName}:t}const B="object"==typeof globalThis?globalThis:window,$=(()=>{try{return document.defaultView}catch{return B}})(),x=$;function D(e,t,o){Object.defineProperty(e,t,{value:o,configurable:!1,writable:!0})}function I(e,t){return Object.hasOwnProperty.call(e,t)}I(B,"__GLOBAL_LOADING_REMOTE_ENTRY__")||D(B,"__GLOBAL_LOADING_REMOTE_ENTRY__",{});const T=B.__GLOBAL_LOADING_REMOTE_ENTRY__;function A(e){I(e,"__VMOK__")&&!I(e,"__FEDERATION__")&&D(e,"__FEDERATION__",e.__VMOK__),I(e,"__FEDERATION__")||(D(e,"__FEDERATION__",{__GLOBAL_PLUGIN__:[],__INSTANCES__:[],moduleInfo:{},__SHARE__:{},__MANIFEST_LOADING__:{},__PRELOADED_MAP__:new Map}),D(e,"__VMOK__",e.__FEDERATION__)),e.__FEDERATION__.__GLOBAL_PLUGIN__??=[],e.__FEDERATION__.__INSTANCES__??=[],e.__FEDERATION__.moduleInfo??={},e.__FEDERATION__.__SHARE__??={},e.__FEDERATION__.__MANIFEST_LOADING__??={},e.__FEDERATION__.__PRELOADED_MAP__??=new Map}function M(e,t){if("string"==typeof t){if(e[t])return{value:e[t],key:t};{const o=Object.keys(e);for(const n of o){const[o,a]=n.split(":"),s=`${o}:${t}`,r=e[s];if(r)return{value:r,key:s}}return{value:void 0,key:t}}}throw new Error("key must be string")}A(B),A($);const O=()=>$.__FEDERATION__.moduleInfo,j=e=>((e,t)=>{const o=M(t,w(e)).value;if(o&&!o.version&&"version"in e&&e.version&&(o.version=e.version),o)return o;if("version"in e&&e.version){const{version:t,...o}=e,n=w(o),a=M($.__FEDERATION__.moduleInfo,n).value;if(a?.version===t)return a}})(e,$.__FEDERATION__.moduleInfo),P=(e,t)=>{const o=w(e);return $.__FEDERATION__.moduleInfo[o]=t,$.__FEDERATION__.moduleInfo},R=(e,t)=>{const o=t||`__FEDERATION_${e}:custom__`;return{remoteEntryKey:o,entryExports:B[o]}},L=e=>{const{__GLOBAL_PLUGIN__:t}=$.__FEDERATION__;e.forEach(e=>{-1===t.findIndex(t=>t.name===e.name)?t.push(e):b(`The plugin ${e.name} has been registered.`)})},F=e=>B.__FEDERATION__.__PRELOADED_MAP__.get(e),U=e=>B.__FEDERATION__.__PRELOADED_MAP__.set(e,!0),z="default",H="global",q="[0-9A-Za-z-]+",G=`(?:\\+(${q}(?:\\.${q})*))`,W="0|[1-9]\\d*",K="[0-9]+",J="\\d*[a-zA-Z-][a-zA-Z0-9-]*",Y=`(?:${K}|${J})`,X=`(?:${W}|${J})`,Q=`(?:-(${X}(?:\\.${X})*))`,Z=`${W}|x|X|\\*`,ee=`[v=\\s]*(${Z})(?:\\.(${Z})(?:\\.(${Z})(?:${Q})?${G}?)?)?`,te=`^\\s*(${ee})\\s+-\\s+(${ee})\\s*$`,oe="((?:<|>)?=?)",ne=`(\\s*)${oe}\\s*([v=\\s]*(${K})\\.(${K})\\.(${K})(?:-?(${Y}(?:\\.${Y})*))?${G}?|${ee})`,ae="(?:~>?)",se=`(\\s*)${ae}\\s+`,re="(?:\\^)",le=`(\\s*)${re}\\s+`,ie=`^${re}${ee}$`,ce=`^${ae}${ee}$`,de=`^${oe}\\s*${ee}$`,pe=`^${oe}\\s*(v?(${W})\\.(${W})\\.(${W})${Q}?${G}?)$|^$`;function ue(e){return new RegExp(e)}function me(e){return!e||"x"===e.toLowerCase()||"*"===e}function he(...e){return t=>e.reduce((e,t)=>t(e),t)}function fe(e){return e.match(ue(pe))}function ve(e,t,o,n){const a=`${e}.${t}.${o}`;return n?`${a}-${n}`:a}function ge(e){return e.replace(ue(te),(e,t,o,n,a,s,r,l,i,c,d,p)=>`${t=me(o)?"":me(n)?`>=${o}.0.0`:me(a)?`>=${o}.${n}.0`:`>=${t}`} ${l=me(i)?"":me(c)?`<${Number(i)+1}.0.0-0`:me(d)?`<${i}.${Number(c)+1}.0-0`:p?`<=${i}.${c}.${d}-${p}`:`<=${l}`}`.trim())}function ye(e){return e.replace(ue(ne),"$1$2$3")}function be(e){return e.replace(ue(se),"$1~")}function ke(e){return e.replace(ue(le),"$1^")}function we(e){return e.trim().split(/\s+/).map(e=>e.replace(ue(ie),(e,t,o,n,a)=>me(t)?"":me(o)?`>=${t}.0.0 <${Number(t)+1}.0.0-0`:me(n)?"0"===t?`>=${t}.${o}.0 <${t}.${Number(o)+1}.0-0`:`>=${t}.${o}.0 <${Number(t)+1}.0.0-0`:a?"0"===t?"0"===o?`>=${t}.${o}.${n}-${a} <${t}.${o}.${Number(n)+1}-0`:`>=${t}.${o}.${n}-${a} <${t}.${Number(o)+1}.0-0`:`>=${t}.${o}.${n}-${a} <${Number(t)+1}.0.0-0`:"0"===t?"0"===o?`>=${t}.${o}.${n} <${t}.${o}.${Number(n)+1}-0`:`>=${t}.${o}.${n} <${t}.${Number(o)+1}.0-0`:`>=${t}.${o}.${n} <${Number(t)+1}.0.0-0`)).join(" ")}function Ee(e){return e.trim().split(/\s+/).map(e=>e.replace(ue(ce),(e,t,o,n,a)=>me(t)?"":me(o)?`>=${t}.0.0 <${Number(t)+1}.0.0-0`:me(n)?`>=${t}.${o}.0 <${t}.${Number(o)+1}.0-0`:a?`>=${t}.${o}.${n}-${a} <${t}.${Number(o)+1}.0-0`:`>=${t}.${o}.${n} <${t}.${Number(o)+1}.0-0`)).join(" ")}function _e(e){return e.split(/\s+/).map(e=>e.trim().replace(ue(de),(e,t,o,n,a,s)=>{const r=me(o),l=r||me(n),i=l||me(a);return"="===t&&i&&(t=""),s="",r?">"===t||"<"===t?"<0.0.0-0":"*":t&&i?(l&&(n=0),a=0,">"===t?(t=">=",l?(o=Number(o)+1,n=0,a=0):(n=Number(n)+1,a=0)):"<="===t&&(t="<",l?o=Number(o)+1:n=Number(n)+1),"<"===t&&(s="-0"),`${t+o}.${n}.${a}${s}`):l?`>=${o}.0.0${s} <${Number(o)+1}.0.0-0`:i?`>=${o}.${n}.0${s} <${o}.${Number(n)+1}.0-0`:e})).join(" ")}function Se(e){return e.trim().replace(ue("(<|>)?=?\\s*\\*"),"")}function Ne(e,t){return(e=Number(e)||e)>(t=Number(t)||t)?1:e===t?0:-1}function Ve(e,t){return Ne(e.major,t.major)||Ne(e.minor,t.minor)||Ne(e.patch,t.patch)||function(e,t){const{preRelease:o}=e,{preRelease:n}=t;if(void 0===o&&Boolean(n))return 1;if(Boolean(o)&&void 0===n)return-1;if(void 0===o&&void 0===n)return 0;for(let e=0,t=o.length;e<=t;e++){const t=o[e],a=n[e];if(t!==a)return void 0===t&&void 0===a?0:t?a?Ne(t,a):-1:1}return 0}(e,t)}function Ce(e,t){return e.version===t.version}function Be(e,t){switch(e.operator){case"":case"=":return Ce(e,t);case">":return Ve(e,t)<0;case">=":return Ce(e,t)||Ve(e,t)<0;case"<":return Ve(e,t)>0;case"<=":return Ce(e,t)||Ve(e,t)>0;case void 0:return!0;default:return!1}}function $e(e){return he(we,Ee,_e,Se)(e)}function xe(e){return he(ge,ye,be,ke)(e.trim()).split(/\s+/).join(" ")}function De(e,t){if(!e)return!1;const o=fe(e);if(!o)return!1;const[,n,,a,s,r,l]=o,i={operator:n,version:ve(a,s,r,l),major:a,minor:s,patch:r,preRelease:l?.split(".")},c=t.split("||");for(const e of c){const t=e.trim();if(!t)return!0;if("*"===t||"x"===t)return!0;try{const e=xe(t);if(!e.trim())return!0;const o=e.split(" ").map(e=>$e(e)).join(" ");if(!o.trim())return!0;const n=o.split(/\s+/).map(e=>e.trim().replace(ue("^\\s*>=\\s*0.0.0\\s*$"),"")).filter(Boolean);if(0===n.length)continue;let a=!0;for(const e of n){const t=fe(e);if(!t){a=!1;break}const[,o,,n,s,r,l]=t;if(!Be({operator:o,version:ve(n,s,r,l),major:n,minor:s,patch:r,preRelease:l?.split(".")},i)){a=!1;break}}if(a)return!0}catch(e){console.error(`[semver] Error processing range part "${t}":`,e);continue}}return!1}function Ie(e,t){const o=t.shared||{},n=t.name,a=Object.keys(o).reduce((e,a)=>{const s=V(o[a]);return e[a]=e[a]||[],s.forEach(o=>{e[a].push(function(e,t,o,n){let a;return a="get"in e?e.get:"lib"in e?()=>Promise.resolve(e.lib):()=>Promise.resolve(()=>{throw new Error(`Can not get shared '${o}'!`)}),{deps:[],useIn:[],from:t,loading:null,...e,shareConfig:{requiredVersion:`^${e.version}`,singleton:!1,eager:!1,strictVersion:!1,...e.shareConfig},get:a,loaded:!(!e?.loaded&&!("lib"in e))||void 0,version:e.version??"0",scope:Array.isArray(e.scope)?e.scope:[e.scope??"default"],strategy:(e.strategy??n)||"version-first"}}(o,n,a,t.shareStrategy))}),e},{}),s={...e.shared};return Object.keys(a).forEach(e=>{s[e]?a[e].forEach(t=>{s[e].find(e=>e.version===t.version)||s[e].push(t)}):s[e]=a[e]}),{shared:s,shareInfos:a}}function Te(e,t){const o=e=>{if(!Number.isNaN(Number(e))){const t=e.split(".");let o=e;for(let e=0;e<3-t.length;e++)o+=".0";return o}return e};return!!De(o(e),`<=${o(t)}`)}const Ae=(e,t)=>{const o=t||function(e,t){return Te(e,t)};return Object.keys(e).reduce((e,t)=>e?o(e,t)||"0"===e?t:e:t,0)},Me=e=>Boolean(e.loaded)||"function"==typeof e.lib;function Oe(e,t,o){const n=e[t][o];return Ae(e[t][o],function(e,t){return!Me(n[e])&&Te(e,t)})}function je(e,t,o){const n=e[t][o];return Ae(e[t][o],function(e,t){const o=e=>Me(e)||(e=>Boolean(e.loading))(e);return o(n[t])?!o(n[e])||Boolean(Te(e,t)):!o(n[e])&&Te(e,t)})}function Pe(e){return"loaded-first"===e?je:Oe}function Re(e,t,o,n){if(!e)return;const{shareConfig:a,scope:s=z,strategy:r}=o,l=Array.isArray(s)?s:[s];for(const s of l)if(a&&e[s]&&e[s][t]){const{requiredVersion:l}=a,i=Pe(r)(e,s,t),c=()=>{if(a.singleton){if("string"==typeof l&&!De(i,l)){const n=`Version ${i} from ${i&&e[s][t][i].from} of shared singleton module ${t} does not satisfy the requirement of ${o.from} which needs ${l})`;a.strictVersion?y(n):b(n)}return e[s][t][i]}if(!1===l||"*"===l)return e[s][t][i];if(De(i,l))return e[s][t][i];for(const[o,n]of Object.entries(e[s][t]))if(De(o,l))return n},d={shareScopeMap:e,scope:s,pkgName:t,version:i,GlobalFederation:x.__FEDERATION__,resolver:c};return(n.emit(d)||d).resolver()}}function Le(){return x.__FEDERATION__.__SHARE__}function Fe(e){const{pkgName:t,extraOptions:o,shareInfos:n}=e,a=o?.resolver??(e=>{if(!e)return;const t={};e.forEach(e=>{t[e.version]=e});const o=Ae(t,function(e,o){return!Me(t[e])&&Te(e,o)});return t[o]});return Object.assign({},a(n[t]),o?.customShareInfo)}const Ue=".then(callbacks[0]).catch(callbacks[1])";function ze(e,t,o){const{remoteEntryKey:n,entryExports:s}=R(e,t);return g(s,m(a,h,{remoteName:e,remoteEntryUrl:o,remoteEntryKey:n})),s}function He(e){const{entry:t,name:o}=e;return(0,n.lG)(o,t)}async function qe(e){const{origin:t,remoteEntryExports:o,remoteInfo:a,getEntryUrl:s,_inErrorHandling:r=!1}=e,l=He(a);if(o)return o;if(!T[l]){const e=t.remoteHandler.hooks.lifecycle.loadEntry,i=t.loaderHook;T[l]=e.emit({loaderHook:i,remoteInfo:a,remoteEntryExports:o}).then(e=>e||(("undefined"!=typeof ENV_TARGET?"web"===ENV_TARGET:(0,n.OL)())?async function({remoteInfo:e,remoteEntryExports:t,loaderHook:o,getEntryUrl:a}){const{entry:s,entryGlobalName:r,name:l,type:i}=e;switch(i){case"esm":case"module":return async function({entry:e,remoteEntryExports:t}){return new Promise((o,n)=>{try{t?o(t):"undefined"!=typeof FEDERATION_ALLOW_NEW_FUNCTION?new Function("callbacks",`import("${e}")${Ue}`)([o,n]):import(e).then(o).catch(n)}catch(e){n(e)}})}({entry:s,remoteEntryExports:t});case"system":return async function({entry:e,remoteEntryExports:t}){return new Promise((o,n)=>{try{t?o(t):new Function("callbacks",`System.import("${e}")${Ue}`)([o,n])}catch(e){n(e)}})}({entry:s,remoteEntryExports:t});default:return async function({name:e,globalName:t,entry:o,loaderHook:a,getEntryUrl:s}){const{entryExports:r}=R(e,t);if(r)return r;const l=s?s(o):o;return(0,n.k0)(l,{attrs:{},createScriptHook:(e,t)=>{const o=a.lifecycle.createScript.emit({url:e,attrs:t});if(o)return o instanceof HTMLScriptElement||"script"in o||"timeout"in o?o:void 0}}).then(()=>ze(e,t,o)).catch(t=>{throw g(void 0,m(p,h,{remoteName:e,resourceUrl:o})),t})}({entry:s,globalName:r,name:l,loaderHook:o,getEntryUrl:a})}}({remoteInfo:a,remoteEntryExports:o,loaderHook:i,getEntryUrl:s}):async function({remoteInfo:e,loaderHook:t}){const{entry:o,entryGlobalName:a,name:s,type:r}=e,{entryExports:l}=R(s,a);return l||(0,n.oe)(o,{attrs:{name:s,globalName:a,type:r},loaderHook:{createScriptHook:(e,o={})=>{const n=t.lifecycle.createScript.emit({url:e,attrs:o});if(n)return"url"in n?n:void 0}}}).then(()=>ze(s,a,o)).catch(e=>{throw e})}({remoteInfo:a,loaderHook:i}))).catch(async e=>{const n=He(a);if(e instanceof Error&&e.message.includes(p)&&!r){const e=e=>qe({...e,_inErrorHandling:!0}),s=await t.loaderHook.lifecycle.loadEntryError.emit({getRemoteEntry:e,origin:t,remoteInfo:a,remoteEntryExports:o,globalLoading:T,uniqueKey:n});if(s)return s}throw e})}return T[l]}function Ge(e){return{...e,entry:"entry"in e?e.entry:"",type:e.type||H,entryGlobalName:e.entryGlobalName||e.name,shareScope:e.shareScope||z}}function We(e){return{resourceCategory:"sync",share:!0,depsRemote:!0,prefetchInterface:!1,...e}}function Ke(e,t,o,a=!0){const{cssAssets:s,jsAssetsWithoutEntry:r,entryAssets:l}=o;if(t.options.inBrowser){if(l.forEach(o=>{const{moduleInfo:n}=o,a=t.moduleCache.get(e.name);qe(a?{origin:t,remoteInfo:n,remoteEntryExports:a.remoteEntryExports}:{origin:t,remoteInfo:n,remoteEntryExports:void 0})}),a){const e={rel:"preload",as:"style"};s.forEach(o=>{const{link:a,needAttach:s}=(0,n.d)({url:o,cb:()=>{},attrs:e,createLinkHook:(e,o)=>{const n=t.loaderHook.lifecycle.createLink.emit({url:e,attrs:o});if(n instanceof HTMLLinkElement)return n}});s&&document.head.appendChild(a)})}else{const e={rel:"stylesheet",type:"text/css"};s.forEach(o=>{const{link:a,needAttach:s}=(0,n.d)({url:o,cb:()=>{},attrs:e,createLinkHook:(e,o)=>{const n=t.loaderHook.lifecycle.createLink.emit({url:e,attrs:o});if(n instanceof HTMLLinkElement)return n},needDeleteLink:!1});s&&document.head.appendChild(a)})}if(a){const e={rel:"preload",as:"script"};r.forEach(o=>{const{link:a,needAttach:s}=(0,n.d)({url:o,cb:()=>{},attrs:e,createLinkHook:(e,o)=>{const n=t.loaderHook.lifecycle.createLink.emit({url:e,attrs:o});if(n instanceof HTMLLinkElement)return n}});s&&document.head.appendChild(a)})}else{const o={fetchpriority:"high",type:"module"===e?.type?"module":"text/javascript"};r.forEach(e=>{const{script:a,needAttach:s}=(0,n.so)({url:e,cb:()=>{},attrs:o,createScriptHook:(e,o)=>{const n=t.loaderHook.lifecycle.createScript.emit({url:e,attrs:o});if(n instanceof HTMLScriptElement)return n},needDeleteScript:!0});s&&document.head.appendChild(a)})}}}class Je{constructor({remoteInfo:e,host:t}){this.inited=!1,this.lib=void 0,this.remoteInfo=e,this.host=t}async getEntry(){if(this.remoteEntryExports)return this.remoteEntryExports;let e;return e=await qe({origin:this.host,remoteInfo:this.remoteInfo,remoteEntryExports:this.remoteEntryExports}),g(e,`remoteEntryExports is undefined \n ${(0,n.ML)(this.remoteInfo)}`),this.remoteEntryExports=e,this.remoteEntryExports}async get(e,t,o,n){const{loadFactory:a=!0}=o||{loadFactory:!0},r=await this.getEntry();if(!this.inited){const t=this.host.shareScopeMap,o=Array.isArray(this.remoteInfo.shareScope)?this.remoteInfo.shareScope:[this.remoteInfo.shareScope];o.length||o.push("default"),o.forEach(e=>{t[e]||(t[e]={})});const a=t[o[0]],l=[],i={version:this.remoteInfo.version||"",shareScopeKeys:Array.isArray(this.remoteInfo.shareScope)?o:this.remoteInfo.shareScope||"default"};Object.defineProperty(i,"shareScopeMap",{value:t,enumerable:!1});const c=await this.host.hooks.lifecycle.beforeInitContainer.emit({shareScope:a,remoteEntryInitOptions:i,initScope:l,remoteInfo:this.remoteInfo,origin:this.host});void 0===r?.init&&y(m(s,h,{hostName:this.host.name,remoteName:this.remoteInfo.name,remoteEntryUrl:this.remoteInfo.entry,remoteEntryKey:this.remoteInfo.entryGlobalName})),await r.init(c.shareScope,c.initScope,c.remoteEntryInitOptions),await this.host.hooks.lifecycle.initContainer.emit({...c,id:e,remoteSnapshot:n,remoteEntryExports:r})}let l;this.lib=r,this.inited=!0,l=await this.host.loaderHook.lifecycle.getModuleFactory.emit({remoteEntryExports:r,expose:t,moduleInfo:this.remoteInfo}),l||(l=await r.get(t)),g(l,`${w(this.remoteInfo)} remote don't export ${t}.`);const i=((e,t)=>{let o;return o=e.endsWith("/")?e.slice(0,-1):e,t.startsWith(".")&&(t=t.slice(1)),o+=t,o})(this.remoteInfo.name,t),c=this.wraperFactory(l,i);return a?await c():c}wraperFactory(e,t){function o(e,t){e&&"object"==typeof e&&Object.isExtensible(e)&&!Object.getOwnPropertyDescriptor(e,Symbol.for("mf_module_id"))&&Object.defineProperty(e,Symbol.for("mf_module_id"),{value:t,enumerable:!1})}return e instanceof Promise?async()=>{const n=await e();return o(n,t),n}:()=>{const n=e();return o(n,t),n}}}class Ye{constructor(e){this.type="",this.listeners=new Set,e&&(this.type=e)}on(e){"function"==typeof e&&this.listeners.add(e)}once(e){const t=this;this.on(function o(...n){return t.remove(o),e.apply(null,n)})}emit(...e){let t;return this.listeners.size>0&&this.listeners.forEach(o=>{t=o(...e)}),t}remove(e){this.listeners.delete(e)}removeAll(){this.listeners.clear()}}class Xe extends Ye{emit(...e){let t;const o=Array.from(this.listeners);if(o.length>0){let n=0;const a=t=>!1!==t&&(n<o.length?Promise.resolve(o[n++].apply(null,e)).then(a):t);t=a()}return Promise.resolve(t)}}function Qe(e,t){if(!S(t))return!1;if(e!==t)for(const o in e)if(!(o in t))return!1;return!0}class Ze extends Ye{constructor(e){super(),this.onerror=y,this.type=e}emit(e){S(e)||y(`The data for the "${this.type}" hook should be an object.`);for(const t of this.listeners)try{const o=t(e);if(!Qe(e,o)){this.onerror(`A plugin returned an unacceptable value for the "${this.type}" type.`);break}e=o}catch(e){b(e),this.onerror(e)}return e}}class et extends Ye{constructor(e){super(),this.onerror=y,this.type=e}emit(e){S(e)||y(`The response data for the "${this.type}" hook must be an object.`);const t=Array.from(this.listeners);if(t.length>0){let o=0;const n=t=>(b(t),this.onerror(t),e),a=s=>{if(Qe(e,s)){if(e=s,o<t.length)try{return Promise.resolve(t[o++](e)).then(a,n)}catch(e){return n(e)}}else this.onerror(`A plugin returned an incorrect value for the "${this.type}" type.`);return e};return Promise.resolve(a(e))}return Promise.resolve(e)}}class tt{constructor(e){this.registerPlugins={},this.lifecycle=e,this.lifecycleKeys=Object.keys(e)}applyPlugin(e,t){var o;g((o=e,"[object Object]"===N.call(o)),"Plugin configuration is invalid.");const n=e.name;g(n,"A name must be provided by the plugin."),this.registerPlugins[n]||(this.registerPlugins[n]=e,e.apply?.(t),Object.keys(this.lifecycle).forEach(t=>{const o=e[t];o&&this.lifecycle[t].on(o)}))}removePlugin(e){g(e,"A name is required.");const t=this.registerPlugins[e];g(t,`The plugin "${e}" is not registered.`),Object.keys(t).forEach(e=>{"name"!==e&&this.lifecycle[e].remove(t[e])})}}function ot(e,t){const o=C(t);o.url||y(`The attribute remoteEntry of ${e.name} must not be undefined.`);let a=(0,n.Al)(t,o.url);(0,n.OL)()||a.startsWith("http")||(a=`https:${a}`),e.type=o.type,e.entryGlobalName=o.globalName,e.entry=a,e.version=t.version,e.buildVersion=t.buildVersion}function nt(e){const t=e.split(":");return 1===t.length?{name:t[0],version:void 0}:2===t.length?{name:t[0],version:t[1]}:{name:t[1],version:t[2]}}function at(e,t,o,a,s={},r){const l=w(t),{value:i}=M(e,l),c=r||i;if(c&&!(0,n.Tr)(c)&&(o(c,t,a),c.remotesInfo)){const t=Object.keys(c.remotesInfo);for(const n of t){if(s[n])continue;s[n]=!0;const t=nt(n),a=c.remotesInfo[n];at(e,{name:t.name,version:a.matchedVersion},o,!1,s,void 0)}}}const st=(e,t)=>document.querySelector(`${e}[${"link"===e?"href":"src"}="${t}"]`);function rt(e,t,o,a,s){const r=[],l=[],i=[],c=new Set,d=new Set,{options:p}=e,{preloadConfig:u}=t,{depsRemote:m}=u;if(at(a,o,(t,o,a)=>{let s;if(a)s=u;else if(Array.isArray(m)){const e=m.find(e=>e.nameOrAlias===o.name||e.nameOrAlias===o.alias);if(!e)return;s=We(e)}else{if(!0!==m)return;s=u}const c=(0,n.Al)(t,C(t).url);c&&i.push({name:o.name,moduleInfo:{name:o.name,entry:c,type:"remoteEntryType"in t?t.remoteEntryType:"global",entryGlobalName:"globalName"in t?t.globalName:o.name,shareScope:"",version:"version"in t?t.version:void 0},url:c});let d="modules"in t?t.modules:[];const p=(h=s.exposes)?h.map(e=>"."===e?e:e.startsWith("./")?e.replace("./",""):e):[];var h;function f(e){const o=e.map(e=>(0,n.Al)(t,e));return s.filter?o.filter(s.filter):o}if(p.length&&"modules"in t&&(d=t?.modules?.reduce((e,t)=>(-1!==p?.indexOf(t.moduleName)&&e.push(t),e),[])),d){const n=d.length;for(let a=0;a<n;a++){const n=d[a],i=`${o.name}/${n.moduleName}`;e.remoteHandler.hooks.lifecycle.handlePreloadModule.emit({id:"."===n.moduleName?o.name:i,name:o.name,remoteSnapshot:t,preloadConfig:s,remote:o,origin:e}),F(i)||("all"===s.resourceCategory?(r.push(...f(n.assets.css.async)),r.push(...f(n.assets.css.sync)),l.push(...f(n.assets.js.async)),l.push(...f(n.assets.js.sync))):(s.resourceCategory="sync")&&(r.push(...f(n.assets.css.sync)),l.push(...f(n.assets.js.sync))),U(i))}}},!0,{},s),s.shared&&s.shared.length>0){const t=(t,o)=>{const n=Re(e.shareScopeMap,o.sharedName,t,e.sharedHandler.hooks.lifecycle.resolveShare);n&&"function"==typeof n.lib&&(o.assets.js.sync.forEach(e=>{c.add(e)}),o.assets.css.sync.forEach(e=>{d.add(e)}))};s.shared.forEach(e=>{const o=p.shared?.[e.sharedName];if(!o)return;const n=e.version?o.find(t=>t.version===e.version):o;n&&V(n).forEach(o=>{t(o,e)})})}const h=l.filter(e=>!c.has(e)&&!st("script",e));return{cssAssets:r.filter(e=>!d.has(e)&&!st("link",e)),jsAssetsWithoutEntry:h,entryAssets:i.filter(e=>!st("script",e.url))}}function lt(e,t){const o=j({name:t.name,version:t.options.version}),n=o&&"remotesInfo"in o&&o.remotesInfo&&M(o.remotesInfo,e.name).value;return n&&n.matchedVersion?{hostGlobalSnapshot:o,globalSnapshot:O(),remoteSnapshot:j({name:e.name,version:n.matchedVersion})}:{hostGlobalSnapshot:void 0,globalSnapshot:O(),remoteSnapshot:j({name:e.name,version:"version"in e?e.version:void 0})}}class it{constructor(e){this.loadingHostSnapshot=null,this.manifestCache=new Map,this.hooks=new tt({beforeLoadRemoteSnapshot:new Xe("beforeLoadRemoteSnapshot"),loadSnapshot:new et("loadGlobalSnapshot"),loadRemoteSnapshot:new et("loadRemoteSnapshot"),afterLoadSnapshot:new et("afterLoadSnapshot")}),this.manifestLoading=x.__FEDERATION__.__MANIFEST_LOADING__,this.HostInstance=e,this.loaderHook=e.loaderHook}async loadRemoteSnapshotInfo({moduleInfo:e,id:t,expose:o}){const{options:a}=this.HostInstance;await this.hooks.lifecycle.beforeLoadRemoteSnapshot.emit({options:a,moduleInfo:e});let s=j({name:this.HostInstance.options.name,version:this.HostInstance.options.version});var r;s||(s={version:this.HostInstance.options.version||"",remoteEntry:"",remotesInfo:{}},r={[this.HostInstance.options.name]:s},$.__FEDERATION__.moduleInfo={...$.__FEDERATION__.moduleInfo,...r}),s&&"remotesInfo"in s&&!M(s.remotesInfo,e.name).value&&("version"in e||"entry"in e)&&(s.remotesInfo={...s?.remotesInfo,[e.name]:{matchedVersion:"version"in e?e.version:e.entry}});const{hostGlobalSnapshot:l,remoteSnapshot:i,globalSnapshot:c}=this.getGlobalRemoteInfo(e),{remoteSnapshot:p,globalSnapshot:u}=await this.hooks.lifecycle.loadSnapshot.emit({options:a,moduleInfo:e,hostGlobalSnapshot:l,remoteSnapshot:i,globalSnapshot:c});let f,v;if(p)if((0,n.Tr)(p)){const t=(0,n.OL)()?p.remoteEntry:p.ssrRemoteEntry||p.remoteEntry||"",o=await this.getManifestJson(t,e,{});f=o,v=P({...e,entry:t},o)}else{const{remoteSnapshot:t}=await this.hooks.lifecycle.loadRemoteSnapshot.emit({options:this.HostInstance.options,moduleInfo:e,remoteSnapshot:p,from:"global"});f=t,v=u}else if(E(e)){const t=await this.getManifestJson(e.entry,e,{}),o=P(e,t),{remoteSnapshot:n}=await this.hooks.lifecycle.loadRemoteSnapshot.emit({options:this.HostInstance.options,moduleInfo:e,remoteSnapshot:t,from:"global"});f=n,v=o}else y(m(d,h,{hostName:e.name,hostVersion:e.version,globalSnapshot:JSON.stringify(u)}));return await this.hooks.lifecycle.afterLoadSnapshot.emit({id:t,host:this.HostInstance,options:a,moduleInfo:e,remoteSnapshot:f}),{remoteSnapshot:f,globalSnapshot:v}}getGlobalRemoteInfo(e){return lt(e,this.HostInstance)}async getManifestJson(e,t,o){const a=async()=>{let o=this.manifestCache.get(e);if(o)return o;try{let t=await this.loaderHook.lifecycle.fetch.emit(e,{});t&&t instanceof Response||(t=await fetch(e,{})),o=await t.json()}catch(n){o=await this.HostInstance.remoteHandler.hooks.lifecycle.errorLoadRemote.emit({id:e,error:n,from:"runtime",lifecycle:"afterResolve",origin:this.HostInstance}),o||(delete this.manifestLoading[e],y(m(r,h,{manifestUrl:e,moduleName:t.name,hostName:this.HostInstance.options.name},`${n}`)))}return g(o.metaData&&o.exposes&&o.shared,`${e} is not a federation manifest`),this.manifestCache.set(e,o),o};return this.manifestLoading[e]||(this.manifestLoading[e]=(async()=>{const o=await a(),s=(0,n.Jn)(o,{version:e}),{remoteSnapshot:r}=await this.hooks.lifecycle.loadRemoteSnapshot.emit({options:this.HostInstance.options,moduleInfo:t,manifestJson:o,remoteSnapshot:s,manifestUrl:e,from:"manifest"});return r})().then(e=>e)),this.manifestLoading[e]}}class ct{constructor(e){this.hooks=new tt({afterResolve:new et("afterResolve"),beforeLoadShare:new et("beforeLoadShare"),loadShare:new Xe,resolveShare:new Ze("resolveShare"),initContainerShareScopeMap:new Ze("initContainerShareScopeMap")}),this.host=e,this.shareScopeMap={},this.initTokens={},this._setGlobalShareScopeMap(e.options)}registerShared(e,t){const{shareInfos:o,shared:n}=Ie(e,t);return Object.keys(o).forEach(e=>{o[e].forEach(o=>{o.scope.forEach(n=>{const a=this.shareScopeMap[n]?.[e];a||this.setShared({pkgName:e,lib:o.lib,get:o.get,loaded:o.loaded||Boolean(o.lib),shared:o,from:t.name})})})}),{shareInfos:o,shared:n}}async loadShare(e,t){const{host:o}=this,n=Fe({pkgName:e,extraOptions:t,shareInfos:o.options.shared});n?.scope&&await Promise.all(n.scope.map(async e=>{await Promise.all(this.initializeSharing(e,{strategy:n.strategy}))}));const a=await this.hooks.lifecycle.beforeLoadShare.emit({pkgName:e,shareInfo:n,shared:o.options.shared,origin:o}),{shareInfo:s}=a;g(s,`Cannot find ${e} Share in the ${o.options.name}. Please ensure that the ${e} Share parameters have been injected`);const r=Re(this.shareScopeMap,e,s,this.hooks.lifecycle.resolveShare),l=e=>{e.useIn||(e.useIn=[]),k(e.useIn,o.options.name)};if(r&&r.lib)return l(r),r.lib;if(r&&r.loading&&!r.loaded){const e=await r.loading;return r.loaded=!0,r.lib||(r.lib=e),l(r),e}if(r){const t=(async()=>{const e=await r.get();return l(r),r.loaded=!0,r.lib=e,e})();return this.setShared({pkgName:e,loaded:!1,shared:r,from:o.options.name,lib:null,loading:t}),t}{if(t?.customShareInfo)return!1;const n=(async()=>{const t=await s.get();s.lib=t,s.loaded=!0,l(s);const o=Re(this.shareScopeMap,e,s,this.hooks.lifecycle.resolveShare);return o&&(o.lib=t,o.loaded=!0,o.from=s.from),t})();return this.setShared({pkgName:e,loaded:!1,shared:s,from:o.options.name,lib:null,loading:n}),n}}initializeSharing(e=z,t){const{host:o}=this,n=t?.from,a=t?.strategy;let s=t?.initScope;const r=[];if("build"!==n){const{initTokens:t}=this;s||(s=[]);let o=t[e];if(o||(o=t[e]={from:this.host.name}),s.indexOf(o)>=0)return r;s.push(o)}const l=this.shareScopeMap,i=o.options.name;l[e]||(l[e]={});const c=l[e];return Object.keys(o.options.shared).forEach(t=>{o.options.shared[t].forEach(o=>{o.scope.includes(e)&&((e,t)=>{const{version:o,eager:n}=t;c[e]=c[e]||{};const a=c[e],s=a[o],r=Boolean(s&&(s.eager||s.shareConfig?.eager));(!s||"loaded-first"!==s.strategy&&!s.loaded&&(Boolean(!n)!==!r?n:i>s.from))&&(a[o]=t)})(t,o)})}),"version-first"!==o.options.shareStrategy&&"version-first"!==a||o.options.remotes.forEach(t=>{t.shareScope===e&&r.push((async t=>{const{module:n}=await o.remoteHandler.getRemoteModuleAndOptions({id:t});if(n.getEntry){let r;try{r=await n.getEntry()}catch(e){r=await o.remoteHandler.hooks.lifecycle.errorLoadRemote.emit({id:t,error:e,from:"runtime",lifecycle:"beforeLoadShare",origin:o})}n.inited||(await(a=r,a&&a.init&&a.init(l[e],s)),n.inited=!0)}var a})(t.name))}),r}loadShareSync(e,t){const{host:o}=this,n=Fe({pkgName:e,extraOptions:t,shareInfos:o.options.shared});n?.scope&&n.scope.forEach(e=>{this.initializeSharing(e,{strategy:n.strategy})});const a=Re(this.shareScopeMap,e,n,this.hooks.lifecycle.resolveShare),s=e=>{e.useIn||(e.useIn=[]),k(e.useIn,o.options.name)};if(a){if("function"==typeof a.lib)return s(a),a.loaded||(a.loaded=!0,a.from===o.options.name&&(n.loaded=!0)),a.lib;if("function"==typeof a.get){const t=a.get();if(!(t instanceof Promise))return s(a),this.setShared({pkgName:e,loaded:!0,from:o.options.name,lib:t,shared:a}),t}}if(n.lib)return n.loaded||(n.loaded=!0),n.lib;if(n.get){const a=n.get();if(a instanceof Promise)throw new Error(m("build"===t?.from?i:c,h,{hostName:o.options.name,sharedPkgName:e}));return n.lib=a,this.setShared({pkgName:e,loaded:!0,from:o.options.name,lib:n.lib,shared:n}),n.lib}throw new Error(m(c,h,{hostName:o.options.name,sharedPkgName:e}))}initShareScopeMap(e,t,o={}){const{host:n}=this;this.shareScopeMap[e]=t,this.hooks.lifecycle.initContainerShareScopeMap.emit({shareScope:t,options:n.options,origin:n,scopeName:e,hostShareScopeMap:o.hostShareScopeMap})}setShared({pkgName:e,shared:t,from:o,lib:n,loading:a,loaded:s,get:r}){const{version:l,scope:i="default",...c}=t;(Array.isArray(i)?i:[i]).forEach(t=>{if(this.shareScopeMap[t]||(this.shareScopeMap[t]={}),this.shareScopeMap[t][e]||(this.shareScopeMap[t][e]={}),!this.shareScopeMap[t][e][l])return this.shareScopeMap[t][e][l]={version:l,scope:[t],...c,lib:n,loaded:s,loading:a},void(r&&(this.shareScopeMap[t][e][l].get=r));const i=this.shareScopeMap[t][e][l];a&&!i.loading&&(i.loading=a),s&&!i.loaded&&(i.loaded=s),o&&i.from!==o&&(i.from=o)})}_setGlobalShareScopeMap(e){const t=Le(),o=e.id||e.name;o&&!t[o]&&(t[o]=this.shareScopeMap)}}class dt{constructor(e){this.hooks=new tt({beforeRegisterRemote:new Ze("beforeRegisterRemote"),registerRemote:new Ze("registerRemote"),beforeRequest:new et("beforeRequest"),onLoad:new Xe("onLoad"),handlePreloadModule:new Ye("handlePreloadModule"),errorLoadRemote:new Xe("errorLoadRemote"),beforePreloadRemote:new Xe("beforePreloadRemote"),generatePreloadAssets:new Xe("generatePreloadAssets"),afterPreloadRemote:new Xe,loadEntry:new Xe}),this.host=e,this.idToRemoteMap={}}formatAndRegisterRemote(e,t){return(t.remotes||[]).reduce((e,t)=>(this.registerRemote(t,e,{force:!1}),e),e.remotes)}setIdToRemoteMap(e,t){const{remote:o,expose:n}=t,{name:a,alias:s}=o;if(this.idToRemoteMap[e]={name:o.name,expose:n},s&&e.startsWith(a)){const t=e.replace(a,s);return void(this.idToRemoteMap[t]={name:o.name,expose:n})}if(s&&e.startsWith(s)){const t=e.replace(s,a);this.idToRemoteMap[t]={name:o.name,expose:n}}}async loadRemote(e,t){const{host:o}=this;try{const{loadFactory:n=!0}=t||{loadFactory:!0},{module:a,moduleOptions:s,remoteMatchInfo:r}=await this.getRemoteModuleAndOptions({id:e}),{pkgNameOrAlias:l,remote:i,expose:c,id:d,remoteSnapshot:p}=r,u=await a.get(d,c,t,p),m=await this.hooks.lifecycle.onLoad.emit({id:d,pkgNameOrAlias:l,expose:c,exposeModule:n?u:void 0,exposeModuleFactory:n?void 0:u,remote:i,options:s,moduleInstance:a,origin:o});return this.setIdToRemoteMap(e,r),"function"==typeof m?m:u}catch(n){const{from:a="runtime"}=t||{from:"runtime"},s=await this.hooks.lifecycle.errorLoadRemote.emit({id:e,error:n,from:a,lifecycle:"onLoad",origin:o});if(!s)throw n;return s}}async preloadRemote(e){const{host:t}=this;await this.hooks.lifecycle.beforePreloadRemote.emit({preloadOps:e,options:t.options,origin:t});const o=(a=t.options.remotes,e.map(e=>{const t=function(e,t){for(const o of e){if(t===o.name)return o;if(o.alias&&t===o.alias)return o}}(a,e.nameOrAlias);return g(t,`Unable to preload ${e.nameOrAlias} as it is not included in ${!t&&(0,n.ML)({remoteInfo:t,remotes:a})}`),{remote:t,preloadConfig:We(e)}}));var a;await Promise.all(o.map(async e=>{const{remote:o}=e,n=Ge(o),{globalSnapshot:a,remoteSnapshot:s}=await t.snapshotHandler.loadRemoteSnapshotInfo({moduleInfo:o}),r=await this.hooks.lifecycle.generatePreloadAssets.emit({origin:t,preloadOptions:e,remote:o,remoteInfo:n,globalSnapshot:a,remoteSnapshot:s});r&&Ke(n,t,r)}))}registerRemotes(e,t){const{host:o}=this;e.forEach(e=>{this.registerRemote(e,o.options.remotes,{force:t?.force})})}async getRemoteModuleAndOptions(e){const{host:t}=this,{id:o}=e;let n;try{n=await this.hooks.lifecycle.beforeRequest.emit({id:o,options:t.options,origin:t})}catch(e){if(n=await this.hooks.lifecycle.errorLoadRemote.emit({id:o,options:t.options,origin:t,from:"runtime",error:e,lifecycle:"beforeRequest"}),!n)throw e}const{id:a}=n,s=function(e,t){for(const o of e){const e=t.startsWith(o.name);let n=t.replace(o.name,"");if(e){if(n.startsWith("/"))return n=`.${n}`,{pkgNameOrAlias:o.name,expose:n,remote:o};if(""===n)return{pkgNameOrAlias:o.name,expose:".",remote:o}}const a=o.alias&&t.startsWith(o.alias);let s=o.alias&&t.replace(o.alias,"");if(o.alias&&a){if(s&&s.startsWith("/"))return s=`.${s}`,{pkgNameOrAlias:o.alias,expose:s,remote:o};if(""===s)return{pkgNameOrAlias:o.alias,expose:".",remote:o}}}}(t.options.remotes,a);g(s,m(l,h,{hostName:t.options.name,requestId:a}));const{remote:r}=s,i=Ge(r),c=await t.sharedHandler.hooks.lifecycle.afterResolve.emit({id:a,...s,options:t.options,origin:t,remoteInfo:i}),{remote:d,expose:p}=c;g(d&&p,`The 'beforeRequest' hook was executed, but it failed to return the correct 'remote' and 'expose' values while loading ${a}.`);let u=t.moduleCache.get(d.name);const f={host:t,remoteInfo:i};return u||(u=new Je(f),t.moduleCache.set(d.name,u)),{module:u,moduleOptions:f,remoteMatchInfo:c}}registerRemote(e,t,o){const{host:a}=this,s=()=>{if(e.alias){const o=t.find(t=>e.alias&&(t.name.startsWith(e.alias)||t.alias?.startsWith(e.alias)));g(!o,`The alias ${e.alias} of remote ${e.name} is not allowed to be the prefix of ${o&&o.name} name or alias`)}"entry"in e&&(0,n.OL)()&&!e.entry.startsWith("http")&&(e.entry=new URL(e.entry,window.location.origin).href),e.shareScope||(e.shareScope=z),e.type||(e.type=H)};this.hooks.lifecycle.beforeRegisterRemote.emit({remote:e,origin:a});const r=t.find(t=>t.name===e.name);if(r){const l=[`The remote "${e.name}" is already registered.`,"Please note that overriding it may cause unexpected errors."];o?.force&&(this.removeRemote(r),s(),t.push(e),this.hooks.lifecycle.registerRemote.emit({remote:e,origin:a}),(0,n.R8)(l.join(" ")))}else s(),t.push(e),this.hooks.lifecycle.registerRemote.emit({remote:e,origin:a})}removeRemote(e){try{const{host:t}=this,{name:o}=e,a=t.options.remotes.findIndex(e=>e.name===o);-1!==a&&t.options.remotes.splice(a,1);const s=t.moduleCache.get(e.name);if(s){const o=s.remoteInfo,a=o.entryGlobalName;B[a]&&(Object.getOwnPropertyDescriptor(B,a)?.configurable?delete B[a]:B[a]=void 0);const r=He(s.remoteInfo);T[r]&&delete T[r],t.snapshotHandler.manifestCache.delete(o.entry);let l=o.buildVersion?(0,n.lG)(o.name,o.buildVersion):o.name;const i=B.__FEDERATION__.__INSTANCES__.findIndex(e=>o.buildVersion?e.options.id===l:e.name===l);if(-1!==i){const e=B.__FEDERATION__.__INSTANCES__[i];l=e.options.id||l;const t=Le();let n=!0;const a=[];Object.keys(t).forEach(e=>{const s=t[e];s&&Object.keys(s).forEach(t=>{const r=s[t];r&&Object.keys(r).forEach(s=>{const l=r[s];l&&Object.keys(l).forEach(r=>{const i=l[r];i&&"object"==typeof i&&i.from===o.name&&(i.loaded||i.loading?(i.useIn=i.useIn.filter(e=>e!==o.name),i.useIn.length?n=!1:a.push([e,t,s,r])):a.push([e,t,s,r]))})})})}),n&&(e.shareScopeMap={},delete t[l]),a.forEach(([e,o,n,a])=>{delete t[e]?.[o]?.[n]?.[a]}),B.__FEDERATION__.__INSTANCES__.splice(i,1)}const{hostGlobalSnapshot:c}=lt(e,t);if(c){const t=c&&"remotesInfo"in c&&c.remotesInfo&&M(c.remotesInfo,e.name).key;t&&(delete c.remotesInfo[t],Boolean(x.__FEDERATION__.__MANIFEST_LOADING__[t])&&delete x.__FEDERATION__.__MANIFEST_LOADING__[t])}t.moduleCache.delete(e.name)}}catch(e){v.log("removeRemote fail: ",e)}}}class pt{constructor(e){this.hooks=new tt({beforeInit:new Ze("beforeInit"),init:new Ye,beforeInitContainer:new et("beforeInitContainer"),initContainer:new et("initContainer")}),this.version="0.21.3",this.moduleCache=new Map,this.loaderHook=new tt({getModuleInfo:new Ye,createScript:new Ye,createLink:new Ye,fetch:new Xe,loadEntryError:new Xe,getModuleFactory:new Xe}),this.bridgeHook=new tt({beforeBridgeRender:new Ye,afterBridgeRender:new Ye,beforeBridgeDestroy:new Ye,afterBridgeDestroy:new Ye});const t=[{name:"snapshot-plugin",async afterResolve(e){const{remote:t,pkgNameOrAlias:o,expose:n,origin:a,remoteInfo:s,id:r}=e;if(!E(t)||!_(t)){const{remoteSnapshot:l,globalSnapshot:i}=await a.snapshotHandler.loadRemoteSnapshotInfo({moduleInfo:t,id:r});ot(s,l);const c={remote:t,preloadConfig:{nameOrAlias:o,exposes:[n],resourceCategory:"sync",share:!1,depsRemote:!1}},d=await a.remoteHandler.hooks.lifecycle.generatePreloadAssets.emit({origin:a,preloadOptions:c,remoteInfo:s,remote:t,remoteSnapshot:l,globalSnapshot:i});return d&&Ke(s,a,d,!1),{...e,remoteSnapshot:l}}return e}},{name:"generate-preload-assets-plugin",async generatePreloadAssets(e){const{origin:t,preloadOptions:o,remoteInfo:a,remote:s,globalSnapshot:r,remoteSnapshot:l}=e;return(0,n.OL)()?E(s)&&_(s)?{cssAssets:[],jsAssetsWithoutEntry:[],entryAssets:[{name:s.name,url:s.entry,moduleInfo:{name:a.name,entry:s.entry,type:a.type||"global",entryGlobalName:"",shareScope:""}}]}:(ot(a,l),rt(t,o,a,r,l)):{cssAssets:[],jsAssetsWithoutEntry:[],entryAssets:[]}}}],o={id:"slider.editor:0.0.11",name:e.name,plugins:t,remotes:[],shared:{},inBrowser:(0,n.OL)()};this.name=e.name,this.options=o,this.snapshotHandler=new it(this),this.sharedHandler=new ct(this),this.remoteHandler=new dt(this),this.shareScopeMap=this.sharedHandler.shareScopeMap,this.registerPlugins([...o.plugins,...e.plugins||[]]),this.options=this.formatOptions(o,e)}initOptions(e){this.registerPlugins(e.plugins);const t=this.formatOptions(this.options,e);return this.options=t,t}async loadShare(e,t){return this.sharedHandler.loadShare(e,t)}loadShareSync(e,t){return this.sharedHandler.loadShareSync(e,t)}initializeSharing(e=z,t){return this.sharedHandler.initializeSharing(e,t)}initRawContainer(e,t,o){const n=Ge({name:e,entry:t}),a=new Je({host:this,remoteInfo:n});return a.remoteEntryExports=o,this.moduleCache.set(e,a),a}async loadRemote(e,t){return this.remoteHandler.loadRemote(e,t)}async preloadRemote(e){return this.remoteHandler.preloadRemote(e)}initShareScopeMap(e,t,o={}){this.sharedHandler.initShareScopeMap(e,t,o)}formatOptions(e,t){const{shared:o}=Ie(e,t),{userOptions:n,options:a}=this.hooks.lifecycle.beforeInit.emit({origin:this,userOptions:t,options:e,shareInfo:o}),s=this.remoteHandler.formatAndRegisterRemote(a,n),{shared:r}=this.sharedHandler.registerShared(a,n),l=[...a.plugins];n.plugins&&n.plugins.forEach(e=>{l.includes(e)||l.push(e)});const i={...e,...t,plugins:l,remotes:s,shared:r};return this.hooks.lifecycle.init.emit({origin:this,options:i}),i}registerPlugins(e){const t=function(e,t){const o=$.__FEDERATION__.__GLOBAL_PLUGIN__,n=[t.hooks,t.remoteHandler.hooks,t.sharedHandler.hooks,t.snapshotHandler.hooks,t.loaderHook,t.bridgeHook];return o.length>0&&o.forEach(t=>{e?.find(e=>e.name!==t.name)&&e.push(t)}),e&&e.length>0&&e.forEach(e=>{n.forEach(o=>{o.applyPlugin(e,t)})}),e}(e,this);this.options.plugins=this.options.plugins.reduce((e,t)=>t?(e&&!e.find(e=>e.name===t.name)&&e.push(t),e):e,t||[])}registerRemotes(e,t){return this.remoteHandler.registerRemotes(e,t)}registerShared(e){this.sharedHandler.registerShared(this.options,{...this.options,shared:e})}}function ut(e){const t=new(B.__FEDERATION__.__DEBUG_CONSTRUCTOR__||pt)(e);return function(e){B.__FEDERATION__.__INSTANCES__.push(e)}(t),t}let mt=null;function ht(e){const t=(o=e.name,n=e.version,B.__FEDERATION__.__INSTANCES__.find(e=>!("slider.editor:0.0.11"!==e.options.id&&(e.options.name!==o||e.options.version||n)&&(e.options.name!==o||!n||e.options.version!==n))));var o,n;return t?(t.initOptions(e),mt||(mt=t),t):(mt=ut(e),mt)}function ft(...e){return g(mt,m(u,h)),mt.loadRemote.apply(mt,e)}function vt(...e){return g(mt,m(u,h)),mt.loadShare.apply(mt,e)}function gt(...e){return g(mt,m(u,h)),mt.loadShareSync.apply(mt,e)}function yt(...e){return g(mt,m(u,h)),mt.preloadRemote.apply(mt,e)}function bt(...e){return g(mt,m(u,h)),mt.registerRemotes.apply(mt,e)}function kt(...e){return g(mt,m(u,h)),mt.registerPlugins.apply(mt,e)}function wt(){return mt}function Et(...e){return g(mt,m(u,h)),mt.registerShared.apply(mt,e)}!function(e,t=(0,n.Bb)()){t&&(B.__FEDERATION__.__DEBUG_CONSTRUCTOR__=e,B.__FEDERATION__.__DEBUG_CONSTRUCTOR_VERSION__="0.21.3")}(pt)}},__webpack_module_cache__={},deferred,inProgress,dataWebpackPrefix,prevStartup,hasRun;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var o=__webpack_module_cache__[e]={exports:{}},n={id:e,module:o,factory:__webpack_modules__[e],require:__webpack_require__};return __webpack_require__.i.forEach(function(e){e(n)}),o=n.module,n.factory.call(o.exports,o,o.exports,n.require),o.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.c=__webpack_module_cache__,__webpack_require__.i=[],__webpack_require__.x=e=>{},__webpack_require__.federation||(__webpack_require__.federation={initOptions:{name:"slider.editor",remotes:[],shareStrategy:"version-first"},chunkMatcher:function(e){return 375!=e},rootOutputDir:"",bundlerRuntimeOptions:{remotes:{remoteInfos:{},webpackRequire:__webpack_require__,idToRemoteMap:{},chunkMapping:{},idToExternalAndNameMapping:{}}}},__webpack_require__.consumesLoadingData={},__webpack_require__.remotesLoadingData={}),deferred=[],__webpack_require__.O=(e,t,o,n)=>{if(!t){var a=1/0;for(i=0;i<deferred.length;i++){for(var[t,o,n]=deferred[i],s=!0,r=0;r<t.length;r++)(!1&n||a>=n)&&Object.keys(__webpack_require__.O).every(e=>__webpack_require__.O[e](t[r]))?t.splice(r--,1):(s=!1,n<a&&(a=n));if(s){deferred.splice(i--,1);var l=o();void 0!==l&&(e=l)}}return e}n=n||0;for(var i=deferred.length;i>0&&deferred[i-1][2]>n;i--)deferred[i]=deferred[i-1];deferred[i]=[t,o,n]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce((t,o)=>(__webpack_require__.f[o](e,t),t),[])),__webpack_require__.u=e=>e+"."+{689:"5aeef4f5",833:"d3c05d4d",920:"53051b9e"}[e]+".chunk.js",__webpack_require__.miniCssF=e=>e+".css",__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),inProgress={},dataWebpackPrefix="@reneos/slider.editor:",__webpack_require__.l=(e,t,o,n)=>{if(inProgress[e])inProgress[e].push(t);else{var a,s;if(void 0!==o)for(var r=document.getElementsByTagName("script"),l=0;l<r.length;l++){var i=r[l];if(i.getAttribute("src")==e||i.getAttribute("data-webpack")==dataWebpackPrefix+o){a=i;break}}a||(s=!0,(a=document.createElement("script")).charset="utf-8",__webpack_require__.nc&&a.setAttribute("nonce",__webpack_require__.nc),a.setAttribute("data-webpack",dataWebpackPrefix+o),a.src=e),inProgress[e]=[t];var c=(t,o)=>{a.onerror=a.onload=null,clearTimeout(d);var n=inProgress[e];if(delete inProgress[e],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach(e=>e(o)),t)return t(o)},d=setTimeout(c.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=c.bind(null,a.onerror),a.onload=c.bind(null,a.onload),s&&document.head.appendChild(a)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{__webpack_require__.S={};var e={},t={};__webpack_require__.I=(o,n)=>{n||(n=[]);var a=t[o];if(a||(a=t[o]={}),!(n.indexOf(a)>=0)){if(n.push(a),e[o])return e[o];__webpack_require__.o(__webpack_require__.S,o)||(__webpack_require__.S[o]={});var s=__webpack_require__.S[o],r="@reneos/slider.editor",l=(e,t,o,n)=>{var a=s[e]=s[e]||{},l=a[t];(!l||!l.loaded&&(!n!=!l.eager?n:r>l.from))&&(a[t]={get:o,from:r,eager:!!n})},i=[];return"default"===o&&(l("@reneos/app","1.0.6",()=>()=>__webpack_require__(302),1),l("three","0.181.0",()=>()=>__webpack_require__(815),1),l("vue","3.5.24",()=>()=>__webpack_require__(31),1)),e[o]=i.length?Promise.all(i).then(()=>e[o]=1):1}}})(),(()=>{__webpack_require__.federation.initOptions.shared={"@reneos/app":[{version:"1.0.6",get:()=>()=>__webpack_require__(302),scope:["default"],shareConfig:{eager:!0,requiredVersion:"1.0.6",singleton:!0,layer:null}}],three:[{version:"0.181.0",get:()=>()=>__webpack_require__(815),scope:["default"],shareConfig:{eager:!0,singleton:!0,layer:null}}],vue:[{version:"3.5.24",get:()=>()=>__webpack_require__(31),scope:["default"],shareConfig:{eager:!0,singleton:!0,layer:null}}]},__webpack_require__.S={};var e={},t={};__webpack_require__.I=(o,n)=>__webpack_require__.federation.bundlerRuntime.I({shareScopeName:o,webpackRequire:__webpack_require__,initPromises:e,initTokens:t,initScope:n})})(),__webpack_require__.p="/editor/",(()=>{var e={};__webpack_require__.consumesLoadingData.moduleIdToConsumeDataMapping={15:{fallback:()=>()=>__webpack_require__(31),shareScope:["default"],singleton:!0,requiredVersion:"",strictVersion:!1,eager:!0,layer:void 0,shareKey:"vue"},875:{fallback:()=>()=>__webpack_require__(815),shareScope:["default"],singleton:!0,requiredVersion:"",strictVersion:!1,eager:!0,layer:void 0,shareKey:"three"},730:{fallback:()=>()=>__webpack_require__(31),shareScope:["default"],singleton:!0,requiredVersion:"^3.5.25",strictVersion:!1,eager:!0,layer:void 0,shareKey:"vue"},117:{fallback:()=>()=>__webpack_require__(815),shareScope:["default"],singleton:!0,requiredVersion:!1,strictVersion:!1,eager:!0,layer:void 0,shareKey:"three"},320:{fallback:()=>()=>__webpack_require__(302),shareScope:["default"],singleton:!0,requiredVersion:"1.0.6",strictVersion:!1,eager:!0,layer:void 0,shareKey:"@reneos/app"}};var t={};__webpack_require__.consumesLoadingData.initialConsumes=[15,875,730,117,320],__webpack_require__.federation.installInitialConsumes=()=>__webpack_require__.federation.bundlerRuntime.installInitialConsumes({initialConsumes:__webpack_require__.consumesLoadingData.initialConsumes,installedModules:e,moduleToHandlerMapping:t,webpackRequire:__webpack_require__}),__webpack_require__.consumesLoadingData.chunkMapping={792:[15,875,730,117,320]},__webpack_require__.f.consumes=(o,n)=>{__webpack_require__.federation.bundlerRuntime.consumes({chunkMapping:__webpack_require__.consumesLoadingData.chunkMapping,installedModules:e,chunkId:o,moduleToHandlerMapping:t,promises:n,webpackRequire:__webpack_require__})}})(),(()=>{if("undefined"!=typeof document){var e={792:0};__webpack_require__.f.miniCss=(t,o)=>{e[t]?o.push(e[t]):0!==e[t]&&{689:1,833:1,920:1}[t]&&o.push(e[t]=(e=>new Promise((t,o)=>{var n=__webpack_require__.miniCssF(e),a=__webpack_require__.p+n;if(((e,t)=>{for(var o=document.getElementsByTagName("link"),n=0;n<o.length;n++){var a=(r=o[n]).getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(a===e||a===t))return r}var s=document.getElementsByTagName("style");for(n=0;n<s.length;n++){var r;if((a=(r=s[n]).getAttribute("data-href"))===e||a===t)return r}})(n,a))return t();((e,t,o,n,a)=>{var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",__webpack_require__.nc&&(s.nonce=__webpack_require__.nc),s.onerror=s.onload=o=>{if(s.onerror=s.onload=null,"load"===o.type)n();else{var r=o&&o.type,l=o&&o.target&&o.target.href||t,i=new Error("Loading CSS chunk "+e+" failed.\n("+r+": "+l+")");i.name="ChunkLoadError",i.code="CSS_CHUNK_LOAD_FAILED",i.type=r,i.request=l,s.parentNode&&s.parentNode.removeChild(s),a(i)}},s.href=t,document.head.appendChild(s)})(e,a,0,t,o)}))(t).then(()=>{e[t]=0},o=>{throw delete e[t],o}))}}})(),prevStartup=__webpack_require__.x,hasRun=!1,__webpack_require__.x=()=>{if(hasRun||(hasRun=!0,__webpack_require__(651)),"function"==typeof prevStartup)return prevStartup();console.warn("[Module Federation] prevStartup is not a function, skipping startup execution")},(()=>{var e={792:0,375:0};__webpack_require__.f.j=(t,o)=>{var n=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==n)if(n)o.push(n[2]);else if(375!=t){var a=new Promise((o,a)=>n=e[t]=[o,a]);o.push(n[2]=a);var s=__webpack_require__.p+__webpack_require__.u(t),r=new Error;__webpack_require__.l(s,o=>{if(__webpack_require__.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var a=o&&("load"===o.type?"missing":o.type),s=o&&o.target&&o.target.src;r.message="Loading chunk "+t+" failed.\n("+a+": "+s+")",r.name="ChunkLoadError",r.type=a,r.request=s,n[1](r)}},"chunk-"+t,t)}else e[t]=0},__webpack_require__.O.j=t=>0===e[t];var t=(t,o)=>{var n,a,[s,r,l]=o,i=0;if(s.some(t=>0!==e[t])){for(n in r)__webpack_require__.o(r,n)&&(__webpack_require__.m[n]=r[n]);if(l)var c=l(__webpack_require__)}for(t&&t(o);i<s.length;i++)a=s[i],__webpack_require__.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return __webpack_require__.O(c)},o=self.webpackChunk_reneos_slider_editor=self.webpackChunk_reneos_slider_editor||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})(),__webpack_require__.x();var __webpack_exports__=__webpack_require__.O(void 0,[375,489,753,776],()=>__webpack_require__(307));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();