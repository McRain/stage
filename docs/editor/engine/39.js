"use strict";(self.webpackChunk_reneos_3d_editor_engine=self.webpackChunk_reneos_3d_editor_engine||[]).push([[39,614],{30:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});var a=s(909);class n extends a.Object3D{static get IsElement(){return!0}constructor(e){super(),this.prototypes=["base"],this.isElement=!0,this.isBase=!0,this.uid=e.uid,this.data={...e},this.type="element",this.path="",this.paths=[],this.state=null,this.actions=[]}exportData(e){const{model:t,children:s,...a}=this.data||e,n=JSON.parse(JSON.stringify(a));if(this.data.rotation&&(n.rotation={x:this.data.rotation.x,y:this.data.rotation.y,z:this.data.rotation.z}),s){n.children=[];for(let e=0;e<s.length;e++){const t=s[e],a=this.children.find(e=>e.uid===t.uid);n.children[e]=a.exportData?a.exportData():JSON.parse(JSON.stringify(a.data||{}))}}return n}addAction(e){this.actions.push(e)}removeAction(e,t){const s=this.data.actions.findIndex(s=>s.uid===e&&s.hook===t);s>=0&&this.data.actions.splice(s,1)}get model(){return this}find(e){const t=e.split(".");let s=this;for(let e=0;e<t.length;e++)s=this.children.find(s=>s.uid===t[e]),list=s.children;return s}}const i=n},39:(e,t,s)=>{s.r(t),s.d(t,{ActionsManager:()=>J,AssetsManager:()=>y,BaseElement:()=>r.default,CssManager:()=>xe,ElementModel:()=>o.default,Factory:()=>E,MouseManager:()=>Y,ProjectManager:()=>ue,THREE:()=>n});var a=s(909),n=s.t(a,2),i=s(351);a.Color.prototype.encode=function(){return{type:"Color",args:[`#${this.getHexString()}`]}},a.Vector3.prototype.encode=function(){return{type:"Vector3",args:[this.x,this.y,this.z]}};var r=s(30),o=s(614);class c extends i.A{constructor(e){super(),this.isAsset=!0,this.data=e,this._clones=[],this.promise=null,this.progress=0}get uid(){return this.data.uid}get type(){return this.data.type}get name(){return this.data.name}set name(e){this.data.name=e}get resource(){if(this.data.clone){const e=this._resource.clone();return e.uid=`${this.uid}_${Date.now()}`,this._clones.push(e),e}return this._resource}async getResource(){if(this.data.clone){const e=this._resource.clone();return e.uid=this.uid,e}return this._resource}get clone(){return this.data.clone}set clone(e){this.data.clone=e}async load(){}async update(e,t,s){this.data[t]=e[t]}destroy(){this._clones.forEach(e=>{e.parent&&e.parent.remove(e)}),this.emit("destroy",this)}}const l=c;var d=s(92);var h=s(231);const u=new Map,p={gltf:class extends l{constructor(e){super(e),this.uses={}}get shadow(){return this.data.shadow||{}}set shadow(e){this.data.shadow=e}_updateEnvMap(e){this.data.envMap=e?e.uid:null;const t=e?e.resource:null;this._resource.traverse(e=>{e.isMesh&&(e.material.envMap=t)}),this.emit("change")}async _setEnvMap(e){if(!e){const e=this.data.envMap,t=this.uses[e];return t&&(delete this.uses[e],t.off("destroy",this._updateEnvMap.bind(this,null)),t.off("update",this._updateEnvMap.bind(this))),delete this.data.envMap,void this._updateEnvMap()}if(e!==this.data.envMap){const e=this.data.envMap,t=this.uses[e];t&&(delete this.uses[e],t.off("destroy",this._updateEnvMap.bind(this,null)),t.off("update",this._updateEnvMap.bind(this)))}const t=this.data.envMap=e,s=this.uses[t]=await y.FindAsset(t);s&&(s.on("destroy",this._updateEnvMap.bind(this,null)),s.on("update",this._updateEnvMap.bind(this)),this._updateEnvMap(s))}load(){return console.log("model.load"),new Promise((e,t)=>{(new d.B).load(this.data.url,async t=>{this._resource=t.scene.children.length>1?t.scene:t.scene.children[0],this._resource.uid=this.uid,this.data.position&&this._resource.position.copy(this.data.position),this.data.rotation&&this._resource.rotation.set(this.data.rotation.x,this.data.rotation.y,this.data.rotation.z,"XYZ"),this.data.scale&&this._resource.scale.copy(this.data.scale),this._setEnvMap(this.data.envMap),this._resource.traverse(e=>{e.isMesh&&(e.castShadow=this.data.shadow?.cast||!1,e.receiveShadow=this.data.shadow?.receive||!1,e.geometry.computeBoundingBox())}),this.emit("update",this),e()},({loaded:e,total:t})=>{this.progress=e/t*100},e=>{t(e)})})}async update(e,t,s){switch(t){case"url":this.load();break;case"envMap":this._setEnvMap(s);break;default:this._resource.traverse(e=>{e.isMesh&&(e.castShadow=this.data.shadow?.cast||!1,e.receiveShadow=this.data.shadow?.receive||!1)})}this.emit("update",this)}},texture:class extends l{constructor(e){return super(e),this.uses={},new Proxy(this,{get:(e,t)=>t in e?e[t]:e.data[t],set:(e,t,s)=>(t in e?e[t]=s:e.data[t]=s,!0)})}get name(){return this.data.name||this.uid}set name(e){this.data.name=e}async load(){const e=new a.TextureLoader;this._resource=await e.load(this.data.url)}setElement(e,t={}){this.element=e,this.elementData=t,this.element.add(this.resource),this.applyData(this.data),this.applyData(this.elementData)}updateResource(e,t){this.element.children.find(e=>e.uid===this.data.uid)!==e&&(this.element.remove(this.resource),this.resource=e,this.element.add(this.resource)),this.applyData(t),this.applyData(this.elementData)}applyData(e){}destroy(){this.element.children.find(e=>e.uid===this.data.uid)&&this.element.remove(this.resource)}},hdr:class extends l{constructor(e){return super(e),this.uses={},new Proxy(this,{get:(e,t)=>t in e?e[t]:e.data[t]})}load(){return new Promise(e=>{(new h.Y).load(this.data.url,t=>{t.mapping=a.EquirectangularReflectionMapping,this._resource=t,this._resource.asset=this,this._resource.uid=this.uid,this.emit("update",this),e()})})}async update(e,t,s){if(this.data[t]=e[t],"url"===t)return this.load(s)}},material:class extends l{constructor(e){super(e),this._resource=new a.MeshStandardMaterial,this.elements=[]}async load(){Object.keys(this.data.textures).forEach(async e=>{this._resource[e]=await y.GetResource(this.data.textures[e].uid)}),Object.keys(this.data.properties).forEach(async e=>{this._resource[e]=this.data.properties[e]})}setElement(e,t={}){this.elements.push({element:e,data:t}),e.add(this._resource.clone()),this.applyData(t)}updateResource(e,t){for(let s=0;s<this.elements.length;s++){const s=this.elements;s.element.children.find(e=>e.uid===this.data.uid)!==e&&(s.element.remove(this._resource),this._resource=e,s.element.add(this._resource.clone())),this.applyData(t),this.applyData(s.data)}}async applyData(e){this._resource.map=y.GetAsset(e.textures.map.uid)}destroy(){for(let e=0;e<this.elements.length;e++){const e=this.elements;e.elements.children.find(e=>e.uid===this.data.uid)&&e.elements.remove(this.resource)}}}};class m{static get Assets(){return u}static GetAsset(e){return u.get(e)}static GetAssets(e){const t=new Set(e);return[...u.values()].filter(e=>t.has(e.uid))}static GetResource(e){const t=u.get(e);if(t)return t._resource?t.resource:(t.promise||(t.promise=new Promise(async e=>{await t.load(),e(t.resource)})),t.promise)}static FindAsset(e){const t=u.get(e);if(t)return t.resource?t:(t.promise||(t.promise=new Promise(async e=>{await t.load(),e(t)})),t.promise)}static async Init(e){const t=[],s=[];for(let t=0;t<e.length;t++){const a=m.Add(e[t]);s.push(a)}s.forEach(e=>{t.push(e.load())});try{await Promise.allSettled(t)}catch(e){console.warn(e)}}static Add(e){const t=new(0,p[e.type])(e);return u.set(t.uid,t),t}static async Update(e,t,s){const a=u.get(e.uid);if(a)try{await a.update(e,t,s)}catch(e){console.warn(e)}}static Remove(e){u.has(e)&&(u.get(e).destroy(),u.delete(e))}}const y=m,g={PlaneGeometry:a.PlaneGeometry,SphereGeometry:a.SphereGeometry,BoxGeometry:a.BoxGeometry,BufferGeometry:a.BufferGeometry,Group:a.Group,Object3D:a.Object3D,PerspectiveCamera:a.PerspectiveCamera,OrthographicCamera:a.OrthographicCamera,InstancedMesh:a.InstancedMesh,Mesh:a.Mesh,DirectionalLight:a.DirectionalLight,AmbientLight:a.AmbientLight,Color:a.Color,Vector3:a.Vector3,Vector2:a.Vector2,Quaternion:a.Quaternion,Matrix4:a.Matrix4,MeshLambertMaterial:a.MeshLambertMaterial,MeshPhysicalMaterial:a.MeshPhysicalMaterial,MeshStandardMaterial:a.MeshStandardMaterial,BufferAttribute:a.BufferAttribute},f=[{label:"DirectionalLight",type:"DirectionalLight"},{label:"AmbientLight",type:"AmbientLight"},{label:"PerspectiveCamera",type:"PerspectiveCamera"},{label:"OrthographicCamera",type:"OrthographicCamera"}],w={},v={},b=[{label:"Base",type:"base",module:()=>Promise.resolve().then(s.bind(s,30))},{label:"Block",type:"block",module:()=>Promise.resolve().then(s.bind(s,314)),allowparent:["$root"],denyparent:["block"],allowchild:[],denychild:["block"]},{label:"Model",type:"model",module:()=>Promise.resolve().then(s.bind(s,614))},{label:"AnimationModel",type:"animatedmodel",module:()=>s.e(857).then(s.bind(s,857))},{label:"Label2D",type:"label2d",module:()=>s.e(127).then(s.bind(s,127))},{label:"VideoPlane",type:"videoplane",module:()=>s.e(328).then(s.bind(s,328))}],M=new i.A;class x{static RegisterElement(e,t,s={}){b.push({label:e,type:e,module:t,...s})}static Find(e){return v[e]}static CheckUseAsset(e){return Object.values(v).reduce((t,s)=>t+(s.data.assets?.some(t=>t.uid===e)?1:0),0)}static GetTypes(){return[...b,...f]}static GetType(e){return b.find(t=>t.type===e)?.module}static AddTemplate(e){w[e.id]=e}static AddTemplates(e){e.forEach(e=>{w[e.id]=e})}static GetElementProp(e,t){let s=v[e];const a=t.split(".");for(let e=0;e<a.length;e++)s=s[a[e]];return s}static async UpdateElement(e,t){const s=v[e];Object.keys(t).forEach(async e=>{s[e]=await x.CreateElement(t[e])})}static Encode(e){}static async CreateElement(e){if(null==e)return null;let t=e;if("object"==typeof e){const{type:s,properties:a,asset:n}=e;if(s){let n;const{args:i,...r}=e,o=b.find(e=>e.type===s);if(o){const e=await o.module();n=e.default||e}else g[s]&&(n=g[s]);if(Array.isArray(i)){const e=await Promise.all(i.map(e=>x.CreateElement(e)));t=new n(...e)}else if(i)t=new n(Object.fromEntries(await Promise.all(Object.entries(i).map(async([e,t])=>[e,await x.CreateElement(t)]))));else if(g[s])t=new n;else try{t=new n(r)}catch(e){console.warn(`${s} : ${e}`)}if(g[s]&&(t.data=e),r.assets?.length){const e=y.GetAssets(r.assets.map(e=>e.uid));t.setAssets(e,r.assets),t.assets=[...r.assets]}t.isObject3D&&!t.isElement&&(t.isElement=!0,t.type=s,t.model=t,t.properties=a||{})}else n&&(t=await y.GetResource(n));a&&await Promise.all(Object.entries(a).map(async([e,s])=>{t[e]=await x.CreateElement(s)}))}return t}static async BuildElements(e,t){const s=[];for(let a=0;a<e.length;a++){const n=e[a],i=await x.BuildElement(n,t);s.push(i)}return s}static async BuildElement(e,t){if(!t)return void console.warn("No find container");const s=structuredClone(w[e.template]?{...w[e.template],...e}:JSON.parse(JSON.stringify(e))),{uid:a,name:n}=s,i=await x.CreateElement(s);if(i){if(i.uid=a||`element${Date.now()}`,i.name=n||"",i.paths=t.paths?[...t.paths,i.uid]:[i.uid],t){const e=b.find(e=>e.type===i.type);if(e?.verifyparent&&!e.verifyparent(t))return;const s=b.find(e=>e.type===t.type);if(s?.verifychild&&!s.verifychild(i))return;(t.addChild||t.add).bind(t)(i)}return e.position&&i.position.copy(e.position),e.children&&await x.BuildElements(e.children,i),v[i.uid]=i,i.init&&await i.init(),M.emit("create",i),i}}static async RemoveModel(e){v[e]&&delete v[e]}static async AddAsset(e,t){const s=y.GetAsset(t.uid);await y.GetResource(t.uid),v[e].setAsset(s,t)}static RemoveAsset(e,t){v[e].removeAsset(t)}}const E=new Proxy(x,{get:(e,t)=>t in e?e[t]:M[t]});function A(e){for(;e;){if(e.isElement)return e;e=e.parent}return null}s(314);var S=s(24),_=s(0);let C,k;const P=class{static MoveTo(e,t){const s={position:new a.Vector3,time:1e3,...e,control:!1},n={position:new a.Vector3,time:1e3,...t,control:!1};C.enabled=!1;const i=Workspace.Camera.position.clone(),r=C.target.clone();s.control=s.time>n.time,n.control=n.time>=s.time;const o=new Tween(i).to(s.position,s.time).easing(Easing.Quadratic.InOut).onUpdate(()=>{Workspace.Camera.position.copy(i),Workspace.Camera.updateProjectionMatrix(),C.update()}).onComplete(()=>{s.control&&(C.enabled=!0),tweengroup.remove(o)}).start(),c=new Tween(r).to(n.position,n.time).easing(Easing.Quadratic.InOut).onUpdate(()=>{C.target.copy(r),C.getPolarAngle()>C.maxPolarAngle&&C.target.setY(center.y+Math.cos(C.maxPolarAngle)*distance)}).onComplete(()=>{n.control&&(C.enabled=!0),tweengroup.remove(c)}).start();tweengroup.add(o,c)}static SetState(e){C.enabled=e}static Init({canvas:e},t,s){C=new S.N(t,e),C.enabled=!0,C.enableDamping=!0,C.dampingFactor=.25,C.screenSpacePanning=!1,C.minDistance=.01,C.maxDistance=500,k=new _.ZU(t,e),k.addEventListener("dragging-changed",e=>{C.enabled=!e.value});const n=k.getHelper();s.add(n),k.getRaycaster().layers.set(1),n.traverse(e=>{e.layers.set(1)}),window.addEventListener("keydown",e=>{switch(C.enabled=!e.ctrlKey,e.code){case"KeyQ":k.setSpace("local"===k.space?"world":"local");break;case"Shift":k.setTranslationSnap(1),k.setRotationSnap(a.MathUtils.degToRad(15)),k.setScaleSnap(.25);break;case"KeyW":k.setMode("translate");break;case"KeyE":k.setMode("rotate");break;case"KeyR":k.setMode("scale");break;case"KeyC":case"KeyV":break;case"+":case"=":k.setSize(k.size+.1);break;case"-":case"_":k.setSize(Math.max(k.size-.1,.1));break;case"KeyX":k.showX=!k.showX;break;case"KeyY":k.showY=!k.showY;break;case"KeyZ":k.showZ=!k.showZ;break;case" ":k.enabled=!k.enabled;break;case"Escape":k.reset()}}),window.addEventListener("keyup",e=>{C.enabled=!e.ctrlKey,"Shift"===e.key&&(k.setTranslationSnap(null),k.setRotationSnap(null),k.setScaleSnap(null))})}static get Transformer(){return k}static Select(e){e?k.attach(e):k.detach()}static Update(e){C.update(e)}static FitTo({center:e,radius:t}){const s=a.MathUtils.degToRad(Workspace.Camera.fov),n=t/Math.sin(s/2),i=(new a.Vector3).subVectors(Workspace.Camera.position,e).normalize(),r=e.clone().add(i.multiplyScalar(n)),o=Workspace.Camera.position.clone();C.enabled=!1;const c=C.target.clone(),l=new Tween(c).to(e,1e3).easing(Easing.Quadratic.InOut).onUpdate(()=>{C.target.copy(c),C.getPolarAngle()>C.maxPolarAngle&&C.target.setY(e.y+Math.cos(C.maxPolarAngle)*distance)}).start(),d=new Tween(o).to(r,1e3).easing(Easing.Quadratic.InOut).onUpdate(()=>{Workspace.Camera.position.copy(o);const t=Workspace.Camera.position.distanceTo(e);t<C.minDistance?Workspace.Camera.position.copy(e.clone().add(i.clone().multiplyScalar(C.minDistance))):t>C.maxDistance&&Workspace.Camera.position.copy(e.clone().add(i.clone().multiplyScalar(C.maxDistance))),Workspace.Camera.updateProjectionMatrix(),C.update()}).onComplete(()=>{C.enabled=!0,tweengroup.remove(d,l)}).start();tweengroup.add(d,l)}},R=new a.Raycaster,D=new i.A;let O,W,j,B;const G={x:0,y:0};let L,T=.03,I=.03,z=.01,U=.01,V=window.innerWidth/2,F=window.innerHeight/2;function $(e){}function H(e){G.x=e.clientX,G.y=e.clientY,L=Date.now()}function K(e){if(Math.abs(G.x-e.clientX)>10||Math.abs(G.y-e.clientY)>10||Date.now()-L>500)return;const t=new a.Vector2,s=B.getBoundingClientRect(),n=e.clientX-s.left,i=e.clientY-s.top;t.x=n/B.clientWidth*2-1,t.y=-i/B.clientHeight*2+1,R.setFromCamera(t,W);const r=R.intersectObjects(O.children,!0);if(0===r.length)return;const o=[];for(let e=0;e<r.length;e++){const t=A(r[e].object);if(t.visible&&!o.includes(t))return o.push(t),void D.emit("click",t)}}const Y=new Proxy(class{static get Control(){return P}static Init(e,t,s,a,n){const i={camera:{range:{x:.01,y:.01},movespeed:{x:.03,y:.03}},...n};O=a,j=s,W=t,B=e,T=i.camera.movespeed.x,I=i.camera.movespeed.y,z=i.camera.range.x,U=i.camera.range.y,V=window.innerWidth/2,F=window.innerHeight/2,e.addEventListener("click",K.bind(null)),e.addEventListener("mousemove",$,!1),e.addEventListener("mousedown",H,!1)}static Update(e){}static SetCamera(e){W=e}},{get:(e,t)=>t in e?e[t]:D[t]}),N={},q=[];async function X(e,t){for(const s of e)try{const e=q.find(e=>e.uid===s.uid);await e.handler({...e,...s},t,window.isEditor),s.actions&&await X(s.actions,t)}catch(e){console.warn(e)}}class Q{static get Library(){return q}static Init(e){for(let t=0;t<e.length;t++)Q.Add(e[t])}static Add(e){e.handler=N[e.type],q.push(e)}static Remove(e){}static GetAction(e){return N[e]}static RegisterAction(e,t){N[e]=t,q.forEach(t=>{t.type===e&&(t.handler=N[t.type])})}static async Run(e=[],t,s){const a=e.filter(e=>e.hook===s);0!==a.length&&await X(a,t)}static async Execute(e,t){const s=[];for(let a=0;a<e.length;a++){const n=e[a];if(n.actions?.length){const e=n.actions.filter(e=>e.hook===t);e.length&&s.push(X(e,n))}}s.length>0&&await Promise.all(s)}}const J=Q;let Z,ee,te,se,ae,ne,ie,re=[];const oe=new i.A,ce=[];function le(e){for(let t=0;t<re.length;t++)re[t](e);se.render(te,ie)}class de{static get Root(){return ae}static get Scene(){return te}static get Camera(){return ie}static get Canvas(){return Z}static get Renderer(){return se}static Init(e){Z=e,ee=new a.Clock,te=new a.Scene,se=new a.WebGLRenderer({canvas:e,alpha:!0,powerPreference:"high-performance",antialias:!0,stencil:!1});const t=Z.clientWidth,s=Z.clientHeight;se.setSize(t,s,!1),se.setPixelRatio(window.devicePixelRatio),se.shadowMap.enabled=!0,se.shadowMap.type=a.PCFSoftShadowMap,ae=new a.Object3D,ae.receiveShadow=!0,ae.castShadow=!0,te.add(ae)}static Start(){ne=ie=new a.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.01,1e3),ie.uid="PlayCamera",te.add(ie),ie.position.set(0,10,30),ie.layers.enable(0),ie.layers.disable(1),se.setAnimationLoop(le),Y.Init(se.domElement,ie,te,ae),Y.on("click",e=>{console.log(e),J.Run([...e.actions,...e.state?e.state.actions:[]],e,"mouse.click")})}static AddToUpdate(e){re.push(e)}static RemoveFromUpdate(e){const t=re.indexOf(e);t>=0&&re.splice(t,1)}static ResetCamera(){de.SetCamera(ne)}static SetCamera(e){ie.visible=!1,ie=e;const t=se.domElement.clientWidth,s=se.domElement.clientHeight;ie.aspect=t/s,ie.updateProjectionMatrix(),ie.visible=!0,ie.layers.enable(0),ie.layers.disable(1),oe.emit("setcamera",ie),Y.SetCamera(ie)}static async Build(e){const t=await E.BuildElements(e,ae);return t.forEach(e=>e.visible=!1),ce.push(...t),console.log(ae),t}static FindBlock(e){return ce.find(t=>t.uid===e)}static FindElement(e){console.log(e);let t=ae;for(let s=0;s<e.length;s++)t=t.children.find(t=>t.uid===e[s]);return t}static async SetAsset(e,t){const s=await y.GetAsset({uid:t.uid}),a=e.split(".");let n=ce.find(e=>e.uid===a[0]);for(let e=1;e<a.length;e++)n=n.children.find(t=>t.uid===a[e]);n.addAsset(t,s)}static RemoveAsset(e,t){const s=e.split(".");let a=ce.find(e=>e.uid===s[0]);for(let e=1;e<s.length;e++)a=a.children.find(t=>t.uid===s[e]);a.removeAsset(t)}static RemoveElement(e){const t=e.split(".");let s=ce;for(let e=0;e<t.length-1;e++){const a=s.find(s=>s.uid===t[e]);s=a.children}const a=s.findIndex(t=>t.path===e);if(a>=0){const e=s.splice(a,1);e[0].parent.remove(e[0])}}}const he=new Proxy(de,{get:(e,t)=>t in e?e[t]:oe[t]});window.Project=he;const ue=he;let pe;const me=new i.A;class ye{static Init(e,t){pe=new Me({element:e}),pe.setSize(window.innerWidth,window.innerHeight),pe.elements.length=0;const s=t.width,a=t.height,n=s/pe.domElement.offsetWidth,i=a/pe.domElement.offsetHeight;pe.domElement.style.transform=`scale(${n}, ${i})`,ue.AddToUpdate(ye.Render)}static Render(){pe.render(ue.Scene,ue.Camera)}static async OnCreate(e,t,s){if(e.isUIElement){e.on("click",()=>{J.Run([...e.actions||[],...e.states[s.actived.uid]?.actions||[]],e,"mouse.click")});try{const s=await t.addElement(e.data.element.component||"UILabel",{data:{...e.data.element,path:e.path},events:e.data.events||{}});e.setElement(s.data,s.element)}catch(e){return}pe.elements.push(e)}}}const ge=new a.Vector3,fe=new a.Matrix4,we=new a.Matrix4,ve=new a.Vector3,be=new a.Vector3;class Me{constructor(e={}){const t=this;let s,a,n,i;const r={objects:new WeakMap},o=void 0!==e.element?e.element:document.createElement("div");function c(e,s,a){ge.setFromMatrixPosition(e.matrixWorld),ge.applyMatrix4(we);const c=ge.z>=-1&&ge.z<=1&&!0===e.layers.test(a.layers),l=e.element;!0===c&&(e.onBeforeRender(t,s,a),l.style.transform=`translate(${-100*e.center.x}%, ${-100*e.center.y}%) translate(${ge.x*n+n}px, ${-ge.y*i+i}px)`,l.parentNode!==o&&o.appendChild(l),e.onAfterRender(t,s,a));const d={distanceToCameraSquared:(h=a,u=e,ve.setFromMatrixPosition(h.matrixWorld),be.setFromMatrixPosition(u.matrixWorld),ve.distanceToSquared(be))};var h,u;r.objects.set(e,d);for(let t=0,s=e.children.length;t<s;t++);}o.style.overflow="hidden",this.domElement=o,this.elements=[],this.getSize=function(){return{width:s,height:a}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),fe.copy(t.matrixWorldInverse),we.multiplyMatrices(t.projectionMatrix,fe);for(let s=0;s<this.elements.length;s++)c(this.elements[s],e,t);!function(e){const t=function(e){const t=[];for(let s=e.length-1;s>=0;s--)e[s].traverseVisible(function(e){e.isCSS2DObject&&t.push(e)});return t}(e).sort(function(e,t){return e.renderOrder!==t.renderOrder?t.renderOrder-e.renderOrder:r.objects.get(e).distanceToCameraSquared-r.objects.get(t).distanceToCameraSquared}),s=t.length;for(let e=0,a=t.length;e<a;e++)t[e].element.style.zIndex=s-e}(this.elements)},this.setSize=function(e,t){s=e,a=t,n=s/2,i=a/2,o.style.width=e+"px",o.style.height=t+"px"}}}const xe=new Proxy(ye,{get:(e,t)=>t in e?e[t]:me[t]})},314:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});var a=s(30);class n extends a.default{constructor(e){super(e),this.isBlock=!0,this.type="block"}}const i=n},351:(e,t,s)=>{s.d(t,{A:()=>a});const a=class{constructor(){this._events={"*":[]}}subs(e,t,s){null==this._events[e]&&(this._events[e]=[]),this._events[e].push({handler:s,once:t})}on(e,t){this.subs(e,!1,t)}once(e,t){this.subs(e,!0,t)}off(e,t){const s=this._events[e];if(s){for(let e=s.length-1;e>=0;e--)s[e].handler===t&&s.splice(e,1);0===s.length&&delete this._events[e]}}clear(e){this._events[e]=[]}clearAll(){this._events={"*":[]}}emit(e,...t){const s=[];this._events[e]&&s.push(...this._events[e]),this._events["*"].length&&s.push(...this._events["*"].map(t=>({handler:t.handler.bind(this,e),once:t.once})));for(let e=s.length-1;e>=0;e--){const a=s[e];a.handler.apply(null,t),a.once&&s.splice(e,1)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}}},614:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});var a=s(30);class n extends a.default{constructor(e){super(e),this.prototypes.push("model"),this.isModel=!0,this.type="model",this.assets=[]}setAssets(e,t){console.log("setAssets");for(let s=0;s<t.length;s++)this.setAsset(e[s],t[s])}setAsset(e,t){e&&(e.on("update",this.updateAsset.bind(this,t)),this.updateAsset(t,e))}updateAsset(e,t){this.removeAsset(t.uid),this.add(t.resource),this.traverse(e=>[e.visible=this.visible])}removeAsset(e){const t=this.children.find(t=>t.uid===e);t&&this.remove(t)}addAsset(e,t){console.log("addAsset"),t.position.copy(e.position||{x:0,y:0,z:0}),t.rotation.setFromVector3(e.rotation||{x:0,y:0,z:0},"XYZ"),t.scale.copy(e.scale||{x:1,y:1,z:1}),e.quaternion&&t.quaternion.copy(e.quaternion),t.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0,e.geometry.computeBoundingBox())}),this.add(t)}}const i=n}}]);