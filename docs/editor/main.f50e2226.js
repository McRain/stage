(()=>{"use strict";var __webpack_modules__={39:(e,t,o)=>{var n={};o.r(n),o.d(n,{AudioControl:()=>fr,BoolEdit:()=>Ya,Buttons:()=>pa,ColorString:()=>us,CustomInput:()=>na,DimensionsEdit:()=>ol,EditColor:()=>cs,ElementView:()=>sa,EulerBlock:()=>Lr,ExpandedButton:()=>vn,ExtMenu:()=>Qn,FileSelect:()=>Bs,Float:()=>ir,FloatBlock:()=>br,FontSize:()=>pl,Icon:()=>kn,ImageView:()=>gs,Int:()=>Qa,ItemsLib:()=>$l,Label:()=>zs,LabelEdit:()=>Zr,LoginForm:()=>ii,Modal:()=>Cn,ModalForm:()=>Rs,ModelPreview:()=>Ss,PopupList:()=>xn,ProjectItem:()=>Al,QuaternionBlock:()=>Ur,RadioButton:()=>ba,SearchFilter:()=>Na,SectionSelect:()=>Ms,Selectable:()=>Ra,ShadowEdit:()=>Ks,SimpleButton:()=>An,SlideBlock:()=>Ca,Spinner:()=>Fn,TextColorEdit:()=>rl,TextEdit:()=>Wr,Toast:()=>Kn,Toasts:()=>Hn,ToggleButton:()=>Pn,TransformEdit:()=>ss,TreeLi:()=>Ia,TwoSideBool:()=>xs,UILabel:()=>di,V2:()=>_r,V3:()=>Br,V3block:()=>Ir,confirmform:()=>ql,params:()=>ar,queryform:()=>Rl,vlist:()=>Ga});var a={};o.r(a),o.d(a,{actions:()=>ud,analitycs:()=>hp,app:()=>mp,assets:()=>cp,engine:()=>vc,inspector:()=>kp,menu:()=>Sp,modal:()=>Ni,models:()=>Yi,modules:()=>ji,project:()=>Rp,projects:()=>Kp,selection:()=>Jp,slides:()=>dc,storage:()=>eu,templates:()=>Bu,toasts:()=>Ei,translations:()=>Ou,ui:()=>Ru});var r=o(15);const s={class:"app-container canvas-container"},l={class:"workspace"},i={id:"editorcanvas",ref:"editorcanvas"},c={id:"playcanvas",ref:"playcanvas"},d={id:"playui",ref:"playui"},p={key:0,class:"splash"},u={class:"container"},m={class:"topline"},h={class:"title"},f={class:"info"},v=["onClick"],g={key:0},y={class:"element"},b=["innerHTML"],k=["onClick"],w={key:0},E={class:"panel-container"},_={class:"panel"},S={class:"header"},N={class:"content"},V={class:"footer"},C={props:{header:{type:Object,default:{label:""}},footer:{type:Object,default:{}}},data:()=>({visible:{heirarhy:!0}})};var B=o(262);const $=(0,B.A)(C,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",E,[(0,r.createElementVNode)("div",_,[(0,r.createElementVNode)("div",S,[(0,r.renderSlot)(e.$slots,"header")]),(0,r.createElementVNode)("div",N,[(0,r.renderSlot)(e.$slots,"default")]),(0,r.createElementVNode)("div",V,[(0,r.renderSlot)(e.$slots,"footer")])])])}]]),x={class:"slide-scroller",ref:"scroller"},D=["onClick","onDragstart","onDrop"],T={class:"title"},I=["src"],A=["src"],M={class:"overflow"},O=["src"],j={class:"overflow"},P=o.p+"assets/3d592ccd944e1f3ef7b0.png",L={props:{slides:{type:Array,required:!0},slide:{type:Object}},data:()=>({slideData:{name:{label:"Имя",value:""}},translateX:0,draggedIndex:null,cardbg:P}),watch:{slide(){this.centerSelectedImage()},slides(){this.slides.sort((e,t)=>e.index-t.index),this.centerSelectedImage()}},mounted(){this.slides.sort((e,t)=>e.index-t.index),this.centerSelectedImage(),this.observer=new ResizeObserver(this.centerSelectedImage.bind(this)),this.observer.observe(this.$refs.scroller)},beforeUnmount(){this.observer.disconnect()},methods:{onDragStart(e){this.draggedIndex=e},async onDrop(e){if(null===this.draggedIndex||this.draggedIndex===e)return;const t=this.slides.splice(this.draggedIndex,1)[0];this.slides.splice(e,0,t);const o=Math.min(this.draggedIndex,e),n=Math.max(this.draggedIndex,e);for(let e=o;e<=n;e++){const t=this.slides[e];t.index=e,await this.$app.slides.save(t)}this.draggedIndex=null,this.$nextTick(this.centerSelectedImage)},onScroll(e){e.deltaY>0?this.$app.slides.next():e.deltaY<0&&this.$app.slides.back()},addSlide(){const e=(0,r.reactive)({title:"Adding a slide",text:"Specify the slide title",answer:""}),t=(0,r.reactive)({label:"Create",class:"primary",disabled:e.answer.length<1,callback:async t=>{const o=await this.$app.slides.add({name:e.answer});this.$app.toasts.add({message:`Slide ${o.name} added`}),this.selectSlide(o),this.centerSelectedImage()}});this.$app.modal.queryText(e,[t],o=>{e.answer=o,t.disabled=e.answer.length<1})},removeSlide(){this.$app.modal.open({header:{value:"Delete slide",handler:()=>{this.$app.modal.close()}},content:{},footer:{buttons:[{label:"Delete",class:"secondary",handler:async()=>{this.$app.modal.close(),this.$app.slides.remove()}},{label:"Cancel",class:"primary",handler:async()=>{this.$app.modal.close()}}]}})},selectSlide(e){this.$app.slides.goto(e.uid)},centerSelectedImage(){this.$nextTick(()=>{const e=this.$refs.scroller.offsetWidth,t=this.$refs.scroller.querySelector(".slide-item.selected");if(t){const o=t.offsetWidth,n=t.offsetLeft;this.translateX=-(n-e/2+o/2)}else this.translateX=.5*e})}}},R=(0,B.A)(L,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",x,[(0,r.createElementVNode)("div",{class:"slide-container",onWheelPassive:t[3]||(t[3]=(...e)=>s.onScroll&&s.onScroll(...e)),style:(0,r.normalizeStyle)({transform:`translateX(${a.translateX}px)`})},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.slides,(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:n,class:(0,r.normalizeClass)(["slide-item",{selected:e===o.slide}]),onClick:t=>s.selectSlide(e),draggable:"true",onDragstart:e=>s.onDragStart(n),onDragover:t[0]||(t[0]=(0,r.withModifiers)(()=>{},["prevent"])),onDrop:e=>s.onDrop(n)},[(0,r.createElementVNode)("div",T,(0,r.toDisplayString)(e.name),1),(0,r.createElementVNode)("img",{src:a.cardbg,alt:"Image"},null,8,I)],42,D))),128)),(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",{class:"slide-item",onClick:t[1]||(t[1]=e=>s.addSlide())},[(0,r.createElementVNode)("img",{src:a.cardbg,alt:"Image"},null,8,A),(0,r.createElementVNode)("div",M,[(0,r.createVNode)(l,{value:"add_to_queue",size:"1em"})])])),[[i,"Add slide"]]),(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",{class:"slide-item",onClick:t[2]||(t[2]=e=>s.removeSlide())},[(0,r.createElementVNode)("img",{src:a.cardbg,alt:"Image"},null,8,O),(0,r.createElementVNode)("div",j,[(0,r.createVNode)(l,{value:"remove_from_queue",size:"1em"})])])),[[i,"Remove slide"]])],36)],512)}],["__scopeId","data-v-14c1e910"]]),F={class:"panel-container"},U={class:"panel"},z={key:0,class:"content"},H={class:"elements"},q={data:()=>({visible:!1})},G=(0,B.A)(q,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",F,[(0,r.createElementVNode)("div",U,[(0,r.createElementVNode)("div",{onClick:t[0]||(t[0]=e=>a.visible=!a.visible),class:"header"},"Hierarhy"),a.visible?((0,r.openBlock)(),(0,r.createElementBlock)("div",z,[(0,r.createElementVNode)("div",H,[(0,r.renderSlot)(e.$slots,"default",{},void 0,!0)])])):(0,r.createCommentVNode)("v-if",!0)])])}],["__scopeId","data-v-e71891a0"]]),W={key:0,class:"element"},K=["onClick"],Y={key:1,class:"label"},J={class:"collapsible-panel"},X={class:"panel-header"},Z={key:1,class:"toggle-icon"},Q={class:"header-content"},ee={__name:"inspectorpanel",props:{label:{type:String,required:!0},tooltip:{type:String,default:""},stat:{type:Boolean,default:!1}},setup(e,{expose:t}){const o=(0,r.useSlots)(),n=(0,r.ref)(!1),a=(0,r.ref)(null),s=()=>{o.content&&(n.value=!n.value,console.log("toggle",n.value))};return t({togglePanel:s,openPanel:()=>{o.content&&(n.value=!0)},closePanel:()=>{o.content&&(n.value=!1)},isOpen:n}),(t,l)=>{const i=(0,r.resolveDirective)("translate"),c=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",J,[(0,r.createElementVNode)("div",X,[(0,r.unref)(o).content?((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:0,onClick:s,class:(0,r.normalizeClass)(["toggle-icon",{open:n.value}])},"▼",2)):((0,r.openBlock)(),(0,r.createElementBlock)("span",Z)),(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",Q,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("span",{onClick:s,class:"label"},[(0,r.createTextVNode)((0,r.toDisplayString)(e.label),1)])),[[i,`$$inspector.${e.label}`]]),(0,r.createVNode)(r.Transition,{name:"fade"},{default:(0,r.withCtx)(()=>[(0,r.renderSlot)(t.$slots,"head",{label:e.label,togglePanel:s},()=>[(0,r.withDirectives)((0,r.createElementVNode)("div",{ref_key:"panelHeader",ref:a},null,512),[[r.vShow,!n.value]])])]),_:3})])),[[c,e.tooltip]]),(0,r.renderSlot)(t.$slots,"icons",{stat:e.stat,togglePanel:s})]),(0,r.createVNode)(r.Transition,{name:"slide",persisted:""},{default:(0,r.withCtx)(()=>[(0,r.withDirectives)((0,r.createElementVNode)("div",{class:"panel-content",style:(0,r.normalizeStyle)({overflow:n.value?"":"hidden"})},[(0,r.renderSlot)(t.$slots,"content",{togglePanel:s})],4),[[r.vShow,n.value]])]),_:3})])}}},te=(0,B.A)(ee,[["__scopeId","data-v-09b67a80"]]),oe={style:{display:"grid","grid-template-columns":"96px 1fr"}},ne=["value"],ae={key:1},re={name:"ModelTypes",data:()=>({types:["model","camera","chart3d"]}),props:{selected:{type:Object}}},se=(0,B.A)(re,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",oe,[t[1]||(t[1]=(0,r.createElementVNode)("div",null,"Тип:",-1)),a.types.includes(o.selected.type)?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("select",{key:0,class:"typeslist","onUpdate:modelValue":t[0]||(t[0]=e=>o.selected.type=e)},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.types,e=>((0,r.openBlock)(),(0,r.createElementBlock)("option",{value:e},(0,r.toDisplayString)(e),9,ne))),256))],512)),[[r.vModelSelect,o.selected.type]]):((0,r.openBlock)(),(0,r.createElementBlock)("div",ae,(0,r.toDisplayString)(o.selected.type),1))])}]]),le={style:{display:"flex","flex-direction":"column"}},ie={style:{display:"flex","justify-content":"center","margin-top":"10px"}},ce={class:"assetblock"},de={key:0,class:"short"},pe={class:"short-text"},ue={key:0,class:"assetcontent"},me={class:"assetrow"},he={class:"assetrow"},fe={name:"AssetView",props:{asset:{type:Object},label:{type:String}},mounted(){},data:()=>({view:!0}),computed:{src(){return this.$app.assets.list.find(e=>e.uid===this.asset.uid)},types(){return this.$app.assets.types}}},ve=(0,B.A)(fe,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",ce,[(0,r.createElementVNode)("div",{onClick:t[0]||(t[0]=e=>a.view=!a.view),class:"title"},[(0,r.createCommentVNode)(' <div class="label">{{ label }}</div> '),a.view?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",de,[(0,r.createTextVNode)((0,r.toDisplayString)(s.src.uid)+" : "+(0,r.toDisplayString)(s.src.type)+" : ",1),(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",pe,[(0,r.createTextVNode)((0,r.toDisplayString)(s.src.url),1)])),[[i,s.src.url]])]))]),a.view?((0,r.openBlock)(),(0,r.createElementBlock)("div",ue,[(0,r.createElementVNode)("div",me,[(0,r.createElementVNode)("div",null,(0,r.toDisplayString)(s.src.type)+" : "+(0,r.toDisplayString)(s.src.name||s.src.uid),1),(0,r.createElementVNode)("div",null,[(0,r.createElementVNode)("button",{onClick:t[1]||(t[1]=t=>e.$emit("remove",o.asset))},[(0,r.createVNode)(l,{value:"bin",size:"1em"})])])]),(0,r.createCommentVNode)(' <div class="assetrow">\r\n                <div>URL:</div>\r\n                <div class="rowcontent">\r\n                    <LabelEdit :value="src.url"></LabelEdit>\r\n                </div>\r\n            </div> '),(0,r.createCommentVNode)(' <div class="assetrow" v-for="(param, key) in src.parameters">\r\n            <div>{{ key }}</div><div>{{ param }}</div>\r\n        </div> '),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.asset.parameters,(e,o)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",he,[(0,r.createElementVNode)("div",null,(0,r.toDisplayString)(o),1),t[2]||(t[2]=(0,r.createElementVNode)("div",{class:"cell"},[(0,r.createCommentVNode)(' <LabelEdit @update:value="asset.parameters[key] = $event; $emit(\'changed\')" :value="param">\r\n                    </LabelEdit> ')],-1))]))),256))])):(0,r.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-eca41270"]]),ge={name:"AssetsView",data:()=>({selectedAsset:null,assetsData:{offtypes:["hdr"]}}),props:{modelValue:{type:Object},value:{type:Object}},methods:{async removeAsset(e){await this.$app.elements.removeAsset(this.value,e),this.$app.toasts.add({message:"Ресурс удален из модели"})},saveProp(){this.$app.toasts.add({message:"Параметр ресурса в элементе изменен"}),this.$app.engine.getManager().UpdateElement(this.value.path,{assets:this.value.assets})},async selectAsset(){const e=await this.$app.assets.selectAsset(["hdr","texture"]);if(e){const t=this.$app.engine.getManager("AssetsManager").GetAsset(e.uid);console.log(this.value),console.log(t),this.$app.assets.setAsset(this.value,t),this.$app.toasts.add({message:"Ресурс добавлен в модель"})}}},computed:{list(){return this.value?.data?.assets||this.value?.assets||[]}},components:{AssetView:ve}},ye=(0,B.A)(ge,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("AssetView"),i=(0,r.resolveComponent)("icon"),c=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",le,[t[1]||(t[1]=(0,r.createElementVNode)("div",null,"Ресурсы",-1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.list,(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(l,{asset:e,key:t,onRemove:s.removeAsset,onChanged:s.saveProp},null,8,["asset","onRemove","onChanged"]))),128)),(0,r.createElementVNode)("div",ie,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("button",{class:"button normal",onClick:t[0]||(t[0]=(...e)=>s.selectAsset&&s.selectAsset(...e))},[(0,r.createVNode)(i,{value:"stack",size:"0.75em"})])),[[c,"Ресурсы"]])])])}]]),be={class:"scenetools"},ke={class:"camera-selector"};var we=o(875);const Ee={name:"SceneTools",data:()=>({}),computed:{selectedCamera:{get(){return this.$app.slides.actived?.camera?.path||null},set(e){this.$app.slides.actived.camera.path=e,this.$app.slides.save()}},slide(){return this.$app.slides.actived},cameras(){return this.$app.project.findObjectsByType(we.Camera)||[]}},mounted(){},methods:{saveSlide(){this.$app.slides.save(this.slide)},onCameraChange(){console.log("change");try{if(this.slide.camera?.path&&this.slide.camera?.path!==this.$app.engine.manager.Camera?.path){const e=this.slide.camera.path.split("."),t=this.$app.project.find(e);this.$app.engine.manager.SetCamera(t),t.updateProjectionMatrix()}}catch(e){console.warn(e.message)}}}},_e=(0,B.A)(Ee,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("EditColor");return(0,r.openBlock)(),(0,r.createElementBlock)("div",ke,[(0,r.createElementVNode)("div",null,[t[0]||(t[0]=(0,r.createElementVNode)("div",null," Background ",-1)),(0,r.createElementVNode)("div",null,[(0,r.createVNode)(l)])])])}],["__scopeId","data-v-7ab7797e"]]),Se={class:"slide-tools"},Ne={key:0},Ve={key:0},Ce=["value"],Be={key:1},$e={style:{display:"block",width:"100%"}},xe={class:"overleyicon"},De={key:1,style:{display:"flex","justify-content":"center"}},Te={name:"AssetView",props:{asset:{type:Object}},methods:{async showLib(){const e=await this.$app.assets.selectAsset(["hdr"]);this.$emit("setasset",e)}}},Ie=(0,B.A)(Te,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,[(0,r.createCommentVNode)("assethdr"),(0,r.createElementVNode)("div",$e,[(0,r.createElementVNode)("div",xe,[o.asset?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:0,onClick:t[0]||(t[0]=(...e)=>s.showLib&&s.showLib(...e)),class:"text"},[(0,r.createTextVNode)((0,r.toDisplayString)(o.asset.name||o.asset.uid),1)])),[[l,o.asset.url]]):((0,r.openBlock)(),(0,r.createElementBlock)("div",De,[(0,r.createElementVNode)("button",{onClick:t[1]||(t[1]=(...e)=>s.showLib&&s.showLib(...e))},"Select")]))])]),(0,r.createCommentVNode)("//assethdr")],2112)}]]),Ae={name:"CameraSelector",props:{slide:{type:Object}},data:()=>({}),computed:{bgColor:{get(){return this.slide.background.color},set(e){this.slide.background.value=e.getStyle(),this.slide.background.setValue("color",this.slide.background.value),this.$app.slides.save(),this.$app.engine.getManager().Scene.background=e}},bgHdr:{get(){return this.slide.background.hdr}},selectedCamera:{get(){return this.slide.camera?.path||null},set(e){this.slide.camera.path=e,this.$app.slides.save()}},cameras(){return this.$app.project.findObjectsByType(we.Camera)||[]}},mounted(){},methods:{save(){this.$app.slides.save(this.slide)},onBgChange(e){this.slide.background.setValue(e,this.slide.background[e]),this.$app.slides.save()},async onAssetChange(e){console.log(e.resource),this.slide.background.setValue("hdr",e.resource),this.slide.background.value=e.uid;const t=await this.$app.engine.getAssetsManager().FindAsset(e.uid);this.$app.engine.getManager().Scene.background=t.resource},saveSlide(){this.$app.slides.save(this.slide)},onCameraChange(){console.log("change");try{if(this.slide.camera?.path&&this.slide.camera?.path!==this.$app.engine.manager.Camera?.path){const e=this.slide.camera.path.split("."),t=this.$app.project.find(e);this.$app.engine.manager.SetCamera(t),t.updateProjectionMatrix()}}catch(e){console.warn(e.message)}}},components:{assethdr:Ie}},Me=(0,B.A)(Ae,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("LabelEdit"),i=(0,r.resolveComponent)("ActionsList");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Se,[o.slide?((0,r.openBlock)(),(0,r.createElementBlock)("div",Ne,[(0,r.createElementVNode)("div",null,[t[3]||(t[3]=(0,r.createElementVNode)("div",null,"Name:",-1)),(0,r.createVNode)(l,{modelValue:o.slide.name,"onUpdate:modelValue":[t[0]||(t[0]=e=>o.slide.name=e),s.save]},null,8,["modelValue","onUpdate:modelValue"])]),s.cameras.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",Ve,[t[5]||(t[5]=(0,r.createElementVNode)("label",null,"Camera:",-1)),(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.selectedCamera=e),onChange:t[2]||(t[2]=(...e)=>s.onCameraChange&&s.onCameraChange(...e))},[t[4]||(t[4]=(0,r.createElementVNode)("option",{value:null},"No",-1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.cameras,e=>((0,r.openBlock)(),(0,r.createElementBlock)("option",{key:e.path,value:e.path}," ("+(0,r.toDisplayString)(e.type)+") "+(0,r.toDisplayString)(e.name||`Camera ${e.uid}`),9,Ce))),128))],544),[[r.vModelSelect,s.selectedCamera]])])):((0,r.openBlock)(),(0,r.createElementBlock)("div",Be," There are no cameras available in the project. ")),(0,r.createElementVNode)("div",null,[t[6]||(t[6]=(0,r.createElementVNode)("div",null,"Slide Events:",-1)),(0,r.createVNode)(i,{"onUpdate:target":s.saveSlide,onSave:s.saveSlide,target:o.slide},null,8,["onUpdate:target","onSave","target"])]),(0,r.createCommentVNode)(' <div>\r\n                <div>Background</div>\r\n                <div>{{ slide.background.type }}\r\n                    <RadioButton v-model="slide.background.type" @change="onBgChange"\r\n                        :options="[{ value: \'color\', label: \'Color\' }, { value: \'hdr\', label: \'HDR\' }, { value: \'none\', label: \'No\' }]"\r\n                        name="array-group" />\r\n                </div>\r\n                <EditColor v-if="slide.background?.type === \'color\'" v-model="bgColor"></EditColor>\r\n                <assethdr v-if="slide.background?.type === \'hdr\'" v-model="bgHdr" @setasset="onAssetChange">\r\n                </assethdr>\r\n            </div> ')])):(0,r.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-7512016c"]]),Oe={data:()=>({asset:{uid:"hdrscene"},view:!0}),name:"SceneTools",computed:{slides(){return this.$app.slides.children},slide(){return this.$app.slides.actived}},components:{slideTools:Me,InspectorPanel:te,scenetools:_e},methods:{removeSlide(){this.$app.slides.remove()}}},je=(0,B.A)(Oe,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("slideTools"),i=(0,r.resolveComponent)("InspectorPanel");return(0,r.openBlock)(),(0,r.createElementBlock)("div",be,[(0,r.createVNode)(i,{label:"Slide Options"},(0,r.createSlots)({_:2},[s.slide?{name:"content",fn:(0,r.withCtx)(()=>[(0,r.createVNode)(l,{slide:s.slide},null,8,["slide"])]),key:"0"}:void 0]),1024),(0,r.createVNode)(i,{label:"Player Options"},(0,r.createSlots)({_:2},[s.slide?{name:"content",fn:(0,r.withCtx)(()=>[(0,r.createVNode)(l,{slide:s.slide},null,8,["slide"])]),key:"0"}:void 0]),1024)])}]]),Pe={methods:{getState(){return this.$app.models.getState(this.selected,this.slide)},getProp(e){const t=e.prop.split(".");let o=t[0],n=this.selected;for(let e=0;e<t.length-1;e++)n=n[t[e]],o=t[e+1];return n[o]},async saveElement(e,t){e.onupdate&&await e.onupdate(this.selected,null,null,this.slide),await this.$app.models.save(this.selected)},async setTargetProperty(e,t,o){if(e.onupdate){const n=await e.onupdate(this.selected,t,o,this.slide);if(!this.selected.isElement||n)return}else"state"in e&&!0!==e.state?this.selected[t]=o?.encode?o.encode():o:this.getState()[t]=o?.encode?o.encode():o;e.nosave||(this.selected.isElement?await this.$app.models.save(this.selected):this.selected.isAsset&&await this.$app.assets.save(this.selected))},async onComponentChanged(e,t,o,n){console.log(t,o),this.selected[t]=o,this.selected.isElement?this.setTargetProperty(e,t,o,n):e.onupdate&&await e.onupdate(this.selected,t,o,this.slide)},async onCleanStateValue(e,t){e.onclean?await e.onclean(this.selected,t,e,this.slide):t in this.getState()&&(delete this.getState()[t],await this.$app.models.save(this.selected))}},computed:{selected(){return this.$app.selection.selected},selectedUID(){return this.$app.selection.uid},blocks(){return[{label:"Name",content:{component:"LabelEdit",prop:"name",state:!1},head:{component:"Label",prop:"name"}},{label:"Type",readonly:!0,head:{component:"Label",prop:"type"}},...this.$app.inspector.blocksFor(this.selected.types)]},slide(){return this.$app.slides.actived?.uid}},watch:{selected(e){console.log(e),e&&e.restore&&e.restore()}},components:{InspectorPanel:te,modeltypes:se,assetsview:ye,ViewPanel:$,SceneTools:je}},Le=(0,B.A)(Pe,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveComponent)("InspectorPanel"),c=(0,r.resolveComponent)("ViewPanel"),d=(0,r.resolveDirective)("tooltip"),p=(0,r.resolveDirective)("translate");return(0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,[(0,r.createVNode)(c,{class:"inspector"},{footer:(0,r.withCtx)(()=>[(0,r.createCommentVNode)(" <SceneTools></SceneTools> ")]),default:(0,r.withCtx)(()=>[s.selectedUID?((0,r.openBlock)(),(0,r.createElementBlock)("div",W,[(0,r.createCommentVNode)(" <div>{{ selected.paths.join('->') }}</div> "),(0,r.renderSlot)(e.$slots,"default",{},()=>[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.blocks,(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(i,{label:e.label,tooltip:e.tooltip,stat:e.state,key:e.label},(0,r.createSlots)({_:2},[e.readonly?void 0:{name:"icons",fn:(0,r.withCtx)(({stat:t})=>[e.nonstate?(0,r.createCommentVNode)("v-if",!0):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("span",{key:0,onClick:t=>s.onCleanStateValue(e.head||e.content,e.head?e.head.prop:e.content.prop),class:"remove-icon"},[(0,r.createVNode)(l,{value:"bin"})],8,K)),[[d,"Очистить значение в слайде"]])]),key:"0"},e.head?{name:"head",fn:(0,r.withCtx)(({togglePanel:t})=>[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.head.component),(0,r.mergeProps)({ref_for:!0},e.head.props,{modelValue:s.selected[e.head.prop],"onUpdate:modelValue":[t=>s.selected[e.head.prop]=t,(...t)=>s.setTargetProperty(e.head,e.head.prop,...t)],value:s.selected,property:e.head,target:e.head.state?s.getState():s.selected,onClean:(...t)=>s.onCleanStateValue(e.head,...t),onSave:t=>s.saveElement(e.head),"onUpdate:target":(...t)=>s.setTargetProperty(e.head,...t),"onUpdate:value":(...t)=>s.onComponentChanged(e.head,e.head.prop,...t),onToggle:e=>t()},(0,r.toHandlers)(e.head.events||{})),null,16,["modelValue","onUpdate:modelValue","value","property","target","onClean","onSave","onUpdate:target","onUpdate:value","onToggle"]))]),key:"1"}:void 0,e.content?{name:"content",fn:(0,r.withCtx)(({togglePanel:t})=>[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.content.component),(0,r.mergeProps)({class:"blockcomponent"},{ref_for:!0},e.content.props||{},{value:s.selected,modelValue:s.selected[e.content.prop],"onUpdate:modelValue":[t=>s.selected[e.content.prop]=t,(...t)=>s.setTargetProperty(e.content,e.content.prop,...t)],property:e.content,target:e.content.state?s.getState():s.selected,options:{inspector:!0},onClean:(...t)=>s.onCleanStateValue(e.content,...t),onSave:t=>s.saveElement(e.content),"onUpdate:target":(...t)=>s.setTargetProperty(e.content,...t),"onUpdate:value":(...t)=>s.onComponentChanged(e.content,e.content.prop,...t),onToggle:e=>t()},(0,r.toHandlers)(e.content.events||{})),null,16,["value","modelValue","onUpdate:modelValue","property","target","onClean","onSave","onUpdate:target","onUpdate:value","onToggle"]))]),key:"2"}:void 0]),1032,["label","tooltip","stat"]))),128))])])):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",Y,[...t[0]||(t[0]=[(0,r.createTextVNode)(" $$Select an model or asset ",-1)])])),[[p]])]),_:3}),(0,r.createCommentVNode)(' <div class="panel-container">\r\n        <div class="panel">\r\n            <div class="header">Inspector</div>\r\n            <div class="content">\r\n                \r\n            </div>\r\n            <div class="footer">\r\n\r\n            </div>\r\n        </div>\r\n    </div> ')],2112)}]]),Re={class:"hierarhy-view"},Fe={class:"hierarhy-head"},Ue={class:"treeicon"},ze=["draggable","droppable"],He={class:"roottree"},qe=["draggable"],Ge={class:"tree-node-content"},We={class:"selector"},Ke=["checked"],Ye={key:0,class:"prepender"},Je=["title"],Xe={key:1,class:"appender"},Ze={key:0,class:"children"},Qe={key:1};function et(e,t){for(let o=0;o<e.length;o++)e[o].isSelected=t,e[o].children&&et(e[o].children,t)}const tt={name:"TreeNode",props:{node:{type:Object,required:!0},selector:{type:Boolean,default:!0},index:{type:Number},focused:{type:Boolean,default:!1},childsFiled:{type:String,default:"childrens"},filter:{type:Function},draggable:{type:Boolean,default:!0},droppable:{type:Boolean,default:!0}},computed:{list(){return this.filter?this.filter(this.node[this.childsFiled]):this.node[this.childsFiled]}},data:()=>({expanded:{},childloaded:{},isLoading:!1,selectChangeEvent:(0,r.inject)("selectChangeEvent",null),clickNodeEvent:(0,r.inject)("clickNodeEvent",null),dropNodeEvent:(0,r.inject)("nodeDropEvent",null),isDragOver:!1}),methods:{onDragStart(e){this.$app.app.draggedNode=this.node,e.dataTransfer.items.add(JSON.stringify({uid:this.node.uid,type:this.node.type,isAsset:this.node.isAsset,isElement:this.node.isElement,isModel:this.node.isModel}),"application/json"),e.dataTransfer.effectAllowed="copy"},onDragOver(e){e.dataTransfer.dropEffect="copy",this.isDragOver=!0},onDragEnter(e){this.isDragOver=!0,!this.expanded[this.node.uid]&&this.node[this.childsFiled]?.length&&this.toggleExpand()},onDragLeave(){this.isDragOver=!1},onDrop(e){this.isDragOver=!1,this.dropNodeEvent({target:this.node,source:this.$app.app.draggedNode})},async toggleExpand(){this.node[this.childsFiled]&&0!==this.node[this.childsFiled].length&&(this.expanded[this.node.uid]=!this.expanded[this.node.uid],this.expanded[this.node.uid]&&!this.childloaded[this.node.uid]&&await this.loadChildren(),this.$emit("updateExpanded",this.node))},async loadChildren(){this.childloaded[this.node.uid]=!0},onChildSelectChange(e){},onCheckboxChange(e){e.isSelected=!e.isSelected,e[this.childsFiled]?.length&&et(e[this.childsFiled],e.isSelected),this.selectChangeEvent(this.node),this.$emit("changeSelection",this.node)},selectNode(e){this.clickNodeEvent(this.node)}}},ot={components:{TreeNode:(0,B.A)(tt,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("TreeNode",!0);return(0,r.openBlock)(),(0,r.createElementBlock)("li",{class:(0,r.normalizeClass)(["tree-node",{"drag-over":a.isDragOver}]),draggable:o.draggable,onDragstart:t[3]||(t[3]=(0,r.withModifiers)(e=>o.draggable&&s.onDragStart(e),["stop"])),onDragover:t[4]||(t[4]=(0,r.withModifiers)((...e)=>s.onDragOver&&s.onDragOver(...e),["prevent"])),onDragenter:t[5]||(t[5]=(0,r.withModifiers)((...e)=>s.onDragEnter&&s.onDragEnter(...e),["prevent"])),onDragleave:t[6]||(t[6]=(...e)=>s.onDragLeave&&s.onDragLeave(...e)),onDrop:t[7]||(t[7]=(0,r.withModifiers)((...e)=>s.onDrop&&s.onDrop(...e),["prevent","stop"]))},[(0,r.createElementVNode)("div",Ge,[(0,r.createElementVNode)("span",{class:"collapser",onClick:t[0]||(t[0]=(...e)=>s.toggleExpand&&s.toggleExpand(...e))},[s.list?.length?(0,r.renderSlot)(e.$slots,"icon",{key:0,node:o.node},()=>[(0,r.createTextVNode)((0,r.toDisplayString)(a.expanded[o.node.uid]?"▼":"▶"),1)],!0):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("span",We,[o.selector?(0,r.renderSlot)(e.$slots,"checkbox",{key:0},()=>[(0,r.createElementVNode)("input",{ref:"checkedInput",type:"checkbox",onChange:t[1]||(t[1]=e=>s.onCheckboxChange(o.node)),checked:o.node.isSelected},null,40,Ke)],!0):(0,r.createCommentVNode)("v-if",!0)]),e.$slots.prepend?((0,r.openBlock)(),(0,r.createElementBlock)("span",Ye,[(0,r.renderSlot)(e.$slots,"prepend",{node:o.node},void 0,!0)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("span",{class:"labeler",title:o.node.uid,onClick:t[2]||(t[2]=(...e)=>s.selectNode&&s.selectNode(...e))},[(0,r.renderSlot)(e.$slots,"label",{node:o.node},()=>[(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(o.node.uid)+"|",1)],!0)],8,Je),e.$slots.append?((0,r.openBlock)(),(0,r.createElementBlock)("span",Xe,[(0,r.renderSlot)(e.$slots,"append",{node:o.node,index:o.index},void 0,!0)])):(0,r.createCommentVNode)("v-if",!0)]),a.expanded[o.node.uid]&&Array.isArray(s.list)&&s.list.length?((0,r.openBlock)(),(0,r.createElementBlock)("ul",Ze,[a.childloaded[o.node.uid]?((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:0},(0,r.renderList)(s.list,t=>((0,r.openBlock)(),(0,r.createBlock)(l,{draggable:o.draggable,onChangeSelection:s.onChildSelectChange,filter:o.filter,selector:o.selector,focused:t.focused,key:t.uid,node:t,childsFiled:o.childsFiled},(0,r.createSlots)({_:2},[(0,r.renderList)(e.$slots,(t,o)=>({name:o,fn:(0,r.withCtx)(t=>[(0,r.renderSlot)(e.$slots,o,(0,r.mergeProps)({ref_for:!0},t),void 0,!0)])}))]),1032,["draggable","onChangeSelection","filter","selector","focused","node","childsFiled"]))),128)):((0,r.openBlock)(),(0,r.createElementBlock)("div",Qe," load... "))])):(0,r.createCommentVNode)("v-if",!0)],42,qe)}],["__scopeId","data-v-9bb33550"]])},computed:{list(){return this.filter?this.filter(this.tree):this.tree}},data:()=>({expandeds:{},isDragOver:!1}),props:{tree:{type:Array,required:!0},selector:{type:Boolean,default:!1},focused:{type:Boolean,default:!1},childsFiled:{type:String,default:"children"},filter:{type:Function},draggable:{type:Boolean,default:!1},droppable:{type:Boolean,default:!1}},setup(e,{slots:t,emit:o}){(0,r.provide)("clickNodeEvent",e=>{o("clickNode",e)}),(0,r.provide)("selectChangeEvent",e=>{o("changeSelect",e)}),(0,r.provide)("nodeDropEvent",e=>{o("node-drop",e)})},methods:{onDragOver(e){e.dataTransfer.dropEffect="copy",this.isDragOver=!0},onDragEnter(e){this.isDragOver=!0},onDragLeave(){this.isDragOver=!1},onDrop(e){this.isDragOver=!1,console.log(e.dataTransfer?.items);for(let t of e.dataTransfer?.items)console.log(`Type: ${t.type}, Kind: ${t.kind}`),"text/plain"!==t.type&&"application/json"!==t.type||t.getAsString(e=>{const t=JSON.parse(e);this.$emit("node-drop",{target:null,source:t})})},onUpdateExpanded(e){},findNodeByUid(e,t){for(let o of e){if(o.uid===t)return o;if(o.children){let e=this.findNodeByUid(o.children,t);if(e)return e}}return null},removeNodeFromTree(e,t){for(let o=0;o<e.length;o++){if(e[o].uid===t)return e.splice(o,1),!0;if(e[o][this.childsFiled]&&this.removeNodeFromTree(e[o][this.childsFiled],t))return!0}return!1}}},nt=(0,B.A)(ot,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("TreeNode");return(0,r.openBlock)(),(0,r.createElementBlock)("div",{class:(0,r.normalizeClass)(["treecontainer",{"drag-over":a.isDragOver}]),draggable:o.draggable,droppable:o.droppable,onDrop:t[0]||(t[0]=(0,r.withModifiers)((...e)=>s.onDrop&&s.onDrop(...e),["prevent","stop"])),onDragover:t[1]||(t[1]=(0,r.withModifiers)((...e)=>s.onDragOver&&s.onDragOver(...e),["prevent"])),onDragenter:t[2]||(t[2]=(0,r.withModifiers)((...e)=>s.onDragEnter&&s.onDragEnter(...e),["prevent"])),onDragleave:t[3]||(t[3]=(...e)=>s.onDragLeave&&s.onDragLeave(...e))},[(0,r.createElementVNode)("ul",He,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.list,(t,n)=>((0,r.openBlock)(),(0,r.createBlock)(l,{key:t.uid,filter:o.filter,selector:o.selector,node:t,index:n,focused:o.focused,childsFiled:o.childsFiled,onUpdateExpanded:s.onUpdateExpanded,draggable:o.draggable,droppable:o.droppable},(0,r.createSlots)({_:2},[(0,r.renderList)(e.$slots,(t,o)=>({name:o,fn:(0,r.withCtx)(t=>[(0,r.renderSlot)(e.$slots,o,(0,r.mergeProps)({ref_for:!0},t),void 0,!0)])}))]),1032,["filter","selector","node","index","focused","childsFiled","onUpdateExpanded","draggable","droppable"]))),128))])],42,ze)}],["__scopeId","data-v-d3191960"]]),at={name:"TreeAssets",props:{title:""},data:()=>({filtersView:!1,filterRect:{},focused:[],editform:!1,editedAsset:{},newAsset:!1,viewlib:!1,libButtons:{add:!0,save:!1}}),watch:{"assets.list"(e){console.log(e)}},computed:{models(){return this.$app.models},slide(){return this.$app.slides.actived},tree(){return this.$app.assets.list.reduce((e,t)=>{let o=e.find(e=>e.type===t.type);return o||(o={isgroup:!0,type:t.type,children:[],uid:t.type},e.push(o)),o.children.push(t),e},[])},assets(){return this.$app.assets},selected(){return this.$app.selection.selected}},methods:{onEdit(e,t){this.editedAsset[e]=t},editAsset(e){this.editedAsset=e?{...e,progress:0}:{uid:null,type:"model",name:"New asset",url:"https://",parameters:{},progress:0},this.$app.assets.editAsset(this.editedAsset)},insertAsset(e){this.$app.project.handleAsset({source:e,target:this.$app.selection.selected})},onUpdateExpanded(e){},onNodeClick(e){this.$app.selection.select(e.isgroup?null:e)},onChangeSelection(){},remove(e){this.$app.modal.confirmReq((0,r.reactive)({title:"Confirm asset remove",text:`Remove asset ${e.name||e.uid} ?`}),[{label:"YES",class:"primary",callback:async()=>{this.assets.remove(e)}},{label:"NO",class:"secondary",callback:async e=>{this.$app.modal.close()}}])}},components:{TreeView:nt}},rt=(0,B.A)(at,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveComponent)("TreeView"),c=(0,r.resolveDirective)("translate"),d=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Re,[(0,r.createElementVNode)("div",Fe,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("span",null,[(0,r.createTextVNode)((0,r.toDisplayString)(o.title)+":",1)])),[[c]]),t[2]||(t[2]=(0,r.createTextVNode)()),(0,r.createElementVNode)("button",{onClick:t[0]||(t[0]=e=>s.assets.selectAsset([],!1))},[(0,r.createVNode)(l,{value:"plus",size:"0.75em"})])]),(0,r.createVNode)(i,{childsFiled:"children",tree:s.tree,onClickNode:s.onNodeClick,onChangeSelect:s.onChangeSelection,onUpdateExpanded:s.onUpdateExpanded,draggable:!0},{prepend:(0,r.withCtx)(({node:e})=>[e.isAsset?((0,r.openBlock)(),(0,r.createBlock)(l,{key:0,value:s.assets.icons[e.type],size:"1em"},null,8,["value"])):(0,r.createCommentVNode)("v-if",!0)]),append:(0,r.withCtx)(({node:e,index:t})=>[(0,r.createElementVNode)("div",Ue,[(0,r.createCommentVNode)(' <icon v-if="!node.isgroup" value="target" v-tooltip="\'Find\'" size="1em" @click="$emit(\'target\', node)"></icon> '),(0,r.createCommentVNode)(' <icon v-if="!node.isgroup" value="pencil" v-tooltip="\'Редактировать\'" size="1em" @click="editAsset(node)">\r\n          </icon> '),e.isModel&&s.slide?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createBlock)(l,{key:0,value:"download",size:"1em",onClick:t=>s.models.createFromAsset(e)},null,8,["onClick"])),[[d,"Insert to scene"]]):(0,r.createCommentVNode)("v-if",!0),e.isgroup?(0,r.createCommentVNode)("v-if",!0):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createBlock)(l,{key:1,value:"bin",size:"1em",onClick:t=>s.remove(e)},null,8,["onClick"])),[[d,"Delete"]])])]),label:(0,r.withCtx)(({node:o})=>[(0,r.createCommentVNode)(' <div @click="onSelectedNode" :class="{ \'focusedtree\': selected === node }"  class="label"\r\n          v-tooltip="`${node.url || node.type}`"> {{ node.name || node.uid }}</div> '),(0,r.createElementVNode)("div",{onClick:t[1]||(t[1]=(...t)=>e.onSelectedNode&&e.onSelectedNode(...t)),class:(0,r.normalizeClass)([{focusedtree:s.selected===o},"label"])},(0,r.toDisplayString)(o.name||o.uid),3)]),_:1},8,["tree","onClickNode","onChangeSelect","onUpdateExpanded"])])}],["__scopeId","data-v-4acc2793"]]),st={class:"hierarhy-view"},lt={class:"treeicon"},it={class:"container"},ct={class:"block"},dt={class:"content"},pt={class:"sub-content"},ut={class:"subtitle"},mt={class:"subtitle"},ht=["value"],ft={props:{callback:{type:Function},modelValue:{type:Object,default:()=>({label:"",type:"model"})},parent:{type:Object},list:{type:Array}},computed:{name:{get(){return this.modelValue.name},set(e){this.$emit("update:modelValue",{name:e,type:this.modelValue.type})}},type:{get(){return this.modelValue.type},set(e){this.$emit("update:modelValue",{name:this.modelValue.name,type:e})}}}},vt=(0,B.A)(ft,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveDirective)("translate");return(0,r.openBlock)(),(0,r.createElementBlock)("div",it,[(0,r.createElementVNode)("div",ct,[(0,r.createElementVNode)("div",dt,[(0,r.createElementVNode)("div",pt,[(0,r.createElementVNode)("div",ut,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"text",placeholder:"Name","onUpdate:modelValue":t[0]||(t[0]=e=>s.name=e)},null,512),[[r.vModelText,s.name]])]),(0,r.createElementVNode)("div",mt,[(0,r.withDirectives)((0,r.createElementVNode)("select",{class:"typeslist","onUpdate:modelValue":t[1]||(t[1]=e=>s.type=e)},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.list,e=>(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("option",{value:e.type},[(0,r.createTextVNode)((0,r.toDisplayString)(e.label),1)],8,ht)),[[l,`elements.${e.label}`]])),256))],512),[[r.vModelSelect,s.type]])])])])])])}],["__scopeId","data-v-4e7f94d3"]]),gt={name:"TreeElement",props:{title:""},mounted(){},data:()=>({filtersView:!1,filterRect:{},requestRemove:!1,removeData:{text:""},newElementData:{},addElementView:!1}),computed:{selected(){return this.$app.selection.selected},selection(){return this.$app.selection},tree(){return this.$app.elements.children}},methods:{filterElements:e=>e,async insertToSlide(e){e.state?this.$app.toasts.add({message:"Элемент уже добавлен в этот слайд"}):await this.$app.slides.addState(e)},deleteElement(e){this.removeData.text=`Delete ${e.name} (${e.uid}) ?`,this.$app.modal.open({header:{value:"Delete item",handler:()=>{this.$app.modal.close(),this.requestRemove=!1}},content:{},footer:{buttons:[{label:"Delete",class:"secondary",handler:async()=>{this.$app.modal.close(),this.requestRemove=!1,this.$app.elements.remove(e),this.$app.toasts.add({message:`Элемент ${e.name} удален`})}},{label:"Cancel",class:"primary",handler:async()=>{this.$app.modal.close(),this.requestRemove=!1}}]}})},onUpdateExpanded(e){},onNodeClick(e){this.$app.selection.select(e)},onChangeSelection(){},addElement(){if(this.selected){const e=this.$app.elements.findElement(this.selected.paths);this.$app.selection.select(e)}let e;this.newElementData.name="New Element",this.newElementData.uid=`Element${Date.now()}`,this.newElementData.type="Group",this.newElementData.paths=[],this.selected&&this.selected.isElement&&(e=this.selected,this.newElementData.paths.push(...this.selected.paths)),this.newElementData.paths.push(this.newElementData.uid),this.newElementData.path=this.newElementData.paths.join("."),this.newElementData.props={visible:!0},this.$app.modal.open({header:{value:`Add element ${e?" to "+e.name||0:" scene"}`,handler:()=>{this.$app.modal.close(),this.addElementView=!1}},content:{},footer:{buttons:[{label:"Add",class:"secondary",handler:async()=>{await this.$app.elements.create(this.newElementData,e),this.$app.modal.close(),this.addElementView=!1}},{label:"Cancel",class:"primary",handler:async()=>{this.$app.modal.close(),this.addElementView=!1}}]}}),this.addElementView=!0}},components:{TreeView:nt,ElementAdd:vt}},yt=(0,B.A)(gt,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveComponent)("TreeView"),c=(0,r.resolveComponent)("ElementAdd"),d=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",st,[(0,r.createElementVNode)("div",null,[(0,r.createTextVNode)((0,r.toDisplayString)(o.title)+": ",1),(0,r.createElementVNode)("button",{onClick:t[0]||(t[0]=(...e)=>s.addElement&&s.addElement(...e))},[(0,r.createVNode)(l,{value:"plus",size:"0.75em"})])]),(0,r.createVNode)(i,{filter:s.filterElements,tree:s.tree,onClickNode:s.onNodeClick,onChangeSelect:s.onChangeSelection,childsFiled:"children",onUpdateExpanded:s.onUpdateExpanded,selector:!1},{append:(0,r.withCtx)(({node:e,index:t})=>[(0,r.createElementVNode)("div",lt,[(0,r.createCommentVNode)(' <icon value="target" v-tooltip="\'Фокус\'" size="1em" @click="$emit(\'target\', node)"></icon>'),(0,r.createCommentVNode)(" <icon v-tooltip=\"'Видимость'\" :value=\"node.show ? 'eye' : 'eye-blocked'\" size=\"1em\"\r\n            @click=\"node.visible = !node.visible\" :color=\"node.visible ? '#8ec58e' : '#8ec58e80'\">\r\n          </icon> "),e.parent?(0,r.createCommentVNode)("v-if",!0):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createBlock)(l,{key:0,value:"dice",size:"1em",onClick:t=>s.insertToSlide(e),color:e.state?"#8ec58e":"#8ec58e80"},null,8,["onClick","color"])),[[d,"Add to slide"]]),(0,r.withDirectives)((0,r.createVNode)(l,{onClick:t=>s.deleteElement(e),value:"bin",size:"1em"},null,8,["onClick"]),[[d,"Remove"]]),(0,r.createCommentVNode)(' <icon v-if="index === 0" size="100%" value="bin"></icon> ')])]),label:(0,r.withCtx)(({node:e})=>[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)([{focusedtree:s.selected===e},"label"])},(0,r.toDisplayString)(e.name||e.uid),3)]),_:1},8,["filter","tree","onClickNode","onChangeSelect","onUpdateExpanded"]),a.addElementView?((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{key:0,to:".modal-content"},[(0,r.createVNode)(c,{value:a.newElementData,"onUpdate:value":t[1]||(t[1]=e=>a.newElementData=e),parent:s.selected},null,8,["value","parent"])])):(0,r.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-3eac9d53"]]),bt={class:"hierarhy-view"},kt={class:"hierarhy-head"},wt=["onUpdate:modelValue","onChange"],Et={class:"treeicon"};function _t(e,t){e.children??=[],(t.children||[]).forEach(t=>{let o=e.children.find(e=>e.path===t.path);o?_t(o,t):e.children.push(t)})}const St=(0,o(334).reactive)({addMenu:function(e,...t){t.forEach(t=>{const o=St[e].list.find(e=>e.path===t.path);o?_t(o,t):St[e].list.push(t)})},top:{list:[]}});Symbol.toStringTag;let Nt="en",Vt={},Ct=[],Bt="$$";const $t={beforeMount(e,t){xt(e,t),Ct.push(()=>{xt(e,t)})},updated(e,t){xt(e,t)}};function xt(e,t){(function(e){const t=[],o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null,!1);let n;for(;n=o.nextNode();)n.nodeValue.trim()&&t.push(n);return t})(e).forEach(o=>{const n=o.nodeValue.trim();if(t.value||n.startsWith(Bt)||e.$translate){let a;e.$translate||(t.value?e.$translate=n.startsWith(Bt)?n.slice(Bt.length):n:n.startsWith(Bt)?e.$translate=n.slice(Bt.length):e.$translate=n),a=t.value?t.value.startsWith(Bt)?t.value.slice(Bt.length):t.value:n.startsWith(Bt)?n.slice(Bt.length):e.$translate;const r=Dt(a);o.nodeValue=r===a?e.$translate:r}})}function Dt(e,t){if(!Vt[Nt])return e;let o=Vt[Nt][e]??e;return t&&Object.keys(t).forEach(e=>{o=o.replace(e,t[e])}),o}function Tt(e){return Ct.push(e),()=>{const t=Ct.indexOf(e);t>-1&&Ct.splice(t,1)}}const It=Object.freeze(Object.defineProperty({__proto__:null,directive:$t,getCurrentLanguage:function(){return Nt},interTranslate:async function(e,t,o){try{return await(await Translator.create({sourceLanguage:t,targetLanguage:o})).translate(e)}catch(e){console.error("Ошибка перевода:",e)}},onLanguageChange:Tt,setLanguage:function(e){Nt!==e&&Vt[e]&&(Nt=e,Ct.forEach(t=>t(e)))},setOptions:function(e){e.sym&&(Bt=e.sym)},setTranslations:function(e,t){Vt[e]=t,Nt===e&&Ct.forEach(t=>t(e))},translateText:Dt,updateTranslations:function(e,t){const o=Vt[e];o&&Object.keys(t).forEach(e=>{o[e]=t[e]})}},Symbol.toStringTag,{value:"Module"})),At=document.createElement("div");At.className="tooltip",At.style.position="absolute",At.style.visibility="hidden",document.body.appendChild(At);let Mt=null;const Ot=(e,t,o)=>{const n=((e,t)=>{if(t){const o=Dt(`tooltip.${t}`);return o===`tooltip.${t}`?e:o}if("string"==typeof e){const t=Dt(`tooltip.${e}`);return t===`tooltip.${e}`?e:t}return e})(t,o.arg);if(At.textContent=n,!n||0===n.length)return void(At.style.visibility="hidden");const a=e.getBoundingClientRect();let r=a.left+window.scrollX+a.width/2-At.offsetWidth/2,s=a.top+window.scrollY-At.offsetHeight-5;r+At.offsetWidth>window.innerWidth&&(r=window.innerWidth-At.offsetWidth-10),r<0&&(r=10),s+At.offsetHeight>window.innerHeight&&(s=a.top+window.scrollY+a.height+5),s<0&&(s=a.top+window.scrollY+a.height+5),At.style.left=`${r}px`,At.style.top=`${s}px`,At.style.visibility="visible"};Tt(()=>{if(Mt){const e=Mt.__lastTooltipValue__;Ot(Mt,e)}});const jt={beforeMount(e,t){e.__lastTooltipValue__=t.value;const o=()=>{Mt=e,Ot(e,t.value,t)},n=()=>{Mt===e&&(At.style.visibility="hidden",Mt=null)};e.__tooltipHandlers__={mouseEnterHandler:o,mouseLeaveHandler:n},e.addEventListener("mouseenter",o),e.addEventListener("mouseleave",n)},updated(e,t){e.__lastTooltipValue__=t.value,Mt===e&&Ot(e,t.value,t)},unmounted(e){const{mouseEnterHandler:t,mouseLeaveHandler:o}=e.__tooltipHandlers__||{};t&&e.removeEventListener("mouseenter",t),o&&e.removeEventListener("mouseleave",o),Mt===e&&(At.style.visibility="hidden",Mt=null)}},Pt={name:"TreeElement",props:{title:""},data:()=>({filtersView:!1,filterRect:{},requestRemove:!1,removeData:{text:""}}),computed:{models(){return this.$app.models},selected(){return this.$app.selection.selected},selection(){return this.$app.selection},tree(){return this.$app.models.children}},methods:{onDrop(e){if(e.source.isAsset)switch(e.source.type){case"model":case"image":const t=this.$app.assets.getAsset(e.source.uid);this.models.createFromAsset(t,e.target?.paths);break;default:this.$app.toasts.add({message:It.translateText("This type cannot be placed on stage")})}},async updateVisible(e){this.$app.models.getState(e,this.$app.slides.actived.uid).visible=e.visible,await this.$app.models.save(e)},filterElements:e=>e.filter(e=>e.isElement||e.isHepler),async insertToSlide(e){e.state?this.$app.toasts.add({message:"The element has already been added to this slide"}):await this.$app.slides.addState(e)},deleteElement(e){this.removeData.text=`Delete ${e.name} (${e.uid}) ?`,this.$app.modal.open({header:{value:"Delete item",handler:()=>{this.$app.modal.close(),this.requestRemove=!1}},content:{},footer:{buttons:[{label:"Delete",class:"secondary",handler:async()=>{this.$app.modal.close(),this.requestRemove=!1,this.$app.models.remove(e.paths),this.$app.toasts.add({message:`The element ${e.name} is deleted`})}},{label:"Cancel",class:"primary",handler:async()=>{this.$app.modal.close(),this.requestRemove=!1}}]}})},onUpdateExpanded(e){},onNodeClick(e){this.$app.selection.select(e)},onChangeSelection(){}},components:{TreeView:nt}},Lt=(0,B.A)(Pt,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveComponent)("TreeView"),c=(0,r.resolveDirective)("translate"),d=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",bt,[(0,r.createElementVNode)("div",kt,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("span",null,[(0,r.createTextVNode)((0,r.toDisplayString)(o.title)+":",1)])),[[c]]),t[1]||(t[1]=(0,r.createTextVNode)()),(0,r.createElementVNode)("button",{onClick:t[0]||(t[0]=e=>s.models.createTo(s.selected))},[(0,r.createVNode)(l,{value:"plus",size:"0.75em"})])]),(0,r.createVNode)(i,{filter:s.filterElements,tree:s.tree,onClickNode:s.onNodeClick,onChangeSelect:s.onChangeSelection,childsFiled:"children",onUpdateExpanded:s.onUpdateExpanded,selector:!1,droppable:!0,onNodeDrop:s.onDrop},{prepend:(0,r.withCtx)(({node:e,index:t})=>[(0,r.createElementVNode)("div",null,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t=>e.visible=t,onChange:t=>s.updateVisible(e)},null,40,wt),[[r.vModelCheckbox,e.visible]])])]),append:(0,r.withCtx)(({node:e,index:t})=>[(0,r.createElementVNode)("div",Et,[(0,r.createCommentVNode)(' <icon value="target" v-tooltip="\'Фокус\'" size="1em" @click="$emit(\'target\', node)"></icon>'),(0,r.createCommentVNode)(" <icon v-tooltip=\"'Видимость'\" :value=\"node.show ? 'eye' : 'eye-blocked'\" size=\"1em\"\r\n            @click=\"node.visible = !node.visible\" :color=\"node.visible ? '#8ec58e' : '#8ec58e80'\">\r\n          </icon> "),e.parent?(0,r.createCommentVNode)("v-if",!0):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createBlock)(l,{key:0,value:"dice",size:"1em",onClick:t=>s.insertToSlide(e),color:e.state?"#8ec58e":"#8ec58e80"},null,8,["onClick","color"])),[[d,"Add to slide"]]),(0,r.withDirectives)((0,r.createVNode)(l,{onClick:t=>s.deleteElement(e),value:"bin",size:"1em"},null,8,["onClick"]),[[d,"Remove"]]),(0,r.createCommentVNode)(' <icon v-if="index === 0" size="100%" value="bin"></icon> ')])]),label:(0,r.withCtx)(({node:e})=>[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)([{focusedtree:s.selected===e},"label"])},(0,r.toDisplayString)(e.name||e.uid),3)]),_:1},8,["filter","tree","onClickNode","onChangeSelect","onUpdateExpanded","onNodeDrop"])])}],["__scopeId","data-v-58798798"]]),Rt={class:"hierarhy-view"},Ft={class:"treeicon"},Ut={name:"Hierarhy",props:{title:""},data:()=>({filtersView:!1,filterRect:{}}),computed:{selected(){return this.$app.selection.selected},slide(){return this.$app.slides.actived||{children:[]}}},methods:{getElement(){},removeSlide(){this.$app.slides.remove(this.$app.slides.actived.uid)},removeState(e){this.$app.slides.removeState(e.paths),this.$app.toasts.add({message:`${e.data.name||e.uid} удален`})},onNodeClick(e){this.$app.selection.select(e)},onChangeSelection(){},onUpdateExpanded(){},assState(){"block"===this.$app.selection.element?.type||this.$app.toasts.add({message:"Только типы block можно добавлять в состояния"})}},components:{TreeView:nt}},zt=(0,B.A)(Ut,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveComponent)("TreeView"),c=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Rt,[(0,r.createElementVNode)("div",null,[(0,r.createTextVNode)((0,r.toDisplayString)(o.title)+" : "+(0,r.toDisplayString)(s.slide.name)+" ",1),(0,r.withDirectives)((0,r.createVNode)(l,{onClick:t[0]||(t[0]=e=>s.removeSlide()),value:"bin",size:"1em"},null,512),[[c,"Delete slide"]])]),(0,r.createVNode)(i,{tree:s.slide.children,onClickNode:s.onNodeClick,onChangeSelect:s.onChangeSelection,onUpdateExpanded:s.onUpdateExpanded,selector:!1},{checkbox:(0,r.withCtx)(()=>[...t[1]||(t[1]=[(0,r.createElementVNode)("span",null,[(0,r.createElementVNode)("input",{type:"checkbox"})],-1)])]),append:(0,r.withCtx)(({node:e,index:t})=>[(0,r.createCommentVNode)(' <div class="filters" v-if="index === 0">\n                    <button v-tooltip="\'Change filters\'"  @click="viewFilters" class="filterbutton">\n                        <icon v-for="v in target.filters" :value="v.props.value" :color="v.props.color" size="1em"></icon>\n                    </button>\n                    <PopupList v-if="filtersView" :rect="filterRect" :values="target.filters" @callback="filtersView = false"></PopupList>\n                </div> '),(0,r.createElementVNode)("div",Ft,[(0,r.createCommentVNode)(' <icon value="target" v-tooltip="\'Fit\'" size="1em" @click="$emit(\'target\', node)"></icon>\n          <icon v-tooltip="\'Visible\'" :value="node.isVisible ? \'eye\' : \'eye-blocked\'" size="1em"\n            @click="$emit(\'visible\', node)">\n          </icon> '),e.isBlock?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createBlock)(l,{key:0,onClick:t=>s.removeState(e),value:"bin",size:"1em"},null,8,["onClick"])),[[c,"Remove element from slide"]]):(0,r.createCommentVNode)("v-if",!0)])]),label:(0,r.withCtx)(({node:e})=>[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)([{focusedtree:s.selected===e},"label"])},(0,r.toDisplayString)(e.name||e.element.uid),3)]),_:1},8,["tree","onClickNode","onChangeSelect","onUpdateExpanded"])])}],["__scopeId","data-v-6bf93691"]]),Ht={class:"transformer"},qt={class:"icons"};var Gt=o(24),Wt=o(0);function Kt(e){return 180*e/Math.PI}function Yt(e){return e*Math.PI/180}function Jt(e){const t=new WeakSet;return JSON.stringify(e,(e,o)=>{if("object"==typeof o&&null!==o&&!Array.isArray(o)){if(t.has(o))return console.log("Exist ",o),o.encode?o.encode():void 0;t.add(o)}return o})}function Xt(e,t){let o=1,n=e;for(;t.includes(n);)n=`${e}_${o}`,o++;return n}let Zt,Qt,eo;function to(){console.log("focus");const e=Qt.object;Zt.update();let t=!1;if(e.traverse(e=>{e.isMesh&&(t=!0)}),t){const t=new we.Box3;e.traverse(e=>{t.expandByObject(e)});const o=new we.Sphere;t.getBoundingSphere(o),oo.FitTo(o)}else oo.FitTo({center:e.position,radius:.25})}class oo{static FocusToSelect(){Qt.object&&to()}static FocusTo(e){Zt.target.copy(e.isObject3D?e.position:e)}static MoveTo(e,t){const o={position:new we.Vector3,time:1e3,...e,control:!1},n={position:new we.Vector3,time:1e3,...t,control:!1};Zt.enabled=!1;const a=Workspace.Camera.position.clone(),r=Zt.target.clone();o.control=o.time>n.time,n.control=n.time>=o.time;const s=new Tween(a).to(o.position,o.time).easing(Easing.Quadratic.InOut).onUpdate(()=>{Workspace.Camera.position.copy(a),Workspace.Camera.updateProjectionMatrix(),Zt.update()}).onComplete(()=>{o.control&&(Zt.enabled=!0),tweengroup.remove(s)}).start(),l=new Tween(r).to(n.position,n.time).easing(Easing.Quadratic.InOut).onUpdate(()=>{Zt.target.copy(r),Zt.getPolarAngle()>Zt.maxPolarAngle&&Zt.target.setY(center.y+Math.cos(Zt.maxPolarAngle)*distance)}).onComplete(()=>{n.control&&(Zt.enabled=!0),tweengroup.remove(l)}).start();tweengroup.add(s,l)}static SetState(e){Zt.enabled=e}static Init({canvas:e},t,o){eo=t,Zt=new Gt.N(t,e),Zt.enabled=!0,Zt.enableDamping=!0,Zt.dampingFactor=.25,Zt.screenSpacePanning=!1,Zt.minDistance=.01,Zt.maxDistance=1e3,Qt=new Wt.ZU(t,e),Qt.addEventListener("dragging-changed",e=>{Zt.enabled=!e.value,e.target.object&&e.target.object.onTransform&&e.target.object.onTransform()});const n=Qt.getHelper();o.add(n),Qt.getRaycaster().layers.set(1),n.traverse(e=>{e.layers.set(1)}),window.addEventListener("keydown",e=>{switch(Zt.enabled=!e.ctrlKey,e.code){case"KeyQ":Qt.setSpace("local"===Qt.space?"world":"local");break;case"Shift":Qt.setTranslationSnap(1),Qt.setRotationSnap(we.MathUtils.degToRad(15)),Qt.setScaleSnap(.25);break;case"KeyW":Qt.setMode("translate");break;case"KeyE":Qt.setMode("rotate");break;case"KeyR":Qt.setMode("scale");break;case"KeyF":Qt.object&&to();break;case"KeyC":case"KeyV":case"KeyX":case"KeyY":case"KeyZ":case" ":case"Escape":break;case"+":case"=":Qt.setSize(Qt.size+.1);break;case"-":case"_":Qt.setSize(Math.max(Qt.size-.1,.1))}}),window.addEventListener("keyup",e=>{Zt.enabled=!e.ctrlKey,"Shift"===e.key&&(Qt.setTranslationSnap(null),Qt.setRotationSnap(null),Qt.setScaleSnap(null))})}static get Transformer(){return Qt}static Select(e){e?(Qt.attach(e),e.onSelect&&e.onSelect()):Qt.detach()}static Update(e){Zt.update(e)}static FitTo({center:e,radius:t}){const o=Yt(eo.fov),n=Math.max(t,.25)/Math.sin(o/2),a=(new we.Vector3).subVectors(eo.position,e).normalize();!function(e,t,o=1){Zt.enabled=!1;const n=o,a=eo.position.clone(),r=Zt.target.clone(),s=Date.now();!function o(){const l=(Date.now()-s)/(1e3*n);if(l>=1)return eo.position.copy(e),Zt.enabled=!0,Zt.target.copy(t),void Zt.update();eo.position.lerpVectors(a,e,l),Zt.target.lerpVectors(r,t,l),Zt.update(),requestAnimationFrame(o)}()}(e.clone().add(a.multiplyScalar(n)),e,.5)}}const no=oo,ao={props:{children:{type:Array},options:{size:"1.5em"}},methods:{setSpace(){no.Transformer.setSpace("local"===no.Transformer.space?"world":"local")},setMode(e){no.Transformer.setMode(e)}}},ro=(0,B.A)(ao,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Ht,[(0,r.createElementVNode)("div",qt,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.children,(e,t)=>(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createBlock)(l,{key:t,size:o.options.size,value:e.icon,onClick:e.handler},null,8,["size","value","onClick"])),[[i,e.hint]])),128))])])}]]),so={class:"horizontal-menu"},lo={href:"#"},io={class:"submenu"},co={href:"#"},po={class:"submenu"},uo={href:"#"},mo={mounted(){}},ho=(0,B.A)(mo,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon");return(0,r.openBlock)(),(0,r.createElementBlock)("ul",so,[t[7]||(t[7]=(0,r.createElementVNode)("li",null,[(0,r.createElementVNode)("a",{href:"#"},[(0,r.createElementVNode)("i",{class:"fas fa-home menu-icon"}),(0,r.createElementVNode)("span",{class:"menu-text"},"Главная")])],-1)),(0,r.createElementVNode)("li",null,[(0,r.createElementVNode)("a",lo,[(0,r.createVNode)(l,{value:"folder",size:"1em"}),t[0]||(t[0]=(0,r.createElementVNode)("span",{class:"menu-text"},"Товары",-1)),t[1]||(t[1]=(0,r.createElementVNode)("i",{class:"fas fa-chevron-down menu-arrow"},null,-1))]),(0,r.createElementVNode)("ul",io,[(0,r.createElementVNode)("li",null,[(0,r.createElementVNode)("a",co,[(0,r.createVNode)(l,{value:"bell",size:"1em"}),t[2]||(t[2]=(0,r.createElementVNode)("span",{class:"menu-text"},"Электроника",-1)),t[3]||(t[3]=(0,r.createElementVNode)("i",{class:"fas fa-chevron-right menu-arrow"},null,-1))]),(0,r.createElementVNode)("ul",po,[(0,r.createElementVNode)("li",null,[(0,r.createElementVNode)("a",uo,[(0,r.createVNode)(l,{value:"cog",size:"1em"}),t[4]||(t[4]=(0,r.createElementVNode)("span",{class:"menu-text"},"Смартфоны",-1))])]),t[5]||(t[5]=(0,r.createElementVNode)("li",null,[(0,r.createElementVNode)("a",{href:"#"},[(0,r.createElementVNode)("i",{class:"fas fa-tablet-alt menu-icon"}),(0,r.createElementVNode)("span",{class:"menu-text"},"Планшеты")])],-1))])]),t[6]||(t[6]=(0,r.createElementVNode)("li",null,[(0,r.createElementVNode)("a",{href:"#"},[(0,r.createElementVNode)("i",{class:"fas fa-tshirt menu-icon"}),(0,r.createElementVNode)("span",{class:"menu-text"},"Одежда")])],-1))])]),t[8]||(t[8]=(0,r.createStaticVNode)('<li data-v-202d206c><a href="#" data-v-202d206c><i class="fas fa-info-circle menu-icon" data-v-202d206c></i><span class="menu-text" data-v-202d206c>О нас</span><i class="fas fa-chevron-down menu-arrow" data-v-202d206c></i></a><ul class="submenu" data-v-202d206c><li data-v-202d206c><a href="#" data-v-202d206c><i class="fas fa-history menu-icon" data-v-202d206c></i><span class="menu-text" data-v-202d206c>История</span></a></li><li data-v-202d206c><a href="#" data-v-202d206c><i class="fas fa-users menu-icon" data-v-202d206c></i><span class="menu-text" data-v-202d206c>Команда</span></a></li></ul></li><li data-v-202d206c><a href="#" data-v-202d206c><i class="fas fa-envelope menu-icon" data-v-202d206c></i><span class="menu-text" data-v-202d206c>Контакты</span></a></li>',2))])}],["__scopeId","data-v-202d206c"]]),fo={class:"horizontal-menu"},vo={class:"menu-text"},go={key:0,class:"submenu"},yo={name:"MenuItem",props:{item:{type:Object,required:!0}},methods:{onClick(e){console.log(e),!e.children&&e.handler&&e.handler()}}},bo={components:{MenuItem:(0,B.A)(yo,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveComponent)("MenuItem",!0),c=(0,r.resolveDirective)("translate"),d=(0,r.resolveDirective)("tooltip");return(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("li",{class:(0,r.normalizeClass)({"has-children":o.item.children})},[(0,r.createElementVNode)("div",{class:"item",onClick:t[0]||(t[0]=e=>s.onClick(o.item))},[(0,r.createVNode)(l,{value:o.item.children?"folder":o.item.icon,size:"1em"},null,8,["value"]),(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("span",vo,[(0,r.createTextVNode)((0,r.toDisplayString)(o.item.text),1)])),[[c,`$$menu.${o.item.text}`]])]),o.item.children?((0,r.openBlock)(),(0,r.createElementBlock)("ul",go,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.item.children,(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(i,{key:t,item:e},null,8,["item"]))),128))])):(0,r.createCommentVNode)("v-if",!0)],2)),[[d,o.item.tooltip]])}],["__scopeId","data-v-72ce0a21"]])},props:{menu:{type:Object}}},ko=(0,B.A)(bo,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("MenuItem");return(0,r.openBlock)(),(0,r.createElementBlock)("ul",fo,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.menu,(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(l,{key:t,item:e},null,8,["item"]))),128))])}],["__scopeId","data-v-88afb356"]]);var wo=o(320);const Eo={class:"dropdown"},_o={key:0,class:"dropdown-menu"},So=["onClick"],No={__name:"userpanel",setup(e){const t=wo.default.default||wo.default,o=(0,r.ref)(!1),n=(0,r.computed)(()=>t.app.user.registered?[{label:"Options",handler:()=>{}},{label:"Logout",handler:t.app.logout}]:[{label:"Login",handler:i}]),a=()=>{o.value=!o.value},s=(0,r.useTemplateRef)("dropdown"),l=e=>{s.value?.contains(e.target)||(o.value=!1)};(0,r.watch)(o,e=>{e?window.addEventListener("click",l):window.removeEventListener("click",l)});const i=()=>{t.modal.open({header:{value:"Login",handler:()=>{t.modal.close()}},content:{component:"LoginForm",props:{},events:{success:()=>{t.modal.close(),t.app.init()}}},footer:{buttons:[]}})};return(e,l)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Eo,[(0,r.createCommentVNode)(" Триггер для открытия меню "),(0,r.createElementVNode)("div",{ref_key:"dropdown",ref:s,class:"dropdown-trigger",onClick:a},(0,r.toDisplayString)((0,r.unref)(t).app.user.name),513),(0,r.createCommentVNode)(" Выпадающее меню "),(0,r.createVNode)(r.Transition,{name:"fade"},{default:(0,r.withCtx)(()=>[o.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",_o,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(n.value,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("a",{key:t,class:"dropdown-item",onClick:t=>(e=>{o.value=!1,e.handler()})(e)},(0,r.toDisplayString)(e.label),9,So))),128))])):(0,r.createCommentVNode)("v-if",!0)]),_:1})]))}},Vo=(0,B.A)(No,[["__scopeId","data-v-4594b897"]]),Co={name:"UI",props:{element:null},data(){return{version:"0.0.10",ui:{blocks:[{component:"AssetsTree",data:{title:"$$Assets"},onSelect:this.onSelectAsset},{component:"ModelsTree",data:{title:"$$Models"},onSelect:()=>{}}],header:{buttons:this.$app.menu.hierarhy.children}},name:"",selectedSlide:null,selectedNodes:[]}},methods:{onButtonClick(e){e.handler&&e.handler()},onSelectAsset(e){},onSelectedNodesUpdate(){},camChange(e){const t=e.target.value,o=this.cameras.find(e=>e.uid===t);o&&"function"==typeof o.handler?o.handler():console.warn(`No handler found for camera with UID: ${t}`)},handleSlideSelected(e){this.selectedSlide=e},activateInMenu(e,t){if(!t)return this.menu.actived[e]=null,void("main"===e&&(this.menu.ext.length=0));this.menu.actived[e]=t.id,"main"===e&&(this.menu.ext.length=0,this.menu.ext.push(...t.ext||[]))},handleNodeDrop({sourceNodeUid:e,targetNodeUid:t,sourceTree:o}){console.log(e);const n="TreeViewLeft"===o?this.leftTree:this.rightTree,a="TreeViewLeft"===o?this.rightTree:this.leftTree,r=this.findNodeInTree(n,e),s=this.findNodeInTree(a,t);r&&s&&(this.removeNodeFromTree(n,e),s.children||this.$set(s,"children",[]),s.children.push(r),"TreeViewLeft"===o?(this.leftTree=[...this.leftTree],this.rightTree=[...this.rightTree]):(this.rightTree=[...this.rightTree],this.leftTree=[...this.leftTree]))},findNodeInTree(e,t){console.log(e)},removeNodeFromTree(e,t){console.log(e)}},computed:{project(){return this.$app.project},projectMenu(){return this.$app.menu.app.children},topMenu(){return this.$app.menu.top},headMenu(){return this.$app.menu.hierarhy.children},footerMenu(){return this.$app.menu.tools.children},viewTransform(){return this.$app.selection.selected?.isElement||this.$app.selection.selected?.isState},slide(){return this.$app.slides.actived},selected(){return this.$app.selection.element},slides(){return this.$app.slides.children},cameras(){return this.$app.app.cameras},leftpanel(){return this.$app.app.leftpanel},rightpanel(){return this.$app.app.rightpanel},options(){return this.$app.options},menu(){return this.$app.menu},app(){return this.$app.app},tools:()=>toolse,models(){return this.$app.models},ready(){return this.$app.engine.ready},toasts(){return this.$app.toasts},modal(){return this.$app.modal},translations(){return this.$app.translations},options(){return this.$app.project.options||{}},info(){return this.$app.project.info||{}}},components:{UserPanel:Vo,ModelsTree:Lt,horizontalmenu:ko,Topmenu:ho,ViewPanel:$,Sliders:R,HierarhyUI:G,InspectorUI:Le,AssetsTree:rt,ElementsTree:yt,StatesTree:zt,Transformer:ro}},Bo=(0,B.A)(Co,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("horizontalmenu"),i=(0,r.resolveComponent)("icon"),c=(0,r.resolveComponent)("SectionSelect"),d=(0,r.resolveComponent)("InspectorUI"),p=(0,r.resolveComponent)("ViewPanel"),E=(0,r.resolveComponent)("Sliders"),_=(0,r.resolveComponent)("Transformer"),S=(0,r.resolveDirective)("tooltip"),N=(0,r.resolveDirective)("translate");return(0,r.openBlock)(),(0,r.createElementBlock)("div",u,[(0,r.createElementVNode)("div",m,[(0,r.createVNode)(l,{menu:s.projectMenu},null,8,["menu"]),(0,r.createElementVNode)("div",h,(0,r.toDisplayString)(s.info.name),1),(0,r.createElementVNode)("div",f,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("button",{class:"square large",onClick:t[0]||(t[0]=e=>s.project.play())},[(0,r.createVNode)(i,{value:"play3"})])),[[S,"Play project"]]),(0,r.createVNode)(c,{modelValue:s.translations.lang,"onUpdate:modelValue":[t[1]||(t[1]=e=>s.translations.lang=e),s.translations.change],list:s.translations.languages},null,8,["modelValue","list","onUpdate:modelValue"]),(0,r.createCommentVNode)(" <UserPanel /> "),(0,r.createCommentVNode)(' <div class="icon">\r\n                    <icon value="cog"></icon>\r\n                </div> '),(0,r.createTextVNode)(" v "+(0,r.toDisplayString)(a.version),1)])]),(0,r.createCommentVNode)(" <Topmenu></Topmenu> "),(0,r.createVNode)(d,{selected:s.selected,class:"inspector"},null,8,["selected"]),s.app.ready?((0,r.openBlock)(),(0,r.createBlock)(p,{key:0,class:"project",header:a.ui.header,footer:a.ui.footer},{header:(0,r.withCtx)(()=>[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.headMenu,e=>(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("button",{class:(0,r.normalizeClass)(e.class),onClick:t=>s.onButtonClick(e)},[e.label?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("span",g,[(0,r.createTextVNode)((0,r.toDisplayString)(e.label||"Close"),1)])),[[N]]):(0,r.createCommentVNode)("v-if",!0),e.icon?((0,r.openBlock)(),(0,r.createBlock)(i,{key:1,value:e.icon,size:"1.5em"},null,8,["value"])):(0,r.createCommentVNode)("v-if",!0)],10,v)),[[S,e.tooltip]])),256))]),footer:(0,r.withCtx)(()=>[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.footerMenu,e=>(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("button",{class:(0,r.normalizeClass)(e.class),onClick:t=>s.onButtonClick(e)},[e.label?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("span",w,[(0,r.createTextVNode)((0,r.toDisplayString)(e.label||"Close"),1)])),[[N]]):(0,r.createCommentVNode)("v-if",!0),e.icon?((0,r.openBlock)(),(0,r.createBlock)(i,{key:1,value:e.icon,size:"1.5em"},null,8,["value"])):(0,r.createCommentVNode)("v-if",!0)],10,k)),[[S,e.tooltip]])),256))]),default:(0,r.withCtx)(()=>[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.ui.blocks,o=>((0,r.openBlock)(),(0,r.createElementBlock)("div",y,[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(o.component||"div"),(0,r.mergeProps)({class:"elementContent"},{ref_for:!0},o.component?o.data:null,{onSelect:o.onSelect,onNodeDrop:s.handleNodeDrop,"onUpdate:tree":t[2]||(t[2]=t=>e.leftTree=t)}),{default:(0,r.withCtx)(()=>[(0,r.createElementVNode)("div",{class:"content-value",innerHTML:o.value||""},null,8,b)]),_:2},1040,["onSelect","onNodeDrop"]))]))),256))]),_:1},8,["header","footer"])):(0,r.createCommentVNode)("v-if",!0),(0,r.createVNode)(E,{slides:s.slides,slide:s.slide,onSlideselect:s.handleSlideSelected,class:"sliders"},null,8,["slides","slide","onSlideselect"]),s.viewTransform?((0,r.openBlock)(),(0,r.createBlock)(_,(0,r.normalizeProps)((0,r.mergeProps)({key:1},s.topMenu)),null,16)):(0,r.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-4b835bb4"]]),$o=new we.Raycaster;$o.layers.enableAll();const xo=new class{constructor(){this._events={"*":[]}}subs(e,t,o){null==this._events[e]&&(this._events[e]=[]),this._events[e].push({handler:o,once:t})}on(e,t){this.subs(e,!1,t)}once(e,t){this.subs(e,!0,t)}off(e,t){const o=this._events[e];if(o){for(let e=o.length-1;e>=0;e--)o[e].handler===t&&o.splice(e,1);0===o.length&&delete this._events[e]}}clear(e){this._events[e]=[]}clearAll(){this._events={"*":[]}}emit(e,...t){const o=[];this._events[e]&&o.push(...this._events[e]),this._events["*"].length&&o.push(...this._events["*"].map(t=>({handler:t.handler.bind(this,e),once:t.once})));for(let e=o.length-1;e>=0;e--){const n=o[e];n.handler.apply(null,t),n.once&&o.splice(e,1)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}};let Do,To,Io;const Ao={x:0,y:0};let Mo,Oo=.03,jo=.03,Po=.01,Lo=.01,Ro=window.innerWidth/2,Fo=window.innerHeight/2;function Uo(e){for(;e;){if(e.isElement||e.isHelper)return e;e=e.parent}return null}function zo(e){}function Ho(e){Ao.x=e.clientX,Ao.y=e.clientY,Mo=Date.now()}function qo(e){if(Math.abs(Ao.x-e.clientX)>10||Math.abs(Ao.y-e.clientY)>10||Date.now()-Mo>500)return;const t=new we.Vector2,o=Io.getBoundingClientRect(),n=e.clientX-o.left,a=e.clientY-o.top;t.x=n/Io.clientWidth*2-1,t.y=-a/Io.clientHeight*2+1,$o.setFromCamera(t,To);const r=$o.intersectObjects(Do.children,!0);if(0!==r.length)for(let e=0;e<r.length;e++){const t=r[e].object;if(t.nonClick)continue;const o=Uo(t);if(o?.visible)return xo.emit("click",o),void(o.onClick&&o.onClick())}else xo.emit("click",null)}const Go=new Proxy(class{static get Control(){return Control}static Init(e,t,o,n,a){const r={camera:{range:{x:.01,y:.01},movespeed:{x:.03,y:.03}},...a};Do=n,To=t,Io=e,Oo=r.camera.movespeed.x,jo=r.camera.movespeed.y,Po=r.camera.range.x,Lo=r.camera.range.y,Ro=window.innerWidth/2,Fo=window.innerHeight/2,e.addEventListener("click",qo.bind(null)),e.addEventListener("mousemove",zo,!1),e.addEventListener("mousedown",Ho,!1)}static Update(e){}static SetCamera(e){To=e}},{get:(e,t)=>t in e?e[t]:xo[t]}),Wo=wo.default.default||wo.default;let Ko,Yo,Jo,Xo,Zo;function Qo(e){Yo.render(Ko,Jo)}class en{static get CameraHelper(){return Zo}static async Init(e){Xo=e;const{Project:t,Factory:o}=Wo.modules.getMod("engine");Ko=t.Scene,Yo=new THREE.WebGLRenderer({canvas:e,alpha:!0,powerPreference:"high-performance",antialias:!0,stencil:!1});const n=Xo.clientWidth,a=Xo.clientHeight;Yo.setSize(n,a,!1),Yo.setPixelRatio(window.devicePixelRatio),Yo.shadowMap.enabled=!0,Yo.shadowMap.type=THREE.PCFSoftShadowMap,t.on("setcamera",()=>{Zo&&(Ko.remove(Zo),Zo.dispose()),Zo=new THREE.CameraHelper(t.Camera),Zo.layers.set(1),Ko.add(Zo)}),Zo=new THREE.CameraHelper(t.Camera),Zo.layers.set(1),Ko.add(Zo),Jo=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.01,5e3),Jo.layers.enable(1),Jo.uid="EditorCamera",Ko.add(Jo),Jo.position.set(5,3,20),Yo.setAnimationLoop(Qo),o.on("create",(e,t)=>{e.type}),no.Init({canvas:Xo},Jo,t.Scene),no.FocusTo(t.Root),Go.Init(Xo,Jo,Ko,t.Root),Go.on("click",Wo.selection.select)}}window.Editor=en;const tn=en;let on="defaultDB",nn=null,an=[],rn="uid";class sn{constructor(e,t,o="id"){this.dbName=e,this._storages=t,this._key=o,this.db=null}async openDatabase(e){return new Promise((t,o)=>{const n=indexedDB.open(this.dbName);n.onupgradeneeded=e=>{const t=e.target.result;for(let e=0;e<this._storages.length;e++)t.objectStoreNames.contains(this._storages[e])||t.createObjectStore(this._storages[e],{keyPath:this._key,autoIncrement:!1})},n.onsuccess=n=>{if(this.db=n.target.result,this.db.objectStoreNames.contains(e))t(this.db);else{this.db.close();const n=this.db.version+1,a=indexedDB.open(this.dbName,n);a.onupgradeneeded=t=>{t.target.result.createObjectStore(e,{keyPath:"id",autoIncrement:!0})},a.onsuccess=e=>{this.db=e.target.result,t(this.db)},a.onerror=e=>{o(e.target.error)}}},n.onerror=e=>{o(e.target.error)}})}async addItem(e,t){const o=(await this.openDatabase(e)).transaction(e,"readwrite");return o.objectStore(e).add(t),new Promise(e=>{o.oncomplete=()=>e(),o.onerror=()=>e()})}async addItems(e,t){const o=[];for(let n=0;n<t.length;n++)o.push(this.addItem(e,t[n]));await Promise.all(o)}async getItem(e,t){const o=(await this.openDatabase(e)).transaction(e,"readonly").objectStore(e);return new Promise((e,n)=>{const a=o.get(t);a.onsuccess=()=>e(a.result),a.onerror=()=>e()})}async deleteItem(e,t){const o=(await this.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,n)=>{const a=o.delete(t);a.onsuccess=()=>e(),a.onerror=()=>n()})}async getAllItems(e){const t=(await this.openDatabase(e)).transaction(e,"readonly").objectStore(e);return new Promise((e,o)=>{const n=t.getAll();n.onsuccess=()=>e(n.result),n.onerror=()=>e()})}async updateItem(e,t){const o=(await this.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,n)=>{const a=o.put(t);a.onsuccess=()=>e(t),a.onerror=()=>n()})}async updateItemProperties(e,t,o){const n=(await this.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,a)=>{const r=n.get(t);r.onsuccess=()=>{const t=r.result;if(t){Object.assign(t,o);const r=n.put(t);r.onsuccess=()=>e(),r.onerror=()=>a()}else a("Item not found")},r.onerror=()=>a()})}async upsertItemProperties(e,t,o){console.log(e);const n=(await this.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,a)=>{const r=n.get(t);r.onsuccess=()=>{let s=r.result;if(s){Object.assign(s,o);const t=n.put(s);t.onsuccess=()=>e(),t.onerror=()=>a()}else{const r={...o,id:t},s=n.add(r);s.onsuccess=()=>e(),s.onerror=()=>a()}},r.onerror=()=>a()})}static async GetList(){try{return await indexedDB.databases()}catch(e){return[]}}static GetStoragesData(e){indexedDB.open(e).onsuccess=function(e){const t=e.target.result,o=t.transaction(t.objectStoreNames,"readonly");t.objectStoreNames.forEach(e=>{const t=o.objectStore(e);console.log("Хранилище:",e),console.log("КлюPath:",t.keyPath),console.log("Автоинкремент:",t.autoIncrement)}),t.close()}}static GetStorages(e){return new Promise((t,o)=>{const n=indexedDB.open(e);n.onsuccess=e=>{const o=e.target.result,n=[];for(let e=0;e<o.objectStoreNames.length;e++)n.push(o.objectStoreNames[e]);o.close(),t(n)},n.onerror=e=>{o(`Ошибка открытия БД: ${e.target.error}`)},n.onupgradeneeded=e=>{console.log("БД требует обновления")}})}static Create(e,t,o=!1){return new Promise((n,a)=>{const r=indexedDB.open(e,1);r.onupgradeneeded=function(e){const n=e.target.result,a=Object.keys(t);for(let e=0;e<a.length;e++){const t=a[e];if(!n.objectStoreNames.contains(t)){const e=n.createObjectStore(t,{keyPath:"uid"});o&&e.createIndex("uid","uid",{unique:!0})}}},r.onsuccess=function(e){const o=e.target.result,r=Object.keys(t),s=o.transaction(r,"readwrite");for(let e=0;e<r.length;e++){const o=r[e],n=s.objectStore(o);if(Array.isArray(t[o]))for(let e=0;e<t[o].length;e++)n.put(t[o][e]);else n.put(t[o])}s.oncomplete=function(){n()},s.onerror=function(){a()}},r.onerror=function(e){a(e.target.error)}})}static async GetFromAll(e,t){try{const e=await indexedDB.databases(),t=[],o=e.map(e=>new Promise((o,n)=>{const a=e.name,r=indexedDB.open(a);r.onsuccess=function(e){const n=e.target.result;if(n.objectStoreNames.contains("project")){const e=n.transaction("project","readonly").objectStore("project").get("info");e.onsuccess=()=>{t.push(e.result),o()},e.onerror=()=>{o()}}else o()},r.onerror=function(){console.error(`Ошибка при открытии базы данных: ${a}`),n()}}));return await Promise.all(o),t}catch(e){console.error("Ошибка при получении списка баз данных:",e)}}static DeleteDatabase(e){return new Promise((t,o)=>{nn.close();const n=indexedDB.deleteDatabase(e);n.onsuccess=function(){t()},n.onerror=function(){console.warn(`Ошибка при удалении базы данных ${e}.`),o()},n.onblocked=async function(){console.warn(`Blocked ${e}.`),t()}})}static Init(e,t,o="uid"){on=e,an=t,rn=o}static async openDatabase(e){return new Promise((t,o)=>{const n=indexedDB.open(on);n.onupgradeneeded=e=>{const t=e.target.result;for(let e=0;e<an.length;e++)t.objectStoreNames.contains(an[e])||t.createObjectStore(an[e],{keyPath:rn,autoIncrement:!1})},n.onsuccess=n=>{if(nn=n.target.result,nn.objectStoreNames.contains(e))t(nn);else{nn.close();const n=nn.version+1,a=indexedDB.open(on,n);a.onupgradeneeded=t=>{t.target.result.createObjectStore(e,{keyPath:"id",autoIncrement:!0})},a.onsuccess=e=>{nn=e.target.result,t(nn)},a.onerror=e=>{o(e.target.error)}}},n.onerror=e=>{o(e.target.error)}})}static async addItem(e,t){const o=(await sn.openDatabase(e)).transaction(e,"readwrite");return o.objectStore(e).add(t),new Promise(e=>{o.oncomplete=()=>e(),o.onerror=()=>e()})}static async addItems(e,t){const o=[];for(let n=0;n<t.length;n++)o.push(sn.addItem(e,t[n]));await Promise.all(o)}static async getItem(e,t){const o=(await sn.openDatabase(e)).transaction(e,"readonly").objectStore(e);return new Promise((e,n)=>{const a=o.get(t);a.onsuccess=()=>e(a.result),a.onerror=()=>e()})}static async deleteItem(e,t){const o=(await this.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,n)=>{const a=o.delete(t);a.onsuccess=()=>e(),a.onerror=()=>n()})}static async getAllItems(e){const t=(await sn.openDatabase(e)).transaction(e,"readonly").objectStore(e);return new Promise((e,o)=>{const n=t.getAll();n.onsuccess=()=>e(n.result),n.onerror=()=>o})}static async updateItem(e,t){const o=(await sn.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,n)=>{const a=o.put(t);a.onsuccess=()=>e(t),a.onerror=()=>n()})}static async updateItemProperties(e,t,o){const n=(await sn.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,a)=>{const r=n.get(t);r.onsuccess=()=>{const t=r.result;if(t){Object.assign(t,o);const r=n.put(t);r.onsuccess=()=>e(),r.onerror=()=>a()}else a("Item not found")},r.onerror=()=>a()})}static async upsertMany(e,t,o="id"){const n=[];for(let a=0;a<t.length;a++){const r=t[a];n.push(sn.upsertItemProperties(e,r[o],r))}await Promise.all(n)}static async upsertItemProperties(e,t,o){console.log(e);const n=(await sn.openDatabase(e)).transaction(e,"readwrite").objectStore(e);return new Promise((e,a)=>{const r=n.get(t);r.onsuccess=()=>{let s=r.result;if(s){s={...s,...o};const t=n.put(s);t.onsuccess=()=>e(),t.onerror=()=>a()}else{const r={...o,id:t,uid:t},s=n.add(r);s.onsuccess=()=>e(),s.onerror=()=>a()}},r.onerror=()=>a()})}static getVersion(e){return new Promise(t=>{const o=indexedDB.open(e);o.onsuccess=e=>{const o=e.target.result,n=o.version;o.close(),t(n)},o.onerror=e=>{console.error("Ошибка при открытии БД:",e.target.error),t(null)}})}static exportToJson(e){return new Promise(async(t,o)=>{const n=await sn.getVersion(e),a=indexedDB.open(e,n);a.onerror=e=>{o(`Ошибка открытия базы данных: ${e.target.error}`)},a.onsuccess=e=>{const n=e.target.result,a={},r=n.objectStoreNames,s=n.transaction(r,"readonly"),l=[];for(let e=0;e<r.length;e++){const t=r[e],o=s.objectStore(t);l.push(new Promise(e=>{const n=[],a=o.openCursor();a.onerror=()=>{console.error(`Ошибка чтения хранилища ${t}`),e({[t]:[]})},a.onsuccess=o=>{const a=o.target.result;a?(n.push(a.value),a.continue()):e({[t]:n})}}))}Promise.all(l).then(e=>{e.forEach(e=>{const t=Object.keys(e)[0];a[t]=e[t]}),t(a)}).catch(o),s.oncomplete=()=>{n.close()}},a.onupgradeneeded=e=>{0===e.target.result.objectStoreNames.length&&t({})}})}}const ln=sn,cn=["actions","assets","models","modules","project","slides"],dn={data:()=>({selectedElement:null,loadComponent:"div",modulesLoaded:!1,progress:0}),computed:{ui(){return this.$app.ui},hierarhyAllow(){return this.$app.engine.instances.length>0},options(){return this.$app.options},app(){return this.$app.app},tools:()=>toolse,models(){return this.$app.models},ready(){return this.$app.app.ready},modal(){return this.$app.modal}},methods:{async start(){this.$app.app.ready=!0},waitCanvasSize(e){const t=window.devicePixelRatio||1;e.forEach(e=>{e.width=e.clientWidth*t,e.height=e.clientHeight*t})}},async mounted(){document.documentElement.setAttribute("data-theme","dark"),window.THREE=we,await Promise.all([this.$app.app.init(),this.$app.translations.init()]),await this.$app.modules.init();const e=this.$refs.editorcanvas,t=this.$refs.playcanvas;this.waitCanvasSize([e,t]);const o=new URLSearchParams(window.location.search),n=o.get("src");let a;switch(n){case"db":default:this.$app.project.uid=o.get("db")||"empty",await ln.Init(this.$app.project.uid,cn,"uid");const e=[];for(let t=0;t<cn.length;t++){const o=await ln.getAllItems(cn[t]);e.push(o)}const[t=[],n=[],r=[],s=[],l={uid:this.$app.project.uid},i=[]]=e;a={actions:t,assets:n,models:r,modules:s,project:l,slides:i};break;case"url":const c=await fetch(o.get("url"));a=await c.json(),this.$app.project.uid=a.project.uid,await ln.Init(this.$app.project.uid,cn,"uid")}this.$app.project.init(a.project),this.$app.projects.init(this.$app.project.uid),await new Promise(e=>{this.$nextTick(e)}),this.loadComponent="LoaderScreen",console.log("---LOAD ENGINE---"),await this.$app.engine.load(),console.log("---LOAD MODULES---"),await this.$app.modules.loadUserModules(a.modules),console.log("---LOAD ASSETS AND ACTIONS---"),await Promise.all([this.$app.assets.init(a.assets,e=>{this.progress=e}),this.$app.actions.init(a.actions)]),console.log("---LOAD END---"),this.$app.engine.manager.Init(t),this.$app.engine.manager.Start(),console.log("---BUILD SCENES---"),await tn.Init(e),await this.$app.engine.start();const r=this.$app.engine.CssManager;await r.Init(this.$refs.playui,t),this.$app.models.on("create",e=>{r.OnCreate(e,this.$app.ui,this.$app.slides)}),this.$app.models.on("remove",(e,t)=>{r.OnRemove(t,this.$app.ui)});try{console.log("---INSTANCED MODELS---"),await this.$app.models.load(a.models)}catch(e){n&&"db"!==n||(console.warn(e),this.$app.toasts.add({message:"Error loading project",type:"alerticon",timehide:!0}))}if(console.log("---BUILD SLIDES---"),0===a.slides.length){const e=await this.$app.slides.add({name:"Main",props:{},actions:[]});a.slides.push(e)}await this.$app.slides.load(a.slides),this.progress=100,a.slides.length>0&&(console.log("---ACTIVATE FIRST SLIDE---"),this.$app.slides.goto(0)),console.log("---READY---"),this.app.ready=!0},components:{UI:Bo}},pn=(0,B.A)(dn,[["render",function(e,t,o,n,a,u){const m=(0,r.resolveComponent)("UI"),h=(0,r.resolveComponent)("Modal"),f=(0,r.resolveComponent)("Toasts");return(0,r.openBlock)(),(0,r.createElementBlock)("div",s,[(0,r.createElementVNode)("div",l,[(0,r.createElementVNode)("canvas",i,null,512),(0,r.createElementVNode)("canvas",c,null,512),(0,r.createElementVNode)("div",d,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(u.ui.elements,(e,t)=>((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.component),(0,r.mergeProps)({onMounted:u.ui.onElementMount,key:t},(0,r.toHandlers)(e.events||{}),{ref_for:!0},e.data),null,16,["onMounted"]))),128))],512),(0,r.createVNode)(m,{element:a.selectedElement},null,8,["element"])]),u.ready?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",p,[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(a.loadComponent),{loadingProgress:a.progress,onClick:u.start},null,8,["loadingProgress","onClick"]))])),u.modal.isVisible?((0,r.openBlock)(),(0,r.createBlock)(h,{key:1})):(0,r.createCommentVNode)("v-if",!0),(0,r.createVNode)(f)])}]]),un={class:"overbutton"},mn={class:"menulabel"},hn={class:"btnicon"},fn={name:"ExpandedButton",props:{label:"",icon:"",color:"rgb(0,0,0)"}},vn=(0,B.A)(fn,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon");return(0,r.openBlock)(),(0,r.createElementBlock)("button",un,[(0,r.createElementVNode)("div",mn,(0,r.toDisplayString)(o.label),1),(0,r.createElementVNode)("div",hn,[(0,r.createVNode)(l,{size:"100%",color:o.color,value:o.icon},null,8,["color","value"])])])}]]),gn=["fill","x","href"],yn=o.p+"assets/e5cea83d172a1097401a.svg",bn={name:"Icon",props:{value:{type:String,default:()=>"icon-checkmark"},size:{type:String,default:()=>null},color:{type:String,default:()=>null},offset:{type:Number}},computed:{style(){return this.size?{width:`${this.size}`,height:`${this.size}`}:{width:"1em",height:"1em"}},val(){return`${yn}#s-${this.value.replace("p-","")}`}}},kn=(0,B.A)(bn,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("svg",{preserveAspectRatio:"xMidYMid meet",class:"svgicon",style:(0,r.normalizeStyle)(s.style)},[(0,r.createElementVNode)("use",{class:"svguse",width:"100%",height:"100%",viewBox:"0 0 32 32",fill:o.color,x:o.offset,href:s.val},[(0,r.createElementVNode)("title",null,[(0,r.renderSlot)(e.$slots,"default",{},void 0,!0)])],8,gn)],4)}],["__scopeId","data-v-a13b2ade"]]),wn={class:"modal-header"},En={class:"modal-content"},_n=["innerHTML"],Sn={class:"modal-footer"},Nn=["disabled","onClick"],Vn={computed:{modal(){return this.$app.modal},header(){return this.modal.header},content(){return this.modal.content},footer(){return this.modal.footer}},methods:{onSelf(){this.modal.values.closable&&this.modal.close()},onClick(e){"function"==typeof e&&e()},closeModal(e){"function"!=typeof e?this.modal.close():e()}}},Cn=(0,B.A)(Vn,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveDirective)("translate");return(0,r.openBlock)(),(0,r.createElementBlock)("div",{class:"modal-overlay",onClick:t[3]||(t[3]=(0,r.withModifiers)((...e)=>s.onSelf&&s.onSelf(...e),["self"]))},[(0,r.createElementVNode)("div",{class:"modal",onClick:t[2]||(t[2]=(0,r.withModifiers)(()=>{},["stop"]))},[(0,r.createElementVNode)("header",wn,[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(s.header.component||"div"),(0,r.mergeProps)({class:"header"},s.header.component?s.header:null),{default:(0,r.withCtx)(()=>[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("h3",null,[(0,r.createTextVNode)((0,r.toDisplayString)(s.header.value),1)])),[[l,`$$title.${s.header.value}`]]),(0,r.createElementVNode)("button",{class:"close-btn",onClick:t[0]||(t[0]=e=>s.closeModal(s.header.handler))},"×")]),_:1},16))]),(0,r.createElementVNode)("main",En,[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(s.content.component||"div"),(0,r.mergeProps)({class:"content"},s.content.component?s.content.props:null,(0,r.toHandlers)(s.content.events||{})),(0,r.createSlots)({default:(0,r.withCtx)(()=>[(0,r.createElementVNode)("div",{class:"content-value",innerHTML:s.content.value||""},null,8,_n)]),_:2},[(0,r.renderList)(s.content.slots,(e,t)=>({name:t,fn:(0,r.withCtx)(t=>[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.component),(0,r.mergeProps)(t,(0,r.toHandlers)(e.events||{})),(0,r.createSlots)({_:2},[(0,r.renderList)(t.slots,(e,t)=>({name:t,fn:(0,r.withCtx)(t=>[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.component),(0,r.normalizeProps)((0,r.guardReactiveProps)(t)),null,16))])}))]),1040))])}))]),1040))]),(0,r.createElementVNode)("footer",Sn,[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(s.footer.component||"div"),(0,r.mergeProps)({class:"footer"},s.footer.component?s.footer.props:null,{onClose:s.closeModal}),{default:(0,r.withCtx)(()=>[s.footer.buttons?((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,{key:0},(0,r.renderList)(s.footer.buttons,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",null,[e.hidden?(0,r.createCommentVNode)("v-if",!0):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:(0,r.normalizeClass)(e.class),disabled:e.disabled,onClick:t=>s.onClick(e.handler)},[(0,r.createTextVNode)((0,r.toDisplayString)(e.label||"Close"),1)],10,Nn)),[[l,`$$buttons.${e.label}`]])]))),256)):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,class:(0,r.normalizeClass)(s.footer.class),onClick:t[1]||(t[1]=e=>s.closeModal(s.footer.handler))},[(0,r.createTextVNode)((0,r.toDisplayString)(s.footer.label||"Close"),1)],2)),[[l,`$$buttons.${s.footer.label}`]])]),_:1},16,["onClose"]))])])])}],["__scopeId","data-v-bf7c1aea"]]),Bn=["onClick"],$n={props:{values:{type:Array},rect:{type:Object},size:{type:Object,default:{width:200,height:100}}},data:()=>({popupStyle:{}}),methods:{togglePopup(e){const t=window.innerWidth;let o=this.rect.top+window.scrollY,n=this.rect.left+window.scrollX;n+this.size.width>t&&(n=this.rect.right-this.size.width+window.scrollX),this.popupStyle={position:"absolute",top:`${o}px`,left:`${n}px`,width:`${this.size.width}px`},this.isPopupVisible=!0},hidePopup(){this.$emit("callback")}}},xn=(0,B.A)($n,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",{class:"popup",style:(0,r.normalizeStyle)(a.popupStyle)},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.values,(t,o)=>(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("p",{class:"element",key:o,onClick:o=>t.handler?t.handler(t):e.$emit("click",t)},[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(t.component||"div"),(0,r.mergeProps)({ref_for:!0},t.props),{default:(0,r.withCtx)(()=>[(0,r.createTextVNode)((0,r.toDisplayString)(t.props),1)]),_:2},1040))],8,Bn)),[[l,t.tooltip]])),128)),(0,r.createElementVNode)("button",{onClick:t[0]||(t[0]=(...e)=>s.hidePopup&&s.hidePopup(...e))},"ОК")],4)}],["__scopeId","data-v-1591e2fe"]]),Dn={key:0,class:"menulabel"},Tn={key:1,class:"btnicon"},In={name:"SimpleButton",props:{label:{type:String},icon:{type:Object},tooltip:{type:String},handlers:{type:Object,required:!0}},methods:{onClick(){this.handlers?.click?this.handlers.click(this):this.$emit("click",this)}}},An=(0,B.A)(In,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveDirective)("tooltip");return(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("button",{class:"small-btn simple",onClick:t[0]||(t[0]=(...e)=>s.onClick&&s.onClick(...e))},[o.label?((0,r.openBlock)(),(0,r.createElementBlock)("div",Dn,(0,r.toDisplayString)(o.label),1)):(0,r.createCommentVNode)("v-if",!0),o.icon?((0,r.openBlock)(),(0,r.createElementBlock)("div",Tn,[(0,r.createVNode)(l,{size:o.icon.size||"100%",value:o.icon.value},null,8,["size","value"])])):(0,r.createCommentVNode)("v-if",!0)])),[[i,o.tooltip]])}],["__scopeId","data-v-7f0518be"]]),Mn={key:0,class:"menulabel"},On={key:1,class:"btnicon"},jn={name:"ToggleButton",props:{id:{type:String,required:!0},label:{type:String},icon:{type:Object},group:{type:Object},handlers:{type:Object,required:!0},tooltip:{type:String}},computed:{isActive(){return this.group.activeId===this.id}},mounted(){this.handlers.activate&&this.handlers.activate(this)},beforeUnmount(){this.handlers.deactivate&&this.handlers.deactivate(this)},methods:{onClick(){this.handlers.click?this.handlers.click(this):this.$emit("click",this)}}},Pn=(0,B.A)(jn,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveDirective)("translate"),c=(0,r.resolveDirective)("tooltip");return(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("button",{class:(0,r.normalizeClass)(["small-btn simple",{active:s.isActive}]),onClick:t[0]||(t[0]=(...e)=>s.onClick&&s.onClick(...e))},[o.label?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",Mn,[(0,r.createTextVNode)((0,r.toDisplayString)(o.label),1)])),[[i,`$$buttons.${o.label}`]]):(0,r.createCommentVNode)("v-if",!0),o.icon?((0,r.openBlock)(),(0,r.createElementBlock)("div",On,[(0,r.createVNode)(l,{size:o.icon.size||"100%",value:o.icon.value},null,8,["size","value"])])):(0,r.createCommentVNode)("v-if",!0)],2)),[[c,o.tooltip]])}],["__scopeId","data-v-5b95ca11"]]),Ln={class:"spinner"},Rn={name:"Spinner"},Fn=(0,B.A)(Rn,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",Ln)}],["__scopeId","data-v-4736cf19"]]),Un={class:"toast-container"},zn={computed:{list(){return this.$app.toasts.list}},methods:{onClick(e){e.onclick&&e.onclick()}}},Hn=(0,B.A)(zn,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",Un,[(0,r.createVNode)(r.TransitionGroup,{name:"toast",tag:"div"},{default:(0,r.withCtx)(()=>[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.list,t=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t.id,class:"toast"},[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(t.component||"div"),(0,r.mergeProps)({class:"toastview"},{ref_for:!0},t.data,{onClick:e=>s.onClick(t)}),{default:(0,r.withCtx)(()=>[t.component?(0,r.createCommentVNode)("v-if",!0):(0,r.renderSlot)(e.$slots,"default",{key:0},()=>[(0,r.createTextVNode)((0,r.toDisplayString)(t.data.message),1)],!0)]),_:2},1040,["onClick"]))]))),128))]),_:3})])}],["__scopeId","data-v-49ca426e"]]),qn={class:"alert"},Gn={class:"text"},Wn={name:"Label",props:{icon:{type:String,default:"notification"},message:{type:String,default:""},type:{type:String,default:"info"}}},Kn=(0,B.A)(Wn,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon");return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[(0,r.createElementVNode)("div",qn,[(0,r.createVNode)(l,{class:(0,r.normalizeClass)(`${o.type}icon`),size:"3em",value:o.icon},null,8,["class","value"]),(0,r.createElementVNode)("span",Gn,(0,r.toDisplayString)(o.message),1)])])}]]),Yn={class:"menu-container"},Jn={key:0,class:"menublock"},Xn={name:"ExtMenu",props:{list:{type:Array,default:[]},actived:{type:String}},computed:{menu(){return this.$app.menu}},methods:{onClick(e){const t=this.list.find(e=>e.id===this.actived);t&&(t.handlers?.disable?.(),t===e)?this.$emit("activate",null):(e.handler?.(e)||e.handlers?.enable?.(e)||this.$emit("click",e),this.$emit("activate",e))}}},Zn=(0,B.A)(Xn,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("ExpandedButton");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Yn,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.list,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t,class:(0,r.normalizeClass)([e.class,"menu-item"])},[e.hidden?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",Jn,[(0,r.createVNode)(l,{onClick:(0,r.withModifiers)(t=>s.onClick(e),["stop"]),label:e.label,color:e.id&&o.actived===e.id?"#ffff00":null,icon:e.icon},null,8,["onClick","label","color","icon"])]))],2))),128))])}]]),Qn=Zn,ea={class:"input-wrapper"},ta=["type","value","placeholder"],oa={name:"MinimalInput",props:{type:{type:String,default:"text"},value:{type:[String,Number],default:""},placeholder:{type:String,default:""}},emits:["update:value"]},na=(0,B.A)(oa,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",ea,[(0,r.createElementVNode)("input",{type:o.type,value:o.value,onInput:t[0]||(t[0]=t=>e.$emit("update:value",t.target.value)),placeholder:o.placeholder,class:"input-field"},null,40,ta)])}],["__scopeId","data-v-f47b63dc"]]),aa=["value"],ra={name:"Elements",props:{modelValue:{type:String}},data:()=>({element:null,list:[]}),mounted(){this.list=this.$app.engine.getFactory().Elements},computed:{val:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}},sa=(0,B.A)(ra,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.val=e),class:"form-select"},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.list,e=>((0,r.openBlock)(),(0,r.createElementBlock)("option",{value:e.path},(0,r.toDisplayString)(e.name),9,aa))),256))],512),[[r.vModelSelect,s.val]])])}]]),la={class:"radio-group"},ia=["onClick"],ca={name:"RadioButton",props:{buttons:{type:Array,required:!0},value:{type:Object}}},da=(0,B.A)(ca,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",la,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.buttons,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:t,class:"btn",onClick:t=>e.handler(o.value)},(0,r.toDisplayString)(e.label),9,ia))),128))])}],["__scopeId","data-v-48e97626"]]),pa=da,ua={class:"radio-group"},ma={class:"radio-label"},ha=["name","value","checked","disabled","onChange"],fa={class:"radio-custom"},va={class:"radio-text"},ga={class:"radio-default-label"},ya={name:"RadioButton",props:{options:{type:[Array,Number],required:!0,validator:e=>Array.isArray(e)||"number"==typeof e&&e>0},modelValue:{type:[String,Number,Boolean,Object],default:null},name:{type:String,default:"radio-group"},disabled:{type:Boolean,default:!1},valueKey:{type:String,default:"value"},labelKey:{type:String,default:"label"}},emits:["update:modelValue","change"],computed:{normalizedOptions(){return"number"==typeof this.options?Array.from({length:this.options},(e,t)=>t+1):this.options}},methods:{getOptionValue(e){return"object"==typeof e&&null!==e&&(e[this.valueKey]||e.value)||e},getOptionLabel(e){return"object"==typeof e&&null!==e?e[this.labelKey]||e.label||this.getOptionValue(e):e},isChecked(e){return this.getOptionValue(e)===this.modelValue},handleChange(e){const t=this.getOptionValue(e);this.$emit("update:modelValue",t),this.$emit("change",t)}}},ba=(0,B.A)(ya,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",ua,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.options,(t,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:n,class:(0,r.normalizeClass)(["radio-item",{"radio-item--disabled":o.disabled}])},[(0,r.createElementVNode)("label",ma,[(0,r.createElementVNode)("input",{type:"radio",name:o.name,value:s.getOptionValue(t),checked:s.isChecked(t),disabled:o.disabled,onChange:e=>s.handleChange(t),class:"radio-input"},null,40,ha),(0,r.createCommentVNode)(" Кастомная кнопка через слот "),(0,r.createElementVNode)("span",fa,[(0,r.renderSlot)(e.$slots,"button",{option:t,index:n,checked:s.isChecked(t)},()=>[(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["radio-default-button",{"radio-default-button--checked":s.isChecked(t)}])},null,2)],!0)]),(0,r.createCommentVNode)(" Кастомная надпись через слот "),(0,r.createElementVNode)("span",va,[(0,r.renderSlot)(e.$slots,"label",{option:t,index:n,checked:s.isChecked(t)},()=>[(0,r.createElementVNode)("span",ga,(0,r.toDisplayString)(s.getOptionLabel(t)),1)],!0)])])],2))),128))])}],["__scopeId","data-v-65d75466"]]),ka={class:"search-filter"},wa={class:"search-input-container"},Ea=["placeholder"],_a=["disabled"],Sa={name:"SearchFilter",props:{value:{type:String,default:""},placeholder:{type:String,default:"Enter text to search..."},debounce:{type:Number,default:300},label:{type:String,default:""},button:{type:String,default:"Search"},reactive:{type:Boolean,default:!1}},data(){return{searchValue:this.value,debounceTimer:null}},watch:{value(e){this.searchValue=e}},methods:{handleInput(){console.log("Search input "),this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.$emit("entry",this.searchValue)},this.debounce)},handleSearch(){console.log("Search handle "),this.searchValue.trim()&&(this.debounceTimer&&(clearTimeout(this.debounceTimer),this.debounceTimer=null),this.$emit("search",this.searchValue))},beforeUnmount(){this.debounceTimer&&clearTimeout(this.debounceTimer)}}},Na=(0,B.A)(Sa,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveDirective)("translate");return(0,r.openBlock)(),(0,r.createElementBlock)("div",ka,[(0,r.createElementVNode)("div",wa,[(0,r.createElementVNode)("div",null,(0,r.toDisplayString)(o.label),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.searchValue=e),type:"text",class:"search-input",placeholder:o.placeholder,onInput:t[1]||(t[1]=(0,r.withModifiers)((...e)=>s.handleInput&&s.handleInput(...e),["stop"])),onKeyup:t[2]||(t[2]=(0,r.withKeys)((...e)=>s.handleSearch&&s.handleSearch(...e),["enter"]))},null,40,Ea),[[r.vModelText,a.searchValue],[l]]),o.reactive?((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:0,class:"search-button",onClick:t[3]||(t[3]=t=>{a.searchValue="",e.$emit("clean")})},[(0,r.renderSlot)(e.$slots,"button-content",{},()=>[(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(o.button),1)],!0)])):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("button",{key:1,class:"search-button",onClick:t[4]||(t[4]=(...e)=>s.handleSearch&&s.handleSearch(...e)),disabled:!a.searchValue.trim()},[(0,r.renderSlot)(e.$slots,"button-content",{},()=>[(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(o.button),1)],!0)],8,_a)),[[l,`$$buttons.${o.button}`]])])])}],["__scopeId","data-v-d5c853e2"]]),Va={name:"SliderBlock",props:{value:{type:Boolean,default:()=>!1},property:{type:String,default:"top"},shift:{type:Number,default:100},zero:{type:Number,default:0}},computed:{style(){return{[this.property]:this.value?`${this.shift}px`:`${this.zero}px`}}},mounted(){"right"===this.property||"left"===this.property?this.$el.style.width=this.shift-this.zero+"px":this.$el.style.height=this.shift-this.zero+"px"}},Ca=(0,B.A)(Va,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",{class:"slider",style:(0,r.normalizeStyle)(s.style)},[(0,r.renderSlot)(e.$slots,"default",{},void 0,!0),(0,r.createElementVNode)("div",{onClick:t[0]||(t[0]=t=>e.$emit("revert"))},[(0,r.renderSlot)(e.$slots,"button",{},void 0,!0)])],4)}],["__scopeId","data-v-b3fc2cec"]]),Ba={key:0},$a={key:1},xa={key:2,class:"child-list"},Da={key:0},Ta={name:"TreeLi",props:["value"],data:()=>({childshow:!1})},Ia=(0,B.A)(Ta,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("TreeLi",!0);return(0,r.openBlock)(),(0,r.createElementBlock)("li",null,[o.value.children?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",Ba,[...t[1]||(t[1]=[(0,r.createElementVNode)("svg",{class:"edicon ics-spinner10"},[(0,r.createElementVNode)("use",{"xlink:href":"#ics-spinner10"})],-1)])])),o.value.children?((0,r.openBlock)(),(0,r.createElementBlock)("div",xa,[(0,r.createElementVNode)("span",{onClick:t[0]||(t[0]=t=>e.childshow=!e.childshow)},[t[3]||(t[3]=(0,r.createElementVNode)("input",{type:"checkbox"},null,-1)),(0,r.createTextVNode)((0,r.toDisplayString)(o.value.name),1)]),e.childshow?((0,r.openBlock)(),(0,r.createElementBlock)("ul",Da,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.value.children,(e,t)=>((0,r.openBlock)(),(0,r.createBlock)(l,{key:t,value:e},null,8,["value"]))),128))])):(0,r.createCommentVNode)("v-if",!0)])):((0,r.openBlock)(),(0,r.createElementBlock)("span",$a,[t[2]||(t[2]=(0,r.createElementVNode)("input",{type:"checkbox"},null,-1)),(0,r.createTextVNode)((0,r.toDisplayString)(o.value.name),1)]))])}],["__scopeId","data-v-562df7a6"]]),Aa={class:"selectable-container"},Ma={class:"list"},Oa={class:"grid"},ja=["onClick"],Pa={key:0,class:"info"},La={name:"ActionsLib",data:()=>({current:null}),props:{list:{type:Array},selected:{type:Object}},watch:{selected(e,t){this.current=e}},emits:["selectItem"],methods:{onItemSelect(e){this.$emit("selectItem",e)}}},Ra=(0,B.A)(La,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",Aa,[(0,r.createElementVNode)("div",Ma,[(0,r.createElementVNode)("div",Oa,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.list,(t,o)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{onClick:e=>s.onItemSelect(t),class:"grid-element",key:o},[(0,r.renderSlot)(e.$slots,"item",{item:t})],8,ja))),128))])]),a.current?((0,r.openBlock)(),(0,r.createElementBlock)("div",Pa,[(0,r.renderSlot)(e.$slots,"selected",{item:a.current})])):(0,r.createCommentVNode)("v-if",!0)])}]]),Fa={class:"vlist-container"},Ua={class:"list"},za={class:"vlist"},Ha=["onClick"],qa={name:"ActionsLib",data:()=>({current:null}),props:{list:{type:Array},selected:{type:Object}},watch:{selected(e,t){this.current=e}},emits:["selectItem"],methods:{onItemSelect(e){this.$emit("selectItem",e)}}},Ga=(0,B.A)(qa,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",Fa,[(0,r.createElementVNode)("div",Ua,[(0,r.createElementVNode)("div",za,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.list,(t,o)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{onClick:e=>s.onItemSelect(t),class:"vlist-element",key:o},[(0,r.renderSlot)(e.$slots,"item",{item:t})],8,Ha))),128))])])])}]]),Wa={style:{"text-align":"right"}},Ka={name:"BoolEdit",props:{modelValue:{type:Boolean}},computed:{val:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}},Ya=(0,B.A)(Ka,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",Wa,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>s.val=e)},null,512),[[r.vModelCheckbox,s.val]])])}]]),Ja={class:"comma-number-input-wrapper"},Xa={class:"arrow-buttons"},Za={name:"input-float",props:{value:Object,modelValue:Number,step:{type:Number,default:1},min:{type:Number,default:Number.MIN_SAFE_INTEGER},max:{type:Number,default:Number.MAX_SAFE_INTEGER}},data:()=>({interval:null,separator:",",isPressed:!1,changeSpeed:100}),computed:{formattedValue:{get(){return this.modelValue},set(e){console.log(e),this.parseNumber(e),this.$emit("update:modelValue",e)}}},mounted(){const e=(new Intl.NumberFormat).format(this.modelValue);this.separator=e.charAt(1),this.$refs.input.addEventListener("wheel",this.onWheel,{passive:!1})},beforeDestroy(){this.$refs.input.removeEventListener("wheel",this.onWheel)},methods:{onFocus(){this.$nextTick(()=>{this.$refs.input.select()})},parseNumber(e){try{const t=parseFloat(e.replace(",","."));return isNaN(t)?this.modelValue:t}catch(e){return this.modelValue}},formatNumber:e=>parseFloat(e).toFixed(0).replace(".",","),onInput(e){this.formattedValue=e.target.modelValue},onWheel(e){e.preventDefault(),e.stopPropagation(),document.activeElement===this.$refs.input&&this.changeValue(e.deltaY>0?-this.step:this.step)},onKeyDown(e){"ArrowUp"===e.key?(this.changeValue(this.step),e.preventDefault()):"ArrowDown"===e.key&&(this.changeValue(-this.step),e.preventDefault())},changeValue(e){let t=(this.modelValue||0)+e;t=Math.max(Math.min(t,this.max),this.min),this.$emit("update:modelValue",parseFloat(t.toFixed(0)))},startIncrement(){this.interval&&clearInterval(this.interval),this.isPressed=!0,this.changeValue(this.step),setTimeout(()=>{this.isPressed&&(this.interval=setInterval(()=>this.changeValue(this.step),50))},400)},startDecrement(){this.interval&&clearInterval(this.interval),this.isPressed=!0,this.changeValue(-this.step),setTimeout(()=>{this.isPressed&&(this.interval=setInterval(()=>this.changeValue(-this.step),50))},400)},stopChange(){this.isPressed=!1,clearInterval(this.interval)}}},Qa=(0,B.A)(Za,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",Ja,[(0,r.withDirectives)((0,r.createElementVNode)("input",{ref:"input","onUpdate:modelValue":t[0]||(t[0]=e=>s.formattedValue=e),onKeydown:t[1]||(t[1]=(...e)=>s.onKeyDown&&s.onKeyDown(...e)),onDblclick:t[2]||(t[2]=(...e)=>s.onFocus&&s.onFocus(...e)),class:"comma-number-input"},null,544),[[r.vModelText,s.formattedValue,void 0,{number:!0}]]),(0,r.createElementVNode)("div",Xa,[(0,r.createElementVNode)("button",{onMousedown:t[3]||(t[3]=(...e)=>s.startIncrement&&s.startIncrement(...e)),onMouseup:t[4]||(t[4]=(...e)=>s.stopChange&&s.stopChange(...e)),onMouseleave:t[5]||(t[5]=(...e)=>s.stopChange&&s.stopChange(...e))},"▲",32),(0,r.createElementVNode)("button",{onMousedown:t[6]||(t[6]=(...e)=>s.startDecrement&&s.startDecrement(...e)),onMouseup:t[7]||(t[7]=(...e)=>s.stopChange&&s.stopChange(...e)),onMouseleave:t[8]||(t[8]=(...e)=>s.stopChange&&s.stopChange(...e))},"▼",32)])])}]]),er=["onUpdate:modelValue"],tr=["onUpdate:modelValue"],or={name:"NameEditor",data:()=>({properties:[{property:"envMap",value:null}]}),methods:{updateAsset(){for(let e=0;e<this.properties.length;e++){const t=this.properties[e];this.selected[t.property],this.$app.assets.updateAsset(this.selected,t.property,()=>{})}}},props:{selected:{type:Object}}},nr=(0,B.A)(or,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.properties,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",null,[(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t=>e.property=t},null,8,er),[[r.vModelText,e.property]]),(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t=>o.selected[e.property]=t},null,8,tr),[[r.vModelText,o.selected[e.property]]])]))),256)),(0,r.createElementVNode)("div",null,[(0,r.createElementVNode)("button",{class:"btn",onClick:t[0]||(t[0]=(...e)=>s.updateAsset&&s.updateAsset(...e))},"Update")])])}]]),ar=nr,rr={class:"comma-number-input-wrapper"},sr={class:"arrow-buttons"},lr={name:"CommaNumberInput",props:{modelValue:Number,step:{type:Number,default:.1},min:{type:Number,default:Number.MIN_SAFE_INTEGER},max:{type:Number,default:Number.MAX_SAFE_INTEGER},decimals:{type:Number,default:2}},data:()=>({interval:null,separator:",",isPressed:!1,changeSpeed:100}),computed:{formattedValue:{get(){return this.modelValue},set(e){const t=this.parseNumber(e);this.$emit("update:modelValue",t)}}},mounted(){const e=(new Intl.NumberFormat).format(this.modelValue);this.separator=e.charAt(1),this.$refs.input.addEventListener("wheel",this.onWheel,{passive:!1})},beforeDestroy(){this.$refs.input.removeEventListener("wheel",this.onWheel)},methods:{onFocus(){this.$nextTick(()=>{this.$refs.input.select()})},parseNumber(e){try{const t=parseFloat(e.replace(",","."));return isNaN(t)?this.modelValue:t}catch(e){return this.modelValue}},formatNumber(e){return parseFloat(e).toFixed(this.decimals).replace(".",",")},onInput(e){this.formattedValue=e.target.modelValue},onWheel(e){e.preventDefault(),e.stopPropagation(),document.activeElement===this.$refs.input&&this.changeValue(e.deltaY>0?-this.step:this.step)},onKeyDown(e){"ArrowUp"===e.key?(this.changeValue(this.step),e.preventDefault()):"ArrowDown"===e.key&&(this.changeValue(-this.step),e.preventDefault())},changeValue(e){let t=(this.modelValue||0)+e;t=Math.max(Math.min(t,this.max),this.min),this.$emit("update:modelValue",parseFloat(t.toFixed(this.decimals)))},startIncrement(){this.interval&&clearInterval(this.interval),this.isPressed=!0,this.changeValue(this.step),setTimeout(()=>{this.isPressed&&(this.interval=setInterval(()=>this.changeValue(this.step),50))},400)},startDecrement(){this.interval&&clearInterval(this.interval),this.isPressed=!0,this.changeValue(-this.step),setTimeout(()=>{this.isPressed&&(this.interval=setInterval(()=>this.changeValue(-this.step),50))},400)},stopChange(){this.isPressed=!1,clearInterval(this.interval)}}},ir=(0,B.A)(lr,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",rr,[(0,r.withDirectives)((0,r.createElementVNode)("input",{ref:"input",type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>s.formattedValue=e),onKeydown:t[1]||(t[1]=(...e)=>s.onKeyDown&&s.onKeyDown(...e)),onDblclick:t[2]||(t[2]=(...e)=>s.onFocus&&s.onFocus(...e)),class:"comma-number-input"},null,544),[[r.vModelText,s.formattedValue]]),(0,r.createElementVNode)("div",sr,[(0,r.createElementVNode)("button",{onMousedown:t[3]||(t[3]=(...e)=>s.startIncrement&&s.startIncrement(...e)),onMouseup:t[4]||(t[4]=(...e)=>s.stopChange&&s.stopChange(...e)),onMouseleave:t[5]||(t[5]=(...e)=>s.stopChange&&s.stopChange(...e))},"▲",32),(0,r.createElementVNode)("button",{onMousedown:t[6]||(t[6]=(...e)=>s.startDecrement&&s.startDecrement(...e)),onMouseup:t[7]||(t[7]=(...e)=>s.stopChange&&s.stopChange(...e)),onMouseleave:t[8]||(t[8]=(...e)=>s.stopChange&&s.stopChange(...e))},"▼",32)])])}]]),cr={class:"control-container"},dr=["max"],pr={class:"buttons"},ur=["disabled"],mr=["disabled"],hr={__name:"playcontrol",props:{modelValue:{type:Object},selected:{type:Object},value:{type:Object},target:{type:Object},property:{type:Object}},setup(e){const t=e,o=(0,r.ref)(!1),n=(0,r.ref)(0),a=(0,r.ref)(0),s=(0,r.ref)(0),l=(0,r.ref)(!1),i=(0,r.ref)(!1);function c(){const e=t.modelValue;i.value?e.pause():e.play()}function d(){t.modelValue.pause(),t.modelValue.currentTime=0}function p(){l.value=!1;const e=t.modelValue;if(o.value&&s.value<=e.duration)if(e.readyState<2){const t=()=>{e.currentTime=s.value,e.removeEventListener("canplay",t)};e.addEventListener("canplay",t),e.load()}else e.currentTime=s.value}function u(e){return!e||isNaN(e)?"0:00":`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`}return(0,r.onMounted)(()=>{const e=t.modelValue,c=()=>{e.readyState>=1&&(n.value=e.duration,o.value=!0)},d=()=>{l.value||(a.value=e.currentTime,s.value=e.currentTime)},p=()=>i.value=!0,u=()=>i.value=!1,m=()=>i.value=!1;e.addEventListener("loadedmetadata",c),e.addEventListener("canplay",c),e.addEventListener("timeupdate",d),e.addEventListener("play",p),e.addEventListener("playing",p),e.addEventListener("pause",u),e.addEventListener("ended",m),c(),(0,r.onUnmounted)(()=>{e.removeEventListener("loadedmetadata",c),e.removeEventListener("canplay",c),e.removeEventListener("timeupdate",d),e.removeEventListener("play",p),e.removeEventListener("playing",p),e.removeEventListener("pause",u),e.removeEventListener("ended",m)})}),(e,t)=>{const m=(0,r.resolveComponent)("icon");return(0,r.openBlock)(),(0,r.createElementBlock)("div",cr,[(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(u(a.value))+" / "+(0,r.toDisplayString)(u(n.value)),1),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"range",min:"0",max:n.value,step:"0.01","onUpdate:modelValue":t[0]||(t[0]=e=>s.value=e),onMousedown:t[1]||(t[1]=e=>l.value=!0),onMouseup:p,onTouchstart:t[2]||(t[2]=e=>l.value=!0),onTouchend:p},null,40,dr),[[r.vModelText,s.value,void 0,{number:!0}]]),(0,r.createElementVNode)("div",pr,[(0,r.createElementVNode)("button",{class:"btn square",onClick:c,disabled:!o.value},[(0,r.createVNode)(m,{value:i.value?"pause2":"play3"},null,8,["value"])],8,ur),(0,r.createCommentVNode)(' <button class="btn square" @click="pause" :disabled="!ready">\r\n                <icon value="pause2"></icon>\r\n            </button> '),(0,r.createElementVNode)("button",{class:"btn square",onClick:d,disabled:!o.value},[(0,r.createVNode)(m,{value:"stop2"})],8,mr)])])}}},fr=(0,B.A)(hr,[["__scopeId","data-v-ae734b3c"]]),vr={style:{display:"grid","grid-template-columns":"96px 1fr"}},gr={style:{"text-align":"center"}},yr={props:{selected:{type:Object},label:{type:String},value:{type:Number},property:{type:Object}},computed:{val:{get(){return this.value},set(e){this.$emit("update:value",e)}}}},br=(0,B.A)(yr,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("FloatInput");return(0,r.openBlock)(),(0,r.createElementBlock)("div",vr,[(0,r.createElementVNode)("div",null,(0,r.toDisplayString)(o.label),1),(0,r.createElementVNode)("div",gr,[(0,r.createVNode)(l,{min:o.property.min||0,step:o.property.step||.01,value:s.val,onChanged:t[0]||(t[0]=e=>s.val=e)},null,8,["min","step","value"])])])}]]),kr={class:"v2value"},wr={class:"v2label"},Er={props:{modelValue:{type:Object,default:new we.Vector2},decimals:{type:Number,default:4},step:{type:Number,default:1},styles:{type:Object,default:{"justify-content":"space-around"}}},computed:{value:{get(){return this.modelValue}}},methods:{updateValue(e,t){"number"==typeof t&&this.$emit("update:modelValue",{...this.value,[e]:t})}}},_r=(0,B.A)(Er,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("float");return(0,r.openBlock)(),(0,r.createElementBlock)("div",{style:(0,r.normalizeStyle)(o.styles),class:"v2"},[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(["x","y"],e=>(0,r.createElementVNode)("div",kr,[(0,r.createElementVNode)("label",wr,(0,r.toDisplayString)(e),1),(0,r.createVNode)(l,{modelValue:s.value[e],"onUpdate:modelValue":[t=>s.value[e]=t,t=>s.updateValue(e,t)],decimals:o.decimals,step:o.step},null,8,["modelValue","onUpdate:modelValue","decimals","step"])])),64))],4)}]]),Sr={class:"v3"},Nr={class:"v3value"},Vr={class:"v3label"},Cr={props:{modelValue:{type:Object,default:new we.Vector3},decimals:{type:Number,default:4},step:{type:Number,default:1}},computed:{value:{get(){return this.modelValue}}},methods:{updateValue(e,t){"number"==typeof t&&this.$emit("update:modelValue",{...this.value,[e]:t})}}},Br=(0,B.A)(Cr,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("float");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Sr,[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(["x","y","z"],e=>(0,r.createElementVNode)("div",Nr,[(0,r.createElementVNode)("label",Vr,(0,r.toDisplayString)(e),1),(0,r.createVNode)(l,{modelValue:s.value[e],"onUpdate:modelValue":[t=>s.value[e]=t,t=>s.updateValue(e,t)],decimals:o.decimals,step:o.step},null,8,["modelValue","onUpdate:modelValue","decimals","step"])])),64))])}]]),$r={style:{display:"flex","align-items":"center",gap:"1px","flex-direction":"column"}},xr={key:0,class:"tools"},Dr={key:1,class:"titleinfo"},Tr={data:()=>({expanded:!0}),props:{label:String,modelValue:{type:Object,default:new we.Vector3},decimals:{type:Number,default:2},step:{type:Number,default:1}},computed:{value:{get(){return this.modelValue}}},watch:{values(e,t){}},methods:{onUpdate(e){const t=new CustomEvent("update:modelValue",{detail:e,bubbles:!1});this.$emit("update:modelValue",t.detail)}}},Ir=(0,B.A)(Tr,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("V3");return(0,r.openBlock)(),(0,r.createElementBlock)("div",$r,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["title",a.expanded?"":"min"])},[(0,r.createElementVNode)("div",{class:"label",onClick:t[0]||(t[0]=e=>a.expanded=!a.expanded)},(0,r.toDisplayString)(a.expanded?"▼":"▶")+" "+(0,r.toDisplayString)(o.label),1),a.expanded?((0,r.openBlock)(),(0,r.createElementBlock)("div",xr,[(0,r.renderSlot)(e.$slots,"tools",{},void 0,!0)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",Dr,"x:"+(0,r.toDisplayString)(o.modelValue.x.toFixed(o.decimals))+",y:"+(0,r.toDisplayString)(o.modelValue.y.toFixed(o.decimals))+",z:"+(0,r.toDisplayString)(o.modelValue.z.toFixed(o.decimals)),1))],2),a.expanded?((0,r.openBlock)(),(0,r.createBlock)(l,{key:0,modelValue:s.value,decimals:o.decimals,step:o.step,"onUpdate:modelValue":s.onUpdate},null,8,["modelValue","decimals","step","onUpdate:modelValue"])):(0,r.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-6e23d76e"]]),Ar={style:{display:"flex","align-items":"center",gap:"3px","flex-direction":"column"}},Mr={class:"label"},Or={key:0,class:"tools"},jr={key:1,class:"titleinfo"},Pr={data:()=>({expanded:!0,vprops:["x","y","z"]}),props:{rotation:{type:Object,default:{x:0,y:0,z:0}},quaternion:Object,label:String,modelValue:Object,decimals:{type:Number,default:2},step:{type:Number,default:1}},methods:{onChangeVal(e){e.x>359&&(e.x=0),e.x<-359&&(e.x=0),e.y>359&&(e.y=0),e.y<-359&&(e.y=0),e.z>359&&(e.z=0),e.z<-359&&(e.z=0);const t=new CustomEvent("update:modelValue",{detail:new we.Euler(Yt(Math.round(e.x)),Yt(Math.round(e.y)),Yt(Math.round(e.z)),"XYZ"),bubbles:!1});this.$emit("update:rotation",t.detail)}},computed:{formattedValue:{get(){return{x:Math.round(Kt(this.rotation.x)),y:Math.round(Kt(this.rotation.y)),z:Math.round(Kt(this.rotation.z))}}}}},Lr=(0,B.A)(Pr,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("V3");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Ar,[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["title",a.expanded?"":"min"]),onClick:t[0]||(t[0]=e=>a.expanded=!a.expanded)},[(0,r.createElementVNode)("div",Mr,(0,r.toDisplayString)(a.expanded?"▼":"▶")+" "+(0,r.toDisplayString)(o.label),1),a.expanded?((0,r.openBlock)(),(0,r.createElementBlock)("div",Or,[(0,r.renderSlot)(e.$slots,"tools",{},void 0,!0)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",jr,"x:"+(0,r.toDisplayString)(s.formattedValue.x)+",y:"+(0,r.toDisplayString)(s.formattedValue.y)+",z:"+(0,r.toDisplayString)(s.formattedValue.z),1))],2),a.expanded?((0,r.openBlock)(),(0,r.createBlock)(l,{key:0,modelValue:s.formattedValue,decimals:o.decimals,step:o.step,"onUpdate:modelValue":s.onChangeVal},null,8,["modelValue","decimals","step","onUpdate:modelValue"])):(0,r.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-b8974312"]]),Rr={style:{display:"flex","align-items":"center",gap:"1px","flex-direction":"column"}},Fr={name:"QuaternionEditor",props:{modelValue:{type:we.Quaternion,required:!0},decimals:{type:Number,default:2},step:{type:Number,default:1}},data:()=>({expanded:!0,x:0,y:0,z:0}),watch:{modelValue:{handler(e){this.updateEulerFromQuaternion(e)},immediate:!0,deep:!0}},methods:{updateEulerFromQuaternion(e){const t=(new we.Euler).setFromQuaternion(e,"XYZ");this.x=this.roundValue(t.x),this.y=this.roundValue(t.y),this.z=this.roundValue(t.z)},updateQuaternion(){const e=new we.Euler(this.x,this.y,this.z,"XYZ"),t=(new we.Quaternion).setFromEuler(e,"XYZ");this.$emit("update:modelValue",t)},roundValue:e=>Math.round(100*e)/100}},Ur=(0,B.A)(Fr,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("V3");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Rr,[(0,r.createCommentVNode)(' <div class="title" :class="expanded ? \'\' : \'min\'">\r\n            <div class="label" @click="expanded = !expanded">{{expanded?\'▼\':\'▶\' }} {{ label }}</div>\r\n            <div v-if="expanded"class="tools"><slot name="tools"></slot></div>\r\n            <div v-else class="titleinfo">x:{{ modelValue.x.toFixed(decimals) }},y:{{ modelValue.y.toFixed(decimals) }},z:{{ modelValue.z.toFixed(decimals) }}</div>\r\n        </div> '),a.expanded?((0,r.openBlock)(),(0,r.createBlock)(l,{key:0,modelValue:{x:a.x,y:a.y,z:a.z},decimals:o.decimals,step:o.step,"onUpdate:modelValue":s.updateQuaternion},null,8,["modelValue","decimals","step","onUpdate:modelValue"])):(0,r.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-96995396"]]),zr={class:"block_container"},Hr={key:0,class:"editrow"},qr={class:"label"},Gr={name:"LabelEditor",props:{modelValue:{type:String,default:""},label:{type:String,default:""},tooltip:{type:String,default:""}},data:()=>({editMode:!1,val:""}),watch:{modelValue(){this.editMode=!1}},methods:{startEdit(){this.val=this.modelValue,this.editMode=!0,this.$nextTick(()=>{this.$refs.editInput.focus()})},complete(e){console.log(e),e.ctrlKey||e.shiftKey||(e&&e.preventDefault(),this.$emit("update:modelValue",this.val),this.editMode=!1)},endEdit(){return this.editMode?(this.editMode=!1,this.val):this.modelValue}},mounted(){}},Wr=(0,B.A)(Gr,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[(0,r.createElementVNode)("div",zr,[e.editMode?((0,r.openBlock)(),(0,r.createElementBlock)("div",Hr,[(0,r.withDirectives)((0,r.createElementVNode)("textarea",{rows:"10",cols:"33",ref:"editInput",class:"editinput","onUpdate:modelValue":t[0]||(t[0]=t=>e.val=t),onKeyup:t[1]||(t[1]=(0,r.withKeys)((...e)=>s.complete&&s.complete(...e),["enter"]))},null,544),[[r.vModelText,e.val]]),(0,r.createVNode)(l,{class:"okicon",value:"checkmark",size:"1em",onClick:s.complete},null,8,["onClick"])])):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",{class:"editrow",onClick:t[2]||(t[2]=(...e)=>s.startEdit&&s.startEdit(...e)),key:"tooltip-"+o.modelValue},[(0,r.createElementVNode)("span",qr,(0,r.toDisplayString)(o.modelValue),1),(0,r.createVNode)(l,{value:"pencil",size:"1em"})])),[[i,o.tooltip||o.modelValue]])])])}],["__scopeId","data-v-44f8aea6"]]),Kr={class:"block_container"},Yr={key:0,class:"editrow"},Jr={class:"label"},Xr={name:"LabelEditor",props:{modelValue:{type:String,default:""},label:{type:String,default:""},tooltip:{type:String,default:""}},data:()=>({editMode:!1,val:""}),watch:{modelValue(){this.editMode=!1}},methods:{startEdit(){this.val=this.modelValue,this.editMode=!0,this.$nextTick(()=>{this.$refs.editInput.focus()})},complete(e){e&&e.preventDefault(),this.$emit("update:modelValue",this.val),this.editMode=!1},endEdit(){return this.editMode?(this.editMode=!1,this.val):this.modelValue}},mounted(){}},Zr=(0,B.A)(Xr,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[(0,r.createElementVNode)("div",Kr,[e.editMode?((0,r.openBlock)(),(0,r.createElementBlock)("div",Yr,[(0,r.withDirectives)((0,r.createElementVNode)("input",{ref:"editInput",class:"editinput","onUpdate:modelValue":t[0]||(t[0]=t=>e.val=t),onKeyup:t[1]||(t[1]=(0,r.withKeys)((...e)=>s.complete&&s.complete(...e),["enter"]))},null,544),[[r.vModelText,e.val]]),(0,r.createVNode)(l,{class:"okicon",value:"checkmark",size:"1em",onClick:s.complete},null,8,["onClick"])])):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",{class:"editrow",onClick:t[2]||(t[2]=(...e)=>s.startEdit&&s.startEdit(...e)),key:"tooltip-"+o.modelValue},[(0,r.createElementVNode)("span",Jr,(0,r.toDisplayString)(o.modelValue),1),(0,r.createVNode)(l,{value:"pencil",size:"1em"})])),[[i,o.tooltip||o.modelValue]])])])}],["__scopeId","data-v-1e1887cc"]]),Qr={class:"transform-container"},es={class:"label"},ts={class:"transforms"},os={key:1},ns={key:3},as={key:5},rs={props:{modelValue:{type:Object,default:{}},value:{type:Object,default:{}},target:{type:Object}},beforeUnmount(){this.value},mounted(){no.Transformer.addEventListener("objectChange",this.onTransformerEvent)},methods:{assignFromModel(e){this.value&&this.value[e]?(this.target[e]={x:this.value[e].x,y:this.value[e].y,z:this.value[e].z},this.$emit("save")):console.warn(`Value or property ${e} is undefined`)},removeTransform(e){this.target&&this.target[e]&&this.target[e]&&(delete this.target[e],"rotation"===e&&this.value.rotation.set(0,0,0,"XYZ"),this.$emit("save"))},onTransformerEvent(e){switch(console.log(no.Transformer,this.target,this.value.position),no.Transformer.mode){case"translate":this.target.position={...this.value.position};break;case"rotate":this.target.rotation={x:this.value.rotation.x,y:this.value.rotation.y,z:this.value.rotation.z};break;case"scale":this.target.scale={...this.value.scale}}this.$emit("save")},async onChangeTransform(e,t){switch(e){case"position":this.value.position.copy(t),this.target.position={x:t.x||0,y:t.y||0,z:t.z||0};break;case"rotation":this.value.rotation.set(t.x,t.y,t.z,"XYZ"),this.target.rotation={x:t.x,y:t.y,z:t.z};break;case"scale":this.value.scale.copy(t),this.target.scale={x:t.x,y:t.y,z:t.z}}this.$emit("save",e)}}},ss=(0,B.A)(rs,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveComponent)("V3block"),c=(0,r.resolveComponent)("EulerBlock"),d=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",null,[(0,r.createElementVNode)("div",Qr,[(0,r.createElementVNode)("div",es,[(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("div",ts,[o.target.position?((0,r.openBlock)(),(0,r.createBlock)(i,{key:0,"onUpdate:modelValue":t[3]||(t[3]=e=>s.onChangeTransform("position",e)),label:"Position",step:.1,modelValue:o.target.position,decimals:4},{tools:(0,r.withCtx)(()=>[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("button",{class:"square",onClick:t[2]||(t[2]=e=>s.removeTransform("position"))},[(0,r.createVNode)(l,{value:"bin",size:"1em"})])),[[d,"Delete position"]])]),_:1},8,["modelValue"])):((0,r.openBlock)(),(0,r.createElementBlock)("div",os,[(0,r.createElementVNode)("button",{class:"copybutton",onClick:t[4]||(t[4]=e=>s.assignFromModel("position"))},"Copy model position")])),o.target.rotation?((0,r.openBlock)(),(0,r.createBlock)(c,{key:2,"onUpdate:rotation":t[6]||(t[6]=e=>s.onChangeTransform("rotation",e)),label:"Rotation",step:1,decimals:0,rotation:o.target.rotation},{tools:(0,r.withCtx)(()=>[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("button",{class:"square",onClick:t[5]||(t[5]=e=>s.removeTransform("rotation"))},[(0,r.createVNode)(l,{value:"bin",size:"1em"})])),[[d,"Remove rotation"]])]),_:1},8,["rotation"])):((0,r.openBlock)(),(0,r.createElementBlock)("div",ns,[(0,r.createElementVNode)("button",{class:"copybutton",onClick:t[7]||(t[7]=e=>s.assignFromModel("rotation"))},"Copy model rotation")])),o.target.scale?((0,r.openBlock)(),(0,r.createBlock)(i,{key:4,"onUpdate:modelValue":t[9]||(t[9]=e=>s.onChangeTransform("scale",e)),label:"Scale",step:.01,modelValue:o.target.scale},{tools:(0,r.withCtx)(()=>[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("button",{class:"square",onClick:t[8]||(t[8]=e=>s.removeTransform("scale"))},[(0,r.createVNode)(l,{value:"bin",size:"1em"})])),[[d,"Remove size"]])]),_:1},8,["modelValue"])):((0,r.openBlock)(),(0,r.createElementBlock)("div",as,[(0,r.createElementVNode)("button",{class:"copybutton",onClick:t[10]||(t[10]=e=>s.assignFromModel("scale"))},"Copy model scale")]))])])])}]]),ls={style:{display:"grid","grid-template-columns":"96px 1fr"}},is={name:"EditColor",props:{modelValue:{type:Object}},computed:{val:{get(){return`#${this.modelValue?.getHexString()||"ffffff"}`},set(e){this.modelValue&&this.modelValue.set(e),this.$emit("update:modelValue",this.modelValue||new we.Color(e))}}}},cs=(0,B.A)(is,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",ls,[(0,r.withDirectives)((0,r.createElementVNode)("input",{style:{width:"100%"},ref:"col",type:"color","onUpdate:modelValue":t[0]||(t[0]=e=>s.val=e)},null,512),[[r.vModelText,s.val]])])}]]),ds={style:{display:"grid","grid-template-columns":"96px 1fr"}},ps={name:"ColorString",props:{modelValue:{type:String}},computed:{val:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}}},us=(0,B.A)(ps,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",ds,[(0,r.withDirectives)((0,r.createElementVNode)("input",{style:{width:"100%"},ref:"col",type:"color","onUpdate:modelValue":t[0]||(t[0]=e=>s.val=e)},null,512),[[r.vModelText,s.val]])])}]]),ms={class:"image-container"},hs={ref:"canva"},fs={key:0,class:"selector"},vs={props:{modelValue:{type:Object,default:null},value:{type:Object},label:{type:String,default:""},tooltip:{type:String,default:""},selectable:{type:Boolean}},data:()=>({txtr:null}),watch:{value(e){this.redraw()}},methods:{onUpdate({result:e,file:t}){console.log(e);const o=new Blob([e],{type:t.type}),n=URL.createObjectURL(o);this.txtr=n;const a=(new THREE.TextureLoader).load(n,()=>{URL.revokeObjectURL(n)});this.$emit("update:modelValue",a.image),this.$app.storage.writeFile("texture.png",e)},redraw(){const e=this.$refs.canva,t=e.getContext("2d");if(t.clearRect(0,0,e.width,e.height),this.value?.resource?.image)try{const o=this.value.resource.image;e.width=o.width,e.height=o.height,t.drawImage(o,0,0)}catch(e){}}},mounted(){this.redraw()}},gs=(0,B.A)(vs,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",ms,[(0,r.createElementVNode)("canvas",hs,null,512),o.selectable?((0,r.openBlock)(),(0,r.createElementBlock)("div",fs,[(0,r.createElementVNode)("button",{onClick:t[0]||(t[0]=t=>e.$emit("select"))},"SELECT")])):(0,r.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-37652e71"]]),ys={class:"image-container"},bs=["src"];var ks=o(92);const ws=new class{constructor(){this.renderer=null,this.scene=null,this.camera=null,this.canvas=null,this.db=null,this.dbName="ModelPreviews",this.dbVersion=1,this.storeName="previews",this.initDatabase(),this.initThreeJS()}async initDatabase(){return new Promise((e,t)=>{const o=indexedDB.open(this.dbName,this.dbVersion);o.onerror=()=>t(o.error),o.onsuccess=()=>{this.db=o.result,e()},o.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:"id"})}})}initThreeJS(){this.canvas=document.createElement("canvas"),this.canvas.width=256,this.canvas.height=256,this.renderer=new we.WebGLRenderer({canvas:this.canvas,antialias:!0,preserveDrawingBuffer:!0,alpha:!0}),this.renderer.setSize(this.canvas.width,this.canvas.height),this.renderer.setClearColor(0,0),this.scene=new we.Scene;const e=new we.AmbientLight(16777215,.6);this.scene.add(e);const t=new we.DirectionalLight(16777215,.8);t.position.set(1,1,1),this.scene.add(t)}async loadModel(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.blob(),n=URL.createObjectURL(o);let a;if(!e.toLowerCase().endsWith(".glb")&&!e.toLowerCase().endsWith(".gltf"))throw new Error("Unsupported format. Only GLB/GLTF supported");return a=await this.loadGLTF(n),URL.revokeObjectURL(n),a}catch(e){throw console.error("Error loading model:",e),e}}loadGLTF(e){return new Promise((t,o)=>{(new ks.B).load(e,e=>t(e.scene),null,e=>o(e))})}fitCameraToObject(e,t){const o=(new we.Box3).setFromObject(e),n=o.getCenter(new we.Vector3),a=o.getSize(new we.Vector3),r=Math.max(a.x,a.y,a.z),s=t.fov*(Math.PI/180);let l=Math.abs(r/Math.sin(s/2));return l*=1.5,t.position.set(n.x,n.y,n.z+l),t.lookAt(n),{center:n,size:a}}async generatePreview(e){try{const t=await this.loadModel(e);this.scene.add(t),this.camera=new we.PerspectiveCamera(45,this.canvas.width/this.canvas.height,.1,1e3),this.fitCameraToObject(t,this.camera),this.renderer.render(this.scene,this.camera);const o=this.canvas.toDataURL("image/png"),n=this.generateId();return await this.saveToDatabase(n,o,e),this.scene.remove(t),n}catch(e){throw console.error("Error generating preview:",e),e}}generateId(){return`preview_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}async saveToDatabase(e,t,o){return new Promise((n,a)=>{const r=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName),s={id:e,screenshot:t,originalUrl:o,createdAt:(new Date).toISOString()},l=r.add(s);l.onsuccess=()=>n(e),l.onerror=()=>a(l.error)})}async getPreview(e){return new Promise((t,o)=>{const n=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(e);n.onsuccess=()=>{n.result?t(n.result):o(new Error("Preview not found"))},n.onerror=()=>o(n.error)})}async deletePreview(e){return new Promise((t,o)=>{const n=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).delete(e);n.onsuccess=()=>t(),n.onerror=()=>o(n.error)})}async getAllPreviews(){return new Promise((e,t)=>{const o=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();o.onsuccess=()=>e(o.result),o.onerror=()=>t(o.error)})}async clearAllPreviews(){return new Promise((e,t)=>{const o=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();o.onsuccess=()=>e(),o.onerror=()=>t(o.error)})}},Es=ws,_s={props:{modelValue:{type:[Object,String],default:null},value:{type:Object},label:{type:String,default:""},image:{type:String},tooltip:{type:String,default:""},selectable:{type:Boolean}},computed:{isString(){return"string"==typeof this.modelValue}},data:()=>({img:null}),watch:{modelValue(e){this.redraw()}},methods:{async redraw(){if(this.img=null,this.value[this.image])return void(this.img=this.value[this.image]);const e=await Es.generatePreview(this.modelValue),t=await Es.getPreview(e);this.img=t.screenshot}},mounted(){this.redraw()}},Ss=(0,B.A)(_s,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",ys,[a.img?((0,r.openBlock)(),(0,r.createElementBlock)("img",{key:0,style:{width:"100%",height:"100%"},src:a.img},null,8,bs)):(0,r.createCommentVNode)("v-if",!0)])}]]),Ns={class:"image-uploader"},Vs=["accept"],Cs={name:"FileSelect",props:{buttonText:{type:String,default:"Select Image"},maxFileSize:{type:Number,default:5242880},acceptedTypes:{type:String,default:"image/*"}},methods:{triggerFileInput(){this.$refs.fileInput.click()},handleFileSelect(e){const t=e.target.files[0];if(!t)return;if(console.log(t),!t.type.match(this.acceptedTypes.replace("*",".*")))return void this.$emit("error","Invalid file type");if(t.size>this.maxFileSize)return void this.$emit("error",`File is too large (max ${this.maxFileSize/1024/1024}MB)`);const o=new FileReader;o.onload=e=>{this.$emit("update:modelValue",{result:e.target.result,file:t})},o.onerror=()=>this.$emit("error","Failed to read file"),o.readAsArrayBuffer(t),e.target.value=""}}},Bs=(0,B.A)(Cs,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",Ns,[(0,r.createElementVNode)("button",{onClick:t[0]||(t[0]=(...e)=>s.triggerFileInput&&s.triggerFileInput(...e)),class:"upload-button"},(0,r.toDisplayString)(o.buttonText),1),(0,r.createElementVNode)("input",{type:"file",ref:"fileInput",accept:o.acceptedTypes,onChange:t[1]||(t[1]=(...e)=>s.handleFileSelect&&s.handleFileSelect(...e)),style:{display:"none"}},null,40,Vs)])}]]),$s={__name:"twosidebool",props:{modelValue:{type:Boolean,default:!1},labels:{type:Array}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,n=t,a=()=>{n("update:modelValue",!o.modelValue)};return(t,o)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{class:"toggle-switch",onClick:a},[(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["slider",{active:e.modelValue}])},[(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["left-label",{active:!e.modelValue}])},[(0,r.renderSlot)(t.$slots,"left",{},()=>[(0,r.createTextVNode)((0,r.toDisplayString)(e.labels[0]),1)])],2),o[0]||(o[0]=(0,r.createElementVNode)("span",{class:"knob"},null,-1)),(0,r.createElementVNode)("span",{class:(0,r.normalizeClass)(["right-label",{active:e.modelValue}])},[(0,r.renderSlot)(t.$slots,"right",{},()=>[(0,r.createTextVNode)((0,r.toDisplayString)(e.labels[1]),1)])],2)],2)]))}},xs=(0,B.A)($s,[["__scopeId","data-v-27cb6eff"]]),Ds={class:"selected-value"},Ts={class:"select-dropdown"},Is=["onClick"],As={__name:"sectionselect",props:{modelValue:{type:String,default:""},list:{type:Array,default:()=>[]},placeholder:{type:String,default:"Выберите вариант"}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,n=t,a=(0,r.ref)(o.modelValue),s=(0,r.ref)(!1),l=(0,r.ref)(null),i=(0,r.computed)(()=>o.list.map(e=>void 0===e.label?{...e,label:c(e.value)}:e)),c=e=>e?e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim():"",d=(0,r.computed)(()=>{const e=i.value.find(e=>e.value===a.value);return e?e.label:o.placeholder});(0,r.watch)(()=>o.modelValue,e=>{e!==a.value&&(a.value=e)});const p=()=>{s.value=!s.value},u=()=>{setTimeout(()=>{s.value=!1},150)},m=e=>{l.value&&!l.value.contains(e.target)&&(s.value=!1)};return(0,r.onMounted)(()=>{document.addEventListener("click",m)}),(0,r.onUnmounted)(()=>{document.removeEventListener("click",m)}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{class:(0,r.normalizeClass)(["custom-select",{"select-open":s.value}]),ref_key:"selectElement",ref:l},[(0,r.createElementVNode)("div",{class:"select-header",onClick:p,onBlur:u,tabindex:"0"},[(0,r.createElementVNode)("span",Ds,(0,r.toDisplayString)(d.value),1),(0,r.createElementVNode)("div",{class:(0,r.normalizeClass)(["select-arrow",{rotated:s.value}])},[...t[0]||(t[0]=[(0,r.createElementVNode)("svg",{width:"12",height:"8",viewBox:"0 0 12 8",fill:"none"},[(0,r.createElementVNode)("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],2)],32),(0,r.createVNode)(r.Transition,{name:"slide-fade",persisted:""},{default:(0,r.withCtx)(()=>[(0,r.withDirectives)((0,r.createElementVNode)("div",Ts,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(i.value,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:e.value,class:(0,r.normalizeClass)(["select-option",{selected:a.value===e.value}]),onClick:t=>(e=>{a.value=e.value,n("update:modelValue",e.value),s.value=!1})(e)},(0,r.toDisplayString)(e.label),11,Is))),128))],512),[[r.vShow,s.value]])]),_:1})],2))}},Ms=(0,B.A)(As,[["__scopeId","data-v-595fd5c3"]]),Os={class:"property-form"},js={class:"label"},Ps={class:"editor"},Ls={name:"PropertyForm",props:{model:{type:Object,required:!0},properties:{type:Array,required:!0}},methods:{updateValue(e,t){!function(e,t,o){const n=t.split("."),a=n.pop();let r=e;for(const e of n)e in r||(r[e]={}),r=r[e];r[a]=o}(this.model,e,t),this.$emit("update:"+e,t),this.$emit("update:model",e,t)},getValue(e){return t=this.model,e.split(".").reduce((e,t)=>e?e[t]:void 0,t);var t}}},Rs=(0,B.A)(Ls,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveDirective)("translate");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Os,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.properties,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t,class:"row"},[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",js,[(0,r.createTextVNode)((0,r.toDisplayString)(e.label||e.key),1)])),[[l,`inspector.${e.label||e.key}`]]),(0,r.createElementVNode)("div",Ps,[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.component),{modelValue:s.getValue(e.prop),"onUpdate:modelValue":t=>s.updateValue(e.prop,t)},null,8,["modelValue","onUpdate:modelValue"])),(0,r.createCommentVNode)(' <component v-if="prop.type === \'custom\'" :is="prop.component" v-model="model[prop.key]"\r\n                    @update:modelValue="updateValue(prop.key, $event)" />\r\n\r\n                <input v-else-if="prop.type === \'string\'" type="text" v-model="model[prop.key]"\r\n                    @input="updateValue(prop.key, $event.target.value)" />\r\n\r\n                <input v-else-if="prop.type === \'int\'" type="number" step="1" v-model.number="model[prop.key]"\r\n                    @input="updateValue(prop.key, parseInt($event.target.value))" />\r\n\r\n                <input v-else-if="prop.type === \'float\'" type="number" step="0.01" v-model.number="model[prop.key]"\r\n                    @input="updateValue(prop.key, parseFloat($event.target.value))" />\r\n\r\n                <select v-else-if="prop.type === \'select\'" v-model="model[prop.key]"\r\n                    @change="updateValue(prop.key, $event.target.value)">\r\n                    <option v-for="(opt, i) in prop.options" :key="i" :value="opt.value ?? opt">\r\n                        {{ opt.label ?? opt }}\r\n                    </option>\r\n                </select>\r\n\r\n                <input v-else-if="prop.type === \'checkbox\'" type="checkbox" v-model="model[prop.key]"\r\n                    @change="updateValue(prop.key, $event.target.checked)" />\r\n\r\n                <div v-else-if="prop.type === \'radio\'">\r\n                    <label v-for="(opt, i) in prop.options" :key="i">\r\n                        <input type="radio" :value="opt.value ?? opt" v-model="model[prop.key]"\r\n                            @change="updateValue(prop.key, $event.target.value)" />\r\n                        {{ opt.label ?? opt }}\r\n                    </label>\r\n                </div> ')])]))),128))])}],["__scopeId","data-v-59b50a68"]]),Fs={class:"labelField"},Us={name:"Label",props:{modelValue:{type:String},value:{type:Object}}},zs=(0,B.A)(Us,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveDirective)("tooltip");return(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",Fs,[(0,r.createTextVNode)((0,r.toDisplayString)(o.modelValue||""),1)])),[[l,o.modelValue]])}],["__scopeId","data-v-45c328bf"]]),Hs={style:{display:"flex","flex-direction":"column"}},qs={style:{display:"flex","flex-direction":"row","justify-content":"space-between"}},Gs={style:{display:"flex","flex-direction":"row","justify-content":"space-between"}},Ws={props:{modelValue:{type:Object,default:{cast:!1,receive:!1}}},computed:{cast:{get(){return!!this.modelValue&&this.modelValue.cast},set(e){this.$emit("update:modelValue",{...this.modelValue?this.modelValue:{},cast:e})}},receive:{get(){return!!this.modelValue&&this.modelValue.receive},set(e){this.$emit("update:modelValue",{...this.modelValue?this.modelValue:{},receive:e})}}}},Ks=(0,B.A)(Ws,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("BoolEdit"),i=(0,r.resolveDirective)("translate");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Hs,[(0,r.createElementVNode)("div",qs,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",null,[...t[2]||(t[2]=[(0,r.createTextVNode)("$$Cast:",-1)])])),[[i]]),(0,r.createVNode)(l,{modelValue:s.cast,"onUpdate:modelValue":t[0]||(t[0]=e=>s.cast=e),"update:modelValue":"cast=$event"},null,8,["modelValue"])]),(0,r.createElementVNode)("div",Gs,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",null,[...t[3]||(t[3]=[(0,r.createTextVNode)("$$Receive:",-1)])])),[[i]]),(0,r.createVNode)(l,{modelValue:s.receive,"onUpdate:modelValue":t[1]||(t[1]=e=>s.receive=e),"update:modelValue":"receive=$event"},null,8,["modelValue"])])])}]]),Ys={class:"dimension-control"},Js={class:"controls"},Xs={class:"control-group"},Zs={class:"control-row"},Qs={class:"control-group"},el={class:"control-row"},tl={name:"DimensionControl",props:{value:{type:Object,default:{}},target:{type:Object}},emits:["update:target"],setup(e,{emit:t}){const o=e=>{if("number"==typeof e)return{value:e,unit:"px"};if("auto"===e||"fit-content"===e||"min-content"===e||"max-content"===e)return{value:0,unit:e};const t=e.match(/^([\d.]+)(\D+)$/);return t?{value:parseFloat(t[1]),unit:t[2]}:{value:0,unit:"px"}},n=o(e.target.width||"100px"),a=(0,r.ref)(n.value),s=(0,r.ref)(n.unit),l=o(e.target.height||"100px"),i=(0,r.ref)(l.value),c=(0,r.ref)(l.unit),d=(e,t)=>["auto","fit-content","min-content","max-content","none"].includes(t)?t:`${e}${t}`;return(0,r.watch)([a,s],()=>{t("update:target","width",d(a.value,s.value))}),(0,r.watch)([i,c],()=>{t("update:target","height",d(i.value,c.value))}),(0,r.watch)(()=>e.target.width,e=>{const t=o(e||"100px");a.value=t.value,s.value=t.unit}),(0,r.watch)(()=>e.target.height,e=>{const t=o(e||"100px");i.value=t.value,c.value=t.unit}),{widthValue:a,widthUnit:s,heightValue:i,heightUnit:c}}},ol=(0,B.A)(tl,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",Ys,[(0,r.createElementVNode)("div",Js,[(0,r.createElementVNode)("div",Xs,[t[5]||(t[5]=(0,r.createElementVNode)("span",null,"Width",-1)),(0,r.createElementVNode)("div",Zs,[(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>n.widthUnit=e)},[...t[4]||(t[4]=[(0,r.createStaticVNode)('<option value="px" data-v-f12dc314>px</option><option value="%" data-v-f12dc314>%</option><option value="em" data-v-f12dc314>em</option><option value="rem" data-v-f12dc314>rem</option><option value="vh" data-v-f12dc314>vh</option><option value="vw" data-v-f12dc314>vw</option><option value="auto" data-v-f12dc314>auto</option><option value="fit-content" data-v-f12dc314>fit-content</option><option value="min-content" data-v-f12dc314>min-content</option><option value="max-content" data-v-f12dc314>max-content</option>',10)])],512),[[r.vModelSelect,n.widthUnit]]),["auto","fit-content","min-content","max-content"].includes(n.widthUnit)?(0,r.createCommentVNode)("v-if",!0):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("input",{key:0,"onUpdate:modelValue":t[1]||(t[1]=e=>n.widthValue=e),type:"number",min:"0"},null,512)),[[r.vModelText,n.widthValue,void 0,{number:!0}]])])]),(0,r.createElementVNode)("div",Qs,[t[7]||(t[7]=(0,r.createElementVNode)("span",null,"Height",-1)),(0,r.createElementVNode)("div",el,[(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>n.heightUnit=e)},[...t[6]||(t[6]=[(0,r.createStaticVNode)('<option value="px" data-v-f12dc314>px</option><option value="%" data-v-f12dc314>%</option><option value="em" data-v-f12dc314>em</option><option value="rem" data-v-f12dc314>rem</option><option value="vh" data-v-f12dc314>vh</option><option value="vw" data-v-f12dc314>vw</option><option value="auto" data-v-f12dc314>auto</option><option value="fit-content" data-v-f12dc314>fit-content</option><option value="min-content" data-v-f12dc314>min-content</option><option value="max-content" data-v-f12dc314>max-content</option>',10)])],512),[[r.vModelSelect,n.heightUnit]]),["auto","fit-content","min-content","max-content"].includes(n.heightUnit)?(0,r.createCommentVNode)("v-if",!0):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("input",{key:0,"onUpdate:modelValue":t[3]||(t[3]=e=>n.heightValue=e),type:"number",min:"0"},null,512)),[[r.vModelText,n.heightValue,void 0,{number:!0}]])])])])])}],["__scopeId","data-v-f12dc314"]]),nl={class:"text-color-editor"},al={name:"TextColorEditor",props:{modelValue:{type:String}},data:()=>({defaultColor:"#000000"}),computed:{textColor:{get(){return this.modelValue||"#000000"},set(e){this.$emit("update:modelValue",e)}}},emits:["update:modelValue"]},rl=(0,B.A)(al,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",nl,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"color",id:"colorPicker","onUpdate:modelValue":t[0]||(t[0]=e=>s.textColor=e)},null,512),[[r.vModelText,s.textColor]])])}],["__scopeId","data-v-73332108"]]),sl={class:"font-size-editor"},ll={class:"controls"},il={class:"size-control"},cl=["value"],dl={name:"FontSizeEditor",data:()=>({fontSizeValue:16,fontSizeUnit:"px",defaultSize:"16px",availableUnits:["px","em","rem","pt","pc","in","cm","mm","ex","ch","vw","vh","vmin","vmax","%"],sizePresets:[{label:"Маленький (12px)",value:"12px"},{label:"Средний (16px)",value:"16px"},{label:"Большой (24px)",value:"24px"},{label:"Заголовок (32px)",value:"32px"}]}),computed:{currentFontSize(){return`${this.fontSizeValue}${this.fontSizeUnit}`}},methods:{updateFontSize(){this.$emit("update:modelValue",this.currentFontSize)},resetSize(){const e=this.defaultSize.match(/(\d+\.?\d*)(\D+)/);e?(this.fontSizeValue=parseFloat(e[1]),this.fontSizeUnit=e[2]):(this.fontSizeValue=16,this.fontSizeUnit="px"),this.updateFontSize()},applyPreset(e){const t=e.match(/(\d+\.?\d*)(\D+)/);t&&(this.fontSizeValue=parseFloat(t[1]),this.fontSizeUnit=t[2],this.updateFontSize())},parseSize(e){const t=e.match(/(\d+\.?\d*)(\D+)/);return t?{value:parseFloat(t[1]),unit:t[2]}:null},init(){const e=this.parseSize(this.modelValue);e&&(this.fontSizeValue=e.value,this.fontSizeUnit=e.unit,this.defaultSize=this.modelValue)}},emits:["update:modelValue"],props:{modelValue:{type:String,default:"16px",validator:e=>/^\d*\.?\d+(px|em|rem|pt|pc|in|cm|mm|ex|ch|vw|vh|vmin|vmax|%)$/.test(e)}},watch:{modelValue(){this.init()}},created(){this.init()}},pl=(0,B.A)(dl,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",sl,[(0,r.createElementVNode)("div",ll,[(0,r.createElementVNode)("div",il,[(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"number",id:"fontSizeValue","onUpdate:modelValue":t[0]||(t[0]=e=>a.fontSizeValue=e),min:"0",step:"0.1",onInput:t[1]||(t[1]=(...e)=>s.updateFontSize&&s.updateFontSize(...e))},null,544),[[r.vModelText,a.fontSizeValue,void 0,{number:!0}]]),(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>a.fontSizeUnit=e),onChange:t[3]||(t[3]=(...e)=>s.updateFontSize&&s.updateFontSize(...e))},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(a.availableUnits,e=>((0,r.openBlock)(),(0,r.createElementBlock)("option",{value:e,key:e},(0,r.toDisplayString)(e),9,cl))),128))],544),[[r.vModelSelect,a.fontSizeUnit]])])])])}],["__scopeId","data-v-f859e98c"]]),ul={class:"container"},ml={class:"list-container"},hl={class:"list-head"},fl={class:"list-slider"},vl={key:0},gl={key:1,class:"grid"},yl=["onClick"],bl={class:"grid-item"},kl={class:"textwrap tcenter w100"},wl={class:"textwrap w100"},El={style:{display:"flex","justify-content":"center"}},_l={key:0,class:"extension"},Sl={class:"form-block"},Nl={class:"form-row"},Vl={name:"LibForm",props:{modelValue:{type:Object},rows:{type:Array}},computed:{val(){return this.modelValue}}},Cl=(0,B.A)(Vl,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",Sl,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.rows,e=>((0,r.openBlock)(),(0,r.createElementBlock)("div",Nl,[(0,r.createElementVNode)("div",null,(0,r.toDisplayString)(e.label),1),((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.component),(0,r.mergeProps)({class:"form-component"},{ref_for:!0},e.props,{value:s.val,modelValue:s.val[e.prop],"onUpdate:modelValue":t=>s.val[e.prop]=t}),null,16,["value","modelValue","onUpdate:modelValue"]))]))),256))])}]]),Bl={name:"ItemsLib",props:{selected:{type:Object},selectedIndex:{type:Number},rows:{type:Array},list:{type:Array},head:{type:Object,default:{}},styles:{type:Object,default:{item:{width:"72px",height:"72px"}}},icons:{type:Object,default:{}},options:{type:Object,default:{id:"uid",name:"name",icon:"icon",icontip:"tooltip"}},busy:{type:Boolean,default:!1}},computed:{target(){return this.selected}},mounted(){this.$emit("open")},components:{LibForm:Cl}},$l=(0,B.A)(Bl,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("Spinner"),i=(0,r.resolveComponent)("icon"),c=(0,r.resolveComponent)("LibForm"),d=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",ul,[(0,r.createElementVNode)("div",ml,[(0,r.createElementVNode)("div",hl,[(0,r.renderSlot)(e.$slots,"head",(0,r.normalizeProps)((0,r.guardReactiveProps)(o.head)),()=>[(0,r.createElementVNode)("div",null,(0,r.toDisplayString)(o.head.title),1)],!0)]),(0,r.createElementVNode)("div",fl,[o.busy?((0,r.openBlock)(),(0,r.createElementBlock)("div",vl,[(0,r.createVNode)(l)])):((0,r.openBlock)(),(0,r.createElementBlock)("div",gl,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.list,(t,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{onClick:o=>e.$emit("selected",t,n),class:(0,r.normalizeClass)([{selected:o.selected===t||o.selectedIndex===n},"grid-element"])},[(0,r.renderSlot)(e.$slots,"item",{item:t},()=>[(0,r.createElementVNode)("div",bl,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",kl,[(0,r.createTextVNode)((0,r.toDisplayString)(t[o.options.name]||t[o.options.id]),1)])),[[d,t[o.options.name]||t[o.options.id]]]),(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",wl,[(0,r.createTextVNode)((0,r.toDisplayString)(t.url),1)])),[[d,t.url]]),(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",El,[(0,r.createVNode)(i,{value:o.icons[t.type],size:"2em"},null,8,["value"])])),[[d,t[o.options.icontip]]])])],!0)],10,yl))),256))]))])]),o.selected?((0,r.openBlock)(),(0,r.createElementBlock)("div",_l,[(0,r.renderSlot)(e.$slots,"edit",{selected:o.selected,rows:o.rows},()=>[(0,r.createVNode)(c,{modelValue:s.target,"onUpdate:modelValue":t[0]||(t[0]=e=>s.target=e),rows:o.rows},null,8,["modelValue","rows"])],!0)])):(0,r.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-4b86ff9e"]]),xl={class:"pitem"},Dl={class:"textwrap w100 tcenter"},Tl={style:{display:"flex","justify-content":"center"},class:"tcenter"},Il={props:{item:{type:Object}},computed:{date(){return new Date(this.item.created).toLocaleString()}}},Al=(0,B.A)(Il,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",xl,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",Dl,[(0,r.createTextVNode)((0,r.toDisplayString)(o.item.name),1)])),[[l,o.item.name]]),(0,r.createElementVNode)("div",Tl,(0,r.toDisplayString)(s.date),1)])}],["__scopeId","data-v-a84bc2fe"]]),Ml={class:"container"},Ol={class:"block"},jl={class:"label"},Pl={class:"value"},Ll={data:()=>({result:""}),props:{text:{type:String}},emits:["update:text"]},Rl=(0,B.A)(Ll,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveDirective)("translate");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Ml,[(0,r.createElementVNode)("div",Ol,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",jl,[(0,r.createTextVNode)(" $$"+(0,r.toDisplayString)(o.text),1)])),[[l]]),(0,r.createElementVNode)("div",Pl,[(0,r.withDirectives)((0,r.createElementVNode)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>a.result=e),onInput:t[1]||(t[1]=t=>e.$emit("update:text",a.result))},null,544),[[r.vModelText,a.result]])])])])}],["__scopeId","data-v-3bf1bb00"]]),Fl={class:"container"},Ul={class:"block"},zl={class:"label"},Hl={data:()=>({result:""}),props:{text:{type:String}}},ql=(0,B.A)(Hl,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",Fl,[(0,r.createElementVNode)("div",Ul,[(0,r.createElementVNode)("div",zl,(0,r.toDisplayString)(o.text),1)])])}],["__scopeId","data-v-11e695e2"]]),Gl={class:"form-group"},Wl=["disabled"],Kl={key:0,class:"form-group"},Yl=["disabled"],Jl={key:1,class:"form-group"},Xl=["disabled"],Zl={key:2,class:"form-group"},Ql=["disabled"],ei=["disabled"],ti={class:"form-actions"},oi=["disabled"],ni=["disabled"],ai={key:3,class:"helper-actions"},ri={key:4,class:"info-message"},si={key:5,class:"error-message"},li={__name:"auth",emits:["success"],setup(e,{emit:t}){const o=wo.default.default||wo.default,n=t,a=(0,r.ref)("login"),s=(0,r.ref)(!1),l=(0,r.ref)(""),i=(0,r.ref)(""),c=(0,r.reactive)({email:"",password:"",code:"",newPassword:"",confirmPassword:""}),d=(0,r.computed)(()=>{switch(a.value){case"login":return"Login";case"recover":return"Отправить код";case"verify":return"Подтвердить код";case"reset":return"Установить пароль"}}),p=(0,r.computed)(()=>"login"===a.value?"Cancel":"Назад"),u=(0,r.computed)(()=>{switch(a.value){case"login":return"Вход...";case"recover":return"Отправка...";case"verify":return"Проверка...";case"reset":return"Сохранение..."}});function m(){f(),a.value="recover",c.password="",c.code="",c.newPassword="",c.confirmPassword=""}function h(){f(),"login"===a.value?(c.email="",c.password=""):(a.value="login",c.code="",c.newPassword="",c.confirmPassword="")}function f(){l.value="",i.value=""}async function v(){if(f(),c.email)try{if(s.value=!0,"login"===a.value){const e=await fetch("/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:c.email,password:c.password})});if(!e.ok)throw await g(e);const t=await e.json();n("success",t)}else if("recover"===a.value){const e=await fetch("/auth/recovery",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:c.email})});if(!e.ok)throw await g(e);i.value="Код отправлен на указанный email",a.value="verify"}else if("verify"===a.value){if(!c.code)return void(l.value="Код обязателен");const e=await fetch("/auth/check",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:c.email,code:c.code})});if(!e.ok)throw await g(e);i.value="Код подтверждён. Введите новый пароль.",a.value="reset"}else if("reset"===a.value){if(!c.newPassword||!c.confirmPassword)return void(l.value="Заполните оба поля пароля");if(c.newPassword!==c.confirmPassword)return void(l.value="Пароли не совпадают");console.log(c.newPassword),await o.app.setPassword(c.newPassword),i.value="Пароль изменён.",a.value="login",c.password="",c.newPassword="",c.confirmPassword="",c.code=""}}catch(e){l.value="string"==typeof e?e:e?.message||"Ошибка сервера"}finally{s.value=!1}else l.value="Email обязателен"}async function g(e){try{const t=await e.json();return t?.message||t?.error||`HTTP ${e.status}`}catch{return`HTTP ${e.status}`}}return(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("form",{onSubmit:(0,r.withModifiers)(v,["prevent"]),class:"login-form"},[(0,r.createElementVNode)("div",Gl,[t[5]||(t[5]=(0,r.createElementVNode)("label",{for:"email"},"Email:",-1)),(0,r.withDirectives)((0,r.createElementVNode)("input",{id:"email",type:"email","onUpdate:modelValue":t[0]||(t[0]=e=>c.email=e),required:"",placeholder:"Введите email",disabled:s.value},null,8,Wl),[[r.vModelText,c.email]])]),(0,r.createCommentVNode)(" LOGIN: email + password "),"login"===a.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Kl,[t[6]||(t[6]=(0,r.createElementVNode)("label",{for:"password"},"Пароль:",-1)),(0,r.withDirectives)((0,r.createElementVNode)("input",{id:"password",type:"password","onUpdate:modelValue":t[1]||(t[1]=e=>c.password=e),required:"",placeholder:"Введите пароль",disabled:s.value},null,8,Yl),[[r.vModelText,c.password]])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" VERIFY CODE "),"verify"===a.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Jl,[t[7]||(t[7]=(0,r.createElementVNode)("label",{for:"code"},"Код из письма:",-1)),(0,r.withDirectives)((0,r.createElementVNode)("input",{id:"code",type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>c.code=e),required:"",placeholder:"Введите код",disabled:s.value},null,8,Xl),[[r.vModelText,c.code]])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" RESET PASSWORD "),"reset"===a.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",Zl,[t[8]||(t[8]=(0,r.createElementVNode)("label",{for:"newPassword"},"Новый пароль:",-1)),(0,r.withDirectives)((0,r.createElementVNode)("input",{id:"newPassword",type:"password","onUpdate:modelValue":t[3]||(t[3]=e=>c.newPassword=e),required:"",placeholder:"Введите новый пароль",disabled:s.value},null,8,Ql),[[r.vModelText,c.newPassword]]),t[9]||(t[9]=(0,r.createElementVNode)("label",{for:"confirmPassword",style:{"margin-top":"8px"}},"Повтор пароля:",-1)),(0,r.withDirectives)((0,r.createElementVNode)("input",{id:"confirmPassword",type:"password","onUpdate:modelValue":t[4]||(t[4]=e=>c.confirmPassword=e),required:"",placeholder:"Повторите пароль",disabled:s.value},null,8,ei),[[r.vModelText,c.confirmPassword]])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",ti,[(0,r.createElementVNode)("button",{type:"submit",disabled:s.value},(0,r.toDisplayString)(s.value?u.value:d.value),9,oi),(0,r.createCommentVNode)(" Cancel / Back "),(0,r.createElementVNode)("button",{type:"button",onClick:h,disabled:s.value},(0,r.toDisplayString)(p.value),9,ni)]),"login"===a.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",ai,[(0,r.createElementVNode)("a",{href:"#",onClick:(0,r.withModifiers)(m,["prevent"])},"Забыли пароль?")])):(0,r.createCommentVNode)("v-if",!0),i.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",ri,(0,r.toDisplayString)(i.value),1)):(0,r.createCommentVNode)("v-if",!0),l.value?((0,r.openBlock)(),(0,r.createElementBlock)("div",si,(0,r.toDisplayString)(l.value),1)):(0,r.createCommentVNode)("v-if",!0)],32))}},ii=(0,B.A)(li,[["__scopeId","data-v-867ec93e"]]),ci={props:{text:{type:Object,default:{value:"TEXT",size:"1em"}},path:{type:String},visible:{type:Boolean},styles:{type:Object}},mounted(){this.$emit("mounted",{path:this.path,element:this.$refs.container})}},di=(0,B.A)(ci,[["render",function(e,t,o,n,a,s){return(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",{ref:"container",class:"cardroot",style:(0,r.normalizeStyle)({fontSize:o.text.size,...o.styles})},(0,r.toDisplayString)(o.text.value),5)),[[r.vShow,o.visible]])}],["__scopeId","data-v-4de6bc04"]]);var pi=o(828);const ui={class:"toastcontainer"},mi={class:"alert"},hi={class:"text"},fi={class:"buttons"},vi=["onClick"],gi={name:"QueryToast",props:{icon:{type:String,default:"notification"},message:{type:String,default:""},type:{type:String,default:"info"},buttons:{type:Array}}},yi=(0,B.A)(gi,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon");return(0,r.openBlock)(),(0,r.createElementBlock)("div",ui,[(0,r.createElementVNode)("div",mi,[(0,r.createVNode)(l,{class:(0,r.normalizeClass)(`${o.type}icon`),size:"3em",value:o.icon},null,8,["class","value"]),(0,r.createElementVNode)("span",hi,(0,r.toDisplayString)(o.message),1)]),(0,r.createElementVNode)("div",fi,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.buttons,e=>((0,r.openBlock)(),(0,r.createElementBlock)("button",{onClick:e.handler,class:"btn"},(0,r.toDisplayString)(e.label),9,vi))),256))])])}]]),bi=wo.default.default||wo.default;let ki=0;const wi=(0,r.reactive)({list:[],add({message:e,icon:t,onclick:o,timehide:n=!0,type:a,...s},l=(0,r.markRaw)(Kn)){const i=(0,r.reactive)({id:ki++,data:{message:e,icon:t,type:a,...s},component:l});return n&&(i.timeout=setTimeout(()=>{wi.remove(i.id)},3e3)),i.onclick=o||wi.remove.bind(this,i.id),wi.list.push(i),i},remove(e){for(let t=wi.list.length-1;t>=0;t--)wi.list[t].id===e&&wi.list.splice(t,1)}});bi.On("init",()=>{window.vue.component("QueryToast",yi)});const Ei=wi,_i=(0,r.ref)(!1),Si=(0,r.reactive)({isVisible:!1,header:null,content:null,footer:null,values:null,open({header:e,content:t,footer:o,...n}){Si.header=e||{},Si.content=t||{},Si.footer=o||{},Si.values={closable:!1,...n},_i.value=!0},close(e){e||(_i.value=!1)},get isVisible(){return _i.value},queryText(e,t,o){Si.open({header:{value:e.title,handler:Si.close},content:{component:"queryform",props:e,events:{"update:text":o}},footer:{buttons:[...t.map(t=>(t.handler=()=>{t.callback(e.answer),Si.close()},t)),{label:"Close",class:"additional",handler:Si.close}]}})},confirmReq(e,t){Si.open({header:{value:e.title,handler:Si.close},content:{component:"confirmform",props:e},footer:{buttons:[...t.map(t=>(t.handler=()=>{t.callback(e.answer),Si.close()},t))]}})}}),Ni=Si,Vi=wo.default.default||wo.default;class Ci extends Error{constructor(){super("Not all required parameters are specified."),this.isReqError=!0}}class Bi extends Error{constructor(){super("This module has already been added."),this.isExistError=!0}}const $i=[{name:"engine",entry:"/editor/engine/mf.js",index:"engine",system:!0},{name:"tools",entry:"/mods/tools/mf.js",index:"tools",system:!0}],xi=[],Di={};function Ti(e){return new Promise(t=>{(0,pi.loadRemote)(`${e.name}/${e.index}`).then(async o=>{console.log(e.name),xi.push({name:e.name,index:e.index,entry:e.entry,title:e.title||e.name,id:e.id,uid:e.uid,global:e.global,description:e.description}),Di[e.name]=o,o.Init&&await o.Init(),t()})})}async function Ii(e){if(e.uid=`${e.index}:${e.entry}`,!e.name?.length||!e.index?.length||!e.entry?.length)throw new Ci;if(xi.find(t=>t.uid===e.uid))throw new Bi;try{(0,pi.registerRemotes)([{...e}],{force:!0}),await Ti(e)}catch(e){throw e}return await async function(e){const t={id:e.entry,...e};return await ln.upsertItemProperties("modules",t.uid,t),t}(e)}function Ai(){const e=(0,r.reactive)({selected:null,list:xi,processed:!1,styles:{item:{width:"128px",height:"128px"}},title:"Project modules"}),t={label:"Add",class:"secondary",hidden:(0,r.computed)(()=>!e.selected||e.selected.uid||e.processed),handler:async()=>{e.processed=!0;try{console.log("try"),e.selected=await Ii(e.selected),console.log("try OK")}catch(t){return console.log(t.message),t.isReqError?Ei.add({message:"Not all required fields are filled in"}):Ei.add({message:"Error adding module"}),e.processed=!1,void(e.selected.uid=null)}Ei.add({message:"The module has been loaded successfully."})}},o={label:"Registration",class:"secondary",hidden:(0,r.computed)(()=>e.selected&&!e.selected.uid),handler:()=>{e.selected=(0,r.reactive)({name:"",entry:"",index:""})}},n={label:"Report",class:"primary",hidden:(0,r.computed)(()=>!e.selected||!e.selected.uid),handler:()=>{e.selected=null}},a={label:"Remove",class:"additional",hidden:(0,r.computed)(()=>!e.selected?.id),handler:async()=>{const t=`${e.selected.index}:${e.selected.entry}`,o=xi.findIndex(e=>`${e.index}:${e.entry}`===t);if(o>=0){const t=Di[e.selected.name];if(t.Remove&&!await t.Remove())return;const n=xi.splice(o,1);console.log(n),ln.deleteItem("modules",n[0].uid),Vi.toasts.add({message:"The module has been removed and will not be loaded the next time you use it.\nPlease refresh the page to take effect."}),e.selected=null}}},s={label:"Close",class:"primary",handler:async()=>{Ni.close()}},l=(0,r.reactive)([o,a,t,n,s]);Ni.open({header:{value:"Managing modules",handler:()=>{Ni.close()}},content:{component:"ItemsLib",props:e,events:{selected:t=>{e.selected=t,console.log(e.selected)}},slots:{item:{component:"ModuleItem"},edit:{component:"ModuleEdit",props:e,events:{edit:(t,o)=>{e.selected[t]=o}}}}},footer:{buttons:l}})}async function Mi(){const e=(0,r.reactive)({selected:null,list:[],processed:!1,canadd:!1,styles:{item:{width:"128px",height:"128px"}},head:{title:""}}),t={label:"Add to project",class:"secondary",hidden:(0,r.computed)(()=>e.processed||!e.selected||!e.canadd),handler:async()=>{e.processed=!0;try{await Ii({...e.selected})}catch(t){return t.isExistError?Ei.add({message:t.message}):Ei.add({message:"Error adding module"}),void(e.processed=!1)}e.canadd=-1===xi.findIndex(t=>t.uid===e.selected.uid),Ei.add({message:"The module has been added to project."}),e.processed=!1}},o={label:"Close",class:"primary",handler:async()=>{Ni.close()}},n=(0,r.reactive)([t,o]),a=async(t="")=>{const o=await fetch("https://s3.eu-west-1.amazonaws.com/3dbuilder.reneos.com/mods/modules.json"),n=await o.json();e.list=n.filter(e=>e.name.includes(t)||e.description.includes(t))};Ni.open({header:{value:"Global modules",handler:()=>{Ni.close()}},content:{component:"ItemsLib",props:e,events:{selected:t=>{e.selected=t,e.canadd=-1===xi.findIndex(t=>t.uid===e.selected.uid),console.log(e.selected,e.canadd)}},slots:{head:{component:"SearchFilter",events:{search(t){e.selected=null,e.canadd=!e.selected||-1===xi.findIndex(t=>t.uid===e.selected.uid),a(t)},entry(t){t||(e.selected=null,e.canadd=!e.selected||-1===xi.findIndex(t=>t.uid===e.selected.uid),a())}}},item:{component:"ModuleItem"},edit:{component:"ModuleView",props:e}}},footer:{buttons:n}}),a()}const Oi=(0,r.reactive)({init:async function(){(0,pi.createInstance)({name:"slider.editor",remotes:[]}),xi.length=0,await(0,pi.registerRemotes)([...$i]),await Promise.all($i.map(e=>new Promise(t=>{(0,pi.loadRemote)(`${e.name}/${e.index}`).then(o=>{Di[e.name]=o,t()})})))},showLib:Ai,getMod:function(e){return Di[e]},loadUserModules:async function(e){console.log(e),await(0,pi.registerRemotes)(e),await Promise.all(e.map(e=>Ti(e)))},AddModules:async function(e){for(let t=0;t<e.length;t++){const o=e[t];try{await Ii(o)}catch(e){continue}}}});Vi.On("init",()=>{Vi.menu.add([{path:"hierarhy.modules",icon:"plug",tooltip:"Modules",handler:Ai}]),window.vue.component("ModuleEdit",(0,r.defineAsyncComponent)(async()=>{const e=await o.e(689).then(o.bind(o,689));return e.default||e})),window.vue.component("ModuleItem",(0,r.defineAsyncComponent)(async()=>{const e=await o.e(920).then(o.bind(o,920));return e.default||e})),window.vue.component("ModuleView",(0,r.defineAsyncComponent)(async()=>{const e=await o.e(833).then(o.bind(o,833));return e.default||e})),Vi.menu.add([{path:"app.libraries.modules",icon:"plug",text:"Modules",handler:Mi}])});const ji=Oi,Pi=class{constructor(){this._events={"*":[]}}subs(e,t,o){null==this._events[e]&&(this._events[e]=[]),this._events[e].push({handler:o,once:t})}on(e,t){this.subs(e,!1,t)}once(e,t){this.subs(e,!0,t)}off(e,t){const o=this._events[e];if(o){for(let e=o.length-1;e>=0;e--)o[e].handler===t&&o.splice(e,1);0===o.length&&delete this._events[e]}}clear(e){this._events[e]=[]}clearAll(){this._events={"*":[]}}emit(e,...t){const o=[];this._events[e]&&o.push(...this._events[e]),this._events["*"].length&&o.push(...this._events["*"].map(t=>({handler:t.handler.bind(this,e),once:t.once})));for(let e=o.length-1;e>=0;e--){const n=o[e];n.handler.apply(null,t),n.once&&o.splice(e,1)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}},Li=wo.default.default||wo.default,{translateText:Ri}=It,Fi=new Pi;let Ui;async function zi(e,t,o){if(!t)return;if(o[t.uid])return o[t.uid];const n=t.parent;let a=o[n];a||(a=await zi(e,e.find(e=>e.uid===n),o));const r=await Hi(t,a);return o[r.uid]=r,r}async function Hi(e,t){const o=await Ui.BuildElement(e,t||Li.engine.getManager().Root);if(!o)return;const n=(0,r.reactive)(o);return(t||Ki).add(n),Fi.emit("create",n),o.visible=!1,n}async function qi(e){console.log(e);try{const t=Ui.exportToJSON(e),o=JSON.parse(Jt({name:e.name,paths:e.paths,path:e.paths.join("."),parent:e.parent?.uid||null,actions:e.actions||[],states:e.states,type:e.type,uid:e.uid,...t}));await ln.upsertItemProperties("models",e.uid,o)}catch(e){console.warn(e)}}function Gi(e){let t=Ki;for(let o=0;o<e.length;o++)t=t.children.find(t=>t.uid===e[o]);return t}function Wi(e,t,o=[]){for(let n=0;n<e.length;n++){const a=e[n];a.isElement&&a.states[t]&&o.push(a),a.children?a.children.length&&Wi(a.children,t,o):console.warn("No child")}}const Ki=(0,r.reactive)({add(e){Ki.children.push(e)},load:async function(e){Ui=Li.engine.getFactory();const t={};for(let o=e.length-1;o>=0;o--){const n=e[o],a=await zi(e,n,t),r=e.findIndex(e=>e.uid===a.uid);r>=0&&e.splice(r,1)}},createElement:Hi,save:qi,remove:async function e(t){let o=Ki,n=Ki;for(let e=0;e<t.length;e++)o=n,n=o.children.find(o=>o.uid===t[e]);Li.selection.selected===n&&Li.selection.select(null);const a=o.children.findIndex(e=>e===n);if(a>=0){for(let t=0;t<n.children.length;t++){const o=n.children[t];o.isElement&&e(o.paths)}o.children.splice(a,1),n.parent&&n.parent.remove(n),ln.deleteItem("models",n.uid),Ui.RemoveInstance(n.uid),Fi.emit("remove",t,n)}},createFromAsset:async function(e,t){if(console.log("createFromAsset",e),!Li.slides.actived)return void Li.toasts.add({message:"You need to create a slide first",key:"slideNeed"});let o;o=t?Gi(t):Li.selection.selected?.isElement?Gi(Li.selection.selected.paths):null;const n={name:Xt(e.name||"asset",Array.from(Ui.instances.values().map(e=>e.name))),...e.toModel()},a=await Hi(n,o);Li.assets.useAsset(e.uid,a.uid),qi(a)},createTo:function(e){console.log("createTo",e);const t={uid:`Element${Date.now()}`,name:"Element",type:"Group",paths:[],path:""};e&&e.isElement&&t.paths.push(...e.paths),t.paths.push(t.uid),t.path=t.paths.join(".");const o={parent:e,modelValue:t,list:Li.app.types.filter(e=>e.isModel).sort((e,t)=>e.label.localeCompare(t.label))};Li.modal.open({header:{value:Ri("addelement.header",{"#suffix":e?Ri("addelement.header.v1",{"#parentname":e.name||e.uid}):Ri("addelement.header.v2")}),handler:()=>{Li.modal.close()}},content:{component:"ElementAdd",props:o,events:{"update:modelValue":e=>{Object.keys(e).forEach(o=>{t[o]=e[o]})}}},footer:{buttons:[{label:"Add",class:"secondary",handler:async()=>{const o=Li.engine.getFactory().getTypeConfig(t.type);o.template&&Object.keys(o.template).forEach(e=>{t[e]=o.template[e]});try{const o=await Hi(t,e);o&&await qi(o)}catch(e){console.warn(e),Li.toasts.add({message:`Error on create ${t.type}`})}Li.modal.close()}},{label:"Cancel",class:"primary",handler:async()=>{Li.modal.close()}}]}})},find:Gi,getState:function(e,t){return e.states[t]||(e.states[t]={actions:[]},Fi.emit("stateadd",t,e.paths)),e.states[t]},findStates:function(e){const t=[];return Wi(Ki.children,e,t),t},findObjectsByType:function(e){const t=[];return function o(n){n instanceof e&&t.push({type:n.type,name:n.name,path:n.path}),n.children&&Array.isArray(n.children)&&n.children.forEach(e=>o(e))}(Ki),t},children:[],uid:null,data:{},on:Fi.on.bind(Fi),off:Fi.off.bind(Fi)});Li.On("init",()=>{Li.slides.on("change",e=>{Wi(Ki.children,e,[])}),Li.slides.on("remove",e=>{const t=[];Wi(Ki.children,e,t);for(let o=0;o<t.length;o++)delete t[o].states[e]})});const Yi=Ki,Ji={class:"slide-tools"},Xi={key:0},Zi=["value"],Qi={key:1},ec={name:"CameraSelector",props:{modelValue:{type:String}},computed:{selectedCamera:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},cameras(){return this.$app.models.findObjectsByType(we.Camera)||[]}}},tc=(0,B.A)(ec,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveDirective)("translate");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Ji,[s.cameras.length>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",Xi,[(0,r.withDirectives)((0,r.createElementVNode)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.selectedCamera=e)},[t[1]||(t[1]=(0,r.createElementVNode)("option",{value:null},"No",-1)),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.cameras,e=>((0,r.openBlock)(),(0,r.createElementBlock)("option",{key:e.path,value:e.path}," ("+(0,r.toDisplayString)(e.type)+") "+(0,r.toDisplayString)(e.name||`Camera ${e.uid}`),9,Zi))),128))],512),[[r.vModelSelect,s.selectedCamera]])])):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",Qi,[...t[2]||(t[2]=[(0,r.createTextVNode)(" There are no cameras available in the project. ",-1)])])),[[l,"No cam in project"]])])}]]),oc=wo.default.default||wo.default,nc=new Pi;async function ac(e){const t=e||ic.actived,o={actions:t.actions,name:t.name,index:t.index,camera:t.camera,uid:t.uid,props:t.props,background:t.background,environment:t.environment},n=JSON.parse(Jt(o));try{await ln.upsertItemProperties("slides",o.uid,n)}catch(e){console.warn(e)}}function rc(e){const t=ic.actived;ic.actived="number"==typeof e?ic.children[e]:ic.children.find(t=>t.uid===e),ic.actived&&(nc.emit("change",ic.actived.uid),async function(e,t){let o=[],n=Yi.findStates(e.uid);t&&(o=Yi.findStates(t.uid),await async function(e,t,o){const n=[],a=[];for(let e=0;e<t.length;e++){const r=t[e];o.findIndex(e=>e.uid===r.uid)>=0?n.push(r):a.push(r)}const r=[...a,...n];await Promise.all([oc.engine.ActionsManager.Execute(r,"slide.out",ud.force),oc.engine.ActionsManager.Run(e.actions,e,"slide.out",ud.force)]),await oc.engine.ActionsManager.Execute(a,"disable.on",ud.force);for(let e=0;e<a.length;e++)lc(a[e])}(t,o,n)),await async function(e,t,o){const n=[],a=[];for(let e=0;e<t.length;e++){const r=t[e];o.findIndex(e=>e.uid===r.uid)>=0?a.push(r):n.push(r)}console.log("Slide In");try{if(e.camera?.path&&e.camera?.path!==oc.engine.getManager().Camera?.path){const t=e.camera.path.split("."),o=Yi.find(t);o&&(oc.engine.getManager().SetCamera(o),o.updateProjectionMatrix())}console.log(e.background),e.background&&(e.background.isAsset?oc.engine.getManager().Scene.background=e.background.resource:oc.engine.getManager().Scene.background=e.background)}catch(e){console.warn(e)}const r=[...n,...a],s=r.map(t=>({...t.states[e.uid],model:t}));await Promise.all([oc.engine.ActionsManager.Execute(s,"slide.in.before",ud.force),oc.engine.ActionsManager.Run(e.actions,e,"slide.in.before",ud.force)]),await oc.engine.ActionsManager.Execute(n,"enable.on",ud.force),await Promise.all([oc.engine.ActionsManager.Execute(s,"slide.in",ud.force),oc.engine.ActionsManager.Run(e.actions,e,"slide.in",ud.force)]);const l=[];for(let t=0;t<r.length;t++)l.push(sc(r[t],e.uid));await Promise.all(l),await Promise.all([oc.engine.ActionsManager.Execute(s,"slide.in.after",ud.force),oc.engine.ActionsManager.Run(e.actions,e,"slide.in.after",ud.force)])}(e,n,o)}(ic.actived,t))}async function sc(e,t){const{position:o,rotation:n,scale:a,actions:r=[],visible:s=!1,...l}=e.states[t];o&&e.position.copy(o),n&&e.rotation.setFromVector3(n,"XYZ"),a&&e.scale.copy(a);const i=Object.keys(l).map(async t=>{const o=t.split("."),n=l[t];let a=o[0],r=e;try{for(let e=0;e<o.length-1;e++)r=r[o[e]],a=o[e+1];return r[a]=await oc.engine.getFactory().CreateValue(n),{success:!0,key:t}}catch(e){return console.warn(e),{success:!1,key:t,error:e}}});await Promise.all(i),e.visible=s,e.state=e.states[t]||{model:e}}function lc(e,t){e.visible=!1}const ic=(0,r.reactive)({load:async function(e){ic.children.length=0;const t=e.sort((e,t)=>e.index-t.index);for(let e=0;e<t.length;e++){const o={name:"",camera:{path:null},actions:[],index:e,props:{},background:null,environment:{},...t[e]};ic.children.push(o)}Yi.on("remove",e=>{const t=e.join(".");oc.engine.manager.Camera?.path===t&&oc.engine.manager.ResetCamera();for(let e=0;e<ic.children.length;e++){const o=ic.children[e];o.camera?.path===t&&(o.camera.path=null,ac(o))}})},add:async function(e){const t=`sl${Date.now()}`,o={index:ic.children.length,name:t,uid:t,background:null,environment:{},camera:{path:null},props:{},actions:[],...e};return ic.children.push(o),await ac(o),nc.emit("add",o.uid),o},remove:async function(e){console.log("remove");let t=e||ic.actived.uid;const o=ic.children.findIndex(e=>e.uid===t);if(o>=0){ic.actived.uid===t&&(0===o?await rc(1):await rc(o-1)),ic.children.splice(o,1),await ln.deleteItem("slides",t);const e=ic.children.find(e=>e.next===t);e&&ic.children.length>=o&&(e.next=ic.children[o].uid),nc.emit("remove",t)}},save:ac,actived:null,children:[],GoToNext(){ic.next()},goto:rc,next(){const e=ic.children.findIndex(e=>e.uid===ic.actived.uid);e>=ic.children.length-1||ic.goto(e+1)},back(){const e=ic.children.findIndex(e=>e.uid===ic.actived.uid);0!==e&&ic.goto(e-1)},on:nc.on.bind(nc),off:nc.off.bind(nc)});function cc(){oc.engine.getFactory().on("remove",e=>{console.log(e);for(let t=0;t<ic.children.length;t++){const o=ic.children[t];o.camera.path===e.path&&(o.camera.path=null,ac(o))}})}oc.On("init",()=>{oc.engine.ready?cc():oc.engine.onload(cc),window.vue.component("CameraSelector",tc),oc.menu.add([{path:"hierarhy.slide",icon:"dvr",tooltip:"Slide options",handler:()=>{var e;e=ic.actived,oc.modal.open({header:{value:"Slide options",handler:()=>{oc.modal.close()}},content:{component:"ModalForm",props:(0,r.reactive)({model:e,properties:[{label:"Name",prop:"name",component:"LabelEdit"},{label:"Camera",prop:"camera.path",component:"CameraSelector"}],head:{title:""}}),events:{"update:model":(t,o)=>{ac(e)},"update:camera.path":t=>{if(console.log(t),e.camera.path!==oc.engine.getManager().Camera?.path){if(!t)return void oc.engine.getManager().ResetCamera();const e=t.split("."),o=Yi.find(e);oc.engine.getManager().SetCamera(o),o.updateProjectionMatrix()}}}},footer:{buttons:(0,r.reactive)([{label:"Close",class:"primary",handler:async()=>{oc.modal.close()}}])}})}}])});const dc=ic;let pc;const uc={},mc=[],hc=[],fc=(0,r.reactive)({ready:!1,get manager(){return pc},getAssetsManager:()=>uc.AssetsManager,getSlidesManager:()=>uc.SlidesManager,getFactory:()=>uc.Factory,getManager:e=>uc[e]||pc,async load(){console.log("Engine load");const{AssetsManager:e,CssManager:t,MouseManager:o,ActionsManager:n,Project:a,Factory:r}=ji.getMod("engine");uc.AssetsManager=e,uc.SlidesManager=dc,uc.Factory=r,uc.MouseManager=o,uc.ActionsManager=n,uc.CssManager=t,uc.Project=pc=a,console.log("Engine load complete"),console.log(hc);const s=[];for(let e=0;e<hc.length;e++)s.push(hc[e](pc));hc.length=0,await Promise.all(s)},async start(){fc.ready=!0;const e=[];for(let t=0;t<mc.length;t++)e.push(mc[t](pc));return mc.length=0,await Promise.all(e),console.log(pc),pc},onload(e){mc.push(e)},onInit(e){hc.push(e)}}),vc=new Proxy(fc,{get:(e,t)=>t in e?e[t]:uc[t]}),gc={class:"blocks-container"},yc={class:"blockslabel"},bc={key:0,class:"blocks"},kc={class:"blocklabel"},wc={class:"blocktitle"},Ec=["onClick"],_c={class:"actionview"},Sc={key:0,class:"actionrow"},Nc={key:1,class:"actionform"},Vc={class:"actionline",style:{display:"flex","justify-content":"center"}},Cc={key:2,class:"actionline",style:{display:"flex","justify-content":"center"}},Bc={name:"ActionIspector",provide(){return{action:this.action}},props:{value:{type:Object,default:{uid:"",hook:""}},isState:{type:Boolean,default:!1},target:{type:Object},state:{type:Object}},data:()=>({expanded:!1,played:!1}),computed:{action(){return this.$app.actions.list.find(e=>e.uid===this.value.uid)}},methods:{onUpdate(e,t){const o=e.split(".");let n=this.action;for(let e=0;e<o.length-1;e++){const t=o[e];n[t]||(n[t]={}),n=n[t]}n[o[o.length-1]]=t,this.$emit("update:action",{[e]:t})},async remove(){this.$app.modal.confirmReq((0,r.reactive)({title:`Remove action '${this.action.name}' ?`,text:"",answer:"",template:""}),[{label:"YES",class:"primary",callback:e=>{this.$emit("remove")}},{label:"NO",class:"secondary",callback:e=>{}}])},async play(){await this.$app.engine.getManager("ActionsManager").Call(this.action,this.target,!0)},reset(){}}},$c=(0,B.A)(Bc,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",_c,[s.action?((0,r.openBlock)(),(0,r.createElementBlock)("div",Sc,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",{class:"label",onClick:t[0]||(t[0]=e=>a.expanded=!a.expanded)},[(0,r.createElementVNode)("span",null,(0,r.toDisplayString)(a.expanded?"▼":"▶"),1),(0,r.createTextVNode)(" "+(0,r.toDisplayString)(s.action.name||s.action.uid),1)])),[[i,s.action.type]]),(0,r.createElementVNode)("button",{onClick:t[1]||(t[1]=(...e)=>s.remove&&s.remove(...e))},[(0,r.createVNode)(l,{value:"bin",size:"1em"})])])):(0,r.createCommentVNode)("v-if",!0),s.action?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",Nc,[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(s.action.type),{onUpdate:s.onUpdate,onPlay:s.play,onReset:s.reset,options:{inspector:!0,expanded:a.expanded},name:s.action.name},{inspector:(0,r.withCtx)(()=>[(0,r.createElementVNode)("div",Vc,[(0,r.createElementVNode)("button",{class:"square",onClick:t[2]||(t[2]=(...e)=>s.play&&s.play(...e))},[(0,r.createVNode)(l,{value:a.played?"stop2":"play3",size:"1.2em"},null,8,["value"])])])]),_:1},40,["onUpdate","onPlay","onReset","options","name"]))],512)),[[r.vShow,a.expanded]]):(0,r.createCommentVNode)("v-if",!0),a.expanded?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",Cc))])}]]),xc=["onMouseover","onClick"],Dc={props:["items","x","y"],data:()=>({isActive:!1,highlightedIndex:null}),methods:{highlight(e){this.highlightedIndex=e},deactivate(){this.highlightedIndex=null,this.$emit("select",null)},selectItem(e){this.$emit("select",e)}}},Tc=(0,B.A)(Dc,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",{class:"menu",onMouseleave:t[0]||(t[0]=(...e)=>s.deactivate&&s.deactivate(...e)),style:(0,r.normalizeStyle)({top:o.y-3+"px",left:o.x+"px"})},[(0,r.createElementVNode)("ul",null,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.items,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("li",{key:t,onMouseover:e=>s.highlight(t),onClick:t=>s.selectItem(e),class:(0,r.normalizeClass)({highlighted:a.highlightedIndex===t})},(0,r.toDisplayString)(e),43,xc))),128))])],36)}],["__scopeId","data-v-56d3c090"]]),Ic={name:"ActionsIspector",props:{modelValue:{type:Object,default:{}},value:{type:Object,default:{data:{}}},target:{type:Object,default:null},property:{type:Object}},computed:{eventTypes(){return this.$app.events.types},actions(){return this.$app.actions},hooks(){return this.$app.actions.hooks.filter(e=>!this.getActionsHooks().includes(e))}},methods:{async addEvent(e){this.events.length=0,this.events.push(...["create.on","enable.on","disable.on","mouse.over","mouse.out"].filter(e=>!this.getActionsHooks().includes(e))),this.menuX=e.clientX,this.menuY=e.clientY,this.listshow=!0,await this.$nextTick();const t=this.$refs.hooksList.$el.offsetHeight,o=window.innerHeight;this.menuY+t>o&&(this.menuY=o-t-10)},onSelectEvent(e){this.listshow=!1,e&&this.openActionsList(e)},openActionsList(e){this.$app.actions.showLib(async t=>{t&&(this.target.actions.push({uid:t.uid,hook:e}),this.$emit("save"))})},onRemove(e,t){const o=this.target.actions.findIndex(o=>o.uid===e.uid&&o.hook===t);o>=0&&(this.target.actions.splice(o,1),this.$emit("update:target",null,null))},getActionsHooks(){return[...new Set(this.target.actions.map(e=>e.hook))]},async reset(e){},async play(e){},onEdit(e,t){this.$app.actions.save({uid:e.uid,...t})}},data:()=>({eventType:"",listshow:!1,show:!0,events:[],menuX:0,menuY:0,played:!1}),components:{Action:$c,HooksList:Tc}},Ac=(0,B.A)(Ic,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveComponent)("Action"),c=(0,r.resolveComponent)("HooksList");return(0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,[(0,r.createCommentVNode)("Actions View"),(0,r.createElementVNode)("div",gc,[(0,r.createElementVNode)("div",yc,[(0,r.createElementVNode)("div",{onClick:t[0]||(t[0]=e=>a.show=!a.show)},"Add : "),(0,r.createElementVNode)("button",{onClick:t[1]||(t[1]=(...e)=>s.addEvent&&s.addEvent(...e))},[(0,r.createVNode)(l,{value:"plus",size:"0.9em"})])]),a.show?((0,r.openBlock)(),(0,r.createElementBlock)("div",bc,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.getActionsHooks(),(e,n)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:n,class:"block"},[(0,r.createElementVNode)("div",kc,[(0,r.createElementVNode)("div",wc,(0,r.toDisplayString)(e),1),(0,r.createCommentVNode)("play block for all actions in hook"),t[2]||(t[2]=(0,r.createElementVNode)("div",{style:{display:"flex","justify-content":"center",gap:"5px"}},[(0,r.createCommentVNode)('LATER <button class="square" @click="play(eventType)">\r\n                            <icon :value="played ? \'stop2\' : \'play3\'" size="1em"></icon>\r\n                        </button>\r\n                        <button class="square" @click="reset(eventType)">\r\n                            <icon value="undo" size="1em"></icon>\r\n                        </button> ')],-1)),(0,r.createElementVNode)("button",{onClick:t=>s.openActionsList(e)},[(0,r.createVNode)(l,{value:"plus",size:"0.9em"})],8,Ec)]),(0,r.createCommentVNode)("Models actions"),(0,r.createCommentVNode)(' <Action :value="action" :target="value"\r\n                    v-for="(action, index) in value.model.data.actions.filter(a => a.hook === eventType)"\r\n                    :ref="`action${action.uid}`" :key="index"\r\n                    @update:action="onEdit(action,$event)">\r\n                </Action> '),(0,r.createCommentVNode)("States actions"),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o.target.actions.filter(t=>t.hook===e),(t,n)=>((0,r.openBlock)(),(0,r.createBlock)(i,{value:t,target:o.value,isState:o.target.isState,state:o.target.state||o.target,ref_for:!0,ref:`action${t.uid}`,key:n,"onUpdate:action":e=>s.onEdit(t,e),onRemove:o=>s.onRemove(t,e)},null,8,["value","target","isState","state","onUpdate:action","onRemove"]))),128))]))),128))])):(0,r.createCommentVNode)("v-if",!0),a.listshow?((0,r.openBlock)(),(0,r.createBlock)(r.Teleport,{key:1,to:"body"},[(0,r.createVNode)(c,{ref:"hooksList",x:a.menuX,y:a.menuY,items:s.hooks,onSelect:s.onSelectEvent},null,8,["x","y","items","onSelect"])])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createCommentVNode)(" // Actions View")],2112)}]]),Mc={class:"form-container"},Oc={class:"form-column"},jc={class:"row"},Pc={class:"rowlabel"},Lc={class:"rowvalue"},Rc={key:0},Fc=["value"],Uc={key:0,class:"row"},zc={class:"rowlabel"},Hc={class:"rowvalue"},qc=["value"],Gc={key:1},Wc={class:"row"},Kc={class:"rowlabel"},Yc={class:"rowvalue"},Jc={key:1,class:"row"},Xc={class:"rowlabel"},Zc={class:"rowvalue"},Qc={key:2,class:"bottomform"},ed={key:0},td={name:"ActionLibSelect",provide(){return{action:(0,r.computed)(()=>this.selected)}},data:()=>({selectedGroup:null}),props:{selected:{type:Object},progress:{type:Number}},computed:{types(){return this.$app.actions.library.filter(e=>e.group===this.selectedGroup)},groups(){return this.$app.actions.groups},selectedType(){return this.$app.actions.library.find(e=>e.component===this.selected.type)},selectType:{get(){return this.selected.type},set(e){this.$emit("change:type",e)}}},methods:{onUpdate(e,t){this.$emit("edit",e,t)},end(){this.$emit("edit","name",this.$refs.nameeditor.endEdit()),this.$emit("edit","url",this.$refs.urleditor.endEdit())}},mounted(){this.selectedGroup=this.selected.group}},od=(0,B.A)(td,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("LabelEdit"),i=(0,r.resolveDirective)("translate");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Mc,[(0,r.createElementVNode)("div",Oc,[(0,r.createElementVNode)("div",jc,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",Pc,[...t[4]||(t[4]=[(0,r.createTextVNode)("$$Group:",-1)])])),[[i]]),(0,r.createElementVNode)("div",Lc,[o.selected.uid?((0,r.openBlock)(),(0,r.createElementBlock)("div",Rc,(0,r.toDisplayString)(o.selected.group),1)):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("select",{key:1,style:{width:"100%"},"onUpdate:modelValue":t[0]||(t[0]=e=>a.selectedGroup=e)},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.groups,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("option",{key:t,value:e},(0,r.toDisplayString)(e),9,Fc))),128))],512)),[[r.vModelSelect,a.selectedGroup]])])]),a.selectedGroup?((0,r.openBlock)(),(0,r.createElementBlock)("div",Uc,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",zc,[...t[5]||(t[5]=[(0,r.createTextVNode)("$$Type:",-1)])])),[[i]]),(0,r.createElementVNode)("div",Hc,[o.selected.uid?((0,r.openBlock)(),(0,r.createElementBlock)("div",Gc,(0,r.toDisplayString)(s.selectedType.name),1)):(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("select",{key:0,style:{width:"100%"},"onUpdate:modelValue":t[1]||(t[1]=e=>s.selectType=e)},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.types,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("option",{key:t,value:e.component},(0,r.toDisplayString)(e.name),9,qc))),128))],512)),[[r.vModelSelect,s.selectType]])])])):(0,r.createCommentVNode)("v-if",!0),(0,r.createElementVNode)("div",Wc,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",Kc,[...t[6]||(t[6]=[(0,r.createTextVNode)("$$Name:",-1)])])),[[i]]),(0,r.createElementVNode)("div",Yc,[(0,r.createVNode)(l,{style:{width:"100%"},ref:"nameeditor","onUpdate:modelValue":t[2]||(t[2]=t=>e.$emit("edit","name",t)),modelValue:o.selected.name},null,8,["modelValue"])])]),o.selected.description?((0,r.openBlock)(),(0,r.createElementBlock)("div",Jc,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",Xc,[...t[7]||(t[7]=[(0,r.createTextVNode)("$$Description:",-1)])])),[[i]]),(0,r.createElementVNode)("div",Zc,(0,r.toDisplayString)(o.selected.description),1)])):(0,r.createCommentVNode)("v-if",!0),((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(o.selected.type),{class:"vertflex",onUpdate:s.onUpdate},null,40,["onUpdate"])),t[9]||(t[9]=(0,r.createElementVNode)("span",{style:{flex:"1"}},null,-1)),o.selected.uid?(0,r.createCommentVNode)("v-if",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",Qc,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("button",{onClick:t[3]||(t[3]=t=>e.$emit("save")),class:"primary"},[...t[8]||(t[8]=[(0,r.createTextVNode)("SAVE",-1)])])),[[i,"buttons.Save"]])]))]),o.progress>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",ed,(0,r.toDisplayString)(o.progress),1)):(0,r.createCommentVNode)("v-if",!0)])}]]),nd={class:"itemElement"},ad={class:"itemrow"},rd={props:{item:{type:Object}}},sd=(0,B.A)(rd,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",nd,[(0,r.createElementVNode)("div",ad,(0,r.toDisplayString)(o.item.name),1)])}]]),ld=wo.default.default||wo.default;let id;function cd(e){const t=(0,r.reactive)({selected:null,list:pd.list,head:{reactive:!0,button:"X",slots:{"button-content":{}}}}),o={label:"Close",class:"secondary",handler:async()=>{t.selected=null,Ni.close(),e&&e()}},n=(0,r.reactive)({label:"Create",class:"primary",handler:async()=>{const e=pd.library[0];t.selected={type:e.component,group:e.group,targets:["*"],description:e.description,...e.template}}}),a={label:"Delete",class:"additional",hidden:(0,r.computed)(()=>!t.selected||!t.selected.uid),handler:async()=>{const e=pd.list.findIndex(e=>e===t.selected);e>=0&&pd.list.splice(e,1),async function(e){await ln.deleteItem("actions",e)}(t.selected.uid),t.selected=null}},s={label:"Select",class:"additional",hidden:(0,r.computed)(()=>!t.selected||!t.selected.uid||!e),handler:async()=>{e(t.selected),Ni.close()}},l=(0,r.reactive)([s,n,a,o]);Ni.open({header:{value:e?"Select an action":"Action Library",handler:()=>{Ni.close()}},content:{component:"ItemsLib",props:t,events:{selected:e=>{e.uid&&(t.selected=e)}},slots:{head:{component:"SearchFilter",props:{reactive:!0},events:{clean(){t.list=pd.list},entry(e){t.list=e?pd.list.filter(t=>t.name.toLowerCase().includes(e.toLowerCase())):pd.list}}},item:{component:"ActionItem"},edit:{component:"ActionLibSelect",props:{selected:t.selected},events:{"change:type":e=>{const o=pd.library.find(t=>t.component===e);t.selected={...o.template,type:o.component,group:o.type,description:o.description}},save:async()=>{const e=pd.library.find(e=>e.component===t.selected.type);if(e.check){if(!await e.check(t.selected))return void Ei.add({message:"Неверные параметры"})}else Object.keys(e.template).forEach(o=>{o in t.selected||(t.selected[o]=JSON.parse(JSON.stringify(e.template[o])))});t.selected.uid=`${t.selected.type}${Date.now()}`,await dd(t.selected),await id.Add(t.selected)},edit:(e,o)=>{const n=e.split(".");let a=t.selected;for(let e=0;e<n.length-1;e++){const t=n[e];a[t]||(a[t]={}),a=a[t]}a[n[n.length-1]]=o,dd(t.selected)}}}}},footer:{buttons:l}})}async function dd(e){e.uid&&await ln.upsertItemProperties("actions",e.uid,JSON.parse(JSON.stringify({id:e.uid,...e})))}const pd=(0,r.reactive)({init:async function(e){id||(id=vc.ActionsManager,await id.Init((0,r.reactive)(e)),id.on("add",e=>{pd.list.push(e)}),id.on("remove",e=>{}),id.on("register",e=>{}),pd.list.push(...id.Actions))},register:function(e){pd.library.push(e)},save:dd,showLib:cd,exportData:async function(){return await ln.getAllItems("actions")},removeFrom:async function(e,{hook:t,uid:o}){},get force(){return id.force},set force(e){id.force=e},hooks:["enable.on","slide.in.before","slide.in","slide.in.after","slide.out.before","slide.out","slide.out.after","disable.on","mouse.in","mouse.click","mouse.out"],list:[],library:[],get groups(){return pd.library.reduce((e,t)=>(e.includes(t.group)||e.push(t.group),e),[])},get values(){return Object.values(pd.list)}});ld.On("init",()=>{window.vue.component("ActionsList",Ac),window.vue.component("ActionLibSelect",od),window.vue.component("ActionItem",sd),ld.menu.add([{path:"hierarhy.actions",icon:"dice",tooltip:"Actions",handler:cd}]),ld.inspector.addToModels(["Object3D"],[{label:"Models actions",readonly:!0,content:{prop:"actions",component:"ActionsList",state:!1}},{label:"States actions",readonly:!0,content:{prop:"actions",component:"ActionsList",state:!0}}])});const ud=pd,md={class:"assetblock"},hd={name:"AssetView",data:()=>({cmps:{hdr:"assethdr"}}),props:{value:{type:Object},modelValue:{type:String},property:{type:Object}},methods:{onAssetChange(e){e&&this.$emit("update:value",e.uid)},cleanProp(){delete this.value[this.property.prop],this.$emit("update:value",null)}},computed:{val(){return this.value[this.property.prop]},asset(){return this.val?this.$app.assets.list.find(e=>e.uid===this.val):null}},components:{assethdr:Ie}},fd=(0,B.A)(hd,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("icon"),i=(0,r.resolveDirective)("tooltip");return(0,r.openBlock)(),(0,r.createElementBlock)("div",md,[((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(a.cmps[o.property.type]),{onSetasset:s.onAssetChange,asset:s.asset},null,40,["onSetasset","asset"])),s.asset?(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createBlock)(l,{key:0,onClick:s.cleanProp,class:"icon",value:"bin",size:"1em"},null,8,["onClick"])),[[i,"Удалить"]]):(0,r.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-5867b901"]]),vd={class:"image-container"},gd={ref:"canva"},yd={class:"selector"},bd={props:{modelValue:{type:Object,default:null},value:{type:Object},label:{type:String,default:""},tooltip:{type:String,default:""},selectable:{type:Boolean}},data:()=>({txtr:null}),watch:{value(e){this.redraw()},modelValue(e){this.redraw()}},methods:{onUpdate({result:e,file:t}){console.log(e);const o=new Blob([e],{type:t.type}),n=URL.createObjectURL(o);this.txtr=n;const a=(new THREE.TextureLoader).load(n,()=>{URL.revokeObjectURL(n)});this.$emit("update:modelValue",a.image),this.$app.storage.writeFile("texture.png",e)}},methods:{redraw(){const e=this.$refs.canva,t=e.getContext("2d");if(t.clearRect(0,0,e.width,e.height),this.modelValue)try{const o=this.modelValue.image;e.width=o.width,e.height=o.height,t.drawImage(o,0,0)}catch(e){}}},mounted(){console.log(this.modelValue,this.value),this.redraw()}},kd=(0,B.A)(bd,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",vd,[(0,r.createElementVNode)("canvas",gd,null,512),(0,r.createElementVNode)("div",yd,[(0,r.createElementVNode)("button",{class:"btn",onClick:t[0]||(t[0]=t=>e.$emit("select",o.value))},"SELECT")])])}]]),wd={class:"form-container"},Ed={class:"info"},_d={class:"row"},Sd={class:"rowlabel"},Nd={class:"rowvalue"},Vd={class:"row"},Cd={class:"rowlabel"},Bd={class:"rowvalue"},$d=["value"],xd=["value"],Dd={key:1},Td={class:"rowlabel"},Id={key:0},Ad={name:"AssetEdit",props:{selected:{type:Object,default:{name:"-"}},progress:{type:Number}},computed:{types(){return this.$app.assets.types},inspector(){return this.$app.inspector.blocksFor(["asset",this.selected.type]).filter(e=>!e.inspectorOnly)}},methods:{updateInspector(e){this.inspector=this.$app.inspector.blocksFor(this.selected.getTypes())},onChange(e,t){console.log(e,t),this.$emit("edit",e,t)},end(){this.$emit("edit","name",this.$refs.nameeditor.endEdit()),this.$emit("edit","url",this.$refs.urleditor.endEdit())},async onComponentUpdate(e,t){if(t.onupdate)await t.onupdate(this.selected,e,t,()=>{this.$emit("edit",t.prop,e)});else{const o=t.prop.split(".");let n=o[0],a=this.selected;for(let e=0;e<o.length-1;e++)a=a[o[e]],n=o[e+1];a[n]=e,this.$emit("edit",t.prop,e)}},onComponentChange(){_saveHandler(this.selected)}}},Md=(0,B.A)(Ad,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("LabelEdit"),i=(0,r.resolveDirective)("translate");return(0,r.openBlock)(),(0,r.createElementBlock)("div",wd,[(0,r.createElementVNode)("div",Ed,[(0,r.createElementVNode)("div",_d,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",Sd,[...t[3]||(t[3]=[(0,r.createTextVNode)("$$Name:",-1)])])),[[i]]),(0,r.createElementVNode)("div",Nd,[(0,r.createVNode)(l,{style:{width:"100%"},ref:"nameeditor","onUpdate:modelValue":[t[0]||(t[0]=e=>s.onChange("name",e)),t[1]||(t[1]=e=>o.selected.name=e)],modelValue:o.selected.name},null,8,["modelValue"])])]),(0,r.createElementVNode)("div",Vd,[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",Cd,[...t[4]||(t[4]=[(0,r.createTextVNode)("$$Type:",-1)])])),[[i]]),(0,r.createElementVNode)("div",Bd,[o.selected.uid?((0,r.openBlock)(),(0,r.createElementBlock)("div",Dd,(0,r.toDisplayString)(o.selected.type),1)):((0,r.openBlock)(),(0,r.createElementBlock)("select",{key:0,class:"typeslist",value:o.selected.type,onChange:t[2]||(t[2]=e=>s.onChange("type",e.target.value))},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.types,e=>((0,r.openBlock)(),(0,r.createElementBlock)("option",{value:e},(0,r.toDisplayString)(e),9,xd))),256))],40,$d))])]),(0,r.createCommentVNode)(' <div class="row">\r\n                <div class="rowlabel">URL</div>\r\n                <div class="rowvalue">\r\n                    <LabelEdit style="width: 100%;" ref="urleditor" @update:value="onChange(\'url\', $event)"\r\n                        :value="selected.url">\r\n                    </LabelEdit>\r\n                </div>\r\n            </div> '),((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(s.inspector,(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:t,class:"row"},[(0,r.withDirectives)(((0,r.openBlock)(),(0,r.createElementBlock)("div",Td,[(0,r.createTextVNode)((0,r.toDisplayString)(e.label),1)])),[[i]]),e.content?((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.content.component),(0,r.mergeProps)({key:0,class:"rowvalue",value:o.selected,modelValue:o.selected[e.content.prop],"onUpdate:modelValue":[t=>o.selected[e.content.prop]=t,t=>s.onComponentUpdate(t,e.content)],property:e.content},{ref_for:!0},e.content.props,{onModify:t=>s.onComponentChange(t,e.content)}),null,16,["value","modelValue","onUpdate:modelValue","property","onModify"])):(0,r.createCommentVNode)("v-if",!0),e.head?((0,r.openBlock)(),(0,r.createBlock)((0,r.resolveDynamicComponent)(e.head.component),(0,r.mergeProps)({key:1,class:"rowvalue",value:o.selected,modelValue:o.selected[e.head.prop],"onUpdate:modelValue":[t=>o.selected[e.head.prop]=t,t=>s.onComponentUpdate(t,e.head)],property:e.head},{ref_for:!0},e.head.props,{onModify:t=>s.onComponentChange(t,e.head)}),null,16,["value","modelValue","onUpdate:modelValue","property","onModify"])):(0,r.createCommentVNode)("v-if",!0)]))),128)),t[5]||(t[5]=(0,r.createElementVNode)("div",null,null,-1))]),(0,r.createElementVNode)("div",null,[o.progress>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",Id,(0,r.toDisplayString)(o.progress),1)):(0,r.createCommentVNode)("v-if",!0)])])}],["__scopeId","data-v-d1f2452c"]]),Od={class:"moditem"},jd={class:"title"},Pd={class:"image"},Ld=["src"],Rd={name:"AssetItem",props:["item"]},Fd=(0,B.A)(Rd,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",Od,[(0,r.createElementVNode)("div",jd,(0,r.toDisplayString)(o.item.name),1),(0,r.createElementVNode)("div",Pd,[o.item.images?((0,r.openBlock)(),(0,r.createElementBlock)("img",{key:0,src:o.item.images[0].url},null,8,Ld)):(0,r.createCommentVNode)("v-if",!0)])])}],["__scopeId","data-v-e24059a8"]]),Ud={class:"form-container"},zd={class:"info"},Hd={class:"row"},qd={class:"rowvalue"},Gd={class:"line"},Wd=["src"],Kd={key:0},Yd={name:"AssetView",props:{selected:{type:Object,default:{name:"-"}},progress:{type:Number}},computed:{types(){return this.$app.assets.types},inspector(){return this.$app.inspector.blocksFor(["asset",this.selected.type]).filter(e=>!e.inspectorOnly)}},methods:{updateInspector(e){this.inspector=this.$app.inspector.blocksFor(this.selected.getTypes())},onChange(e,t){this.$emit("edit",e,t)},end(){this.$emit("edit","name",this.$refs.nameeditor.endEdit()),this.$emit("edit","url",this.$refs.urleditor.endEdit())},async onComponentUpdate(e,t){if(t.onupdate)await t.onupdate(this.selected,e,t,()=>{this.$emit("edit",t.prop,e)});else{const o=t.prop.split(".");let n=o[0],a=this.selected;for(let e=0;e<o.length-1;e++)a=a[o[e]],n=o[e+1];a[n]=e,this.$emit("edit",t.prop,e)}},onComponentChange(){_saveHandler(this.selected)}}},Jd=(0,B.A)(Yd,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",Ud,[(0,r.createElementVNode)("div",zd,[(0,r.createElementVNode)("div",Hd,[t[0]||(t[0]=(0,r.createElementVNode)("div",{class:"rowlabel"},"Name",-1)),(0,r.createElementVNode)("div",qd,(0,r.toDisplayString)(o.selected.name),1)]),(0,r.createElementVNode)("div",Gd,[(0,r.createElementVNode)("img",{src:o.selected.images[0].url},null,8,Wd)])]),(0,r.createElementVNode)("div",null,[o.progress>0?((0,r.openBlock)(),(0,r.createElementBlock)("div",Kd,(0,r.toDisplayString)(o.progress),1)):(0,r.createCommentVNode)("v-if",!0)])])}],["__scopeId","data-v-321414c5"]]),Xd=wo.default.default||wo.default,Zd={asset:[{label:"URL:",content:{prop:"url",component:"LabelEdit",onupdate(e,t,o,n){tp.Update(e,t,o)}}},{label:"$$Clone:",head:{component:"BoolEdit",prop:"clone",async onupdate(e,t,o,n){await tp.Update(e,t,o)}}}],model:[{label:"$$Shadow:",content:{component:"ShadowEdit",prop:"shadow",onupdate:async(e,t,o,n)=>{await tp.Update(e,t,o)}}},{label:"$$Environment map",inspectorOnly:!0,content:{component:"AssetSelector",prop:"envMap",type:"hdr",onupdate:async(e,t,o,n)=>{await tp.Update(e,t,o)}}}],image:[{label:"Image",content:{inspectorOnly:!0,prop:"img",component:"ImageView",props:{acceptedTypes:"image/*",selectable:!1},async onupdate(e,t,o){console.log(t),e.img=t}}}],hdr:[]},Qd={model:()=>!0},ep={model:"codepen",image:"image",hdr:"loop2",video:"film"};let tp;function op(e=[]){return console.log(e),ip.list.filter(t=>0===e.length||e.includes(t.type)).map(e=>({...e.data}))}async function np(e){e.uid||(e.uid=`asset_${Date.now()}`);const t=tp.Add(e);await t.load(e=>{console.log(`${t.uid}:${e}%`)}),t.on("update",()=>{ap(t)}),ip.list.push(t),await ln.addItem("assets",JSON.parse(JSON.stringify(e)))}async function ap(e){console.log("Save asset");try{if(!e.uid)return;await ln.updateItem("assets",JSON.parse(JSON.stringify({id:e.uid,...e.data})))}catch(e){console.error("Error saving asset:",e),Xd.toasts.add({message:"Error saving asset"})}}async function rp(e){switch(e.type){case"model":if(Xd.models.children.some(t=>t.isUseAsset&&t.isUseAsset(e.uid)))return Xd.toasts.add({message:"Cannot delete, asset in use"}),!1;break;case"hdr":if(ip.list.find(t=>t.data.envMap===e.uid))return Xd.toasts.add({message:"Cannot delete, asset in use"}),!1}const t=ip.list.findIndex(t=>t.uid===e.uid);return t>=0&&(ip.list.splice(t,1),tp.Remove(e.uid),await ln.deleteItem("assets",e.uid)),!0}function sp(e,t=!0){return new Promise(o=>{const n=(0,r.reactive)({selected:null,list:op(e),icons:ep}),a=(0,r.reactive)([{label:"Select",class:"primary",hidden:(0,r.computed)(()=>!t||!n.selected),handler:async()=>{Ni.close(),o(n.selected)}},{label:"Remove",class:"additional",hidden:(0,r.computed)(()=>!n.selected?.uid),handler:async()=>{rp(n.selected)&&(n.selected=null,n.list=op(e))}},{label:"Save",class:"primary",hidden:(0,r.computed)(()=>!n.selected||n.selected.uid||n.busy),handler:async()=>{if(!Qd[n.selected.type]||await Qd[n.selected.type](n.selected)){Xd.toasts.add({message:"Start load asset"});try{n.selected=await np(n.selected)}catch(e){return Xd.toasts.add({message:e.message}),void(n.selected.uid=null)}n.list=op(e),Xd.toasts.add({message:"Asset saved"})}}},{label:"Create",class:"secondary",handler:async()=>{n.selected={name:"",type:ip.types[0],url:""}}},{label:"Close",class:"additional",handler:async()=>{Ni.close(),o()}}]);Ni.open({header:{value:t?"Select asset":"Project assets",handler:()=>{Ni.close()}},content:{component:"ItemsLib",props:n,events:{selected:e=>{n.selected=e}},slots:{edit:{component:"AssetEdit",props:{selected:n.selected},events:{edit:(e,t)=>{n.selected[e]=t,n.selected.uid&&ap({data:n.selected})}}}}},footer:{buttons:a}})})}async function lp(){const e=[{label:"Name",prop:"name",component:"Label"}],t={model:[{label:"Preview",component:"ModelPreview",prop:"url",props:{image:"preview"}}],hdr:[],image:[],video:[]},o=(0,r.reactive)({selected:null,selectedIndex:-1,list:[],busy:!1,styles:{item:{width:"128px",height:"128px"}},icons:ep,head:{title:""},rows:[]});async function n(e){o.busy=!0;const t=await fetch("https://s3.eu-west-1.amazonaws.com/3dbuilder.reneos.com/assets/assets.json",{cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}}),n=await t.json();o.list=n.map(e=>({...e,name:e.name||e.uid})).filter(t=>!e||t.name.includes(e)),o.busy=!1}const a={label:"Add to project",class:"secondary",hidden:(0,r.computed)(()=>o.processed||o.selectedIndex<0||!o.canadd),handler:async()=>{o.processed=!0;try{const{name:e,url:t,type:n}=o.selected;await np({uid:Xt(o.selected.uid,ip.list.map(e=>e.name)),name:e,url:t,type:n})}catch(e){return e.isExistError?Xd.toasts.add({message:e.message}):Xd.toasts.add({message:"Error adding asset"}),void(o.processed=!1)}o.canadd=-1===ip.list.findIndex(e=>e.uid===o.selected.uid),Xd.toasts.add({message:"The asset has been added to project."}),o.processed=!1}},s={label:"Close",class:"primary",handler:async()=>{Ni.close()}},l=(0,r.reactive)([a,s]);Ni.open({header:{value:"Global assets",handler:()=>{Ni.close()}},content:{component:"ItemsLib",props:o,events:{open:()=>{n()},selected:(n,a)=>{o.selected=n,o.selectedIndex=a,o.rows=[...e,...t[o.selected.type]],o.canadd=-1===ip.list.findIndex(e=>e.uid===o.selected.uid)}},slots:{head:{component:"SearchFilter",events:{search(e){n(e)},entry(e){e||n()}}},item:{component:"AssetItem"}}},footer:{buttons:l}})}const ip=(0,r.reactive)({init:async function(e,t){console.log("Init assets"),tp=vc.getManager("AssetsManager"),await tp.Init(e,t);const o=Array.from(tp.Assets.values());o.forEach(e=>{e.on("update",()=>{ap(e)})}),ip.list.push(...o)},create:np,update:async function(e,t,o){await tp.Update(e,t,o)},save:ap,selectAsset:sp,editAsset:function(e){const t=(0,r.reactive)({current:e}),o=(0,r.reactive)([{label:"Save",class:"secondary",handler:async()=>{e.uid?await ap({data:e}):await np(e),Ni.close()}},{label:"Cancel",class:"primary",handler:async()=>{Ni.close()}}]);Ni.open({header:{value:"Select asset",handler:()=>{Ni.close()}},content:{component:"AssetEdit",props:t,events:{edit:(t,o)=>{e[t]=o}}},footer:{buttons:o}})},remove:rp,setAsset:function(e,t){e.assets||(e.assets=[]),e.assets.push({uid:t.uid}),Xd.engine.getFactory().AddAsset(e.uid,t)},openAssetsLib:lp,useAsset:function(e,t){const o=ip.list.find(t=>t.uid===e);o&&o.uses.add(t)},getAsset:function(e){return ip.list.find(t=>t.uid===e)},types:["model","hdr","image"],icons:ep,list:[],exportData:async()=>Array.from(tp.Assets.values()),get inspector(){return Zd},getInspector:e=>Zd[e]||[],getManager:()=>tp});Xd.On("init",()=>{Xd.menu.add([{path:"hierarhy.assets",icon:"cube",tooltip:"Assets",handler:()=>{sp([],!1)}}]),Xd.menu.add([{path:"app.libraries.assets",icon:"plug",text:"Assets",handler:async()=>{lp()}}]),window.vue.component("AssetView",Jd),window.vue.component("AssetItem",Fd),window.vue.component("AssetSelector",fd),window.vue.component("AssetEdit",Md),window.vue.component("AssetImage",kd),Object.keys(Zd).forEach(e=>{Xd.inspector.addToModels([e],Zd[e])})});const cp=ip,dp=(Boolean,wo.default.default||wo.default);let pp;const up=(0,r.reactive)({init:async function(){console.log("app init"),pp=new ln("slider",["data","templates"]),await pp.openDatabase("slider")},save:async function(){const e={uid:"currproject",id:"currproject",actions:ud.exportData(),assets:cp.exportData(),elements:Elements.exportData()};return await ln.updateItem("projects",e),e.uid},saveData:function(e,t,o){return pp.upsertItemProperties(e,t,o)},readData:function(e,t){return pp.getItem(e,t)},GetDB:function(){return pp},draggedNode:null,ready:!1,cameras:[],get types(){return dp.engine.getFactory().GetTypes()},user:{registered:!1,name:"Guest",options:{manual:"false"!==localStorage.getItem("options.manual")}},setPassword:async function(e){try{const{error:t,me:o}=await gqlc.Set({me:[{password:[{$args:{value:e}}]}]})}catch(e){dp.toasts.add({message:"Error on change password"})}},async logout(){const e=await fetch("/auth/logout"),t=await e.json();console.log(t),window.location.reload()}});dp.On("init",async()=>{dp.menu.add([{path:"app.help.channel",icon:"bullhorn",text:"Channel",handler:async()=>{window.open("https://t.me/webslider","_blank")}},{path:"app.help.chat",icon:"bubbles",text:"Chat",tooltip:"Discuss",handler:()=>{window.open("https://t.me/chatslider","_blank")}},{path:"app.help.docs",icon:"books",text:"Documents",tooltip:"Documents",handler:()=>{window.open("/docs/","_blank")}}]),setTimeout(async()=>{},7e3)});const mp=up,hp=(wo.default.default||wo.default,(0,r.reactive)({event(e,t){gtag("event",e,t)}})),fp=[],vp=[],gp={},yp={},bp={},kp=(0,r.reactive)({ready:!1,cameras:[],blocksFor:e=>e.flatMap(e=>yp[e]||[]),handlers:bp,setHandler(e,t){bp[e]=t},getHandlers:()=>bp,addBlocks(e,t){Object.keys(_blocks).forEach(o=>{t(o)&&_blocks[o].push(...e)})},addToAssets(e,t){for(let o=0;o<e.length;o++){const n=e[o];"*"!==n?(gp[n]||(gp[n]=[]),gp[n].push(...t)):vp.push(...t)}},addToModels(e,t){for(let o=0;o<e.length;o++){const n=e[o];"*"!==n?(yp[n]||(yp[n]=[]),yp[n].push(...t)):fp.push(...t)}}}),wp=wo.default.default||wo.default;function Ep(e){no.Transformer.setMode(e)}const _p=(0,r.reactive)({add:function e(t){for(let o=0;o<t.length;o++){const n=t[o],a=n.path.split("."),r=a[0];let s=_p[r];if(!s){console.warn(`Root menu '${r}' not found`);continue}let l=r,i=s;for(let e=1;e<a.length-1;e++){const t=a[e];l+="."+t;let o=i.children.find(e=>e.path===l);o||(o={path:l},i.children.push(o)),o.children||(o.children=[]),i=o}const c=n.path,d=i.children.findIndex(e=>e.path===c);if(d>=0){const t=i.children[d];Object.keys(n).forEach(e=>{"path"!==e&&(t[e]=n[e])}),n.children&&n.children.length>0&&(t.children||(t.children=[]),e(n.children))}else{const t={...n};n.children&&n.children.length>0&&(t.children||(t.children=[]),e(n.children)),i.children.push(t)}}},app:{children:[{path:"app.project",icon:"",text:"Project",link:"#",children:[]},{path:"app.libraries",icon:"",text:"Libraries",link:"#",children:[]},{path:"app.help",icon:"question",text:"Help",link:"#",children:[]}]},top:{children:[{icon:"sphere",hint:"Local/global space",handler:function(){no.Transformer.setSpace("local"===no.Transformer.space?"world":"local")}},{icon:"move",hint:"Moving",handler:Ep.bind(null,"translate")},{icon:"loop2",hint:"Rotation",handler:Ep.bind(null,"rotate")},{icon:"enlarge2",hint:"Scale",handler:Ep.bind(null,"scale")},{icon:"target",hint:"Zoom in on selected",handler:no.FocusToSelect},{icon:"cross",hint:"Deselect",handler:()=>{wp.selection.select(null)}}],options:{size:"1.5em"}},hierarhy:{children:[],options:{}},tools:{children:[]}}),Sp=_p,Np={class:"importer"},Vp={class:"row"},Cp={class:"row"},Bp={class:"label"},$p={class:"row"},xp={class:"label"},Dp={class:"row"},Tp={class:"label"},Ip={class:"row"},Ap={class:"label"},Mp={name:"Importer",data:()=>({merge:!1,assets:new Set,models:new Set,slides:new Set,modules:new Set}),methods:{onChangeElements(e){e.isSelected?this.models.add(e.path):this.models.delete(e.path),this.$emit("changelist",{assets:this.assets,models:this.models,slides:this.slides,modules:this.modules})},onChangeModules(e){e.isSelected?this.modules.add(e.name):this.modules.delete(e.name),this.$emit("changelist",{assets:this.assets,models:this.models,slides:this.slides,modules:this.modules})},onChangeSlides(e){e.isSelected?this.slides.add(e.uid):this.slides.delete(e.uid),this.$emit("changelist",{assets:this.assets,models:this.models,slides:this.slides,modules:this.modules})},onChangeAssets(e){e.isgroup?e.isSelected?e.children.map(e=>this.assets.add(e.uid)):this.assets.clear():e.isSelected?this.assets.add(e.uid):this.assets.delete(e.uid),this.$emit("changelist",{assets:this.assets,models:this.models,slides:this.slides,modules:this.modules})}},props:{project:{type:Object}},components:{TreeView:nt},computed:{assetsTree(){return this.project.assets.reduce((e,t)=>{let o=e.find(e=>e.type===t.type);return o||(o={isgroup:!0,type:t.type,children:[],uid:t.type},e.push(o)),o.children.push(t),e},[])}}},Op=(0,B.A)(Mp,[["render",function(e,t,o,n,a,s){const l=(0,r.resolveComponent)("TreeView");return(0,r.openBlock)(),(0,r.createElementBlock)("div",Np,[(0,r.createElementVNode)("div",Vp,[(0,r.createElementVNode)("div",null,[t[2]||(t[2]=(0,r.createTextVNode)("Импортировать в текущий проект ",-1)),(0,r.withDirectives)((0,r.createElementVNode)("input",{type:"checkbox",onChange:t[0]||(t[0]=t=>e.$emit("options",{merge:a.merge})),"onUpdate:modelValue":t[1]||(t[1]=e=>a.merge=e)},null,544),[[r.vModelCheckbox,a.merge]])])]),(0,r.createElementVNode)("div",Cp,[t[3]||(t[3]=(0,r.createElementVNode)("div",{class:"title"},"Assets",-1)),(0,r.createElementVNode)("div",null,[(0,r.createVNode)(l,{childsFiled:"children",tree:s.assetsTree,onChangeSelect:s.onChangeAssets},{label:(0,r.withCtx)(({node:e})=>[(0,r.createElementVNode)("div",Bp,(0,r.toDisplayString)(e.name||e.uid),1)]),_:1},8,["tree","onChangeSelect"])])]),(0,r.createElementVNode)("div",$p,[t[4]||(t[4]=(0,r.createElementVNode)("div",{class:"title"},"Модули",-1)),(0,r.createElementVNode)("div",null,[(0,r.createVNode)(l,{childsFiled:"childrenz",tree:o.project.modules,onChangeSelect:s.onChangeModules},{label:(0,r.withCtx)(({node:e})=>[(0,r.createElementVNode)("div",xp,(0,r.toDisplayString)(e.name||e.uid),1)]),_:1},8,["tree","onChangeSelect"])])]),(0,r.createElementVNode)("div",Dp,[t[5]||(t[5]=(0,r.createElementVNode)("div",{class:"title"},"Элементы",-1)),(0,r.createElementVNode)("div",null,[(0,r.createVNode)(l,{childsFiled:"childrenz",tree:o.project.models,onChangeSelect:s.onChangeElements},{label:(0,r.withCtx)(({node:e})=>[(0,r.createElementVNode)("div",Tp,(0,r.toDisplayString)(e.name||e.uid),1)]),_:1},8,["tree","onChangeSelect"])])]),(0,r.createElementVNode)("div",Ip,[t[6]||(t[6]=(0,r.createElementVNode)("div",{class:"title"},"Слайды",-1)),(0,r.createElementVNode)("div",null,[(0,r.createVNode)(l,{childsFiled:"childrenz",tree:o.project.slides,onChangeSelect:s.onChangeSlides},{label:(0,r.withCtx)(({node:e})=>[(0,r.createElementVNode)("div",Ap,(0,r.toDisplayString)(e.name||e.uid),1)]),_:1},8,["tree","onChangeSelect"])])])])}]]),jp=wo.default.default||wo.default,Pp=new Pi;const Lp=(0,r.reactive)({uid:null,init:function(e){for(let t=0;t<e.length;t++){const o=e[t];Lp.data[o.uid]=o}Lp.options=Lp.data.options||{fullscreen:!1,showslides:!0},Lp.info=Lp.data.info||{name:"Project"}},data:{},exportToJson:async function(){const e=await ln.exportToJson(Lp.uid),t=new Blob([JSON.stringify(e)],{type:"application/json"}),o=`project${Lp.uid}.json`;if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveBlob(t,o);else{const e=window.document.createElement("a");e.href=window.URL.createObjectURL(t),e.download=o,e.style="display: none",e.click()}},importProject:async function(){try{const e=await function(e=".json"){return new Promise(t=>{const o=document.createElement("input");o.type="file",o.accept=e,o.style.display="none",o.addEventListener("change",()=>{o.files&&o.files[0]&&t(o.files[0]),document.body.removeChild(o)}),document.body.appendChild(o),o.click()})}(),t=await function(e){return new Promise((t,o)=>{if(!e.name.endsWith(".json"))return void o(new Error("Выберите файл с расширением .json"));const n=new FileReader;n.onload=e=>{try{const o=JSON.parse(e.target.result);t(o)}catch(e){o(new Error("Ошибка парсинга JSON: "+e.message))}},n.onerror=()=>{o(new Error("Ошибка чтения файла"))},n.readAsText(e)})}(e);(0,r.reactive)({actions:{},assets:{},elements:{},slides:{},modules:{}}),await ln.addItems("actions",t.actions),await ln.addItems("assets",t.assets),await ln.addItems("models",t.models),await ln.addItems("slides",t.slides),await ln.addItems("modules",t.modules),await ln.addItems("project",t.project);const o=new URL(window.location.href);return window.location.href=o.toString(),t}catch(e){throw console.error("Ошибка:",e.message),e}},play:async function(e="data"){jp.analitycs.event("project_play");const t=await ln.exportToJson(Lp.uid);t.assets=[...jp.engine.getAssetsManager().Assets.values()].map(e=>e.data);let o=`../player?src=${e}`;"db"===e&&(o+=`&db=${Lp.uid}`);const n=window.open(o,"Player");if(n){if("data"===e){const e=async(o=0)=>{try{if(n.closed)return void console.error("Окно плеера было закрыто");const e={};Object.keys(t).forEach(o=>{console.log(o),e[o]=structuredClone(t[o])}),n.postMessage({type:"INIT_DATA",payload:e},window.location.origin)}catch(t){console.error("Ошибка при отправке данных:",t),o<5&&setTimeout(()=>e(o+1),500*(o+1))}};setTimeout(e,3e3)}}else console.error("Не удалось открыть окно. Возможно, браузер заблокировал pop-up.")},children:[],on:Pp.on.bind(Pp),off:Pp.off.bind(Pp),options:{fullscreen:!1,showslides:!0},info:{name:"Project"}});jp.On("init",()=>{window.vue.component("Importer",Op),window.vue.component("ElementAdd",vt),jp.menu.add([{path:"hierarhy.project",icon:"equalizer2",tooltip:"Project options",handler:()=>{!function(){const e=(0,r.reactive)({model:Lp.options,properties:[{label:"Show slides",prop:"showslides",component:"BoolEdit"},{label:"Fullscreen",prop:"fullscreen",component:"BoolEdit"}],head:{title:""}}),t={label:"Close",class:"primary",handler:async()=>{jp.modal.close()}},o=(0,r.reactive)([t]);jp.modal.open({header:{value:"Project options",handler:()=>{jp.modal.close()}},content:{component:"ModalForm",props:e,events:{"update:model":(e,t)=>{!async function(){await ln.upsertItemProperties("project","options",JSON.parse(Jt(Lp.options)))}()}}},footer:{buttons:o}})}()}}]),jp.menu.add([{path:"app.project",icon:"",text:"Project",link:"#",children:[{path:"app.project.create",icon:"file-empty",text:"Create",handler:async()=>{jp.projects.create()}},{path:"app.project.open",icon:"menu",text:"Open",tooltip:"Open project",handler:()=>{jp.projects.open()}},{path:"app.project.export",icon:"download",text:"Export",tooltip:"Export project",handler:()=>{jp.project.exportToJson()}},{path:"app.project.import",icon:"upload",text:"Import",link:"#",tooltip:"Import project",handler:()=>{jp.project.importProject()}},{path:"app.project.remove",icon:"bin",text:"Delete",handler:()=>{jp.projects.remove()}}]}])});const Rp=Lp,Fp=wo.default.default||wo.default,Up=[];let zp="";function Hp(e={}){return new Promise(t=>{const o=(0,r.reactive)({title:"Creating a project",text:"Please enter the project name *",answer:"",template:""}),n=(0,r.reactive)({label:"Create",class:"primary",disabled:o.answer.length<1,callback:async o=>{const n=`project${Date.now()}`;await ln.Create(n,{project:[{uid:"info",id:n,name:o,created:Date.now(),last:Date.now()},{uid:"options",showslides:!0}],assets:e.assets||[],actions:e.actions||[],models:e.models||[],slides:e.slides||[],modules:e.modules||[]}),Fp.analitycs.event("project_create"),t(n)}});Ni.queryText(o,[n],e=>{o.answer=e,n.disabled=o.answer.length<1})})}async function qp(e){const t=new URL(window.location.href);t.searchParams.set("src","db"),t.searchParams.set("db",e),window.location.href=t.toString()}async function Gp(){const e=await ln.GetFromAll("project","info");return Wp.list.length=0,Wp.list.push(...e.filter(e=>void 0!==e).map(e=>(e.uid=e.id,e))),Wp.list}const Wp=(0,r.reactive)({init:async function(e){console.log(e),zp=e},create:async function(){const e=await Hp();e&&qp(e)},createProject:Hp,open:async function(){const e=await Gp(),t=(0,r.reactive)({list:e.filter(e=>e.uid!==Fp.project.uid)});Ni.open({header:{value:"Open project",handler:Ni.close},content:{component:"ItemsLib",props:t,events:{selected:e=>{qp(e.id),Ni.close()}},slots:{item:{component:"ProjectItem"}}},footer:{buttons:[{label:"Close",class:"primary",handler:Ni.close}]}})},goto:qp,remove:async function(e){console.log(e);const t=e||zp;console.log(t),await ln.DeleteDatabase(t),console.log("Removed");const o=Wp.list.findIndex(e=>e.uid===t);o>=0&&Wp.list.splice(o,1),window.location.href=new URL(`${window.location.origin}${window.location.pathname}`).toString()},getList:Gp,loadExample:async function(e){const t=(await Up[e]()).default,o=`project${e}`;await ln.Init(o,["project","assets","models","slides","actions","modules"],"uid"),await ln.addItems("actions",t.actions),await ln.addItems("assets",t.assets),await ln.addItems("models",t.models),await ln.addItems("modules",t.modules),await ln.addItems("project",t.project),await ln.addItems("slides",t.slides);const n=new URL(window.location.href);n.searchParams.set("project",o),window.location.href=n.toString()},play:async function(e="data"){const t=await ln.exportToJson(zp);console.log(t),t.project={ui:{slides:!0,fullscreen:!0}};let o=`../player?target=${e}`;"src"===e&&(o+=`&src=${zp}`);const n=window.open(o,"Player");if(n){if("data"===e){const e=async(o=0)=>{try{if(n.closed)return void console.error("Окно плеера было закрыто");n.postMessage({type:"INIT_DATA",payload:t},window.location.origin),console.log("Данные отправлены")}catch(t){console.error("Ошибка при отправке данных:",t),o<5&&setTimeout(()=>e(o+1),500*(o+1))}};setTimeout(e,1e3)}}else console.error("Не удалось открыть окно. Возможно, браузер заблокировал pop-up.")},importProject:async function(){try{const e=await function(e=".json"){return new Promise(t=>{const o=document.createElement("input");o.type="file",o.accept=e,o.style.display="none",o.addEventListener("change",()=>{o.files&&o.files[0]&&t(o.files[0]),document.body.removeChild(o)}),document.body.appendChild(o),o.click()})}(),t=await function(e){return new Promise((t,o)=>{if(!e.name.endsWith(".json"))return void o(new Error("Выберите файл с расширением .json"));const n=new FileReader;n.onload=e=>{try{const o=JSON.parse(e.target.result);t(o)}catch(e){o(new Error("Ошибка парсинга JSON: "+e.message))}},n.onerror=()=>{o(new Error("Ошибка чтения файла"))},n.readAsText(e)})}(e);let o=!1;const n=(0,r.reactive)({actions:{},assets:{},elements:{},slides:{},modules:{}});return Ni.open({header:{value:"Импорт",handler:()=>{Ni.close()}},content:{component:"Importer",props:{project:t},events:{options:e=>{o=e.merge},changelist:e=>{Object.keys(e).forEach(t=>{n[t]=e[t]})}}},footer:{buttons:[{label:"Импорт",class:"secondary",handler:async()=>{const e=`project${Date.now()}`;await ln.Init(e,["project","assets","elements","slides","actions","modules"],"uid"),await ln.addItems("actions",t.actions),await ln.addItems("assets",t.assets),await ln.addItems("elements",t.elements),await ln.addItems("slides",t.slides),await ln.addItems("modules",t.modules),await ln.addItems("project",t.project);const o=new URL(window.location.href);o.searchParams.set("project",e),window.location.href=o.toString(),Ni.close()}},{label:"Отмена",class:"primary",handler:async()=>{Ni.close()}}]}}),t}catch(e){throw console.error("Ошибка:",e.message),e}},load:async function(){},player:null,list:[]}),Kp=Wp,Yp=(0,r.reactive)({uid:"",selected:null,Control:no,slide:{},select(e){if(!e)return Yp.selected=null,Yp.uid=null,void no.Select(null);e.nonSelect||(Yp.selected=e,Yp.uid=e.uid),e.isObject3D&&no.Select(e)}}),Jp=Yp,Xp=wo.default.default||wo.default,Zp=new class{#e=null;get handle(){return this.#e}async requestAccess(){this.#e=await window.showDirectoryPicker({mode:"readwrite"}),await ln.upsertItemProperties("project","storage",{handle:this.#e})}updateHandle(e){this.#e=e}async writeFile(e,t){this.#t();const o=await this.#e.getFileHandle(e,{create:!0}),n=await o.createWritable();await n.write(t),await n.close()}async readFile(e){this.#t();const t=await this.#e.getFileHandle(e),o=await t.getFile();return await o.text()}async listFiles(){this.#t();const e=[];for await(const[t,o]of this.#e.entries())"file"===o.kind&&e.push(t);return e}#t(){if(!this.#e)throw new Error("Folder access not granted")}};let Qp;const eu=(0,r.reactive)({getHandle:()=>Zp.handle,init:async function(){const e=await ln.getItem("project","storage");if(e)Zp.updateHandle(e.handle);else{const e=(0,r.reactive)({title:"Укажите папку для хранения моделей",text:"",answer:"",template:""}),t=(0,r.reactive)({label:"ОК",class:"primary",callback:async e=>{await Zp.requestAccess(),Qp&&Qp()}});Xp.modal.confirmReq(e,[t])}},requestAccess:Zp.requestAccess.bind(Zp),writeFile:Zp.writeFile.bind(Zp),readFile:Zp.readFile.bind(Zp),listFiles:Zp.listFiles.bind(Zp),access:()=>new Promise(e=>{Qp=e})}),tu={class:"itemElement"},ou={class:"itemrow"},nu={class:"itemrow"},au={class:"itemrow"},ru={props:{item:{type:Object}}},su=(0,B.A)(ru,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",tu,[(0,r.createElementVNode)("div",ou,(0,r.toDisplayString)(o.item.title),1),(0,r.createElementVNode)("div",nu,(0,r.toDisplayString)(o.item.price),1),(0,r.createElementVNode)("div",au,(0,r.toDisplayString)(o.item.autor?.name),1)])}]]),lu={class:"product-card"},iu={class:"product-title"},cu={key:0,class:"card-section"},du={class:"card-value"},pu={class:"card-section"},uu={class:"card-image"},mu=["src","alt"],hu={class:"card-section"},fu={key:0,class:"carousel"},vu={class:"carousel-container"},gu=["src","onClick","alt"],yu={class:"card-section"},bu={class:"card-value"},ku=["href"],wu={key:1,class:"card-section"},Eu={class:"card-value"},_u=(0,r.defineComponent)({name:"ProductCard",props:{selected:{type:Object,required:!0,validator:e=>!0}},computed:{data(){return this.selected}},data:()=>({img:0}),setup:e=>({formattedPrice:(0,r.computed)(()=>void 0===e.selected.price||null===e.selected.price?"Цена не указана":new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(e.selected.price))}),methods:{onImageClick(e){this.img=e}}}),Su=(0,B.A)(_u,[["render",function(e,t,o,n,a,s){return(0,r.openBlock)(),(0,r.createElementBlock)("div",lu,[(0,r.createCommentVNode)(" Заголовок "),(0,r.createElementVNode)("h2",iu,(0,r.toDisplayString)(e.data.title),1),e.data.description?((0,r.openBlock)(),(0,r.createElementBlock)("div",cu,[(0,r.createElementVNode)("span",du,(0,r.toDisplayString)(e.data.description),1)])):(0,r.createCommentVNode)("v-if",!0),(0,r.createCommentVNode)(" Основное изображение "),(0,r.createElementVNode)("div",pu,[(0,r.createElementVNode)("div",uu,[e.data.images&&e.data.images.length?((0,r.openBlock)(),(0,r.createElementBlock)("img",{key:0,src:e.data.images[e.img],alt:e.data.title,class:"image-preview"},null,8,mu)):(0,r.createCommentVNode)("v-if",!0)])]),(0,r.createCommentVNode)(" Карусель изображений "),(0,r.createElementVNode)("div",hu,[e.data.images&&e.data.images.length?((0,r.openBlock)(),(0,r.createElementBlock)("div",fu,[(0,r.createElementVNode)("div",vu,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(e.data.images,(t,o)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",{key:o,class:"carousel-item"},[(0,r.createElementVNode)("img",{src:t,onClick:t=>e.onImageClick(o),alt:`${e.data.title} - изображение ${o+1}`,class:"carousel-image"},null,8,gu)]))),128))])])):(0,r.createCommentVNode)("v-if",!0)]),(0,r.createElementVNode)("div",yu,[t[0]||(t[0]=(0,r.createElementVNode)("span",{class:"card-label"},null,-1)),(0,r.createElementVNode)("span",bu,[(0,r.createElementVNode)("a",{href:"../player?src=url&url="+e.data.url,target:"_blank"},"Preview",8,ku)])]),(0,r.createCommentVNode)(" Цена "),(0,r.createCommentVNode)(' <div class="card-section">\r\n            <span class="card-label">Price:</span>\r\n            <span class="card-value">{{ formattedPrice }}</span>\r\n        </div> '),(0,r.createCommentVNode)(" Автор "),e.data.autor?((0,r.openBlock)(),(0,r.createElementBlock)("div",wu,[t[1]||(t[1]=(0,r.createElementVNode)("span",{class:"card-label"},"Autor:",-1)),(0,r.createElementVNode)("span",Eu,(0,r.toDisplayString)(e.data.autor.name),1)])):(0,r.createCommentVNode)("v-if",!0)])}],["__scopeId","data-v-73ea6e84"]]),Nu=wo.default.default||wo.default;async function Vu(){const[e,t]=await Promise.all([fetch("https://s3.eu-west-1.amazonaws.com/3dbuilder.reneos.com/templates/index.json",{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},cache:"no-store"}).then(e=>e.json()),Nu.app.GetDB().getAllItems("templates")]);return[...e,...t]}const Cu=(0,r.reactive)({loadList:Vu});Nu.On("init",()=>{window.vue.component("TemplateItem",su),window.vue.component("TemplateView",Su),Nu.menu.add([{path:"app.libraries.templates",icon:"codepen",text:"Templates",handler:async()=>{!async function(){const e=(0,r.reactive)({selected:null,list:[],busy:!0}),t={label:"Close",class:"secondary",handler:async()=>{e.selected=null,Nu.modal.close()}},o={label:"Use",class:"additional",hidden:(0,r.computed)(()=>!e.selected),handler:async()=>{const t=await fetch(e.selected.url,{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"},cache:"no-store"}),o=await t.json(),n=await Nu.projects.createProject(o);Nu.projects.goto(n)}},n=(0,r.reactive)([o,t]);Nu.modal.open({header:{value:"Templates",handler:()=>{Nu.modal.close()}},content:{component:"ItemsLib",props:e,events:{selected:async t=>{e.selected=t},open:async()=>{e.list.length=0,e.busy=!0;try{const t=await Vu();e.list.push(...t)}catch(e){}e.busy=!1}},slots:{item:{component:"TemplateItem"},edit:{component:"TemplateView",props:{data:e.selected},events:{"change:type":t=>{const o=Cu.library.find(e=>e.component===t);e.selected={...o.template,type:o.component,group:o.type,description:o.description}},edit:(t,o)=>{const n=t.split(".");let a=e.selected;for(let e=0;e<n.length-1;e++){const t=n[e];a[t]||(a[t]={}),a=a[t]}a[n[n.length-1]]=o,save(e.selected)}}}}},footer:{buttons:n}})}()}}])});const Bu=Cu,{setLanguage:$u,setTranslations:xu,getCurrentLanguage:Du,updateTranslations:Tu}=(wo.default.default||wo.default,It),Iu={ru:[],en:[]};async function Au(e){const t=await fetch(`contents/${e}.json`),o=await t.json();xu(e,o);for(let t=0;t<Iu[e].length;t++){const o=await fetch(Iu[e][t]),n=await o.json();Tu(e,n)}$u(e),Mu.lang=e}const Mu=(0,r.reactive)({init:async function(e="en"){await Au(e)},addTranslations:async function(e,t){if(Iu[e].push(t),e===Du()){const o=await fetch(t),n=await o.json();Tu(e,n)}},change:Au,languages:[{label:"English",value:"en"},{label:"Русский",value:"ru"}],lang:"en"}),Ou=Mu,ju=wo.default.default||wo.default,Pu={},Lu=(0,r.reactive)({elements:[],onElementMount(e){Pu[e.path]&&(Pu[e.path](e.element),delete Pu[e.path])},addElement(e,t){return console.log(e),new Promise((o,n)=>{if(!window.vue._context.components[e])return ju.toasts.add({message:`Component "${e}" is not registered`}),void n(new Error(`Component "${e}" is not registered`));const a=(0,r.reactive)(t.data),s={component:e,data:a,events:t.events};this.elements.push(s),Pu[t.data.path]=e=>{s.element=e,o({data:a,element:e})}})},removeElement(e){const t=this.elements.findIndex(t=>t.element===e);t>=0&&this.elements.splice(t,1)}});ju.On("init",()=>{Lu.elements.length=0});const Ru=Lu,Fu=wo.default.default||wo.default;console.log=()=>{};const Uu=window.vue=(0,r.createApp)(pn);Uu.config.errorHandler=(e,t,o)=>{if(console.error("Vue 3 Error:",e),console.error("Component:",t),console.error("Where:",o),console.group("🔍 Vue 3 Error Debug"),console.error("Error:",e),t){console.error("Component name:",t.$options.name||"Anonymous"),console.error("Component file:",t.$options.__file||"Unknown"),console.error("Component props:",t.$props),console.error("Component data:",t.$data),console.error("Component $el:",t.$el);const e=[];let o=t.$parent;for(;o;)e.push(o.$options.name||"Anonymous"),o=o.$parent;console.error("Parent chain:",e.reverse())}console.error("Hook/method:",o),console.error("Error stack:",e.stack),console.groupEnd()},window.addEventListener("error",e=>{console.error("Global Error:",e.error)}),window.addEventListener("unhandledrejection",e=>{console.error("Unhandled Promise Rejection:",e.reason)}),Uu.use(e=>{e.config.globalProperties.$app=Fu.Init(a)}),Object.keys(n).forEach(e=>{Uu.component(e,n[e])}),Uu.provide("globalComponents",Uu._context.components),Uu.directive("tooltip",jt),Uu.directive("translate",It.directive),Uu.mount("#app"),window.isEditor=!0},615:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Al:()=>getResourceUrl,Bb:()=>isDebugMode,Jn:()=>generateSnapshotFromManifest,ML:()=>safeToString,OL:()=>isBrowserEnv,R8:()=>warn,Tr:()=>isManifestProvider,d:()=>createLink,e4:()=>decodeName,h:()=>createLogger,k0:()=>loadScript,lG:()=>composeKeyWithSeparator,oe:()=>loadScriptNode,so:()=>createScript,tf:()=>isReactNativeEnv,yq:()=>ENCODE_NAME_PREFIX});const FederationModuleManifest="federation-manifest.json",MANIFEST_EXT=".json",BROWSER_LOG_KEY="FEDERATION_DEBUG",NameTransformSymbol={AT:"@",HYPHEN:"-",SLASH:"/"},NameTransformMap={[NameTransformSymbol.AT]:"scope_",[NameTransformSymbol.HYPHEN]:"_",[NameTransformSymbol.SLASH]:"__"},EncodedNameTransformMap={[NameTransformMap[NameTransformSymbol.AT]]:NameTransformSymbol.AT,[NameTransformMap[NameTransformSymbol.HYPHEN]]:NameTransformSymbol.HYPHEN,[NameTransformMap[NameTransformSymbol.SLASH]]:NameTransformSymbol.SLASH},SEPARATOR=":",ManifestFileName="mf-manifest.json",StatsFileName="mf-stats.json",MFModuleType={NPM:"npm",APP:"app"},MODULE_DEVTOOL_IDENTIFIER="__MF_DEVTOOLS_MODULE_INFO__",ENCODE_NAME_PREFIX="ENCODE_NAME_PREFIX",TEMP_DIR=".federation",MFPrefetchCommon={identifier:"MFDataPrefetch",globalKey:"__PREFETCH__",library:"mf-data-prefetch",exportsKey:"__PREFETCH_EXPORTS__",fileName:"bootstrap.js"};var ContainerPlugin=Object.freeze({__proto__:null}),ContainerReferencePlugin=Object.freeze({__proto__:null}),ModuleFederationPlugin=Object.freeze({__proto__:null}),SharePlugin=Object.freeze({__proto__:null});function isBrowserEnv(){return"undefined"!=typeof window&&void 0!==window.document}function isReactNativeEnv(){return"undefined"!=typeof navigator&&"ReactNative"===navigator?.product}function isBrowserDebug(){try{if(isBrowserEnv()&&window.localStorage)return Boolean(localStorage.getItem(BROWSER_LOG_KEY))}catch(e){return!1}return!1}function isDebugMode(){return"undefined"!=typeof process&&process.env&&process.env.FEDERATION_DEBUG?Boolean(process.env.FEDERATION_DEBUG):!("undefined"==typeof FEDERATION_DEBUG||!Boolean(FEDERATION_DEBUG))||isBrowserDebug()}const getProcessEnv=function(){return"undefined"!=typeof process&&process.env?process.env:{}},LOG_CATEGORY="[ Federation Runtime ]",parseEntry=(e,t,o=SEPARATOR)=>{const n=e.split(o),a="development"===getProcessEnv().NODE_ENV&&t,r=e=>e.startsWith("http")||e.includes(MANIFEST_EXT);if(n.length>=2){let[t,...s]=n;e.startsWith(o)&&(t=n.slice(0,2).join(o),s=[a||n.slice(2).join(o)]);let l=a||s.join(o);return r(l)?{name:t,entry:l}:{name:t,version:l||"*"}}if(1===n.length){const[e]=n;return a&&r(a)?{name:e,entry:a}:{name:e,version:a||"*"}}throw`Invalid entry value: ${e}`},composeKeyWithSeparator=function(...e){return e.length?e.reduce((e,t)=>t?e?`${e}${SEPARATOR}${t}`:t:e,""):""},encodeName=function(e,t="",o=!1){try{const n=o?".js":"";return`${t}${e.replace(new RegExp(`${NameTransformSymbol.AT}`,"g"),NameTransformMap[NameTransformSymbol.AT]).replace(new RegExp(`${NameTransformSymbol.HYPHEN}`,"g"),NameTransformMap[NameTransformSymbol.HYPHEN]).replace(new RegExp(`${NameTransformSymbol.SLASH}`,"g"),NameTransformMap[NameTransformSymbol.SLASH])}${n}`}catch(e){throw e}},decodeName=function(e,t,o){try{let n=e;if(t){if(!n.startsWith(t))return n;n=n.replace(new RegExp(t,"g"),"")}return n=n.replace(new RegExp(`${NameTransformMap[NameTransformSymbol.AT]}`,"g"),EncodedNameTransformMap[NameTransformMap[NameTransformSymbol.AT]]).replace(new RegExp(`${NameTransformMap[NameTransformSymbol.SLASH]}`,"g"),EncodedNameTransformMap[NameTransformMap[NameTransformSymbol.SLASH]]).replace(new RegExp(`${NameTransformMap[NameTransformSymbol.HYPHEN]}`,"g"),EncodedNameTransformMap[NameTransformMap[NameTransformSymbol.HYPHEN]]),o&&(n=n.replace(".js","")),n}catch(e){throw e}},generateExposeFilename=(e,t)=>{if(!e)return"";let o=e;return"."===o&&(o="default_export"),o.startsWith("./")&&(o=o.replace("./","")),encodeName(o,"__federation_expose_",t)},generateShareFilename=(e,t)=>e?encodeName(e,"__federation_shared_",t):"",getResourceUrl=(e,t)=>{if("getPublicPath"in e){let o;return o=e.getPublicPath.startsWith("function")?new Function("return "+e.getPublicPath)()():new Function(e.getPublicPath)(),`${o}${t}`}return"publicPath"in e?isBrowserEnv()||isReactNativeEnv()||!("ssrPublicPath"in e)?`${e.publicPath}${t}`:`${e.ssrPublicPath}${t}`:(console.warn("Cannot get resource URL. If in debug mode, please ignore.",e,t),"")},assert=(e,t)=>{e||error(t)},error=e=>{throw new Error(`${LOG_CATEGORY}: ${e}`)},warn=e=>{console.warn(`${LOG_CATEGORY}: ${e}`)};function safeToString(e){try{return JSON.stringify(e,null,2)}catch(e){return""}}const VERSION_PATTERN_REGEXP=/^([\d^=v<>~]|[*xX]$)/;function isRequiredVersion(e){return VERSION_PATTERN_REGEXP.test(e)}const simpleJoinRemoteEntry=(e,t)=>{if(!e)return t;const o=(e=>{if("."===e)return"";if(e.startsWith("./"))return e.replace("./","");if(e.startsWith("/")){const t=e.slice(1);return t.endsWith("/")?t.slice(0,-1):t}return e})(e);return o?o.endsWith("/")?`${o}${t}`:`${o}/${t}`:t};function inferAutoPublicPath(e){return e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/")}function generateSnapshotFromManifest(e,t={}){const{remotes:o={},overrides:n={},version:a}=t;let r;const s=()=>"publicPath"in e.metaData?"auto"===e.metaData.publicPath&&a?inferAutoPublicPath(a):e.metaData.publicPath:e.metaData.getPublicPath,l=Object.keys(n);let i={};Object.keys(o).length||(i=e.remotes?.reduce((e,t)=>{let o;const a=t.federationContainerName;return o=l.includes(a)?n[a]:"version"in t?t.version:t.entry,e[a]={matchedVersion:o},e},{})||{}),Object.keys(o).forEach(e=>i[e]={matchedVersion:l.includes(e)?n[e]:o[e]});const{remoteEntry:{path:c,name:d,type:p},types:u,buildInfo:{buildVersion:m},globalName:h,ssrRemoteEntry:f}=e.metaData,{exposes:v}=e;let g={version:a||"",buildVersion:m,globalName:h,remoteEntry:simpleJoinRemoteEntry(c,d),remoteEntryType:p,remoteTypes:simpleJoinRemoteEntry(u.path,u.name),remoteTypesZip:u.zip||"",remoteTypesAPI:u.api||"",remotesInfo:i,shared:e?.shared.map(e=>({assets:e.assets,sharedName:e.name,version:e.version})),modules:v?.map(e=>({moduleName:e.name,modulePath:e.path,assets:e.assets}))};if(e.metaData?.prefetchInterface){const t=e.metaData.prefetchInterface;g={...g,prefetchInterface:t}}if(e.metaData?.prefetchEntry){const{path:t,name:o,type:n}=e.metaData.prefetchEntry;g={...g,prefetchEntry:simpleJoinRemoteEntry(t,o),prefetchEntryType:n}}if(r="publicPath"in e.metaData?{...g,publicPath:s(),ssrPublicPath:e.metaData.ssrPublicPath}:{...g,getPublicPath:s()},f){const e=simpleJoinRemoteEntry(f.path,f.name);r.ssrRemoteEntry=e,r.ssrRemoteEntryType=f.type||"commonjs-module"}return r}function isManifestProvider(e){return!(!("remoteEntry"in e)||!e.remoteEntry.includes(MANIFEST_EXT))}const PREFIX="[ Module Federation ]",DEFAULT_DELEGATE=console,LOGGER_STACK_SKIP_TOKENS=["logger.ts","logger.js","captureStackTrace","Logger.emit","Logger.log","Logger.info","Logger.warn","Logger.error","Logger.debug"];function captureStackTrace(){try{const e=(new Error).stack;if(!e)return;const[,...t]=e.split("\n"),o=t.filter(e=>!LOGGER_STACK_SKIP_TOKENS.some(t=>e.includes(t)));if(!o.length)return;return`Stack trace:\n${o.slice(0,5).join("\n")}`}catch{return}}class Logger{constructor(e,t=DEFAULT_DELEGATE){this.prefix=e,this.delegate=t??DEFAULT_DELEGATE}setPrefix(e){this.prefix=e}setDelegate(e){this.delegate=e??DEFAULT_DELEGATE}emit(e,t){const o=this.delegate,n=isDebugMode()?captureStackTrace():void 0,a=n?[...t,n]:t,r=(()=>{switch(e){case"log":return["log","info"];case"info":return["info","log"];case"warn":return["warn","info","log"];case"error":return["error","warn","log"];default:return["debug","log"]}})();for(const e of r){const t=o[e];if("function"==typeof t)return void t.call(o,this.prefix,...a)}for(const e of r){const t=DEFAULT_DELEGATE[e];if("function"==typeof t)return void t.call(DEFAULT_DELEGATE,this.prefix,...a)}}log(...e){this.emit("log",e)}warn(...e){this.emit("warn",e)}error(...e){this.emit("error",e)}success(...e){this.emit("info",e)}info(...e){this.emit("info",e)}ready(...e){this.emit("info",e)}debug(...e){isDebugMode()&&this.emit("debug",e)}}function createLogger(e){return new Logger(e)}function createInfrastructureLogger(e){const t=new Logger(e);return Object.defineProperty(t,"__mf_infrastructure_logger__",{value:!0,enumerable:!1,configurable:!1}),t}function bindLoggerToCompiler(e,t,o){if(e.__mf_infrastructure_logger__&&t?.getInfrastructureLogger)try{const n=t.getInfrastructureLogger(o);!n||"object"!=typeof n||"function"!=typeof n.log&&"function"!=typeof n.info&&"function"!=typeof n.warn&&"function"!=typeof n.error||e.setDelegate(n)}catch{e.setDelegate(void 0)}}const logger=createLogger(PREFIX),infrastructureLogger=createInfrastructureLogger(PREFIX);async function safeWrapper(e,t){try{return await e()}catch(e){return void(!t&&warn(e))}}function isStaticResourcesEqual(e,t){const o=/^(https?:)?\/\//i;return e.replace(o,"").replace(/\/$/,"")===t.replace(o,"").replace(/\/$/,"")}function createScript(e){let t,o=null,n=!0,a=2e4;const r=document.getElementsByTagName("script");for(let t=0;t<r.length;t++){const a=r[t],s=a.getAttribute("src");if(s&&isStaticResourcesEqual(s,e.url)){o=a,n=!1;break}}if(!o){const t=e.attrs;let n;o=document.createElement("script"),o.type="module"===t?.type?"module":"text/javascript",e.createScriptHook&&(n=e.createScriptHook(e.url,e.attrs),n instanceof HTMLScriptElement?o=n:"object"==typeof n&&("script"in n&&n.script&&(o=n.script),"timeout"in n&&n.timeout&&(a=n.timeout))),o.src||(o.src=e.url),t&&!n&&Object.keys(t).forEach(e=>{o&&("async"===e||"defer"===e?o[e]=t[e]:o.getAttribute(e)||o.setAttribute(e,t[e]))})}const s=async(n,a)=>{clearTimeout(t);const r=()=>{"error"===a?.type?e?.onErrorCallback&&e?.onErrorCallback(a):e?.cb&&e?.cb()};if(o&&(o.onerror=null,o.onload=null,safeWrapper(()=>{const{needDeleteScript:t=!0}=e;t&&o?.parentNode&&o.parentNode.removeChild(o)}),n&&"function"==typeof n)){const e=n(a);if(e instanceof Promise){const t=await e;return r(),t}return r(),e}r()};return o.onerror=s.bind(null,o.onerror),o.onload=s.bind(null,o.onload),t=setTimeout(()=>{s(null,new Error(`Remote script "${e.url}" time-outed.`))},a),{script:o,needAttach:n}}function createLink(e){let t=null,o=!0;const n=document.getElementsByTagName("link");for(let a=0;a<n.length;a++){const r=n[a],s=r.getAttribute("href"),l=r.getAttribute("rel");if(s&&isStaticResourcesEqual(s,e.url)&&l===e.attrs.rel){t=r,o=!1;break}}if(!t){let o;t=document.createElement("link"),t.setAttribute("href",e.url);const n=e.attrs;e.createLinkHook&&(o=e.createLinkHook(e.url,n),o instanceof HTMLLinkElement&&(t=o)),n&&!o&&Object.keys(n).forEach(e=>{t&&!t.getAttribute(e)&&t.setAttribute(e,n[e])})}const a=(o,n)=>{const a=()=>{"error"===n?.type?e?.onErrorCallback&&e?.onErrorCallback(n):e?.cb&&e?.cb()};if(t&&(t.onerror=null,t.onload=null,safeWrapper(()=>{const{needDeleteLink:o=!0}=e;o&&t?.parentNode&&t.parentNode.removeChild(t)}),o)){const e=o(n);return a(),e}a()};return t.onerror=a.bind(null,t.onerror),t.onload=a.bind(null,t.onload),{link:t,needAttach:o}}function loadScript(e,t){const{attrs:o={},createScriptHook:n}=t;return new Promise((t,a)=>{const{script:r,needAttach:s}=createScript({url:e,cb:t,onErrorCallback:a,attrs:{fetchpriority:"high",...o},createScriptHook:n,needDeleteScript:!0});s&&document.head.appendChild(r)})}const sdkImportCache=new Map;function importNodeModule(e){if(!e)throw new Error("import specifier is required");if(sdkImportCache.has(e))return sdkImportCache.get(e);const t=new Function("name","return import(name)")(e).then(e=>e).catch(t=>{throw console.error(`Error importing module ${e}:`,t),sdkImportCache.delete(e),t});return sdkImportCache.set(e,t),t}const loadNodeFetch=async()=>{const e=await importNodeModule("node-fetch");return e.default||e},lazyLoaderHookFetch=async(e,t,o)=>{const n=await((e,t)=>o.lifecycle.fetch.emit(e,t))(e,t||{});return n&&n instanceof Response?n:("undefined"==typeof fetch?await loadNodeFetch():fetch)(e,t||{})},createScriptNode="undefined"==typeof ENV_TARGET||"web"!==ENV_TARGET?(url,cb,attrs,loaderHook)=>{if(loaderHook?.createScriptHook){const e=loaderHook.createScriptHook(url);e&&"object"==typeof e&&"url"in e&&(url=e.url)}let urlObj;try{urlObj=new URL(url)}catch(e){return console.error("Error constructing URL:",e),void cb(new Error(`Invalid URL: ${e}`))}const getFetch=async()=>loaderHook?.fetch?(e,t)=>lazyLoaderHookFetch(e,t,loaderHook):"undefined"==typeof fetch?loadNodeFetch():fetch,handleScriptFetch=async(f,urlObj)=>{try{const res=await f(urlObj.href),data=await res.text(),[path,vm]=await Promise.all([importNodeModule("path"),importNodeModule("vm")]),scriptContext={exports:{},module:{exports:{}}},urlDirname=urlObj.pathname.split("/").slice(0,-1).join("/"),filename=path.basename(urlObj.pathname),script=new vm.Script(`(function(exports, module, require, __dirname, __filename) {${data}\n})`,{filename,importModuleDynamically:vm.constants?.USE_MAIN_CONTEXT_DEFAULT_LOADER??importNodeModule});script.runInThisContext()(scriptContext.exports,scriptContext.module,eval("require"),urlDirname,filename);const exportedInterface=scriptContext.module.exports||scriptContext.exports;if(attrs&&exportedInterface&&attrs.globalName){const e=exportedInterface[attrs.globalName]||exportedInterface;return void cb(void 0,e)}cb(void 0,exportedInterface)}catch(e){cb(e instanceof Error?e:new Error(`Script execution error: ${e}`))}};getFetch().then(async e=>{if("esm"===attrs?.type||"module"===attrs?.type)return loadModule(urlObj.href,{fetch:e,vm:await importNodeModule("vm")}).then(async e=>{await e.evaluate(),cb(void 0,e.namespace)}).catch(e=>{cb(e instanceof Error?e:new Error(`Script execution error: ${e}`))});handleScriptFetch(e,urlObj)}).catch(e=>{cb(e)})}:(e,t,o,n)=>{t(new Error("createScriptNode is disabled in non-Node.js environment"))},loadScriptNode="undefined"==typeof ENV_TARGET||"web"!==ENV_TARGET?(e,t)=>new Promise((o,n)=>{createScriptNode(e,(e,a)=>{if(e)n(e);else{const e=globalThis[t?.attrs?.globalName||`__FEDERATION_${t?.attrs?.name}:custom__`]=a;o(e)}},t.attrs,t.loaderHook)}):(e,t)=>{throw new Error("loadScriptNode is disabled in non-Node.js environment")},esmModuleCache=new Map;async function loadModule(e,t){if(esmModuleCache.has(e))return esmModuleCache.get(e);const{fetch:o,vm:n}=t,a=await o(e),r=await a.text(),s=new n.SourceTextModule(r,{importModuleDynamically:async(o,n)=>loadModule(new URL(o,e).href,t)});return esmModuleCache.set(e,s),await s.link(async o=>{const n=new URL(o,e).href;return await loadModule(n,t)}),s}function normalizeOptions(e,t,o){return function(n){if(!1===n)return!1;if(void 0===n)return!!e&&t;if(!0===n)return t;if(n&&"object"==typeof n)return{...t,...n};throw new Error(`Unexpected type for \`${o}\`, expect boolean/undefined/object, got: ${typeof n}`)}}const createModuleFederationConfig=e=>e},828:(e,t,o)=>{o.r(t),o.d(t,{Module:()=>Ye,ModuleFederation:()=>pt,createInstance:()=>ut,getInstance:()=>wt,getRemoteEntry:()=>qe,getRemoteInfo:()=>Ge,init:()=>ht,loadRemote:()=>ft,loadScript:()=>n.k0,loadScriptNode:()=>n.oe,loadShare:()=>vt,loadShareSync:()=>gt,preloadRemote:()=>yt,registerGlobalPlugins:()=>R,registerPlugins:()=>kt,registerRemotes:()=>bt,registerShared:()=>Et});var n=o(615);const a="RUNTIME-001",r="RUNTIME-002",s="RUNTIME-003",l="RUNTIME-004",i="RUNTIME-005",c="RUNTIME-006",d="RUNTIME-007",p="RUNTIME-008",u="RUNTIME-009",m=(e,t,o,n)=>{const a=[`${[t[e]]} #${e}`];return o&&a.push(`args: ${JSON.stringify(o)}`),a.push((e=>`View the docs to see how to solve: https://module-federation.io/guide/troubleshooting/${e.split("-")[0].toLowerCase()}/${e}`)(e)),n&&a.push(`Original Error Message:\n ${n}`),a.join("\n")},h={[a]:"Failed to get remoteEntry exports.",[r]:'The remote entry interface does not contain "init"',[s]:"Failed to get manifest.",[l]:"Failed to locate remote.",[i]:"Invalid loadShareSync function call from bundler runtime",[c]:"Invalid loadShareSync function call from runtime",[d]:"Failed to get remote snapshot.",[p]:"Failed to load script resources.",[u]:"Please call createInstance first."},f="[ Federation Runtime ]",v=(0,n.h)(f);function g(e,t){e||y(t)}function y(e){if(e instanceof Error)throw e.message.startsWith(f)||(e.message=`${f}: ${e.message}`),e;throw new Error(`${f}: ${e}`)}function b(e){e instanceof Error?(e.message.startsWith(f)||(e.message=`${f}: ${e.message}`),v.warn(e)):v.warn(e)}function k(e,t){return-1===e.findIndex(e=>e===t)&&e.push(t),e}function w(e){return"version"in e&&e.version?`${e.name}:${e.version}`:"entry"in e&&e.entry?`${e.name}:${e.entry}`:`${e.name}`}function E(e){return void 0!==e.entry}function _(e){return!e.entry.includes(".json")}function S(e){return e&&"object"==typeof e}const N=Object.prototype.toString;function V(e){return Array.isArray(e)?e:[e]}function C(e){const t={url:"",type:"global",globalName:""};return(0,n.OL)()||(0,n.tf)()?"remoteEntry"in e?{url:e.remoteEntry,type:e.remoteEntryType,globalName:e.globalName}:t:"ssrRemoteEntry"in e?{url:e.ssrRemoteEntry||t.url,type:e.ssrRemoteEntryType||t.type,globalName:e.globalName}:t}const B="object"==typeof globalThis?globalThis:window,$=(()=>{try{return document.defaultView}catch{return B}})(),x=$;function D(e,t,o){Object.defineProperty(e,t,{value:o,configurable:!1,writable:!0})}function T(e,t){return Object.hasOwnProperty.call(e,t)}T(B,"__GLOBAL_LOADING_REMOTE_ENTRY__")||D(B,"__GLOBAL_LOADING_REMOTE_ENTRY__",{});const I=B.__GLOBAL_LOADING_REMOTE_ENTRY__;function A(e){T(e,"__VMOK__")&&!T(e,"__FEDERATION__")&&D(e,"__FEDERATION__",e.__VMOK__),T(e,"__FEDERATION__")||(D(e,"__FEDERATION__",{__GLOBAL_PLUGIN__:[],__INSTANCES__:[],moduleInfo:{},__SHARE__:{},__MANIFEST_LOADING__:{},__PRELOADED_MAP__:new Map}),D(e,"__VMOK__",e.__FEDERATION__)),e.__FEDERATION__.__GLOBAL_PLUGIN__??=[],e.__FEDERATION__.__INSTANCES__??=[],e.__FEDERATION__.moduleInfo??={},e.__FEDERATION__.__SHARE__??={},e.__FEDERATION__.__MANIFEST_LOADING__??={},e.__FEDERATION__.__PRELOADED_MAP__??=new Map}function M(e,t){if("string"==typeof t){if(e[t])return{value:e[t],key:t};{const o=Object.keys(e);for(const n of o){const[o,a]=n.split(":"),r=`${o}:${t}`,s=e[r];if(s)return{value:s,key:r}}return{value:void 0,key:t}}}throw new Error("key must be string")}A(B),A($);const O=()=>$.__FEDERATION__.moduleInfo,j=e=>((e,t)=>{const o=M(t,w(e)).value;if(o&&!o.version&&"version"in e&&e.version&&(o.version=e.version),o)return o;if("version"in e&&e.version){const{version:t,...o}=e,n=w(o),a=M($.__FEDERATION__.moduleInfo,n).value;if(a?.version===t)return a}})(e,$.__FEDERATION__.moduleInfo),P=(e,t)=>{const o=w(e);return $.__FEDERATION__.moduleInfo[o]=t,$.__FEDERATION__.moduleInfo},L=(e,t)=>{const o=t||`__FEDERATION_${e}:custom__`;return{remoteEntryKey:o,entryExports:B[o]}},R=e=>{const{__GLOBAL_PLUGIN__:t}=$.__FEDERATION__;e.forEach(e=>{-1===t.findIndex(t=>t.name===e.name)?t.push(e):b(`The plugin ${e.name} has been registered.`)})},F=e=>B.__FEDERATION__.__PRELOADED_MAP__.get(e),U=e=>B.__FEDERATION__.__PRELOADED_MAP__.set(e,!0),z="default",H="global",q="[0-9A-Za-z-]+",G=`(?:\\+(${q}(?:\\.${q})*))`,W="0|[1-9]\\d*",K="[0-9]+",Y="\\d*[a-zA-Z-][a-zA-Z0-9-]*",J=`(?:${K}|${Y})`,X=`(?:${W}|${Y})`,Z=`(?:-(${X}(?:\\.${X})*))`,Q=`${W}|x|X|\\*`,ee=`[v=\\s]*(${Q})(?:\\.(${Q})(?:\\.(${Q})(?:${Z})?${G}?)?)?`,te=`^\\s*(${ee})\\s+-\\s+(${ee})\\s*$`,oe="((?:<|>)?=?)",ne=`(\\s*)${oe}\\s*([v=\\s]*(${K})\\.(${K})\\.(${K})(?:-?(${J}(?:\\.${J})*))?${G}?|${ee})`,ae="(?:~>?)",re=`(\\s*)${ae}\\s+`,se="(?:\\^)",le=`(\\s*)${se}\\s+`,ie=`^${se}${ee}$`,ce=`^${ae}${ee}$`,de=`^${oe}\\s*${ee}$`,pe=`^${oe}\\s*(v?(${W})\\.(${W})\\.(${W})${Z}?${G}?)$|^$`;function ue(e){return new RegExp(e)}function me(e){return!e||"x"===e.toLowerCase()||"*"===e}function he(...e){return t=>e.reduce((e,t)=>t(e),t)}function fe(e){return e.match(ue(pe))}function ve(e,t,o,n){const a=`${e}.${t}.${o}`;return n?`${a}-${n}`:a}function ge(e){return e.replace(ue(te),(e,t,o,n,a,r,s,l,i,c,d,p)=>`${t=me(o)?"":me(n)?`>=${o}.0.0`:me(a)?`>=${o}.${n}.0`:`>=${t}`} ${l=me(i)?"":me(c)?`<${Number(i)+1}.0.0-0`:me(d)?`<${i}.${Number(c)+1}.0-0`:p?`<=${i}.${c}.${d}-${p}`:`<=${l}`}`.trim())}function ye(e){return e.replace(ue(ne),"$1$2$3")}function be(e){return e.replace(ue(re),"$1~")}function ke(e){return e.replace(ue(le),"$1^")}function we(e){return e.trim().split(/\s+/).map(e=>e.replace(ue(ie),(e,t,o,n,a)=>me(t)?"":me(o)?`>=${t}.0.0 <${Number(t)+1}.0.0-0`:me(n)?"0"===t?`>=${t}.${o}.0 <${t}.${Number(o)+1}.0-0`:`>=${t}.${o}.0 <${Number(t)+1}.0.0-0`:a?"0"===t?"0"===o?`>=${t}.${o}.${n}-${a} <${t}.${o}.${Number(n)+1}-0`:`>=${t}.${o}.${n}-${a} <${t}.${Number(o)+1}.0-0`:`>=${t}.${o}.${n}-${a} <${Number(t)+1}.0.0-0`:"0"===t?"0"===o?`>=${t}.${o}.${n} <${t}.${o}.${Number(n)+1}-0`:`>=${t}.${o}.${n} <${t}.${Number(o)+1}.0-0`:`>=${t}.${o}.${n} <${Number(t)+1}.0.0-0`)).join(" ")}function Ee(e){return e.trim().split(/\s+/).map(e=>e.replace(ue(ce),(e,t,o,n,a)=>me(t)?"":me(o)?`>=${t}.0.0 <${Number(t)+1}.0.0-0`:me(n)?`>=${t}.${o}.0 <${t}.${Number(o)+1}.0-0`:a?`>=${t}.${o}.${n}-${a} <${t}.${Number(o)+1}.0-0`:`>=${t}.${o}.${n} <${t}.${Number(o)+1}.0-0`)).join(" ")}function _e(e){return e.split(/\s+/).map(e=>e.trim().replace(ue(de),(e,t,o,n,a,r)=>{const s=me(o),l=s||me(n),i=l||me(a);return"="===t&&i&&(t=""),r="",s?">"===t||"<"===t?"<0.0.0-0":"*":t&&i?(l&&(n=0),a=0,">"===t?(t=">=",l?(o=Number(o)+1,n=0,a=0):(n=Number(n)+1,a=0)):"<="===t&&(t="<",l?o=Number(o)+1:n=Number(n)+1),"<"===t&&(r="-0"),`${t+o}.${n}.${a}${r}`):l?`>=${o}.0.0${r} <${Number(o)+1}.0.0-0`:i?`>=${o}.${n}.0${r} <${o}.${Number(n)+1}.0-0`:e})).join(" ")}function Se(e){return e.trim().replace(ue("(<|>)?=?\\s*\\*"),"")}function Ne(e,t){return(e=Number(e)||e)>(t=Number(t)||t)?1:e===t?0:-1}function Ve(e,t){return Ne(e.major,t.major)||Ne(e.minor,t.minor)||Ne(e.patch,t.patch)||function(e,t){const{preRelease:o}=e,{preRelease:n}=t;if(void 0===o&&Boolean(n))return 1;if(Boolean(o)&&void 0===n)return-1;if(void 0===o&&void 0===n)return 0;for(let e=0,t=o.length;e<=t;e++){const t=o[e],a=n[e];if(t!==a)return void 0===t&&void 0===a?0:t?a?Ne(t,a):-1:1}return 0}(e,t)}function Ce(e,t){return e.version===t.version}function Be(e,t){switch(e.operator){case"":case"=":return Ce(e,t);case">":return Ve(e,t)<0;case">=":return Ce(e,t)||Ve(e,t)<0;case"<":return Ve(e,t)>0;case"<=":return Ce(e,t)||Ve(e,t)>0;case void 0:return!0;default:return!1}}function $e(e){return he(we,Ee,_e,Se)(e)}function xe(e){return he(ge,ye,be,ke)(e.trim()).split(/\s+/).join(" ")}function De(e,t){if(!e)return!1;const o=fe(e);if(!o)return!1;const[,n,,a,r,s,l]=o,i={operator:n,version:ve(a,r,s,l),major:a,minor:r,patch:s,preRelease:l?.split(".")},c=t.split("||");for(const e of c){const t=e.trim();if(!t)return!0;if("*"===t||"x"===t)return!0;try{const e=xe(t);if(!e.trim())return!0;const o=e.split(" ").map(e=>$e(e)).join(" ");if(!o.trim())return!0;const n=o.split(/\s+/).map(e=>e.trim().replace(ue("^\\s*>=\\s*0.0.0\\s*$"),"")).filter(Boolean);if(0===n.length)continue;let a=!0;for(const e of n){const t=fe(e);if(!t){a=!1;break}const[,o,,n,r,s,l]=t;if(!Be({operator:o,version:ve(n,r,s,l),major:n,minor:r,patch:s,preRelease:l?.split(".")},i)){a=!1;break}}if(a)return!0}catch(e){console.error(`[semver] Error processing range part "${t}":`,e);continue}}return!1}function Te(e,t){const o=t.shared||{},n=t.name,a=Object.keys(o).reduce((e,a)=>{const r=V(o[a]);return e[a]=e[a]||[],r.forEach(o=>{e[a].push(function(e,t,o,n){let a;return a="get"in e?e.get:"lib"in e?()=>Promise.resolve(e.lib):()=>Promise.resolve(()=>{throw new Error(`Can not get shared '${o}'!`)}),{deps:[],useIn:[],from:t,loading:null,...e,shareConfig:{requiredVersion:`^${e.version}`,singleton:!1,eager:!1,strictVersion:!1,...e.shareConfig},get:a,loaded:!(!e?.loaded&&!("lib"in e))||void 0,version:e.version??"0",scope:Array.isArray(e.scope)?e.scope:[e.scope??"default"],strategy:(e.strategy??n)||"version-first"}}(o,n,a,t.shareStrategy))}),e},{}),r={...e.shared};return Object.keys(a).forEach(e=>{r[e]?a[e].forEach(t=>{r[e].find(e=>e.version===t.version)||r[e].push(t)}):r[e]=a[e]}),{shared:r,shareInfos:a}}function Ie(e,t){const o=e=>{if(!Number.isNaN(Number(e))){const t=e.split(".");let o=e;for(let e=0;e<3-t.length;e++)o+=".0";return o}return e};return!!De(o(e),`<=${o(t)}`)}const Ae=(e,t)=>{const o=t||function(e,t){return Ie(e,t)};return Object.keys(e).reduce((e,t)=>e?o(e,t)||"0"===e?t:e:t,0)},Me=e=>Boolean(e.loaded)||"function"==typeof e.lib;function Oe(e,t,o){const n=e[t][o];return Ae(e[t][o],function(e,t){return!Me(n[e])&&Ie(e,t)})}function je(e,t,o){const n=e[t][o];return Ae(e[t][o],function(e,t){const o=e=>Me(e)||(e=>Boolean(e.loading))(e);return o(n[t])?!o(n[e])||Boolean(Ie(e,t)):!o(n[e])&&Ie(e,t)})}function Pe(e){return"loaded-first"===e?je:Oe}function Le(e,t,o,n){if(!e)return;const{shareConfig:a,scope:r=z,strategy:s}=o,l=Array.isArray(r)?r:[r];for(const r of l)if(a&&e[r]&&e[r][t]){const{requiredVersion:l}=a,i=Pe(s)(e,r,t),c=()=>{if(a.singleton){if("string"==typeof l&&!De(i,l)){const n=`Version ${i} from ${i&&e[r][t][i].from} of shared singleton module ${t} does not satisfy the requirement of ${o.from} which needs ${l})`;a.strictVersion?y(n):b(n)}return e[r][t][i]}if(!1===l||"*"===l)return e[r][t][i];if(De(i,l))return e[r][t][i];for(const[o,n]of Object.entries(e[r][t]))if(De(o,l))return n},d={shareScopeMap:e,scope:r,pkgName:t,version:i,GlobalFederation:x.__FEDERATION__,resolver:c};return(n.emit(d)||d).resolver()}}function Re(){return x.__FEDERATION__.__SHARE__}function Fe(e){const{pkgName:t,extraOptions:o,shareInfos:n}=e,a=o?.resolver??(e=>{if(!e)return;const t={};e.forEach(e=>{t[e.version]=e});const o=Ae(t,function(e,o){return!Me(t[e])&&Ie(e,o)});return t[o]});return Object.assign({},a(n[t]),o?.customShareInfo)}const Ue=".then(callbacks[0]).catch(callbacks[1])";function ze(e,t,o){const{remoteEntryKey:n,entryExports:r}=L(e,t);return g(r,m(a,h,{remoteName:e,remoteEntryUrl:o,remoteEntryKey:n})),r}function He(e){const{entry:t,name:o}=e;return(0,n.lG)(o,t)}async function qe(e){const{origin:t,remoteEntryExports:o,remoteInfo:a,getEntryUrl:r,_inErrorHandling:s=!1}=e,l=He(a);if(o)return o;if(!I[l]){const e=t.remoteHandler.hooks.lifecycle.loadEntry,i=t.loaderHook;I[l]=e.emit({loaderHook:i,remoteInfo:a,remoteEntryExports:o}).then(e=>e||(("undefined"!=typeof ENV_TARGET?"web"===ENV_TARGET:(0,n.OL)())?async function({remoteInfo:e,remoteEntryExports:t,loaderHook:o,getEntryUrl:a}){const{entry:r,entryGlobalName:s,name:l,type:i}=e;switch(i){case"esm":case"module":return async function({entry:e,remoteEntryExports:t}){return new Promise((o,n)=>{try{t?o(t):"undefined"!=typeof FEDERATION_ALLOW_NEW_FUNCTION?new Function("callbacks",`import("${e}")${Ue}`)([o,n]):import(e).then(o).catch(n)}catch(e){n(e)}})}({entry:r,remoteEntryExports:t});case"system":return async function({entry:e,remoteEntryExports:t}){return new Promise((o,n)=>{try{t?o(t):new Function("callbacks",`System.import("${e}")${Ue}`)([o,n])}catch(e){n(e)}})}({entry:r,remoteEntryExports:t});default:return async function({name:e,globalName:t,entry:o,loaderHook:a,getEntryUrl:r}){const{entryExports:s}=L(e,t);if(s)return s;const l=r?r(o):o;return(0,n.k0)(l,{attrs:{},createScriptHook:(e,t)=>{const o=a.lifecycle.createScript.emit({url:e,attrs:t});if(o)return o instanceof HTMLScriptElement||"script"in o||"timeout"in o?o:void 0}}).then(()=>ze(e,t,o)).catch(t=>{throw g(void 0,m(p,h,{remoteName:e,resourceUrl:o})),t})}({entry:r,globalName:s,name:l,loaderHook:o,getEntryUrl:a})}}({remoteInfo:a,remoteEntryExports:o,loaderHook:i,getEntryUrl:r}):async function({remoteInfo:e,loaderHook:t}){const{entry:o,entryGlobalName:a,name:r,type:s}=e,{entryExports:l}=L(r,a);return l||(0,n.oe)(o,{attrs:{name:r,globalName:a,type:s},loaderHook:{createScriptHook:(e,o={})=>{const n=t.lifecycle.createScript.emit({url:e,attrs:o});if(n)return"url"in n?n:void 0}}}).then(()=>ze(r,a,o)).catch(e=>{throw e})}({remoteInfo:a,loaderHook:i}))).catch(async e=>{const n=He(a);if(e instanceof Error&&e.message.includes(p)&&!s){const e=e=>qe({...e,_inErrorHandling:!0}),r=await t.loaderHook.lifecycle.loadEntryError.emit({getRemoteEntry:e,origin:t,remoteInfo:a,remoteEntryExports:o,globalLoading:I,uniqueKey:n});if(r)return r}throw e})}return I[l]}function Ge(e){return{...e,entry:"entry"in e?e.entry:"",type:e.type||H,entryGlobalName:e.entryGlobalName||e.name,shareScope:e.shareScope||z}}function We(e){return{resourceCategory:"sync",share:!0,depsRemote:!0,prefetchInterface:!1,...e}}function Ke(e,t,o,a=!0){const{cssAssets:r,jsAssetsWithoutEntry:s,entryAssets:l}=o;if(t.options.inBrowser){if(l.forEach(o=>{const{moduleInfo:n}=o,a=t.moduleCache.get(e.name);qe(a?{origin:t,remoteInfo:n,remoteEntryExports:a.remoteEntryExports}:{origin:t,remoteInfo:n,remoteEntryExports:void 0})}),a){const e={rel:"preload",as:"style"};r.forEach(o=>{const{link:a,needAttach:r}=(0,n.d)({url:o,cb:()=>{},attrs:e,createLinkHook:(e,o)=>{const n=t.loaderHook.lifecycle.createLink.emit({url:e,attrs:o});if(n instanceof HTMLLinkElement)return n}});r&&document.head.appendChild(a)})}else{const e={rel:"stylesheet",type:"text/css"};r.forEach(o=>{const{link:a,needAttach:r}=(0,n.d)({url:o,cb:()=>{},attrs:e,createLinkHook:(e,o)=>{const n=t.loaderHook.lifecycle.createLink.emit({url:e,attrs:o});if(n instanceof HTMLLinkElement)return n},needDeleteLink:!1});r&&document.head.appendChild(a)})}if(a){const e={rel:"preload",as:"script"};s.forEach(o=>{const{link:a,needAttach:r}=(0,n.d)({url:o,cb:()=>{},attrs:e,createLinkHook:(e,o)=>{const n=t.loaderHook.lifecycle.createLink.emit({url:e,attrs:o});if(n instanceof HTMLLinkElement)return n}});r&&document.head.appendChild(a)})}else{const o={fetchpriority:"high",type:"module"===e?.type?"module":"text/javascript"};s.forEach(e=>{const{script:a,needAttach:r}=(0,n.so)({url:e,cb:()=>{},attrs:o,createScriptHook:(e,o)=>{const n=t.loaderHook.lifecycle.createScript.emit({url:e,attrs:o});if(n instanceof HTMLScriptElement)return n},needDeleteScript:!0});r&&document.head.appendChild(a)})}}}class Ye{constructor({remoteInfo:e,host:t}){this.inited=!1,this.lib=void 0,this.remoteInfo=e,this.host=t}async getEntry(){if(this.remoteEntryExports)return this.remoteEntryExports;let e;return e=await qe({origin:this.host,remoteInfo:this.remoteInfo,remoteEntryExports:this.remoteEntryExports}),g(e,`remoteEntryExports is undefined \n ${(0,n.ML)(this.remoteInfo)}`),this.remoteEntryExports=e,this.remoteEntryExports}async get(e,t,o,n){const{loadFactory:a=!0}=o||{loadFactory:!0},s=await this.getEntry();if(!this.inited){const t=this.host.shareScopeMap,o=Array.isArray(this.remoteInfo.shareScope)?this.remoteInfo.shareScope:[this.remoteInfo.shareScope];o.length||o.push("default"),o.forEach(e=>{t[e]||(t[e]={})});const a=t[o[0]],l=[],i={version:this.remoteInfo.version||"",shareScopeKeys:Array.isArray(this.remoteInfo.shareScope)?o:this.remoteInfo.shareScope||"default"};Object.defineProperty(i,"shareScopeMap",{value:t,enumerable:!1});const c=await this.host.hooks.lifecycle.beforeInitContainer.emit({shareScope:a,remoteEntryInitOptions:i,initScope:l,remoteInfo:this.remoteInfo,origin:this.host});void 0===s?.init&&y(m(r,h,{hostName:this.host.name,remoteName:this.remoteInfo.name,remoteEntryUrl:this.remoteInfo.entry,remoteEntryKey:this.remoteInfo.entryGlobalName})),await s.init(c.shareScope,c.initScope,c.remoteEntryInitOptions),await this.host.hooks.lifecycle.initContainer.emit({...c,id:e,remoteSnapshot:n,remoteEntryExports:s})}let l;this.lib=s,this.inited=!0,l=await this.host.loaderHook.lifecycle.getModuleFactory.emit({remoteEntryExports:s,expose:t,moduleInfo:this.remoteInfo}),l||(l=await s.get(t)),g(l,`${w(this.remoteInfo)} remote don't export ${t}.`);const i=((e,t)=>{let o;return o=e.endsWith("/")?e.slice(0,-1):e,t.startsWith(".")&&(t=t.slice(1)),o+=t,o})(this.remoteInfo.name,t),c=this.wraperFactory(l,i);return a?await c():c}wraperFactory(e,t){function o(e,t){e&&"object"==typeof e&&Object.isExtensible(e)&&!Object.getOwnPropertyDescriptor(e,Symbol.for("mf_module_id"))&&Object.defineProperty(e,Symbol.for("mf_module_id"),{value:t,enumerable:!1})}return e instanceof Promise?async()=>{const n=await e();return o(n,t),n}:()=>{const n=e();return o(n,t),n}}}class Je{constructor(e){this.type="",this.listeners=new Set,e&&(this.type=e)}on(e){"function"==typeof e&&this.listeners.add(e)}once(e){const t=this;this.on(function o(...n){return t.remove(o),e.apply(null,n)})}emit(...e){let t;return this.listeners.size>0&&this.listeners.forEach(o=>{t=o(...e)}),t}remove(e){this.listeners.delete(e)}removeAll(){this.listeners.clear()}}class Xe extends Je{emit(...e){let t;const o=Array.from(this.listeners);if(o.length>0){let n=0;const a=t=>!1!==t&&(n<o.length?Promise.resolve(o[n++].apply(null,e)).then(a):t);t=a()}return Promise.resolve(t)}}function Ze(e,t){if(!S(t))return!1;if(e!==t)for(const o in e)if(!(o in t))return!1;return!0}class Qe extends Je{constructor(e){super(),this.onerror=y,this.type=e}emit(e){S(e)||y(`The data for the "${this.type}" hook should be an object.`);for(const t of this.listeners)try{const o=t(e);if(!Ze(e,o)){this.onerror(`A plugin returned an unacceptable value for the "${this.type}" type.`);break}e=o}catch(e){b(e),this.onerror(e)}return e}}class et extends Je{constructor(e){super(),this.onerror=y,this.type=e}emit(e){S(e)||y(`The response data for the "${this.type}" hook must be an object.`);const t=Array.from(this.listeners);if(t.length>0){let o=0;const n=t=>(b(t),this.onerror(t),e),a=r=>{if(Ze(e,r)){if(e=r,o<t.length)try{return Promise.resolve(t[o++](e)).then(a,n)}catch(e){return n(e)}}else this.onerror(`A plugin returned an incorrect value for the "${this.type}" type.`);return e};return Promise.resolve(a(e))}return Promise.resolve(e)}}class tt{constructor(e){this.registerPlugins={},this.lifecycle=e,this.lifecycleKeys=Object.keys(e)}applyPlugin(e,t){var o;g((o=e,"[object Object]"===N.call(o)),"Plugin configuration is invalid.");const n=e.name;g(n,"A name must be provided by the plugin."),this.registerPlugins[n]||(this.registerPlugins[n]=e,e.apply?.(t),Object.keys(this.lifecycle).forEach(t=>{const o=e[t];o&&this.lifecycle[t].on(o)}))}removePlugin(e){g(e,"A name is required.");const t=this.registerPlugins[e];g(t,`The plugin "${e}" is not registered.`),Object.keys(t).forEach(e=>{"name"!==e&&this.lifecycle[e].remove(t[e])})}}function ot(e,t){const o=C(t);o.url||y(`The attribute remoteEntry of ${e.name} must not be undefined.`);let a=(0,n.Al)(t,o.url);(0,n.OL)()||a.startsWith("http")||(a=`https:${a}`),e.type=o.type,e.entryGlobalName=o.globalName,e.entry=a,e.version=t.version,e.buildVersion=t.buildVersion}function nt(e){const t=e.split(":");return 1===t.length?{name:t[0],version:void 0}:2===t.length?{name:t[0],version:t[1]}:{name:t[1],version:t[2]}}function at(e,t,o,a,r={},s){const l=w(t),{value:i}=M(e,l),c=s||i;if(c&&!(0,n.Tr)(c)&&(o(c,t,a),c.remotesInfo)){const t=Object.keys(c.remotesInfo);for(const n of t){if(r[n])continue;r[n]=!0;const t=nt(n),a=c.remotesInfo[n];at(e,{name:t.name,version:a.matchedVersion},o,!1,r,void 0)}}}const rt=(e,t)=>document.querySelector(`${e}[${"link"===e?"href":"src"}="${t}"]`);function st(e,t,o,a,r){const s=[],l=[],i=[],c=new Set,d=new Set,{options:p}=e,{preloadConfig:u}=t,{depsRemote:m}=u;if(at(a,o,(t,o,a)=>{let r;if(a)r=u;else if(Array.isArray(m)){const e=m.find(e=>e.nameOrAlias===o.name||e.nameOrAlias===o.alias);if(!e)return;r=We(e)}else{if(!0!==m)return;r=u}const c=(0,n.Al)(t,C(t).url);c&&i.push({name:o.name,moduleInfo:{name:o.name,entry:c,type:"remoteEntryType"in t?t.remoteEntryType:"global",entryGlobalName:"globalName"in t?t.globalName:o.name,shareScope:"",version:"version"in t?t.version:void 0},url:c});let d="modules"in t?t.modules:[];const p=(h=r.exposes)?h.map(e=>"."===e?e:e.startsWith("./")?e.replace("./",""):e):[];var h;function f(e){const o=e.map(e=>(0,n.Al)(t,e));return r.filter?o.filter(r.filter):o}if(p.length&&"modules"in t&&(d=t?.modules?.reduce((e,t)=>(-1!==p?.indexOf(t.moduleName)&&e.push(t),e),[])),d){const n=d.length;for(let a=0;a<n;a++){const n=d[a],i=`${o.name}/${n.moduleName}`;e.remoteHandler.hooks.lifecycle.handlePreloadModule.emit({id:"."===n.moduleName?o.name:i,name:o.name,remoteSnapshot:t,preloadConfig:r,remote:o,origin:e}),F(i)||("all"===r.resourceCategory?(s.push(...f(n.assets.css.async)),s.push(...f(n.assets.css.sync)),l.push(...f(n.assets.js.async)),l.push(...f(n.assets.js.sync))):(r.resourceCategory="sync")&&(s.push(...f(n.assets.css.sync)),l.push(...f(n.assets.js.sync))),U(i))}}},!0,{},r),r.shared&&r.shared.length>0){const t=(t,o)=>{const n=Le(e.shareScopeMap,o.sharedName,t,e.sharedHandler.hooks.lifecycle.resolveShare);n&&"function"==typeof n.lib&&(o.assets.js.sync.forEach(e=>{c.add(e)}),o.assets.css.sync.forEach(e=>{d.add(e)}))};r.shared.forEach(e=>{const o=p.shared?.[e.sharedName];if(!o)return;const n=e.version?o.find(t=>t.version===e.version):o;n&&V(n).forEach(o=>{t(o,e)})})}const h=l.filter(e=>!c.has(e)&&!rt("script",e));return{cssAssets:s.filter(e=>!d.has(e)&&!rt("link",e)),jsAssetsWithoutEntry:h,entryAssets:i.filter(e=>!rt("script",e.url))}}function lt(e,t){const o=j({name:t.name,version:t.options.version}),n=o&&"remotesInfo"in o&&o.remotesInfo&&M(o.remotesInfo,e.name).value;return n&&n.matchedVersion?{hostGlobalSnapshot:o,globalSnapshot:O(),remoteSnapshot:j({name:e.name,version:n.matchedVersion})}:{hostGlobalSnapshot:void 0,globalSnapshot:O(),remoteSnapshot:j({name:e.name,version:"version"in e?e.version:void 0})}}class it{constructor(e){this.loadingHostSnapshot=null,this.manifestCache=new Map,this.hooks=new tt({beforeLoadRemoteSnapshot:new Xe("beforeLoadRemoteSnapshot"),loadSnapshot:new et("loadGlobalSnapshot"),loadRemoteSnapshot:new et("loadRemoteSnapshot"),afterLoadSnapshot:new et("afterLoadSnapshot")}),this.manifestLoading=x.__FEDERATION__.__MANIFEST_LOADING__,this.HostInstance=e,this.loaderHook=e.loaderHook}async loadRemoteSnapshotInfo({moduleInfo:e,id:t,expose:o}){const{options:a}=this.HostInstance;await this.hooks.lifecycle.beforeLoadRemoteSnapshot.emit({options:a,moduleInfo:e});let r=j({name:this.HostInstance.options.name,version:this.HostInstance.options.version});var s;r||(r={version:this.HostInstance.options.version||"",remoteEntry:"",remotesInfo:{}},s={[this.HostInstance.options.name]:r},$.__FEDERATION__.moduleInfo={...$.__FEDERATION__.moduleInfo,...s}),r&&"remotesInfo"in r&&!M(r.remotesInfo,e.name).value&&("version"in e||"entry"in e)&&(r.remotesInfo={...r?.remotesInfo,[e.name]:{matchedVersion:"version"in e?e.version:e.entry}});const{hostGlobalSnapshot:l,remoteSnapshot:i,globalSnapshot:c}=this.getGlobalRemoteInfo(e),{remoteSnapshot:p,globalSnapshot:u}=await this.hooks.lifecycle.loadSnapshot.emit({options:a,moduleInfo:e,hostGlobalSnapshot:l,remoteSnapshot:i,globalSnapshot:c});let f,v;if(p)if((0,n.Tr)(p)){const t=(0,n.OL)()?p.remoteEntry:p.ssrRemoteEntry||p.remoteEntry||"",o=await this.getManifestJson(t,e,{});f=o,v=P({...e,entry:t},o)}else{const{remoteSnapshot:t}=await this.hooks.lifecycle.loadRemoteSnapshot.emit({options:this.HostInstance.options,moduleInfo:e,remoteSnapshot:p,from:"global"});f=t,v=u}else if(E(e)){const t=await this.getManifestJson(e.entry,e,{}),o=P(e,t),{remoteSnapshot:n}=await this.hooks.lifecycle.loadRemoteSnapshot.emit({options:this.HostInstance.options,moduleInfo:e,remoteSnapshot:t,from:"global"});f=n,v=o}else y(m(d,h,{hostName:e.name,hostVersion:e.version,globalSnapshot:JSON.stringify(u)}));return await this.hooks.lifecycle.afterLoadSnapshot.emit({id:t,host:this.HostInstance,options:a,moduleInfo:e,remoteSnapshot:f}),{remoteSnapshot:f,globalSnapshot:v}}getGlobalRemoteInfo(e){return lt(e,this.HostInstance)}async getManifestJson(e,t,o){const a=async()=>{let o=this.manifestCache.get(e);if(o)return o;try{let t=await this.loaderHook.lifecycle.fetch.emit(e,{});t&&t instanceof Response||(t=await fetch(e,{})),o=await t.json()}catch(n){o=await this.HostInstance.remoteHandler.hooks.lifecycle.errorLoadRemote.emit({id:e,error:n,from:"runtime",lifecycle:"afterResolve",origin:this.HostInstance}),o||(delete this.manifestLoading[e],y(m(s,h,{manifestUrl:e,moduleName:t.name,hostName:this.HostInstance.options.name},`${n}`)))}return g(o.metaData&&o.exposes&&o.shared,`${e} is not a federation manifest`),this.manifestCache.set(e,o),o};return this.manifestLoading[e]||(this.manifestLoading[e]=(async()=>{const o=await a(),r=(0,n.Jn)(o,{version:e}),{remoteSnapshot:s}=await this.hooks.lifecycle.loadRemoteSnapshot.emit({options:this.HostInstance.options,moduleInfo:t,manifestJson:o,remoteSnapshot:r,manifestUrl:e,from:"manifest"});return s})().then(e=>e)),this.manifestLoading[e]}}class ct{constructor(e){this.hooks=new tt({afterResolve:new et("afterResolve"),beforeLoadShare:new et("beforeLoadShare"),loadShare:new Xe,resolveShare:new Qe("resolveShare"),initContainerShareScopeMap:new Qe("initContainerShareScopeMap")}),this.host=e,this.shareScopeMap={},this.initTokens={},this._setGlobalShareScopeMap(e.options)}registerShared(e,t){const{shareInfos:o,shared:n}=Te(e,t);return Object.keys(o).forEach(e=>{o[e].forEach(o=>{o.scope.forEach(n=>{const a=this.shareScopeMap[n]?.[e];a||this.setShared({pkgName:e,lib:o.lib,get:o.get,loaded:o.loaded||Boolean(o.lib),shared:o,from:t.name})})})}),{shareInfos:o,shared:n}}async loadShare(e,t){const{host:o}=this,n=Fe({pkgName:e,extraOptions:t,shareInfos:o.options.shared});n?.scope&&await Promise.all(n.scope.map(async e=>{await Promise.all(this.initializeSharing(e,{strategy:n.strategy}))}));const a=await this.hooks.lifecycle.beforeLoadShare.emit({pkgName:e,shareInfo:n,shared:o.options.shared,origin:o}),{shareInfo:r}=a;g(r,`Cannot find ${e} Share in the ${o.options.name}. Please ensure that the ${e} Share parameters have been injected`);const s=Le(this.shareScopeMap,e,r,this.hooks.lifecycle.resolveShare),l=e=>{e.useIn||(e.useIn=[]),k(e.useIn,o.options.name)};if(s&&s.lib)return l(s),s.lib;if(s&&s.loading&&!s.loaded){const e=await s.loading;return s.loaded=!0,s.lib||(s.lib=e),l(s),e}if(s){const t=(async()=>{const e=await s.get();return l(s),s.loaded=!0,s.lib=e,e})();return this.setShared({pkgName:e,loaded:!1,shared:s,from:o.options.name,lib:null,loading:t}),t}{if(t?.customShareInfo)return!1;const n=(async()=>{const t=await r.get();r.lib=t,r.loaded=!0,l(r);const o=Le(this.shareScopeMap,e,r,this.hooks.lifecycle.resolveShare);return o&&(o.lib=t,o.loaded=!0,o.from=r.from),t})();return this.setShared({pkgName:e,loaded:!1,shared:r,from:o.options.name,lib:null,loading:n}),n}}initializeSharing(e=z,t){const{host:o}=this,n=t?.from,a=t?.strategy;let r=t?.initScope;const s=[];if("build"!==n){const{initTokens:t}=this;r||(r=[]);let o=t[e];if(o||(o=t[e]={from:this.host.name}),r.indexOf(o)>=0)return s;r.push(o)}const l=this.shareScopeMap,i=o.options.name;l[e]||(l[e]={});const c=l[e];return Object.keys(o.options.shared).forEach(t=>{o.options.shared[t].forEach(o=>{o.scope.includes(e)&&((e,t)=>{const{version:o,eager:n}=t;c[e]=c[e]||{};const a=c[e],r=a[o],s=Boolean(r&&(r.eager||r.shareConfig?.eager));(!r||"loaded-first"!==r.strategy&&!r.loaded&&(Boolean(!n)!==!s?n:i>r.from))&&(a[o]=t)})(t,o)})}),"version-first"!==o.options.shareStrategy&&"version-first"!==a||o.options.remotes.forEach(t=>{t.shareScope===e&&s.push((async t=>{const{module:n}=await o.remoteHandler.getRemoteModuleAndOptions({id:t});if(n.getEntry){let s;try{s=await n.getEntry()}catch(e){s=await o.remoteHandler.hooks.lifecycle.errorLoadRemote.emit({id:t,error:e,from:"runtime",lifecycle:"beforeLoadShare",origin:o})}n.inited||(await(a=s,a&&a.init&&a.init(l[e],r)),n.inited=!0)}var a})(t.name))}),s}loadShareSync(e,t){const{host:o}=this,n=Fe({pkgName:e,extraOptions:t,shareInfos:o.options.shared});n?.scope&&n.scope.forEach(e=>{this.initializeSharing(e,{strategy:n.strategy})});const a=Le(this.shareScopeMap,e,n,this.hooks.lifecycle.resolveShare),r=e=>{e.useIn||(e.useIn=[]),k(e.useIn,o.options.name)};if(a){if("function"==typeof a.lib)return r(a),a.loaded||(a.loaded=!0,a.from===o.options.name&&(n.loaded=!0)),a.lib;if("function"==typeof a.get){const t=a.get();if(!(t instanceof Promise))return r(a),this.setShared({pkgName:e,loaded:!0,from:o.options.name,lib:t,shared:a}),t}}if(n.lib)return n.loaded||(n.loaded=!0),n.lib;if(n.get){const a=n.get();if(a instanceof Promise)throw new Error(m("build"===t?.from?i:c,h,{hostName:o.options.name,sharedPkgName:e}));return n.lib=a,this.setShared({pkgName:e,loaded:!0,from:o.options.name,lib:n.lib,shared:n}),n.lib}throw new Error(m(c,h,{hostName:o.options.name,sharedPkgName:e}))}initShareScopeMap(e,t,o={}){const{host:n}=this;this.shareScopeMap[e]=t,this.hooks.lifecycle.initContainerShareScopeMap.emit({shareScope:t,options:n.options,origin:n,scopeName:e,hostShareScopeMap:o.hostShareScopeMap})}setShared({pkgName:e,shared:t,from:o,lib:n,loading:a,loaded:r,get:s}){const{version:l,scope:i="default",...c}=t;(Array.isArray(i)?i:[i]).forEach(t=>{if(this.shareScopeMap[t]||(this.shareScopeMap[t]={}),this.shareScopeMap[t][e]||(this.shareScopeMap[t][e]={}),!this.shareScopeMap[t][e][l])return this.shareScopeMap[t][e][l]={version:l,scope:[t],...c,lib:n,loaded:r,loading:a},void(s&&(this.shareScopeMap[t][e][l].get=s));const i=this.shareScopeMap[t][e][l];a&&!i.loading&&(i.loading=a),r&&!i.loaded&&(i.loaded=r),o&&i.from!==o&&(i.from=o)})}_setGlobalShareScopeMap(e){const t=Re(),o=e.id||e.name;o&&!t[o]&&(t[o]=this.shareScopeMap)}}class dt{constructor(e){this.hooks=new tt({beforeRegisterRemote:new Qe("beforeRegisterRemote"),registerRemote:new Qe("registerRemote"),beforeRequest:new et("beforeRequest"),onLoad:new Xe("onLoad"),handlePreloadModule:new Je("handlePreloadModule"),errorLoadRemote:new Xe("errorLoadRemote"),beforePreloadRemote:new Xe("beforePreloadRemote"),generatePreloadAssets:new Xe("generatePreloadAssets"),afterPreloadRemote:new Xe,loadEntry:new Xe}),this.host=e,this.idToRemoteMap={}}formatAndRegisterRemote(e,t){return(t.remotes||[]).reduce((e,t)=>(this.registerRemote(t,e,{force:!1}),e),e.remotes)}setIdToRemoteMap(e,t){const{remote:o,expose:n}=t,{name:a,alias:r}=o;if(this.idToRemoteMap[e]={name:o.name,expose:n},r&&e.startsWith(a)){const t=e.replace(a,r);return void(this.idToRemoteMap[t]={name:o.name,expose:n})}if(r&&e.startsWith(r)){const t=e.replace(r,a);this.idToRemoteMap[t]={name:o.name,expose:n}}}async loadRemote(e,t){const{host:o}=this;try{const{loadFactory:n=!0}=t||{loadFactory:!0},{module:a,moduleOptions:r,remoteMatchInfo:s}=await this.getRemoteModuleAndOptions({id:e}),{pkgNameOrAlias:l,remote:i,expose:c,id:d,remoteSnapshot:p}=s,u=await a.get(d,c,t,p),m=await this.hooks.lifecycle.onLoad.emit({id:d,pkgNameOrAlias:l,expose:c,exposeModule:n?u:void 0,exposeModuleFactory:n?void 0:u,remote:i,options:r,moduleInstance:a,origin:o});return this.setIdToRemoteMap(e,s),"function"==typeof m?m:u}catch(n){const{from:a="runtime"}=t||{from:"runtime"},r=await this.hooks.lifecycle.errorLoadRemote.emit({id:e,error:n,from:a,lifecycle:"onLoad",origin:o});if(!r)throw n;return r}}async preloadRemote(e){const{host:t}=this;await this.hooks.lifecycle.beforePreloadRemote.emit({preloadOps:e,options:t.options,origin:t});const o=(a=t.options.remotes,e.map(e=>{const t=function(e,t){for(const o of e){if(t===o.name)return o;if(o.alias&&t===o.alias)return o}}(a,e.nameOrAlias);return g(t,`Unable to preload ${e.nameOrAlias} as it is not included in ${!t&&(0,n.ML)({remoteInfo:t,remotes:a})}`),{remote:t,preloadConfig:We(e)}}));var a;await Promise.all(o.map(async e=>{const{remote:o}=e,n=Ge(o),{globalSnapshot:a,remoteSnapshot:r}=await t.snapshotHandler.loadRemoteSnapshotInfo({moduleInfo:o}),s=await this.hooks.lifecycle.generatePreloadAssets.emit({origin:t,preloadOptions:e,remote:o,remoteInfo:n,globalSnapshot:a,remoteSnapshot:r});s&&Ke(n,t,s)}))}registerRemotes(e,t){const{host:o}=this;e.forEach(e=>{this.registerRemote(e,o.options.remotes,{force:t?.force})})}async getRemoteModuleAndOptions(e){const{host:t}=this,{id:o}=e;let n;try{n=await this.hooks.lifecycle.beforeRequest.emit({id:o,options:t.options,origin:t})}catch(e){if(n=await this.hooks.lifecycle.errorLoadRemote.emit({id:o,options:t.options,origin:t,from:"runtime",error:e,lifecycle:"beforeRequest"}),!n)throw e}const{id:a}=n,r=function(e,t){for(const o of e){const e=t.startsWith(o.name);let n=t.replace(o.name,"");if(e){if(n.startsWith("/"))return n=`.${n}`,{pkgNameOrAlias:o.name,expose:n,remote:o};if(""===n)return{pkgNameOrAlias:o.name,expose:".",remote:o}}const a=o.alias&&t.startsWith(o.alias);let r=o.alias&&t.replace(o.alias,"");if(o.alias&&a){if(r&&r.startsWith("/"))return r=`.${r}`,{pkgNameOrAlias:o.alias,expose:r,remote:o};if(""===r)return{pkgNameOrAlias:o.alias,expose:".",remote:o}}}}(t.options.remotes,a);g(r,m(l,h,{hostName:t.options.name,requestId:a}));const{remote:s}=r,i=Ge(s),c=await t.sharedHandler.hooks.lifecycle.afterResolve.emit({id:a,...r,options:t.options,origin:t,remoteInfo:i}),{remote:d,expose:p}=c;g(d&&p,`The 'beforeRequest' hook was executed, but it failed to return the correct 'remote' and 'expose' values while loading ${a}.`);let u=t.moduleCache.get(d.name);const f={host:t,remoteInfo:i};return u||(u=new Ye(f),t.moduleCache.set(d.name,u)),{module:u,moduleOptions:f,remoteMatchInfo:c}}registerRemote(e,t,o){const{host:a}=this,r=()=>{if(e.alias){const o=t.find(t=>e.alias&&(t.name.startsWith(e.alias)||t.alias?.startsWith(e.alias)));g(!o,`The alias ${e.alias} of remote ${e.name} is not allowed to be the prefix of ${o&&o.name} name or alias`)}"entry"in e&&(0,n.OL)()&&!e.entry.startsWith("http")&&(e.entry=new URL(e.entry,window.location.origin).href),e.shareScope||(e.shareScope=z),e.type||(e.type=H)};this.hooks.lifecycle.beforeRegisterRemote.emit({remote:e,origin:a});const s=t.find(t=>t.name===e.name);if(s){const l=[`The remote "${e.name}" is already registered.`,"Please note that overriding it may cause unexpected errors."];o?.force&&(this.removeRemote(s),r(),t.push(e),this.hooks.lifecycle.registerRemote.emit({remote:e,origin:a}),(0,n.R8)(l.join(" ")))}else r(),t.push(e),this.hooks.lifecycle.registerRemote.emit({remote:e,origin:a})}removeRemote(e){try{const{host:t}=this,{name:o}=e,a=t.options.remotes.findIndex(e=>e.name===o);-1!==a&&t.options.remotes.splice(a,1);const r=t.moduleCache.get(e.name);if(r){const o=r.remoteInfo,a=o.entryGlobalName;B[a]&&(Object.getOwnPropertyDescriptor(B,a)?.configurable?delete B[a]:B[a]=void 0);const s=He(r.remoteInfo);I[s]&&delete I[s],t.snapshotHandler.manifestCache.delete(o.entry);let l=o.buildVersion?(0,n.lG)(o.name,o.buildVersion):o.name;const i=B.__FEDERATION__.__INSTANCES__.findIndex(e=>o.buildVersion?e.options.id===l:e.name===l);if(-1!==i){const e=B.__FEDERATION__.__INSTANCES__[i];l=e.options.id||l;const t=Re();let n=!0;const a=[];Object.keys(t).forEach(e=>{const r=t[e];r&&Object.keys(r).forEach(t=>{const s=r[t];s&&Object.keys(s).forEach(r=>{const l=s[r];l&&Object.keys(l).forEach(s=>{const i=l[s];i&&"object"==typeof i&&i.from===o.name&&(i.loaded||i.loading?(i.useIn=i.useIn.filter(e=>e!==o.name),i.useIn.length?n=!1:a.push([e,t,r,s])):a.push([e,t,r,s]))})})})}),n&&(e.shareScopeMap={},delete t[l]),a.forEach(([e,o,n,a])=>{delete t[e]?.[o]?.[n]?.[a]}),B.__FEDERATION__.__INSTANCES__.splice(i,1)}const{hostGlobalSnapshot:c}=lt(e,t);if(c){const t=c&&"remotesInfo"in c&&c.remotesInfo&&M(c.remotesInfo,e.name).key;t&&(delete c.remotesInfo[t],Boolean(x.__FEDERATION__.__MANIFEST_LOADING__[t])&&delete x.__FEDERATION__.__MANIFEST_LOADING__[t])}t.moduleCache.delete(e.name)}}catch(e){v.log("removeRemote fail: ",e)}}}class pt{constructor(e){this.hooks=new tt({beforeInit:new Qe("beforeInit"),init:new Je,beforeInitContainer:new et("beforeInitContainer"),initContainer:new et("initContainer")}),this.version="0.21.3",this.moduleCache=new Map,this.loaderHook=new tt({getModuleInfo:new Je,createScript:new Je,createLink:new Je,fetch:new Xe,loadEntryError:new Xe,getModuleFactory:new Xe}),this.bridgeHook=new tt({beforeBridgeRender:new Je,afterBridgeRender:new Je,beforeBridgeDestroy:new Je,afterBridgeDestroy:new Je});const t=[{name:"snapshot-plugin",async afterResolve(e){const{remote:t,pkgNameOrAlias:o,expose:n,origin:a,remoteInfo:r,id:s}=e;if(!E(t)||!_(t)){const{remoteSnapshot:l,globalSnapshot:i}=await a.snapshotHandler.loadRemoteSnapshotInfo({moduleInfo:t,id:s});ot(r,l);const c={remote:t,preloadConfig:{nameOrAlias:o,exposes:[n],resourceCategory:"sync",share:!1,depsRemote:!1}},d=await a.remoteHandler.hooks.lifecycle.generatePreloadAssets.emit({origin:a,preloadOptions:c,remoteInfo:r,remote:t,remoteSnapshot:l,globalSnapshot:i});return d&&Ke(r,a,d,!1),{...e,remoteSnapshot:l}}return e}},{name:"generate-preload-assets-plugin",async generatePreloadAssets(e){const{origin:t,preloadOptions:o,remoteInfo:a,remote:r,globalSnapshot:s,remoteSnapshot:l}=e;return(0,n.OL)()?E(r)&&_(r)?{cssAssets:[],jsAssetsWithoutEntry:[],entryAssets:[{name:r.name,url:r.entry,moduleInfo:{name:a.name,entry:r.entry,type:a.type||"global",entryGlobalName:"",shareScope:""}}]}:(ot(a,l),st(t,o,a,s,l)):{cssAssets:[],jsAssetsWithoutEntry:[],entryAssets:[]}}}],o={id:"slider.editor:0.0.10",name:e.name,plugins:t,remotes:[],shared:{},inBrowser:(0,n.OL)()};this.name=e.name,this.options=o,this.snapshotHandler=new it(this),this.sharedHandler=new ct(this),this.remoteHandler=new dt(this),this.shareScopeMap=this.sharedHandler.shareScopeMap,this.registerPlugins([...o.plugins,...e.plugins||[]]),this.options=this.formatOptions(o,e)}initOptions(e){this.registerPlugins(e.plugins);const t=this.formatOptions(this.options,e);return this.options=t,t}async loadShare(e,t){return this.sharedHandler.loadShare(e,t)}loadShareSync(e,t){return this.sharedHandler.loadShareSync(e,t)}initializeSharing(e=z,t){return this.sharedHandler.initializeSharing(e,t)}initRawContainer(e,t,o){const n=Ge({name:e,entry:t}),a=new Ye({host:this,remoteInfo:n});return a.remoteEntryExports=o,this.moduleCache.set(e,a),a}async loadRemote(e,t){return this.remoteHandler.loadRemote(e,t)}async preloadRemote(e){return this.remoteHandler.preloadRemote(e)}initShareScopeMap(e,t,o={}){this.sharedHandler.initShareScopeMap(e,t,o)}formatOptions(e,t){const{shared:o}=Te(e,t),{userOptions:n,options:a}=this.hooks.lifecycle.beforeInit.emit({origin:this,userOptions:t,options:e,shareInfo:o}),r=this.remoteHandler.formatAndRegisterRemote(a,n),{shared:s}=this.sharedHandler.registerShared(a,n),l=[...a.plugins];n.plugins&&n.plugins.forEach(e=>{l.includes(e)||l.push(e)});const i={...e,...t,plugins:l,remotes:r,shared:s};return this.hooks.lifecycle.init.emit({origin:this,options:i}),i}registerPlugins(e){const t=function(e,t){const o=$.__FEDERATION__.__GLOBAL_PLUGIN__,n=[t.hooks,t.remoteHandler.hooks,t.sharedHandler.hooks,t.snapshotHandler.hooks,t.loaderHook,t.bridgeHook];return o.length>0&&o.forEach(t=>{e?.find(e=>e.name!==t.name)&&e.push(t)}),e&&e.length>0&&e.forEach(e=>{n.forEach(o=>{o.applyPlugin(e,t)})}),e}(e,this);this.options.plugins=this.options.plugins.reduce((e,t)=>t?(e&&!e.find(e=>e.name===t.name)&&e.push(t),e):e,t||[])}registerRemotes(e,t){return this.remoteHandler.registerRemotes(e,t)}registerShared(e){this.sharedHandler.registerShared(this.options,{...this.options,shared:e})}}function ut(e){const t=new(B.__FEDERATION__.__DEBUG_CONSTRUCTOR__||pt)(e);return function(e){B.__FEDERATION__.__INSTANCES__.push(e)}(t),t}let mt=null;function ht(e){const t=(o=e.name,n=e.version,B.__FEDERATION__.__INSTANCES__.find(e=>!("slider.editor:0.0.10"!==e.options.id&&(e.options.name!==o||e.options.version||n)&&(e.options.name!==o||!n||e.options.version!==n))));var o,n;return t?(t.initOptions(e),mt||(mt=t),t):(mt=ut(e),mt)}function ft(...e){return g(mt,m(u,h)),mt.loadRemote.apply(mt,e)}function vt(...e){return g(mt,m(u,h)),mt.loadShare.apply(mt,e)}function gt(...e){return g(mt,m(u,h)),mt.loadShareSync.apply(mt,e)}function yt(...e){return g(mt,m(u,h)),mt.preloadRemote.apply(mt,e)}function bt(...e){return g(mt,m(u,h)),mt.registerRemotes.apply(mt,e)}function kt(...e){return g(mt,m(u,h)),mt.registerPlugins.apply(mt,e)}function wt(){return mt}function Et(...e){return g(mt,m(u,h)),mt.registerShared.apply(mt,e)}!function(e,t=(0,n.Bb)()){t&&(B.__FEDERATION__.__DEBUG_CONSTRUCTOR__=e,B.__FEDERATION__.__DEBUG_CONSTRUCTOR_VERSION__="0.21.3")}(pt)},985:(e,t,o)=>{var n=o(828);const a=["script"];var r=o(615);function s(e){e.S&&!e.federation.hasAttachShareScopeMap&&e.federation.instance&&e.federation.instance.shareScopeMap&&(e.S=e.federation.instance.shareScopeMap,e.federation.hasAttachShareScopeMap=!0)}function l(e){const{webpackRequire:t,moduleToHandlerMapping:o}=e,{consumesLoadingData:n,initializeSharingData:a}=t;if(n&&!n._updated){const{moduleIdToConsumeDataMapping:t={},initialConsumes:a=[],chunkMapping:r={}}=n;if(Object.entries(t).forEach(([e,t])=>{o[e]||(o[e]={getter:t.fallback,shareInfo:{shareConfig:{requiredVersion:t.requiredVersion,strictVersion:t.strictVersion,singleton:t.singleton,eager:t.eager,layer:t.layer},scope:Array.isArray(t.shareScope)?t.shareScope:[t.shareScope||"default"]},shareKey:t.shareKey})}),"initialConsumes"in e){const{initialConsumes:t=[]}=e;a.forEach(e=>{t.includes(e)||t.push(e)})}if("chunkMapping"in e){const{chunkMapping:t={}}=e;Object.entries(r).forEach(([e,o])=>{t[e]||(t[e]=[]),o.forEach(o=>{t[e].includes(o)||t[e].push(o)})})}n._updated=1}if(a&&!a._updated){const{federation:e}=t;if(!e.instance||!a.scopeToSharingDataMapping)return;const o={};for(let[e,t]of Object.entries(a.scopeToSharingDataMapping))for(let n of t)if("object"==typeof n&&null!==n){const{name:t,version:a,factory:r,eager:s,singleton:l,requiredVersion:i,strictVersion:c}=n,d={requiredVersion:`^${a}`},p=function(e){return void 0!==e};p(l)&&(d.singleton=l),p(i)&&(d.requiredVersion=i),p(s)&&(d.eager=s),p(c)&&(d.strictVersion=c);const u={version:a,scope:[e],shareConfig:d,get:r};o[t]?o[t].push(u):o[t]=[u]}e.instance.registerShared(o),a._updated=1}}const i={runtime:n,instance:void 0,initOptions:void 0,bundlerRuntime:{remotes:function(e){!function(e){const{webpackRequire:t,idToExternalAndNameMapping:o={},idToRemoteMap:n={},chunkMapping:a={}}=e,{remotesLoadingData:r}=t,s=t.federation?.bundlerRuntimeOptions?.remotes?.remoteInfos;if(!r||r._updated||!s)return;const{chunkMapping:l,moduleIdToRemoteDataMapping:i}=r;if(l&&i){for(let[e,t]of Object.entries(i))if(o[e]||(o[e]=[t.shareScope,t.name,t.externalModuleId]),!n[e]&&s[t.remoteName]){const o=s[t.remoteName];n[e]||=[],o.forEach(t=>{n[e].includes(t)||n[e].push(t)})}a&&Object.entries(l).forEach(([e,t])=>{a[e]||(a[e]=[]),t.forEach(t=>{a[e].includes(t)||a[e].push(t)})}),r._updated=1}}(e);const{chunkId:t,promises:o,webpackRequire:n,chunkMapping:l,idToExternalAndNameMapping:i,idToRemoteMap:c}=e;s(n),n.o(l,t)&&l[t].forEach(e=>{let t=n.R;t||(t=[]);const s=i[e],l=c[e]||[];if(t.indexOf(s)>=0)return;if(t.push(s),s.p)return o.push(s.p);const d=t=>{t||(t=new Error("Container missing")),"string"==typeof t.message&&(t.message+=`\nwhile loading "${s[1]}" from ${s[2]}`),n.m[e]=()=>{throw t},s.p=0},p=(e,t,n,a,r,l)=>{try{const i=e(t,n);if(!i||!i.then)return r(i,a,l);{const e=i.then(e=>r(e,a),d);if(!l)return e;o.push(s.p=e)}}catch(e){d(e)}};var u=(e,o,n)=>p(o.get,s[1],t,0,m,n),m=t=>{s.p=1,n.m[e]=e=>{e.exports=t()}};1===l.length&&a.includes(l[0].externalType)&&l[0].name?p(()=>{try{const e=(0,r.e4)(l[0].name,r.yq)+s[1].slice(1),t=n.federation.instance,o=()=>n.federation.instance.loadRemote(e,{loadFactory:!1,from:"build"});return"version-first"===t.options.shareStrategy?Promise.all(t.sharedHandler.initializeSharing(s[0])).then(()=>o()):o()}catch(e){d(e)}},s[2],0,0,m,1):p(n,s[2],0,0,(e,t,o)=>e?p(n.I,s[0],0,e,u,o):d(),1)})},consumes:function(e){l(e);const{chunkId:t,promises:o,installedModules:n,webpackRequire:a,chunkMapping:r,moduleToHandlerMapping:i}=e;s(a),a.o(r,t)&&r[t].forEach(e=>{if(a.o(n,e))return o.push(n[e]);const t=t=>{n[e]=0,a.m[e]=o=>{delete a.c[e];const n=t(),{shareInfo:r}=i[e];if(r?.shareConfig?.layer&&n&&"object"==typeof n)try{n.hasOwnProperty("layer")&&void 0!==n.layer||(n.layer=r.shareConfig.layer)}catch(e){}o.exports=n}},r=t=>{delete n[e],a.m[e]=o=>{throw delete a.c[e],t}};try{const s=a.federation.instance;if(!s)throw new Error("Federation instance not found!");const{shareKey:l,getter:c,shareInfo:d}=i[e],p=s.loadShare(l,{customShareInfo:d}).then(e=>!1===e?c():e);p.then?o.push(n[e]=p.then(t).catch(r)):t(p)}catch(e){r(e)}})},I:function({shareScopeName:e,webpackRequire:t,initPromises:o,initTokens:n,initScope:r}){const l=Array.isArray(e)?e:[e];var i=[];return l.forEach(l=>{i.push(function(l){r||(r=[]);const i=t.federation.instance;var c=n[l];if(c||(c=n[l]={from:i.name}),r.indexOf(c)>=0)return;r.push(c);const d=o[l];if(d)return d;var p=o=>{var n=e=>{return t="Initialization of sharing external failed: "+e,"undefined"!=typeof console&&console.warn&&console.warn(t);var t};try{var a=t(o);if(!a)return;var s=o=>o&&o.init&&o.init(t.S[l],r,{shareScopeMap:t.S||{},shareScopeKeys:e});if(a.then)return u.push(a.then(s,n));var i=s(a);if(i&&"boolean"!=typeof i&&i.then)return u.push(i.catch(n))}catch(e){n(e)}};const u=i.initializeSharing(l,{strategy:i.options.shareStrategy,initScope:r,from:"build"});s(t);const m=t.federation.bundlerRuntimeOptions.remotes;return m&&Object.keys(m.idToRemoteMap).forEach(e=>{const t=m.idToRemoteMap[e],o=m.idToExternalAndNameMapping[e][2];if(t.length>1)p(o);else if(1===t.length){const e=t[0];a.includes(e.externalType)||p(o)}}),u.length?o[l]=Promise.all(u).then(()=>o[l]=!0):o[l]=!0}(l))}),Promise.all(i).then(()=>!0)},S:{},installInitialConsumes:function(e){const{webpackRequire:t}=e;l(e);const{initialConsumes:o,moduleToHandlerMapping:n,installedModules:a}=e;o.forEach(e=>{t.m[e]=o=>{a[e]=0,delete t.c[e];const r=function(e){const{moduleId:t,moduleToHandlerMapping:o,webpackRequire:n}=e,a=n.federation.instance;if(!a)throw new Error("Federation instance not found!");const{shareKey:r,shareInfo:s}=o[t];try{return a.loadShareSync(r,{customShareInfo:s})}catch(e){throw console.error('loadShareSync failed! The function should not be called unless you set "eager:true". If you do not set it, and encounter this issue, you can check whether an async boundary is implemented.'),console.error("The original error message is as follows: "),e}}({moduleId:e,moduleToHandlerMapping:n,webpackRequire:t});if("function"!=typeof r)throw new Error(`Shared module is not available for eager consumption: ${e}`);const s=r(),{shareInfo:l}=n[e];if(l?.shareConfig?.layer&&s&&"object"==typeof s)try{s.hasOwnProperty("layer")&&void 0!==s.layer||(s.layer=l.shareConfig.layer)}catch(e){}o.exports=s}})},initContainerEntry:function(e){const{webpackRequire:t,shareScope:o,initScope:n,shareScopeKey:a,remoteEntryInitOptions:r}=e;if(!t.S)return;if(!t.federation||!t.federation.instance||!t.federation.initOptions)return;const s=t.federation.instance;s.initOptions({name:t.federation.initOptions.name,remotes:[],...r});const l=r?.shareScopeKeys,i=r?.shareScopeMap;if(a&&"string"!=typeof a)a.forEach(e=>{if(!l||!i)return void s.initShareScopeMap(e,o,{hostShareScopeMap:r?.shareScopeMap||{}});i[e]||(i[e]={});const t=i[e];s.initShareScopeMap(e,t,{hostShareScopeMap:r?.shareScopeMap||{}})});else{const e=a||"default";Array.isArray(l)?l.forEach(e=>{i[e]||(i[e]={});const t=i[e];s.initShareScopeMap(e,t,{hostShareScopeMap:r?.shareScopeMap||{}})}):s.initShareScopeMap(e,o,{hostShareScopeMap:r?.shareScopeMap||{}})}return t.federation.attachShareScopeMap&&t.federation.attachShareScopeMap(t),"function"==typeof t.federation.prefetch&&t.federation.prefetch(),Array.isArray(a)?Boolean(t.federation.initOptions.shared)?t.I(a,n):Promise.all(a.map(e=>t.I(e,n))).then(()=>!0):t.I(a||"default",n)}},attachShareScopeMap:s,bundlerRuntimeOptions:{}};if(!o.federation.runtime){var c=o.federation;for(var d in o.federation={},i)o.federation[d]=i[d];for(var d in c)o.federation[d]=c[d]}o.federation.instance||(o.federation.instance=o.federation.runtime.init(o.federation.initOptions),o.federation.attachShareScopeMap&&o.federation.attachShareScopeMap(o),o.federation.installInitialConsumes&&o.federation.installInitialConsumes(),!o.federation.isMFRemote&&o.federation.prefetch&&o.federation.prefetch())}},__webpack_module_cache__={},deferred,inProgress,dataWebpackPrefix,prevStartup,hasRun;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var o=__webpack_module_cache__[e]={exports:{}},n={id:e,module:o,factory:__webpack_modules__[e],require:__webpack_require__};return __webpack_require__.i.forEach(function(e){e(n)}),o=n.module,n.factory.call(o.exports,o,o.exports,n.require),o.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.c=__webpack_module_cache__,__webpack_require__.i=[],__webpack_require__.x=e=>{},__webpack_require__.federation||(__webpack_require__.federation={initOptions:{name:"slider.editor",remotes:[],shareStrategy:"version-first"},chunkMatcher:function(e){return!0},rootOutputDir:"",bundlerRuntimeOptions:{remotes:{remoteInfos:{},webpackRequire:__webpack_require__,idToRemoteMap:{},chunkMapping:{},idToExternalAndNameMapping:{}}}},__webpack_require__.consumesLoadingData={},__webpack_require__.remotesLoadingData={}),deferred=[],__webpack_require__.O=(e,t,o,n)=>{if(!t){var a=1/0;for(i=0;i<deferred.length;i++){for(var[t,o,n]=deferred[i],r=!0,s=0;s<t.length;s++)(!1&n||a>=n)&&Object.keys(__webpack_require__.O).every(e=>__webpack_require__.O[e](t[s]))?t.splice(s--,1):(r=!1,n<a&&(a=n));if(r){deferred.splice(i--,1);var l=o();void 0!==l&&(e=l)}}return e}n=n||0;for(var i=deferred.length;i>0&&deferred[i-1][2]>n;i--)deferred[i]=deferred[i-1];deferred[i]=[t,o,n]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var o in t)__webpack_require__.o(t,o)&&!__webpack_require__.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce((t,o)=>(__webpack_require__.f[o](e,t),t),[])),__webpack_require__.u=e=>e+"."+{689:"1adc1670",833:"d3c05d4d",920:"53051b9e"}[e]+".chunk.js",__webpack_require__.miniCssF=e=>e+".css",__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),inProgress={},dataWebpackPrefix="@reneos/slider.editor:",__webpack_require__.l=(e,t,o,n)=>{if(inProgress[e])inProgress[e].push(t);else{var a,r;if(void 0!==o)for(var s=document.getElementsByTagName("script"),l=0;l<s.length;l++){var i=s[l];if(i.getAttribute("src")==e||i.getAttribute("data-webpack")==dataWebpackPrefix+o){a=i;break}}a||(r=!0,(a=document.createElement("script")).charset="utf-8",__webpack_require__.nc&&a.setAttribute("nonce",__webpack_require__.nc),a.setAttribute("data-webpack",dataWebpackPrefix+o),a.src=e),inProgress[e]=[t];var c=(t,o)=>{a.onerror=a.onload=null,clearTimeout(d);var n=inProgress[e];if(delete inProgress[e],a.parentNode&&a.parentNode.removeChild(a),n&&n.forEach(e=>e(o)),t)return t(o)},d=setTimeout(c.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=c.bind(null,a.onerror),a.onload=c.bind(null,a.onload),r&&document.head.appendChild(a)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{__webpack_require__.S={};var e={},t={};__webpack_require__.I=(o,n)=>{n||(n=[]);var a=t[o];if(a||(a=t[o]={}),!(n.indexOf(a)>=0)){if(n.push(a),e[o])return e[o];__webpack_require__.o(__webpack_require__.S,o)||(__webpack_require__.S[o]={});var r=__webpack_require__.S[o],s="@reneos/slider.editor",l=(e,t,o,n)=>{var a=r[e]=r[e]||{},l=a[t];(!l||!l.loaded&&(!n!=!l.eager?n:s>l.from))&&(a[t]={get:o,from:s,eager:!!n})},i=[];return"default"===o&&(l("@reneos/app","1.0.6",()=>()=>__webpack_require__(302),1),l("three","0.181.0",()=>()=>__webpack_require__(815),1),l("vue","3.5.22",()=>()=>__webpack_require__(68),1),l("vue","3.5.24",()=>()=>__webpack_require__(31),1)),e[o]=i.length?Promise.all(i).then(()=>e[o]=1):1}}})(),(()=>{__webpack_require__.federation.initOptions.shared={"@reneos/app":[{version:"1.0.6",get:()=>()=>__webpack_require__(302),scope:["default"],shareConfig:{eager:!0,requiredVersion:"1.0.6",singleton:!0,layer:null}}],three:[{version:"0.181.0",get:()=>()=>__webpack_require__(815),scope:["default"],shareConfig:{eager:!0,singleton:!0,layer:null}}],vue:[{version:"3.5.22",get:()=>()=>__webpack_require__(68),scope:["default"],shareConfig:{eager:!0,singleton:!0,layer:null}},{version:"3.5.24",get:()=>()=>__webpack_require__(31),scope:["default"],shareConfig:{eager:!0,singleton:!0,layer:null}}]},__webpack_require__.S={};var e={},t={};__webpack_require__.I=(o,n)=>__webpack_require__.federation.bundlerRuntime.I({shareScopeName:o,webpackRequire:__webpack_require__,initPromises:e,initTokens:t,initScope:n})})(),__webpack_require__.p="/editor/",(()=>{var e={};__webpack_require__.consumesLoadingData.moduleIdToConsumeDataMapping={15:{fallback:()=>()=>__webpack_require__(31),shareScope:["default"],singleton:!0,requiredVersion:"",strictVersion:!1,eager:!0,layer:void 0,shareKey:"vue"},875:{fallback:()=>()=>__webpack_require__(815),shareScope:["default"],singleton:!0,requiredVersion:"",strictVersion:!1,eager:!0,layer:void 0,shareKey:"three"},334:{fallback:()=>()=>__webpack_require__(68),shareScope:["default"],singleton:!0,requiredVersion:"^3.5.22",strictVersion:!1,eager:!0,layer:void 0,shareKey:"vue"},117:{fallback:()=>()=>__webpack_require__(815),shareScope:["default"],singleton:!0,requiredVersion:!1,strictVersion:!1,eager:!0,layer:void 0,shareKey:"three"},320:{fallback:()=>()=>__webpack_require__(302),shareScope:["default"],singleton:!0,requiredVersion:"1.0.6",strictVersion:!1,eager:!0,layer:void 0,shareKey:"@reneos/app"}};var t={};__webpack_require__.consumesLoadingData.initialConsumes=[15,875,334,117,320],__webpack_require__.federation.installInitialConsumes=()=>__webpack_require__.federation.bundlerRuntime.installInitialConsumes({initialConsumes:__webpack_require__.consumesLoadingData.initialConsumes,installedModules:e,moduleToHandlerMapping:t,webpackRequire:__webpack_require__}),__webpack_require__.consumesLoadingData.chunkMapping={792:[15,875,334,117,320]},__webpack_require__.f.consumes=(o,n)=>{__webpack_require__.federation.bundlerRuntime.consumes({chunkMapping:__webpack_require__.consumesLoadingData.chunkMapping,installedModules:e,chunkId:o,moduleToHandlerMapping:t,promises:n,webpackRequire:__webpack_require__})}})(),(()=>{if("undefined"!=typeof document){var e={792:0};__webpack_require__.f.miniCss=(t,o)=>{e[t]?o.push(e[t]):0!==e[t]&&{689:1,833:1,920:1}[t]&&o.push(e[t]=(e=>new Promise((t,o)=>{var n=__webpack_require__.miniCssF(e),a=__webpack_require__.p+n;if(((e,t)=>{for(var o=document.getElementsByTagName("link"),n=0;n<o.length;n++){var a=(s=o[n]).getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(a===e||a===t))return s}var r=document.getElementsByTagName("style");for(n=0;n<r.length;n++){var s;if((a=(s=r[n]).getAttribute("data-href"))===e||a===t)return s}})(n,a))return t();((e,t,o,n,a)=>{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",__webpack_require__.nc&&(r.nonce=__webpack_require__.nc),r.onerror=r.onload=o=>{if(r.onerror=r.onload=null,"load"===o.type)n();else{var s=o&&o.type,l=o&&o.target&&o.target.href||t,i=new Error("Loading CSS chunk "+e+" failed.\n("+s+": "+l+")");i.name="ChunkLoadError",i.code="CSS_CHUNK_LOAD_FAILED",i.type=s,i.request=l,r.parentNode&&r.parentNode.removeChild(r),a(i)}},r.href=t,document.head.appendChild(r)})(e,a,0,t,o)}))(t).then(()=>{e[t]=0},o=>{throw delete e[t],o}))}}})(),prevStartup=__webpack_require__.x,hasRun=!1,__webpack_require__.x=()=>{if(hasRun||(hasRun=!0,__webpack_require__(985)),"function"==typeof prevStartup)return prevStartup();console.warn("[Module Federation] prevStartup is not a function, skipping startup execution")},(()=>{var e={792:0};__webpack_require__.f.j=(t,o)=>{var n=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==n)if(n)o.push(n[2]);else{var a=new Promise((o,a)=>n=e[t]=[o,a]);o.push(n[2]=a);var r=__webpack_require__.p+__webpack_require__.u(t),s=new Error;__webpack_require__.l(r,o=>{if(__webpack_require__.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var a=o&&("load"===o.type?"missing":o.type),r=o&&o.target&&o.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+r+")",s.name="ChunkLoadError",s.type=a,s.request=r,n[1](s)}},"chunk-"+t,t)}},__webpack_require__.O.j=t=>0===e[t];var t=(t,o)=>{var n,a,[r,s,l]=o,i=0;if(r.some(t=>0!==e[t])){for(n in s)__webpack_require__.o(s,n)&&(__webpack_require__.m[n]=s[n]);if(l)var c=l(__webpack_require__)}for(t&&t(o);i<r.length;i++)a=r[i],__webpack_require__.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return __webpack_require__.O(c)},o=self.webpackChunk_reneos_slider_editor=self.webpackChunk_reneos_slider_editor||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})(),__webpack_require__.x();var __webpack_exports__=__webpack_require__.O(void 0,[333,489,753,776],()=>__webpack_require__(39));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();