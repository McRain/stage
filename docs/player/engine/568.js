/*! For license information please see 568.js.LICENSE.txt */
"use strict";(self.webpackChunk_reneos_3d_player_engine=self.webpackChunk_reneos_3d_player_engine||[]).push([[568],{183:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});var a=s(702);class n extends a.Object3D{static get IsElement(){return!0}constructor(e){super(),this.prototypes=["base"],this.isElement=!0,this.isBase=!0,this.uid=e.uid,this.data=e,this.type="element",this.data.actions||(this.data.actions=[]),e.position&&(this.position.copy(e.position),this.data.position=this.position.clone()),e.rotation&&(this.rotation.setFromVector3(e.rotation,"XYZ"),this.data.rotation=this.rotation.clone()),e.scale&&(this.scale.copy(e.scale),this.data.scale=this.scale.clone()),this.visible=e.view||!1}addAction(e){this.data.actions.push(e)}get actions(){return this.data.actions}get model(){return this}get visible(){return super.visible}set visible(e){super.visible=e}addElement(e,t,s,a){s===this?(this.add(t),e.position&&t.position.copy(a[e.position]||e.position),e.scale&&t.scale.copy(a[e.scale]||e.scale)):s.addElement(e,t,s,a)}}const i=n},351:(e,t,s)=>{s.d(t,{A:()=>a});const a=class{constructor(){this._events={"*":[]}}subs(e,t,s){null==this._events[e]&&(this._events[e]=[]),this._events[e].push({handler:s,once:t})}on(e,t){this.subs(e,!1,t)}once(e,t){this.subs(e,!0,t)}off(e,t){const s=this._events[e];if(s){for(let e=s.length-1;e>=0;e--)s[e].handler===t&&s.splice(e,1);0===s.length&&delete this._events[e]}}clear(e){this._events[e]=[]}clearAll(){this._events={"*":[]}}emit(e,...t){const s=[];this._events[e]&&s.push(...this._events[e]),this._events["*"].length&&s.push(...this._events["*"].map(t=>({handler:t.handler.bind(this,e),once:t.once})));for(let e=s.length-1;e>=0;e--){const a=s[e];a.handler.apply(null,t),a.once&&s.splice(e,1)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}}},900:(e,t,s)=>{s.r(t),s.d(t,{ActionsManager:()=>_,AssetsManager:()=>m,CssManager:()=>je,Factory:()=>M,MouseManager:()=>Ee,Project:()=>H,SlidesManager:()=>K,THREE:()=>n});var a=s(702),n=s.t(a,2),i=s(351);class o extends i.A{constructor(e){super(),this.isAsset=!0,this.data=e,this._clones=[],this.promise=null,this.progress=0,this._resource=null}get url(){return this.data.url}get uid(){return this.data.uid}get type(){return this.data.type}get name(){return this.data.name}set name(e){this.data.name=e}get resource(){if(this.data.clone){console.log("CLONE");const e=this._resource.clone();return e.uid=`${this.uid}_${Date.now()}`,this._clones.push(e),e.traverse(e=>{e.visible=!0}),e}return this._resource}async getResource(){if(this.data.clone){const e=this._resource.clone();return e.uid=this.uid,e}return this._resource}get clone(){return this.data.clone}set clone(e){this.data.clone=e}async load(){}async update(e,t){console.log(e),this.data[e]=t,this.emit("update",this)}destroy(){this._clones.forEach(e=>{e.parent&&e.parent.remove(e)}),this.emit("destroy",this)}}const r=o;var c=s(92);var l=s(231);const d=new Map,h={gltf:class extends r{constructor(e){super(e),this.uses={}}get shadow(){return this.data.shadow||{}}set shadow(e){this.data.shadow=e}_updateEnvMap(e){this.data.envMap=e?e.uid:null;const t=e?e.resource:null;for(let e=0;e<this._clones.length;e++)this._clones[e].traverse(e=>{e.isMesh&&(e.material.envMap=t)});this._resource.traverse(e=>{e.isMesh&&(e.material.envMap=t)}),this.emit("update")}async _setEnvMap(e,t=!1){if(console.log(e),t||!e||e!==this.data.envMap){const t=this.data.envMap;let s=this.uses[t];if(s&&(delete this.uses[t],s.off("destroy",this._updateEnvMap.bind(this,null)),s.off("update",this._updateEnvMap.bind(this))),delete this.data.envMap,s=null,e){const t=this.data.envMap=e;if(s=this.uses[t]=await m.FindAsset(t),!s)return;s.on("destroy",this._updateEnvMap.bind(this,null)),s.on("update",this._updateEnvMap.bind(this))}this._updateEnvMap(s)}}async load(){const e=await m.Load(this,{type:"arrayBuffer"}),t=new c.B;await new Promise(s=>{t.parse(e,null,async e=>{this._resource=e.scene.children.length>1?e.scene:e.scene.children[0],this._resource.uid=this.uid,this.data.position&&this._resource.position.copy(this.data.position),this.data.rotation&&this._resource.rotation.set(this.data.rotation.x,this.data.rotation.y,this.data.rotation.z,"XYZ"),this.data.scale&&this._resource.scale.copy(this.data.scale),await this._setEnvMap(this.data.envMap,!0),this._resource.traverse(e=>{e.isMesh&&(e.castShadow=this.data.shadow?.cast||!1,e.receiveShadow=this.data.shadow?.receive||!1,e.geometry.computeBoundingBox())}),this.emit("change",this),s()},e=>{console.warn(e)})})}async update(e,t){switch(console.log(`Update ${e}`),e){case"url":await this.load();break;case"envMap":await this._setEnvMap(t);break;default:this._resource.traverse(e=>{e.isMesh&&(e.castShadow=this.data.shadow?.cast||!1,e.receiveShadow=this.data.shadow?.receive||!1)})}super.update(e,t)}setTo(e){e.isObject3D&&e.add(this.resource)}},texture:class extends r{constructor(e){super(e)}async load(){const e=new a.TextureLoader;this.resource=await e.load(this.data.url)}setElement(e,t={}){this.element=e,this.elementData=t,this.element.add(this.resource),this.applyData(this.data),this.applyData(this.elementData)}updateResource(e,t){this.element.children.find(e=>e.uid===this.data.uid)!==e&&(this.element.remove(this.resource),this.resource=e,this.element.add(this.resource)),this.applyData(t),this.applyData(this.elementData)}destroy(){this.element.children.find(e=>e.uid===this.data.uid)&&this.element.remove(this.resource)}},hdr:class extends r{constructor(e){return super(e),this.uses={},new Proxy(this,{get:(e,t)=>t in e?e[t]:e.data[t]})}load(){return new Promise(e=>{(new l.Y).load(this.data.url,t=>{t.mapping=a.EquirectangularReflectionMapping,this._resource=t,this._resource.asset=this,this._resource.uid=this.uid,this.emit("update",this),e()})})}async update(e,t,s){if(this.data[t]=e[t],"url"===t)return this.load(s)}}};let u=async(e,t={type:"text"})=>{const s=await fetch(e.url);return await s[t.type]()};class p{static get Assets(){return d}static SetLoader(e){u=e}static async Init(e,t={}){console.log("INIT");const s=[],a=[];for(let t=0;t<e.length;t++){const s=p.Add(e[t]);a.push(s)}a.forEach(e=>{s.push(e.load())});try{await Promise.allSettled(s)}catch(e){console.warn(e)}console.log([...d.values()].map(e=>e.resource)),console.log("Çomplete")}static GetAsset(e){return d.get(e)}static GetAssets(e){const t=new Set(e);return[...d.values()].filter(e=>t.has(e.uid))}static GetResource(e){const t=d.get(e);if(t)return t._resource?t.resource:(t.promise||(t.promise=new Promise(async e=>{await t.load(),e(t.resource)})),t.promise)}static FindAsset(e){const t=d.get(e);if(t)return t.resource?t:(t.promise||(t.promise=new Promise(async e=>{await t.load(),e(t)})),t.promise)}static async SetAssetTo(e,t){d.get(t.uid).setTo(e)}static Load(e,t){return u(e,t)}static Add(e){const t=new(0,h[e.type])(e);return d.set(t.uid,t),t}static async Update(e,t,s){const a=d.get(e.uid);if(a)try{await a.update(t,s)}catch(e){console.warn(e)}}static Remove(e){d.has(e)&&(d.get(e).destroy(),d.delete(e))}}const m=p;a.Color.prototype.encode=function(){return{type:"Color",args:[`#${this.getHexString()}`]}},a.Vector3.prototype.encode=function(){return{type:"Vector3",args:[this.x,this.y,this.z]}},s(183);const g={PlaneGeometry:a.PlaneGeometry,SphereGeometry:a.SphereGeometry,BoxGeometry:a.BoxGeometry,BufferGeometry:a.BufferGeometry,Group:a.Group,Object3D:a.Object3D,PerspectiveCamera:a.PerspectiveCamera,OrthographicCamera:a.OrthographicCamera,InstancedMesh:a.InstancedMesh,Mesh:a.Mesh,DirectionalLight:a.DirectionalLight,AmbientLight:a.AmbientLight,Color:a.Color,Vector3:a.Vector3,Vector2:a.Vector2,Quaternion:a.Quaternion,Matrix4:a.Matrix4,MeshLambertMaterial:a.MeshLambertMaterial,MeshPhysicalMaterial:a.MeshPhysicalMaterial,MeshStandardMaterial:a.MeshStandardMaterial,BufferAttribute:a.BufferAttribute},f=[{label:"3Д Объект",type:"Object3D"},{label:"Группа",type:"Group"},{label:"DirectionalLight",type:"DirectionalLight"},{label:"AmbientLight",type:"AmbientLight"},{label:"PerspectiveCamera",type:"PerspectiveCamera"},{label:"OrthographicCamera",type:"OrthographicCamera"}],y={},w={},v=[{label:"Base",type:"base",module:()=>Promise.resolve().then(s.bind(s,183))},{label:"Label2D",type:"label2d",module:()=>s.e(736).then(s.bind(s,736))},{label:"VideoPlane",type:"videoplane",module:()=>s.e(241).then(s.bind(s,241))}],b=new i.A;class x{static RegisterElement(e,t,s={}){v.push({label:e,type:e,module:t,...s})}static Find(e){return w[e]}static CheckUseAsset(e){return Object.values(w).reduce((t,s)=>t+(s.data.assets?.some(t=>t.uid===e)?1:0),0)}static GetTypes(){return[...v,...f]}static GetType(e){return v.find(t=>t.type===e)?.module}static AddTemplate(e){y[e.id]=e}static AddTemplates(e){e.forEach(e=>{y[e.id]=e})}static GetElementProp(e,t){let s=w[e];const a=t.split(".");for(let e=0;e<a.length;e++)s=s[a[e]];return s}static async UpdateElement(e,t){const s=w[e];Object.keys(t).forEach(async e=>{s[e]=await x.CreateElement(t[e])})}static Encode(e){}static async CreateElement(e){if(null==e)return null;let t=e;if("object"==typeof e){const{type:s,properties:a,asset:n}=e;if(s){let n;const{args:i,...o}=e,r=v.find(e=>e.type===s);if(r){const e=await r.module();n=e.default||e}else g[s]&&(n=g[s]);if(Array.isArray(i)){const e=await Promise.all(i.map(e=>x.CreateElement(e)));t=new n(...e)}else if(i)t=new n(Object.fromEntries(await Promise.all(Object.entries(i).map(async([e,t])=>[e,await x.CreateElement(t)]))));else if(g[s])t=new n;else try{t=new n(o)}catch(e){console.warn(`${s} : ${e}`)}if(g[s]&&(t.data=e),o.assets?.length){t.assets=[...o.assets];for(let e=0;e<o.assets.length;e++)m.SetAssetTo(t,o.assets[e])}t.isObject3D&&!t.isElement&&(t.isElement=!0,t.type=s,t.model=t,t.properties=a||{},t.states=e.states||{},t.actions=o.actions||[])}else n&&(t=await m.GetResource(n));a&&await Promise.all(Object.entries(a).map(async([e,s])=>{t[e]=await x.CreateElement(s)}))}return t}static async BuildElements(e,t){const s=[];for(let a=0;a<e.length;a++){const n=e[a],i=await x.BuildElement(n,t);s.push(i)}return s}static async BuildElement(e,t){if(!t)return void console.warn("No find container");const s=structuredClone(y[e.template]?{...y[e.template],...e}:JSON.parse(JSON.stringify(e))),{uid:a,name:n}=s,i=await x.CreateElement(s);if(i){if(i.uid=a||`element${Date.now()}`,i.name=n||"",i.paths=t.paths?[...t.paths,i.uid]:[i.uid],i.path=i.paths.join("."),t){const e=v.find(e=>e.type===i.type);if(e?.verifyparent&&!e.verifyparent(t))return;const s=v.find(e=>e.type===t.type);if(s?.verifychild&&!s.verifychild(i))return;(t.addChild||t.add).bind(t)(i)}return e.position&&i.position.copy(e.position),e.children&&await x.BuildElements(e.children,i),w[i.uid]=i,i.init&&await i.init(),b.emit("create",i),i}}static async RemoveModel(e){w[e]&&delete w[e]}static async AddAsset(e,t){const s=m.GetAsset(t.uid);await m.GetResource(t.uid),w[e].setAsset(s,t)}static RemoveAsset(e,t){w[e].removeAsset(t)}}const M=new Proxy(x,{get:(e,t)=>t in e?e[t]:b[t]}),E={propset:function(e,t,s){let a=t;for(let t=0;t<e.paths.length;t++)a=a[e.paths[t]];a[e.property]=e.value}},C={cameraSet:{uid:"cameraSet",type:"func",handler:E.func,paths:["model"],method:"activate",values:{}},propset:{uid:"propset",type:"propset",handler:E.propset}};async function A(e,t){const s=C[e.uid];await s.handler({...s,...e},t,!1),e.actions&&await S(e.actions,t)}async function S(e,t){const s=[];for(const a of e)s.push(A(a,t));await Promise.all(s)}class P{static get Library(){return C}static Init(e){for(let t=0;t<e.length;t++)P.Add(e[t])}static Add(e){e.handler=E[e.type],C[e.uid]=e}static GetAction(e){return E[e]}static RegisterAction(e,t){E[e]=t,Object.values(C).forEach(t=>{t.type===e&&(t.handler=E[t.type])})}static async Run(e=[],t,s){const a=e.filter(e=>e.hook===s);0!==a.length&&await S(a,t)}static async Execute(e,t){const s=[];for(let a=0;a<e.length;a++){const n=e[a],i=n.actions?n.actions.filter(e=>e.hook===t):[],o=n.model.actions?n.model.actions.filter(e=>e.hook===t):[];(i.length>0||o.length>0)&&s.push(S([...i,...o],n))}await Promise.all(s)}}const _=P;function k(e){for(;e;){if(e.isElement)return e;e=e.parent}return null}var O=s(24);let R,D;const j=class{static MoveTo(e,t){const s={position:new a.Vector3,time:1e3,...e,control:!1},n={position:new a.Vector3,time:1e3,...t,control:!1};R.enabled=!1;const i=Workspace.Camera.position.clone(),o=R.target.clone();s.control=s.time>n.time,n.control=n.time>=s.time;const r=new Tween(i).to(s.position,s.time).easing(Easing.Quadratic.InOut).onUpdate(()=>{Workspace.Camera.position.copy(i),Workspace.Camera.updateProjectionMatrix(),R.update()}).onComplete(()=>{s.control&&(R.enabled=!0),tweengroup.remove(r)}).start(),c=new Tween(o).to(n.position,n.time).easing(Easing.Quadratic.InOut).onUpdate(()=>{R.target.copy(o),R.getPolarAngle()>R.maxPolarAngle&&R.target.setY(center.y+Math.cos(R.maxPolarAngle)*distance)}).onComplete(()=>{n.control&&(R.enabled=!0),tweengroup.remove(c)}).start();tweengroup.add(r,c)}static SetState(e){R.enabled=e}static Target(e){R.target.copy(e)}static Init({canvas:e},t,s){R&&s.remove(R),R=new O.N(t,e),R.enabled=!0,R.enableDamping=!0,R.dampingFactor=.25,R.screenSpacePanning=!1,R.minDistance=.01,R.maxDistance=500}static ChangeCamera(e){R.object=e}static get Transformer(){return D}static Select(e){e?D.attach(e):D.detach()}static Update(e){R.update(e)}static FitTo({center:e,radius:t}){const s=a.MathUtils.degToRad(Workspace.Camera.fov),n=t/Math.sin(s/2),i=(new a.Vector3).subVectors(Workspace.Camera.position,e).normalize(),o=e.clone().add(i.multiplyScalar(n)),r=Workspace.Camera.position.clone();R.enabled=!1;const c=R.target.clone(),l=new Tween(c).to(e,1e3).easing(Easing.Quadratic.InOut).onUpdate(()=>{R.target.copy(c),R.getPolarAngle()>R.maxPolarAngle&&R.target.setY(e.y+Math.cos(R.maxPolarAngle)*distance)}).start(),d=new Tween(r).to(o,1e3).easing(Easing.Quadratic.InOut).onUpdate(()=>{Workspace.Camera.position.copy(r);const t=Workspace.Camera.position.distanceTo(e);t<R.minDistance?Workspace.Camera.position.copy(e.clone().add(i.clone().multiplyScalar(R.minDistance))):t>R.maxDistance&&Workspace.Camera.position.copy(e.clone().add(i.clone().multiplyScalar(R.maxDistance))),Workspace.Camera.updateProjectionMatrix(),R.update()}).onComplete(()=>{R.enabled=!0,tweengroup.remove(d,l)}).start();tweengroup.add(d,l)}};let T,G,W,I,L,B,F,U=[];const V=new i.A;function $(e){for(let t=0;t<U.length;t++)U[t](e);I.render(W,B)}class Y{static get Root(){return L}static get Scene(){return W}static get Camera(){return B}static get Canvas(){return T}static get Renderer(){return I}static Init(e){T=e,G=new a.Clock,W=new a.Scene,I=new a.WebGLRenderer({canvas:e,alpha:!0,powerPreference:"high-performance",antialias:!0,stencil:!1});const t=T.clientWidth,s=T.clientHeight;I.setSize(t,s,!1),I.setPixelRatio(window.devicePixelRatio),I.shadowMap.enabled=!0,I.shadowMap.type=a.PCFSoftShadowMap,L=new a.Object3D,W.add(L),F=L.position.clone()}static async Start(){B=new a.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.01,1e3),B.uid="EditorCamera",W.add(B),B.position.set(0,10,20),I.setAnimationLoop($),B.layers.enable(1),Ee.Init(I.domElement,B,W,L),Ee.on("click",e=>{_.Run([...e.actions,...e.state?.actions||[]],e,"mouse.click")}),Ee.on("mouse.in",e=>{_.Run([...e.actions,...e.state?.actions||[]],e,"mouse.in")}),Ee.on("mouse.out",e=>{_.Run([...e.actions,...e.state?.actions||[]],e,"mouse.out")}),U.push(Ee.Update)}static AddToUpdate(e){U.push(e)}static RemoveFromUpdate(e){const t=U.indexOf(e);t>=0&&U.splice(t,1)}static Collect(e,t,s=[]){for(let a=0;a<e.length;a++){const n=e[a];n.isElement&&n.states[t]&&s.push(n),n.children.length&&Y.Collect(n.children,t,s)}}static FindStates(e){const t=[];return Y.Collect(L.children,e,t),t}static Find(e){console.log(e);let t=L;for(let s=0;s<e.length;s++)t=t.children.find(t=>t.uid===e[s]);return t}static SetCamera(e){B.visible=!1,B=e,B.aspect=window.innerWidth/window.innerHeight,B.updateProjectionMatrix(),B.visible=!0,Ee.SetCamera(B)}static async Builds(e){await M.BuildElements(e,L),L.children.push(...L.children),console.log(L)}static FindBlock(e){return L.children.find(t=>t.uid===e)}static FindElement(e){let t=L.children.find(t=>t.uid===e[0]);for(let s=1;s<e.length;s++)t=t.children.find(t=>t.uid===e[s]);return t}static async SetAsset(e,t){const s=await m.GetAsset({uid:t.uid}),a=e.split(".");let n=L.children.find(e=>e.uid===a[0]);for(let e=1;e<a.length;e++)n=n.children.find(t=>t.uid===a[e]);n.addAsset(t,s)}static RemoveAsset(e,t){const s=e.split(".");let a=L.children.find(e=>e.uid===s[0]);for(let e=1;e<s.length;e++)a=a.children.find(t=>t.uid===s[e]);a.removeAsset(t)}static RemoveElement(e){const t=e.split(".");let s=L.children;for(let e=0;e<t.length-1;e++){const a=s.find(s=>s.uid===t[e]);s=a.children}const a=s.findIndex(t=>t.path===e);if(a>=0){const e=s.splice(a,1);e[0].parent.remove(e[0])}}}const z=new Proxy(Y,{get:(e,t)=>t in e?e[t]:V[t]});window.Project=z;const H=z,N=[],X=[];let Q,q=!1;const Z=new i.A;class J{static get Processed(){return q}static get Current(){return Q}static AddSlides(e){for(let t=0;t<e.length;t++){const s={name:"",children:[],camera:{},scene:{},actions:[],...e[t]},a=H.FindStates(s.uid);for(let e=0;e<a.length;e++){const t=a[e];s.children.push({model:t,...t.states[s.uid]})}N.push(s)}return Z.emit("add",N),N}static async GoTo(e){const t="number"==typeof e?N[e]:N.find(t=>t.uid===e);t&&Q?.uid!==t.uid&&(X[X.length-1]!==t.uid&&X.push(t.uid),await J.Activate(t,Q))}static async GoToNext(){const e=N.findIndex(e=>e===Q);await J.GoTo(e+1)}static async GoToBack(){X.pop(),await J.GoTo(X[X.length-1])}static async Activate(e,t){q||(q=!0,t?(await J.SlideOut(t,e.children),Z.emit("activate",e,t),await J.SlideIn(e,t.children)):(Z.emit("activate",e,t),await J.SlideIn(e)),Q=e,Z.emit("change",e,t),q=!1)}static async SlideIn(e,t=[]){const s=[],a=[],n=[];for(let a=0;a<e.children.length;a++){const i=e.children[a];t.findIndex(e=>e.model.uid===i.model.uid)>=0?n.push(i):s.push(i)}for(let s=0;s<t.length;s++){const n=t[s];e.children.findIndex(e=>e.model.uid===n.model.uid)<0&&a.push(n)}try{if(e.camera?.path&&e.camera?.path!==H.Camera?.path){const t=e.camera.path.split("."),s=H.Find(t);H.SetCamera(s),s.updateProjectionMatrix()}e.scene?.background?.color&&(H.Scene.background=new Color(e.scene?.background.color))}catch(e){console.warn(e.message)}try{if(e.scene.background.uid){const t=AssetsManager.GetAsset(e.scene.background.uid);H.Scene.background=t.resource}}catch(e){console.warn(e.message)}const i=[...s,...n];await Promise.all([_.Execute(i,"slide.in.before"),_.Run(e.actions,e,"slide.in.before")]),await _.Execute(s,"enable.on"),await Promise.all([_.Execute(i,"slide.in"),_.Run(e.actions,e,"slide.in")]);const o=i.map(t=>J.ActivateState(t,e.uid));await Promise.all(o),await Promise.all([_.Execute(i,"slide.in.after"),_.Run(e.actions,e,"slide.in.after")])}static async ActivateState(e,t){const{position:s,rotation:a,scale:n,actions:i=[],model:o,properties:r={},store:c={},...l}=e;o.state=e,s&&o.position.copy(s),a&&o.rotation.setFromVector3(a,"XYZ"),n&&o.scale.copy(n);const d=Object.keys(l);for(let e=0;e<d.length;e++){const t=d[e],s=t.split("."),a=l[t];let n=s[0],i=o;for(let e=0;e<s.length-1;e++)i=i[s[e]],n=s[e+1];const r=await M.CreateElement(a);i[n]=r}"visible"in l||(o.visible=!0)}static async SlideOut(e,t){const s=[],a=[];for(let n=0;n<e.children.length;n++){const i=e.children[n],o=t.find(e=>e.model.uid===i.model.uid);o&&!1!==o.visible?s.push(i):a.push(i)}const n=[...a,...s];await Promise.all([_.Execute(n,"slide.out"),_.Run(e.actions,e,"slide.out")]),await _.Execute(a,"disable.on");for(let t=0;t<a.length;t++)J.DectivateState(a[t],e)}static DectivateState(e,t){e.model.visible=!1}}const K=new Proxy(J,{get:(e,t)=>t in e?e[t]:Z[t]}),ee=new a.Raycaster,te=new i.A;let se,ae,ne,ie,oe=0,re=0;const ce={x:0,y:0};let le,de=!1,he=0,ue=null,pe=!1,me=.03,ge=.03,fe=.01,ye=.01,we=window.innerWidth/2,ve=window.innerHeight/2;function be(e){if(de&&(oe=(e.clientX-we)*fe,re=(e.clientY-ve)*ye,Date.now()-he>50)){he=Date.now();const t=e.target.getBoundingClientRect(),s=new a.Vector2((e.clientX-t.left)/t.width*2-1,-(e.clientY-t.top)/t.height*2+1);ee.setFromCamera(s,ae);const n=ee.intersectObjects(se.children,!0);let i=null;if(n.length>0)for(let e=0;e<n.length;e++){const t=k(n[e].object);if(t&&t.visible){i=t;break}}if(pe){if(!ue||i&&i===ue){if(i===ue)return}else if(te.emit("mouse.out",ue),ue=null,pe=!1,i)return ue=i,te.emit("mouse.in",ue),void(pe=!0)}else i&&(ue=i,te.emit("mouse.in",ue),pe=!0)}}function xe(e){ce.x=e.clientX,ce.y=e.clientY,le=Date.now()}function Me(e){if(!de||K.Processed)return;if(Math.abs(ce.x-e.clientX)>10||Math.abs(ce.y-e.clientY)>10||Date.now()-le>500)return;const t=e.clientX/window.innerWidth,s=-e.clientY/window.innerHeight,n=new a.Vector2;n.x=2*t-1,n.y=2*s+1,ee.setFromCamera(n,ae);const i=ee.intersectObjects(se.children,!0);if(0===i.length)return;const o=[];for(let e=0;e<i.length;e++){const t=k(i[e].object);if(t.visible&&!o.includes(t))return o.push(t),void te.emit("click",t)}}const Ee=new Proxy(class{static get Control(){return j}static Init(e,t,s,a,n){const i={camera:{range:{x:.01,y:.01},movespeed:{x:.03,y:.03}},...n};se=a,ne=s,ae=t,ie=e,me=i.camera.movespeed.x,ge=i.camera.movespeed.y,fe=i.camera.range.x,ye=i.camera.range.y,we=window.innerWidth/2,ve=window.innerHeight/2,e.addEventListener("click",Me.bind(null)),e.addEventListener("mousemove",be,!1),e.addEventListener("mousedown",xe,!1),de=!0}static Update(e){}static SetCamera(e){ae=e}},{get:(e,t)=>t in e?e[t]:te[t]});let Ce;const Ae=new i.A;class Se{static Init(e,t){Ce=new De({element:e}),Ce.setSize(window.innerWidth,window.innerHeight),Ce.elements.length=0;const s=t.width,a=t.height,n=s/Ce.domElement.offsetWidth,i=a/Ce.domElement.offsetHeight;Ce.domElement.style.transform=`scale(${n}, ${i})`,H.AddToUpdate(Se.Render)}static Render(){Ce.render(H.Scene,H.Camera)}static async OnCreate(e,t,s){if(e.isUIElement){e.on("click",()=>{_.Run([...e.actions||[],...e.states[s.actived.uid]?.actions||[]],e,"mouse.click")});try{const s=await t.addElement(e.data.element.component||"UILabel",{data:{...e.data.element,path:e.path},events:e.data.events||{}});e.setElement(s.data,s.element)}catch(e){return}Ce.elements.push(e)}}}const Pe=new a.Vector3,_e=new a.Matrix4,ke=new a.Matrix4,Oe=new a.Vector3,Re=new a.Vector3;class De{constructor(e={}){const t=this;let s,a,n,i;const o={objects:new WeakMap},r=void 0!==e.element?e.element:document.createElement("div");function c(e,s,a){Pe.setFromMatrixPosition(e.matrixWorld),Pe.applyMatrix4(ke);const c=Pe.z>=-1&&Pe.z<=1&&!0===e.layers.test(a.layers),l=e.element;!0===c&&(e.onBeforeRender(t,s,a),l.style.transform=`translate(${-100*e.center.x}%, ${-100*e.center.y}%) translate(${Pe.x*n+n}px, ${-Pe.y*i+i}px)`,l.parentNode!==r&&r.appendChild(l),e.onAfterRender(t,s,a));const d={distanceToCameraSquared:(h=a,u=e,Oe.setFromMatrixPosition(h.matrixWorld),Re.setFromMatrixPosition(u.matrixWorld),Oe.distanceToSquared(Re))};var h,u;o.objects.set(e,d);for(let t=0,s=e.children.length;t<s;t++);}r.style.overflow="hidden",this.domElement=r,this.elements=[],this.getSize=function(){return{width:s,height:a}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),_e.copy(t.matrixWorldInverse),ke.multiplyMatrices(t.projectionMatrix,_e);for(let s=0;s<this.elements.length;s++)c(this.elements[s],e,t);!function(e){const t=function(e){const t=[];for(let s=e.length-1;s>=0;s--)e[s].traverseVisible(function(e){e.isCSS2DObject&&t.push(e)});return t}(e).sort(function(e,t){return e.renderOrder!==t.renderOrder?t.renderOrder-e.renderOrder:o.objects.get(e).distanceToCameraSquared-o.objects.get(t).distanceToCameraSquared}),s=t.length;for(let e=0,a=t.length;e<a;e++)t[e].element.style.zIndex=s-e}(this.elements)},this.setSize=function(e,t){s=e,a=t,n=s/2,i=a/2,r.style.width=e+"px",r.style.height=t+"px"}}}const je=new Proxy(Se,{get:(e,t)=>t in e?e[t]:Ae[t]})}}]);