"use strict";(self.webpackChunk_reneos_3d_player_engine=self.webpackChunk_reneos_3d_player_engine||[]).push([[614,691],{30:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});var a=s(702);class n extends a.Object3D{static get IsElement(){return!0}constructor(e){super(),this.prototypes=["base"],this.isElement=!0,this.isBase=!0,this.uid=e.uid,this.data=e,this.type="element",this.data.actions||(this.data.actions=[]),e.position&&(this.position.copy(e.position),this.data.position=this.position.clone()),e.rotation&&(this.rotation.setFromVector3(e.rotation,"XYZ"),this.data.rotation=this.rotation.clone()),e.scale&&(this.scale.copy(e.scale),this.data.scale=this.scale.clone()),this.visible=e.view||!1}addAction(e){this.data.actions.push(e)}get actions(){return this.data.actions}get model(){return this}get visible(){return super.visible}set visible(e){super.visible=e}addElement(e,t,s,a){s===this?(this.add(t),e.position&&t.position.copy(a[e.position]||e.position),e.scale&&t.scale.copy(a[e.scale]||e.scale)):s.addElement(e,t,s,a)}}const i=n},351:(e,t,s)=>{s.d(t,{A:()=>a});const a=class{constructor(){this._events={"*":[]}}subs(e,t,s){null==this._events[e]&&(this._events[e]=[]),this._events[e].push({handler:s,once:t})}on(e,t){this.subs(e,!1,t)}once(e,t){this.subs(e,!0,t)}off(e,t){const s=this._events[e];if(s){for(let e=s.length-1;e>=0;e--)s[e].handler===t&&s.splice(e,1);0===s.length&&delete this._events[e]}}clear(e){this._events[e]=[]}clearAll(){this._events={"*":[]}}emit(e,...t){const s=[];this._events[e]&&s.push(...this._events[e]),this._events["*"].length&&s.push(...this._events["*"].map(t=>({handler:t.handler.bind(this,e),once:t.once})));for(let e=s.length-1;e>=0;e--){const a=s[e];a.handler.apply(null,t),a.once&&s.splice(e,1)}}addEventListener(e,t){this.on(e,t)}removeEventListener(e,t){this.off(e,t)}}},495:(e,t,s)=>{s.r(t),s.d(t,{ActionsManager:()=>te,AssetsManager:()=>m,BaseElement:()=>o.default,CssManager:()=>Oe,ElementModel:()=>r.default,Factory:()=>b,MouseManager:()=>Q,ProjectManager:()=>fe,SlidesManager:()=>Me,THREE:()=>n});var a=s(702),n=s.t(a,2),i=s(351),o=s(30),r=s(614);const c=class{constructor(e){this.data=e,this.resource=null,this.promise=null,this.elements=[]}async load(){}updateResource(e,t){this.resource=e,this.applyData(t||this.data)}get uid(){return this.data.uid}};var l=s(92);var d=s(231);const h=new Map,u={gltf:class extends c{constructor(e){super(e)}async load(){await new Promise(e=>{(new l.B).load(this.data.url,async t=>{let s;this.resource=t.scene.children.length>1?t.scene:t.scene.children[0],this.data.transform?.position&&this.resource.position.copy(this.data.transform.position),this.data.transform?.rotation&&this.resource.rotation.set(this.data.transform.rotation.x,this.data.transform.rotation.y,this.data.transform.rotation.z,"XYZ"),this.data.transform?.scale&&this.resource.scale.copy(this.data.transform.scale),this.data.envMap&&(s=await m.GetResource(this.data.envMap)),this.resource.traverse(e=>{e.isMesh&&(this.data.envMap&&(e.material.envMap=s,e.material.envMapIntensity=.75),e.castShadow=!0,e.receiveShadow=!0,e.geometry.computeBoundingBox())}),e()})})}setElement(e,t={}){this.elements.push({element:e,data:t}),e.add(this.resource.clone()),this.applyData(t)}updateResource(e,t){super.updateResource(e,t);for(let t=0;t<this.elements.length;t++){const t=this.elements,s=t.element.children.find(e=>e.uid===this.data.uid);s!==e&&(t.element.remove(s),t.element.add(this.resource.clone())),this.applyData(t.data)}}async applyData(e){let t;this.resource.position.copy(e.transform?.position||{x:0,y:0,z:0}),this.resource.rotation.setFromVector3(e.transform?.rotation||{x:0,y:0,z:0},"XYZ"),this.resource.scale.copy(e.transform?.scale||{x:1,y:1,z:1}),e.transform?.quaternion&&this.resource.quaternion.copy(e.transform.quaternion),e.envMap&&(t=await m.GetAsset(e.envMap).resource),this.resource.traverse(s=>{s.isMesh&&(e.envMap&&(s.material.envMap=t),s.castShadow=e.shadow?.cast||!1,s.receiveShadow=e.shadow?.receive||!1,s.geometry.computeBoundingBox())})}destroy(){for(let e=0;e<this.elements.length;e++){const e=this.elements;e.elements.children.find(e=>e.uid===this.data.uid)&&e.elements.remove(this.resource)}}},texture:class extends c{constructor(e){super(e)}async load(){const e=new a.TextureLoader;this.resource=await e.load(this.data.url)}setElement(e,t={}){this.element=e,this.elementData=t,this.element.add(this.resource),this.applyData(this.data),this.applyData(this.elementData)}updateResource(e,t){this.element.children.find(e=>e.uid===this.data.uid)!==e&&(this.element.remove(this.resource),this.resource=e,this.element.add(this.resource)),this.applyData(t),this.applyData(this.elementData)}destroy(){this.element.children.find(e=>e.uid===this.data.uid)&&this.element.remove(this.resource)}},hdr:class extends c{constructor(e){super(e)}load(){return new Promise(e=>{(new d.Y).load(this.data.url,t=>{t.mapping=a.EquirectangularReflectionMapping,this.resource=t,e()})})}setElement(e,t={}){this.element=e,this.elementData=t,this.element.add(this.resource),this.applyData(this.data),this.applyData(this.elementData)}updateResource(e,t){this.element.children.find(e=>e.uid===this.data.uid)!==e&&(this.element.remove(this.resource),this.resource=e,this.element.add(this.resource)),this.applyData(t),this.applyData(this.elementData)}destroy(){this.element.children.find(e=>e.uid===this.data.uid)&&this.element.remove(this.resource)}},material:class extends c{constructor(e){super(e),this.resource=new a.MeshStandardMaterial,this.elements=[]}async load(){Object.keys(this.data.textures).forEach(async e=>{this.resource[e]=await m.GetResource(this.data.textures[e].uid)}),Object.keys(this.data.properties).forEach(async e=>{this.resource[e]=this.data.properties[e]})}setElement(e,t={}){this.elements.push({element:e,data:t}),e.add(this.resource.clone()),this.applyData(t)}updateResource(e,t){for(let s=0;s<this.elements.length;s++){const s=this.elements;s.element.children.find(e=>e.uid===this.data.uid)!==e&&(s.element.remove(this.resource),this.resource=e,s.element.add(this.resource.clone())),this.applyData(t),this.applyData(s.data)}}}},m=class{static GetAsset(e){return h.get(e)}static GetAssets(e){const t=new Set(e);return[...h.values()].filter(e=>t.has(e.uid))}static GetResource(e){const t=h.get(e);return t.resource?t.resource:(t.promise||(t.promise=new Promise(async e=>{await t.load(),e(t.resource)})),t.promise)}static async Init(e){for(let t=0;t<e.length;t++){const s=e[t],a=new(0,u[s.type])(s);h.set(a.uid,a)}const t=[];for(const[e,s]of h.entries())t.push(s.load());await Promise.allSettled(t)}static RemoveAsset(e){h.has(e.uid)&&(h.get(e.uid).destroy(),h.delete(e.uid))}},p={PlaneGeometry:a.PlaneGeometry,SphereGeometry:a.SphereGeometry,BoxGeometry:a.BoxGeometry,BufferGeometry:a.BufferGeometry,Group:a.Group,Object3D:a.Object3D,PerspectiveCamera:a.PerspectiveCamera,OrthographicCamera:a.OrthographicCamera,InstancedMesh:a.InstancedMesh,Mesh:a.Mesh,DirectionalLight:a.DirectionalLight,AmbientLight:a.AmbientLight,Color:a.Color,Vector3:a.Vector3,Vector2:a.Vector2,Quaternion:a.Quaternion,Matrix4:a.Matrix4,MeshLambertMaterial:a.MeshLambertMaterial,MeshPhysicalMaterial:a.MeshPhysicalMaterial,MeshStandardMaterial:a.MeshStandardMaterial,BufferAttribute:a.BufferAttribute},f=new i.A,g={block:{module:()=>s.e(314).then(s.bind(s,314)),allowparent:["$root"],denyparent:["block"],allowchild:[],denychild:["block"]},base:{module:()=>Promise.resolve().then(s.bind(s,30))},model:{module:()=>Promise.resolve().then(s.bind(s,614))},alight:{module:()=>s.e(966).then(s.bind(s,966))},label2d:{module:()=>s.e(127).then(s.bind(s,127))},videoplane:{module:()=>s.e(328).then(s.bind(s,328))}},y={},w={};class v{static RegisterElement(e,t,s={}){console.log(`Refister ${e}`),g[e]={label:e,type:e,module:t,...s}}static GetType(e){return g[e]?.module}static AddTemplate(e){y[e.id]=element}static AddTemplates(e){e.forEach(e=>{y[e.id]=e})}static GetElementProp(e,t){let s=w[e];const a=t.split(".");for(let e=0;e<a.length;e++)s=s[a[e]];return s}static async UpdateElement(e,t){const s=w[e];Object.keys(t).forEach(async e=>{s[e]=await v.CreateElement(t[e])})}static async CreateElement(e){if(null==e)return null;let t=e;if("object"==typeof e){const{type:s,properties:a,asset:n}=e;if(s){let a;const{args:n,...i}=e,o=g[s];if(o){const e=await o.module();a=e.default||e}else p[s]&&(a=p[s]);if(Array.isArray(n)){const e=await Promise.all(n.map(e=>v.CreateElement(e)));t=new a(...e)}else if(n)t=new a(Object.fromEntries(await Promise.all(Object.entries(n).map(async([e,t])=>[e,await v.CreateElement(t)]))));else if(p[s])t=new a;else try{t=new a(i)}catch(e){console.warn(i,s)}if(i.assets?.length){const e=m.GetAssets(i.assets.map(e=>e.uid));t.setAssets(e,i.assets)}t.isObject3D&&(t.isElement||(t.actions=e.actions||[],t.isElement=!0,t.model=t),t.paths=e.paths,t.path=t.paths.join("."))}else n&&(t=await m.GetResource(n));a&&await Promise.all(Object.entries(a).map(async([e,s])=>{t[e]=await v.CreateElement(s)}))}return t}static async BuildElements(e,t){const s={};for(let a=e.length-1;a>=0;a--){const n=e[a],i=await v.Build(e,n,s,t),o=e.findIndex(e=>e.uid===i.uid);o>=0&&e.splice(o,1)}}static async Build(e,t,s,a){if(!t)return;if(s[t.uid])return s[t.uid];const n=t.parent;let i=s[n];i||(i=await v.Build(e,e.find(e=>e.uid===n),s,a));const o=await v.BuildElement(t,i||a);return s[o.uid]=o,o}static async BuildElement(e,t){if(!t)return;const s=structuredClone(y[e.template]?{...y[e.template],...e}:JSON.parse(JSON.stringify(e))),{uid:a,name:n}=s,i=await v.CreateElement(s);if(i){if(i.uid=a,i.name=n||a,i.states=s.states||{},i.path=t.path?`${t.path}.${a}`:a,t){const e=g[i.type];if(e?.verifyparent&&!e.verifyparent(t))return;const s=g[t.type];if(s?.verifychild&&!s.verifychild(i))return;(t.addChild||t.add).bind(t)(i)}return e.position&&i.position.copy(e.position),e.children&&await v.BuildElements(e.children,i),w[i.uid]=i,i.init&&await i.init(),f.emit("create",i),i}}}const b=new Proxy(v,{get:(e,t)=>t in e?e[t]:f[t]});function x(e){for(;e;){if(e.isElement)return e;e=e.parent}return null}var M=s(24);let E,S;const C=class{static MoveTo(e,t){const s={position:new a.Vector3,time:1e3,...e,control:!1},n={position:new a.Vector3,time:1e3,...t,control:!1};E.enabled=!1;const i=Workspace.Camera.position.clone(),o=E.target.clone();s.control=s.time>n.time,n.control=n.time>=s.time;const r=new Tween(i).to(s.position,s.time).easing(Easing.Quadratic.InOut).onUpdate(()=>{Workspace.Camera.position.copy(i),Workspace.Camera.updateProjectionMatrix(),E.update()}).onComplete(()=>{s.control&&(E.enabled=!0),tweengroup.remove(r)}).start(),c=new Tween(o).to(n.position,n.time).easing(Easing.Quadratic.InOut).onUpdate(()=>{E.target.copy(o),E.getPolarAngle()>E.maxPolarAngle&&E.target.setY(center.y+Math.cos(E.maxPolarAngle)*distance)}).onComplete(()=>{n.control&&(E.enabled=!0),tweengroup.remove(c)}).start();tweengroup.add(r,c)}static SetState(e){E.enabled=e}static Target(e){E.target.copy(e)}static Init({canvas:e},t,s){E&&s.remove(E),E=new M.N(t,e),E.enabled=!0,E.enableDamping=!0,E.dampingFactor=.25,E.screenSpacePanning=!1,E.minDistance=.01,E.maxDistance=500}static ChangeCamera(e){E.object=e}static get Transformer(){return S}static Select(e){e?S.attach(e):S.detach()}static Update(e){E.update(e)}static FitTo({center:e,radius:t}){const s=a.MathUtils.degToRad(Workspace.Camera.fov),n=t/Math.sin(s/2),i=(new a.Vector3).subVectors(Workspace.Camera.position,e).normalize(),o=e.clone().add(i.multiplyScalar(n)),r=Workspace.Camera.position.clone();E.enabled=!1;const c=E.target.clone(),l=new Tween(c).to(e,1e3).easing(Easing.Quadratic.InOut).onUpdate(()=>{E.target.copy(c),E.getPolarAngle()>E.maxPolarAngle&&E.target.setY(e.y+Math.cos(E.maxPolarAngle)*distance)}).start(),d=new Tween(r).to(o,1e3).easing(Easing.Quadratic.InOut).onUpdate(()=>{Workspace.Camera.position.copy(r);const t=Workspace.Camera.position.distanceTo(e);t<E.minDistance?Workspace.Camera.position.copy(e.clone().add(i.clone().multiplyScalar(E.minDistance))):t>E.maxDistance&&Workspace.Camera.position.copy(e.clone().add(i.clone().multiplyScalar(E.maxDistance))),Workspace.Camera.updateProjectionMatrix(),E.update()}).onComplete(()=>{E.enabled=!0,tweengroup.remove(d,l)}).start();tweengroup.add(d,l)}},A=new a.Raycaster,P=new i.A;let D,k,R,j,O=0,B=0;const G={x:0,y:0};let W,I=!1,T=0,F=null,_=!1,V=.03,L=.03,U=.01,z=.01,Y=window.innerWidth/2,q=window.innerHeight/2;function X(e){if(I&&(O=(e.clientX-Y)*U,B=(e.clientY-q)*z,Date.now()-T>50)){T=Date.now();const t=e.target.getBoundingClientRect(),s=new a.Vector2((e.clientX-t.left)/t.width*2-1,-(e.clientY-t.top)/t.height*2+1);A.setFromCamera(s,k);const n=A.intersectObjects(D.children,!0);let i=null;if(n.length>0)for(let e=0;e<n.length;e++){const t=x(n[e].object);if(t&&t.visible){i=t;break}}if(_){if(!F||i&&i===F){if(i===F)return}else if(P.emit("mouse.out",F),F=null,_=!1,i)return F=i,P.emit("mouse.in",F),void(_=!0)}else i&&(F=i,P.emit("mouse.in",F),_=!0)}}function $(e){G.x=e.clientX,G.y=e.clientY,W=Date.now()}function H(e){if(!I||Me.Processed)return;if(Math.abs(G.x-e.clientX)>10||Math.abs(G.y-e.clientY)>10||Date.now()-W>500)return;const t=e.clientX/window.innerWidth,s=-e.clientY/window.innerHeight,n=new a.Vector2;n.x=2*t-1,n.y=2*s+1,A.setFromCamera(n,k);const i=A.intersectObjects(D.children,!0);if(0===i.length)return;const o=[];for(let e=0;e<i.length;e++){const t=x(i[e].object);if(t.visible&&!o.includes(t))return o.push(t),void P.emit("click",t)}}const Q=new Proxy(class{static get Control(){return C}static Init(e,t,s,a,n){const i={camera:{range:{x:.01,y:.01},movespeed:{x:.03,y:.03}},...n};D=a,R=s,k=t,j=e,V=i.camera.movespeed.x,L=i.camera.movespeed.y,U=i.camera.range.x,z=i.camera.range.y,Y=window.innerWidth/2,q=window.innerHeight/2,e.addEventListener("click",H.bind(null)),e.addEventListener("mousemove",X,!1),e.addEventListener("mousedown",$,!1),I=!0}static Update(e){}static SetCamera(e){k=e}},{get:(e,t)=>t in e?e[t]:P[t]}),N={visible:async function(e,t,s){let a=t;if(e.paths)for(let t=0;t<e.paths.length;t++)a=a[e.paths[t]];if(e.target)for(let t=0;t<e.target.length;t++)a=a.children.find(s=>s.uid===e.target[t]);a.visible=e.value,a.dispatchEvent({target:a,type:"visible",value:a.visible})},propset:function(e,t,s){let a=t;for(let t=0;t<e.paths.length;t++)a=a[e.paths[t]];a[e.property]=e.value}},Z={cameraSet:{uid:"cameraSet",type:"func",handler:N.func,paths:["model"],method:"activate",values:{}},visibleSet:{uid:"visibleSet",type:"visible",handler:N.visible,paths:[]},propset:{uid:"propset",type:"propset",handler:N.propset}};async function J(e,t){const s=Z[e.uid];await s.handler({...s,...e},t,!1),e.actions&&await K(e.actions,t)}async function K(e,t){const s=[];for(const a of e)s.push(J(a,t));await Promise.all(s)}class ee{static get Library(){return Z}static Init(e){for(let t=0;t<e.length;t++)ee.Add(e[t])}static Add(e){e.handler=N[e.type],Z[e.uid]=e}static GetAction(e){return N[e]}static RegisterAction(e,t){N[e]=t,Object.values(Z).forEach(t=>{t.type===e&&(t.handler=N[t.type])})}static async Run(e=[],t,s){const a=e.filter(e=>e.hook===s);0!==a.length&&await K(a,t)}static async Execute(e,t){const s=[];for(let a=0;a<e.length;a++){const n=e[a],i=n.actions?n.actions.filter(e=>e.hook===t):[],o=n.model.actions?n.model.actions.filter(e=>e.hook===t):[];(i.length>0||o.length>0)&&s.push(K([...i,...o],n))}await Promise.all(s)}}const te=ee;let se,ae,ne,ie,oe,re,ce,le=[];const de=new i.A,he=[];function ue(e){for(let t=0;t<le.length;t++)le[t](e);ie.render(ne,re)}class me{static get Block(){return he}static get Root(){return oe}static get Scene(){return ne}static get Camera(){return re}static get Canvas(){return se}static get Renderer(){return ie}static Init(e){se=e,ae=new a.Clock,ne=new a.Scene,ie=new a.WebGLRenderer({canvas:e,alpha:!0,powerPreference:"high-performance",antialias:!0,stencil:!1});const t=se.clientWidth,s=se.clientHeight;ie.setSize(t,s,!1),ie.setPixelRatio(window.devicePixelRatio),ie.shadowMap.enabled=!0,ie.shadowMap.type=a.PCFSoftShadowMap,oe=new a.Object3D,ne.add(oe),ce=oe.position.clone()}static async Start(){re=new a.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.01,1e3),re.uid="EditorCamera",ne.add(re),re.position.set(0,10,20),ie.setAnimationLoop(ue),re.layers.enable(1),Q.Init(ie.domElement,re,ne,oe),Q.on("click",e=>{te.Run([...e.actions,...e.state?.actions||[]],e,"mouse.click")}),Q.on("mouse.in",e=>{te.Run([...e.actions,...e.state?.actions||[]],e,"mouse.in")}),Q.on("mouse.out",e=>{te.Run([...e.actions,...e.state?.actions||[]],e,"mouse.out")}),le.push(Q.Update)}static AddToUpdate(e){le.push(e)}static RemoveFromUpdate(e){const t=le.indexOf(e);t>=0&&le.splice(t,1)}static Collect(e,t,s=[]){for(let a=0;a<e.length;a++){const n=e[a];n.isElement&&n.states[t]&&s.push(n),n.children.length&&me.Collect(n.children,t,s)}}static FindStates(e){const t=[];return me.Collect(he,e,t),t}static Find(e){let t={children:he};for(let s=0;s<e.length;s++)t=t.children.find(t=>t.uid===e[s]);return t}static SetCamera(e){re.visible=!1,re=e,re.aspect=window.innerWidth/window.innerHeight,re.updateProjectionMatrix(),re.visible=!0,Q.SetCamera(re)}static async Builds(e){await b.BuildElements(e,oe),he.push(...oe.children),console.log(oe)}static FindBlock(e){return he.find(t=>t.uid===e)}static FindElement(e){let t=he.find(t=>t.uid===e[0]);for(let s=1;s<e.length;s++)t=t.children.find(t=>t.uid===e[s]);return t}static async SetAsset(e,t){const s=await m.GetAsset({uid:t.uid}),a=e.split(".");let n=he.find(e=>e.uid===a[0]);for(let e=1;e<a.length;e++)n=n.children.find(t=>t.uid===a[e]);n.addAsset(t,s)}static RemoveAsset(e,t){const s=e.split(".");let a=he.find(e=>e.uid===s[0]);for(let e=1;e<s.length;e++)a=a.children.find(t=>t.uid===s[e]);a.removeAsset(t)}static RemoveElement(e){const t=e.split(".");let s=he;for(let e=0;e<t.length-1;e++){const a=s.find(s=>s.uid===t[e]);s=a.children}const a=s.findIndex(t=>t.path===e);if(a>=0){const e=s.splice(a,1);e[0].parent.remove(e[0])}}}const pe=new Proxy(me,{get:(e,t)=>t in e?e[t]:de[t]});window.Project=pe;const fe=pe,ge=[],ye=[];let we,ve=!1;const be=new i.A;class xe{static get Processed(){return ve}static get Current(){return we}static AddSlides(e){for(let t=0;t<e.length;t++){const s={name:"",children:[],camera:{},scene:{},actions:[],...e[t]},a=fe.FindStates(s.uid);for(let e=0;e<a.length;e++){const t=a[e];s.children.push({model:t,...t.states[s.uid]})}ge.push(s)}return be.emit("add",ge),ge}static async GoTo(e){const t="number"==typeof e?ge[e]:ge.find(t=>t.uid===e);t&&we?.uid!==t.uid&&(ye[ye.length-1]!==t.uid&&ye.push(t.uid),await xe.Activate(t,we))}static async GoToNext(){const e=ge.findIndex(e=>e===we);await xe.GoTo(e+1)}static async GoToBack(){ye.pop(),await xe.GoTo(ye[ye.length-1])}static async Activate(e,t){ve||(ve=!0,t?(await xe.SlideOut(t,e.children),be.emit("activate",e,t),await xe.SlideIn(e,t.children)):(be.emit("activate",e,t),await xe.SlideIn(e)),we=e,be.emit("change",e,t),ve=!1)}static async SlideIn(e,t=[]){const s=[],a=[],n=[];for(let a=0;a<e.children.length;a++){const i=e.children[a];t.findIndex(e=>e.model.uid===i.model.uid)>=0?n.push(i):s.push(i)}for(let s=0;s<t.length;s++){const n=t[s];e.children.findIndex(e=>e.model.uid===n.model.uid)<0&&a.push(n)}try{if(e.camera?.path&&e.camera?.path!==fe.Camera?.path){const t=e.camera.path.split("."),s=fe.Find(t);fe.SetCamera(s),s.updateProjectionMatrix()}}catch(e){console.warn(e.message)}try{if(e.scene.background.uid){const t=AssetsManager.GetAsset(e.scene.background.uid);fe.Scene.background=t.resource}}catch(e){console.warn(e.message)}const i=[...s,...n];await Promise.all([te.Execute(i,"slide.in.before"),te.Run(e.actions,e,"slide.in.before")]),await te.Execute(s,"enable.on"),await Promise.all([te.Execute(i,"slide.in"),te.Run(e.actions,e,"slide.in")]);const o=i.map(t=>xe.ActivateState(t,e.uid));await Promise.all(o),await Promise.all([te.Execute(i,"slide.in.after"),te.Run(e.actions,e,"slide.in.after")])}static async ActivateState(e,t){const{position:s,rotation:a,scale:n,actions:i=[],model:o,properties:r={},store:c={},...l}=e;o.state=e,s&&o.position.copy(s),a&&o.rotation.setFromVector3(a,"XYZ"),n&&o.scale.copy(n);const d=Object.keys(l);for(let e=0;e<d.length;e++){const t=d[e],s=t.split("."),a=l[t];let n=s[0],i=o;for(let e=0;e<s.length-1;e++)i=i[s[e]],n=s[e+1];const r=await b.CreateElement(a);i[n]=r}"visible"in l||(o.visible=!0)}static async SlideOut(e,t){const s=[],a=[];for(let n=0;n<e.children.length;n++){const i=e.children[n],o=t.find(e=>e.model.uid===i.model.uid);o&&"visible"in o&&o.visible?s.push(i):a.push(i)}const n=[...a,...s];await Promise.all([te.Execute(n,"slide.out"),te.Run(e.actions,e,"slide.out")]),await te.Execute(a,"disable.on");for(let t=0;t<a.length;t++)xe.DectivateState(a[t],e)}static DectivateState(e,t){e.model.visible=!1}}const Me=new Proxy(xe,{get:(e,t)=>t in e?e[t]:be[t]});let Ee;const Se=new i.A;class Ce{static Init(e,t){Ee=new je({element:e}),Ee.setSize(window.innerWidth,window.innerHeight),Ee.elements.length=0;const s=t.width,a=t.height,n=s/Ee.domElement.offsetWidth,i=a/Ee.domElement.offsetHeight;Ee.domElement.style.transform=`scale(${n}, ${i})`,fe.AddToUpdate(Ce.Render)}static Render(){Ee.render(fe.Scene,fe.Camera)}static async OnCreate(e,t,s){if(e.isUIElement){e.on("click",()=>{te.Run([...e.actions||[],...e.states[s.actived.uid]?.actions||[]],e,"mouse.click")});try{const s=await t.addElement(e.data.element.component||"UILabel",{data:{...e.data.element,path:e.path},events:e.data.events||{}});e.setElement(s.data,s.element)}catch(e){return}Ee.elements.push(e)}}}const Ae=new a.Vector3,Pe=new a.Matrix4,De=new a.Matrix4,ke=new a.Vector3,Re=new a.Vector3;class je{constructor(e={}){const t=this;let s,a,n,i;const o={objects:new WeakMap},r=void 0!==e.element?e.element:document.createElement("div");function c(e,s,a){Ae.setFromMatrixPosition(e.matrixWorld),Ae.applyMatrix4(De);const c=Ae.z>=-1&&Ae.z<=1&&!0===e.layers.test(a.layers),l=e.element;!0===c&&(e.onBeforeRender(t,s,a),l.style.transform=`translate(${-100*e.center.x}%, ${-100*e.center.y}%) translate(${Ae.x*n+n}px, ${-Ae.y*i+i}px)`,l.parentNode!==r&&r.appendChild(l),e.onAfterRender(t,s,a));const d={distanceToCameraSquared:(h=a,u=e,ke.setFromMatrixPosition(h.matrixWorld),Re.setFromMatrixPosition(u.matrixWorld),ke.distanceToSquared(Re))};var h,u;o.objects.set(e,d);for(let t=0,s=e.children.length;t<s;t++);}r.style.overflow="hidden",this.domElement=r,this.elements=[],this.getSize=function(){return{width:s,height:a}},this.render=function(e,t){!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),Pe.copy(t.matrixWorldInverse),De.multiplyMatrices(t.projectionMatrix,Pe);for(let s=0;s<this.elements.length;s++)c(this.elements[s],e,t);!function(e){const t=function(e){const t=[];for(let s=e.length-1;s>=0;s--)e[s].traverseVisible(function(e){e.isCSS2DObject&&t.push(e)});return t}(e).sort(function(e,t){return e.renderOrder!==t.renderOrder?t.renderOrder-e.renderOrder:o.objects.get(e).distanceToCameraSquared-o.objects.get(t).distanceToCameraSquared}),s=t.length;for(let e=0,a=t.length;e<a;e++)t[e].element.style.zIndex=s-e}(this.elements)},this.setSize=function(e,t){s=e,a=t,n=s/2,i=a/2,r.style.width=e+"px",r.style.height=t+"px"}}}const Oe=new Proxy(Ce,{get:(e,t)=>t in e?e[t]:Se[t]})},614:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});var a=s(30);class n extends a.default{constructor(e){super(e),this.isModel=!0,this.type="model"}setAssets(e,t){for(let s=0;s<t.length;s++)this.add(...e.map(e=>e.resource.clone()))}removeAsset(e){const t=this.children.find(t=>t.uid===e);t&&this.remove(t)}addAsset(e,t){t.position.copy(e.transform?.position||{x:0,y:0,z:0}),t.rotation.setFromVector3(e.transform?.rotation||{x:0,y:0,z:0},"XYZ"),t.scale.copy(e.transform?.scale||{x:1,y:1,z:1}),e.transform?.quaternion&&t.quaternion.copy(e.transform?.quaternion),t.traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0,e.geometry.computeBoundingBox())}),this.add(t)}find(e){const t=e.split(".");let s=this;for(let e=0;e<t.length;e++)s=this.children.find(s=>s.uid===t[e]),list=s.children;return s}}const i=n}}]);